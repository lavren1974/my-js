---
sidebar_position: 19
title: –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ Rust
description: –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ Rust
keywords: [rust]
tags: [rust]
---

# Rust

Hello world!

–î–∞–Ω–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –æ—Å–Ω–æ–≤–∞–Ω–æ –Ω–∞ [Comprehensive Rust](https://google.github.io/comprehensive-rust/index.html) - —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–µ –ø–æ `Rust` –æ—Ç –∫–æ–º–∞–Ω–¥—ã `Android` –≤ `Google` –∏ —Ä–∞—Å—Å—á–∏—Ç–∞–Ω–æ –Ω–∞ –ª—é–¥–µ–π, –∫–æ—Ç–æ—Ä—ã–µ —É–≤–µ—Ä–µ–Ω–Ω–æ –≤–ª–∞–¥–µ—é—Ç –ª—é–±—ã–º —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–º —è–∑—ã–∫–æ–º –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—è. –ï—â–µ —Ä–∞–∑: —ç—Ç–æ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –Ω–µ —Ä–∞—Å—Å—á–∏—Ç–∞–Ω–æ –Ω–∞ —Ç–µ—Ö, –∫—Ç–æ —Ç–æ–ª—å–∫–æ –Ω–∞—á–∏–Ω–∞–µ—Ç –∫–æ–¥–∏—Ç—å üòâ

–ú–∞—Ç–µ—Ä–∏–∞–ª—ã –¥–ª—è –¥–∞–ª—å–Ω–µ–π—à–µ–≥–æ –∏–∑—É—á–µ–Ω–∏—è Rust:

- [–ë–æ–ª—å—à–∞—è —à–ø–∞—Ä–≥–∞–ª–∫–∞ –ø–æ Rust](https://my-js.org/docs/cheatsheet/rust/) (–Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ)
- [–ö–Ω–∏–≥–∞/—É—á–µ–±–Ω–∏–∫ –ø–æ Rust](https://doc.rust-lang.ru/book) (–Ω–∞ —Ä—É—Å—Å–∫–æ–º)
- [rustlings](https://github.com/rust-lang/rustlings)
- [Rust –Ω–∞ –ø—Ä–∏–º–µ—Ä–∞—Ö](https://doc.rust-lang.ru/stable/rust-by-example/) (–Ω–∞ —Ä—É—Å—Å–∫–æ–º)
- [Rust by practice](https://practice.rs/why-exercise.html)
- [–®–∏–∫–∞—Ä–Ω—ã–π –∫—É—Ä—Å –ø–æ Rust](https://github.com/matklad/rust-course)

## Hello, World

__–ß—Ç–æ —Ç–∞–∫–æ–µ Rust?__

`Rust` - —ç—Ç–æ –Ω–æ–≤—ã–π —è–∑—ã–∫ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—è, [—Ä–µ–ª–∏–∑ –ø–µ—Ä–≤–æ–π –≤–µ—Ä—Å–∏–∏ –∫–æ—Ç–æ—Ä–æ–≥–æ —Å–æ—Å—Ç–æ—è–ª—Å—è –≤ 2015 –≥–æ–¥—É](https://blog.rust-lang.org/2015/05/15/Rust-1.0.html):

- `Rust` - —ç—Ç–æ —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–π –∫–æ–º–ø–∏–ª–∏—Ä—É–µ–º—ã–π —è–∑—ã–∫ (–∫–∞–∫ `C++`)
  - `rustc` (–∫–æ–º–ø–∏–ª—è—Ç–æ—Ä `Rust`) –∏—Å–ø–æ–ª—å–∑—É–µ—Ç [LLVM](https://ru.wikipedia.org/wiki/LLVM) –≤ –∫–∞—á–µ—Å—Ç–≤–µ –±—ç–∫—ç–Ω–¥–∞
- `Rust` –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –º–Ω–æ–∂–µ—Å—Ç–≤–æ [–ø–ª–∞—Ç—Ñ–æ—Ä–º –∏ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä](https://doc.rust-lang.org/nightly/rustc/platform-support.html)
  - x86, ARM, WebAssembly...
  - Linux, Mac, Windows...
- `Rust` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—è —à–∏—Ä–æ–∫–æ–≥–æ –¥–∏–∞–ø–∞–∑–æ–Ω–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤
  - –ø—Ä–æ—à–∏–≤–∫–∏ (firmware) –∏ –∑–∞–≥—Ä—É–∑—á–∏–∫–∏ (boot loaders)
  - —É–º–Ω—ã–µ —Ç–µ–ª–µ–≤–∏–∑–æ—Ä—ã
  - –º–æ–±–∏–ª—å–Ω—ã–µ —Ç–µ–ª–µ—Ñ–æ–Ω—ã
  - –Ω–∞—Å—Ç–æ–ª—å–Ω—ã–µ –∫–æ–º–ø—å—é—Ç–µ—Ä—ã
  - —Å–µ—Ä–≤–µ—Ä—ã

–ù–µ–∫–æ—Ç–æ—Ä—ã–µ –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ `Rust`:

- –≤—ã—Å–æ–∫–∞—è –≥–∏–±–∫–æ—Å—Ç—å
- –≤—ã—Å–æ–∫–∏–π —É—Ä–æ–≤–µ–Ω—å –∫–æ–Ω—Ç—Ä–æ–ª—è
- –º–æ–∂–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –¥–ª—è –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—è –æ—á–µ–Ω—å –Ω–∏–∑–∫–æ—É—Ä–æ–≤–Ω–µ–≤—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤, —Ç–∞–∫–∏—Ö –∫–∞–∫ –º–∏–∫—Ä–æ–∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä—ã
- –Ω–µ –∏–º–µ–µ—Ç —Å—Ä–µ–¥—ã –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∏–ª–∏ —Å–±–æ—Ä–∫–∏ –º—É—Å–æ—Ä–∞
- —Ñ–æ–∫—É—Å –Ω–∞ –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç–∏ –∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –±–µ–∑ —É—â–µ—Ä–±–∞ –¥–ª—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

__Hello, World__

–†–∞—Å—Å–º–æ—Ç—Ä–∏–º –ø—Ä–æ—Å—Ç–µ–π—à—É—é –ø—Ä–æ–≥—Ä–∞–º–º—É –Ω–∞ `Rust`:

```rust
fn main() {
    println!("–ü—Ä–∏–≤–µ—Ç üåç!");
}
```

–í–æ—Ç —á—Ç–æ –º—ã –∑–¥–µ—Å—å –≤–∏–¥–∏–º:

- —Ñ—É–Ω–∫—Ü–∏–∏ –æ–ø—Ä–µ–¥–µ–ª—è—é—Ç—Å—è —Å –ø–æ–º–æ—â—å—é `fn`
- –±–ª–æ–∫–∏ –∫–æ–¥–∞ –≤—ã–¥–µ–ª—è—é—Ç—Å—è —Ñ–∏–≥—É—Ä–Ω—ã–º–∏ —Å–∫–æ–±–∫–∞–º–∏
- —Ñ—É–Ω–∫—Ü–∏—è `main()` - —ç—Ç–æ –≤—Ö–æ–¥–Ω–∞—è —Ç–æ—á–∫–∞ –ø—Ä–æ–≥—Ä–∞–º–º—ã
- `Rust` –∏–º–µ–µ—Ç –≥–∏–≥–∏–µ–Ω–∏—á–µ—Å–∫–∏–µ –º–∞–∫—Ä–æ—Å—ã, —Ç–∞–∫–∏–µ –∫–∞–∫ `println!()`
- —Å—Ç—Ä–æ–∫–∏ –≤ `Rust` –∫–æ–¥–∏—Ä—É—é—Ç—Å—è –≤ UTF-8 –∏ –º–æ–≥—É—Ç —Å–æ–¥–µ—Ä–∂–∞—Ç—å –ª—é–±–æ–π —Å–∏–º–≤–æ–ª –Æ–Ω–∏–∫–æ–¥–∞

–†–µ–º–∞—Ä–∫–∏:

- `Rust` –æ—á–µ–Ω—å –ø–æ—Ö–æ–∂ –Ω–∞ —Ç–∞–∫–∏–µ —è–∑—ã–∫–∏, –∫–∞–∫ `C`/`C++`/`Java`. –û–Ω —è–≤–ª—è–µ—Ç—Å—è –∏–º–ø–µ—Ä–∞—Ç–∏–≤–Ω—ã–º –∏ –Ω–µ –∏–∑–æ–±—Ä–µ—Ç–∞–µ—Ç "–≤–µ–ª–æ—Å–∏–ø–µ–¥—ã" –±–µ–∑ –∫—Ä–∞–π–Ω–µ–π –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏
- `Rust` —è–≤–ª—è–µ—Ç—Å—è —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–º: –ø–æ–ª–Ω–æ—Å—Ç—å—é –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Ç–∞–∫–∏–µ –≤–µ—â–∏, –∫–∞–∫ –Æ–Ω–∏–∫–æ–¥ (Unicode)
- `Rust` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –º–∞–∫—Ä–æ—Å—ã (macros) –¥–ª—è —Å–∏—Ç—É–∞—Ü–∏–π, –∫–æ–≥–¥–∞ —Ñ—É–Ω–∫—Ü–∏—è –ø—Ä–∏–Ω–∏–º–∞–µ—Ç —Ä–∞–∑–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ (–Ω–µ –ø—É—Ç–∞—Ç—å —Å –ø–µ—Ä–µ–≥—Ä—É–∑–∫–æ–π —Ñ—É–Ω–∫—Ü–∏–∏ (function overloading))
- –º–∞–∫—Ä–æ—Å—ã —è–≤–ª—è—é—Ç—Å—è "–≥–∏–≥–∏–µ–Ω–∏—á–µ—Å–∫–∏–º–∏" - –æ–Ω–∏ –Ω–µ –ø–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞—é—Ç —Å–ª—É—á–∞–π–Ω–æ –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä—ã –∏–∑ –æ–±–ª–∞—Å—Ç–∏ –≤–∏–¥–∏–º–æ—Å—Ç–∏, –≤ –∫–æ—Ç–æ—Ä–æ–π –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è. –ù–∞ —Å–∞–º–æ–º –¥–µ–ª–µ, –º–∞–∫—Ä–æ—Å—ã `Rust` —Ç–æ–ª—å–∫–æ [—á–∞—Å—Ç–∏—á–Ω–æ](https://veykril.github.io/tlborm/decl-macros/minutiae/hygiene.html) —è–≤–ª—è—é—Ç—Å—è –≥–∏–≥–∏–µ–Ω–∏—á–µ—Å–∫–∏–º–∏
- `Rust` —è–≤–ª—è–µ—Ç—Å—è –º—É–ª—å—Ç–∏–ø–∞—Ä–∞–¥–∏–≥–º–µ–Ω–Ω—ã–º —è–∑—ã–∫–æ–º. –û–Ω –∏–º–µ–µ—Ç –º–æ—â–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –û–û–ü –∏ –≤–∫–ª—é—á–∞–µ—Ç –ø–µ—Ä–µ—á–µ–Ω—å —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã—Ö –∫–æ–Ω—Ü–µ–ø—Ü–∏–π

__–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ Rust__

–ù–µ–∫–æ—Ç–æ—Ä—ã–µ —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ `Rust`:

- –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –ø–∞–º—è—Ç–∏ –≤–æ –≤—Ä–µ–º—è –∫–æ–º–ø–∏–ª—è—Ü–∏–∏ - –≤–µ—Å—å –∫–ª–∞—Å—Å –ø—Ä–æ–±–ª–µ–º —Å –ø–∞–º—è—Ç—å—é –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç—Å—è –≤–æ –≤—Ä–µ–º—è –∫–æ–º–ø–∏–ª—è—Ü–∏–∏
  - –Ω–µ–∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
  - –¥–≤–æ–π–Ω–æ–µ –æ—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏–µ (double-frees)
  - –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–æ—Å–ª–µ –æ—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏—è (use-after-free)
  - –Ω—É–ª–µ–≤—ã–µ —É–∫–∞–∑–∞—Ç–µ–ª–∏ (`NULL` pointers)
  - –∑–∞–±—ã—Ç—ã–µ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –º—å—é—Ç–µ–∫—Å—ã (mutexes)
  - –≥–æ–Ω–∫–∏ –¥–∞–Ω–Ω—ã—Ö –º–µ–∂–¥—É –ø–æ—Ç–æ–∫–∞–º–∏ (threads)
  - –∏–Ω–≤–∞–ª–∏–¥–∞—Ü–∏—è –∏—Ç–µ—Ä–∞—Ç–æ—Ä–∞
- –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –Ω–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–≥–æ –ø–æ–≤–µ–¥–µ–Ω–∏—è –≤–æ –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è - —Ç–æ, —á—Ç–æ –¥–µ–ª–∞–µ—Ç –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è `Rust`, –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ –æ—Å—Ç–∞–µ—Ç—Å—è –Ω–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–º
  - –ø—Ä–æ–≤–µ—Ä—è—é—Ç—Å—è –≥—Ä–∞–Ω–∏—Ü—ã –¥–æ—Å—Ç—É–ø–∞ (index boundaries) –∫ –º–∞—Å—Å–∏–≤—É
  - –ø–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω–∏–µ (overflowing) —Ü–µ–ª—ã—Ö —á–∏—Å–µ–ª –ø—Ä–∏–≤–æ–¥–∏—Ç –∫ –ø–∞–Ω–∏–∫–µ –∏–ª–∏ –æ–±–æ—Ä–∞—á–∏–≤–∞–Ω–∏—é (wrapping)
- —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ - —Å—Ç–æ–ª—å –∂–µ –≤—ã—Ä–∞–∑–∏—Ç–µ–ª—å–Ω—ã–µ –∏ —ç—Ä–≥–æ–Ω–æ–º–∏—á–Ω—ã–µ, –∫–∞–∫ –≤ –≤—ã—Å–æ–∫–æ—É—Ä–æ–≤–Ω–µ–≤—ã—Ö —è–∑—ã–∫–∞—Ö
  - –ø–µ—Ä–µ—á–∏—Å–ª–µ–Ω–∏—è –∏ —Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ —Å –æ–±—Ä–∞–∑—Ü–æ–º (matching)
  - –¥–∂–µ–Ω–µ—Ä–∏–∫–∏ (generics)
  - –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –≤–Ω–µ—à–Ω–∏—Ö —Ñ—É–Ω–∫—Ü–∏–π (foreign function interface, FFI) –±–µ–∑ –Ω–∞–∫–ª–∞–¥–Ω—ã—Ö —Ä–∞—Å—Ö–æ–¥–æ–≤
  - –±–µ—Å–ø–ª–∞—Ç–Ω—ã–µ –∞–±—Å—Ç—Ä–∞–∫—Ü–∏–∏
  - –æ—Ç–ª–∏—á–Ω—ã–µ –æ—à–∏–±–∫–∏ –∫–æ–º–ø–∏–ª—è—Ç–æ—Ä–∞
  - –≤—Å—Ç—Ä–æ–µ–Ω–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è–º–∏
  - –≤—Å—Ç—Ä–æ–µ–Ω–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
  - –ø—Ä–µ–≤–æ—Å—Ö–æ–¥–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –ø—Ä–æ—Ç–æ–∫–æ–ª–∞ —è–∑—ã–∫–æ–≤–æ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞ (Language Server Protocol)

__–ü–µ—Å–æ—á–Ω–∏—Ü–∞__

[–ü–µ—Å–æ—á–Ω–∏—Ü–∞ `Rust`](https://play.rust-lang.org/) –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –ª–µ–≥–∫–∏–π —Å–ø–æ—Å–æ–± –±—ã—Å—Ç—Ä–æ –∑–∞–ø—É—Å–∫–∞—Ç—å –∫–æ—Ä–æ—Ç–∫–∏–µ –ø—Ä–æ–≥—Ä–∞–º–º—ã `Rust`.

## –¢–∏–ø—ã –∏ –∑–Ω–∞—á–µ–Ω–∏—è

__–ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ__

–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å —Ç–∏–ø–æ–≤ –≤ `Rust` –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç—Å—è –∑–∞ —Å—á–µ—Ç —Å—Ç–∞—Ç–∏—á–µ—Å–∫–æ–π —Ç–∏–ø–∏–∑–∞—Ü–∏–∏. –ü—Ä–∏–≤—è–∑–∫–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö (variable bindings) –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è —Å –ø–æ–º–æ—â—å—é `let`:

```rust
fn main() {
    let x: i32 = 10;
    println!("x: {x}");
    // x = 20;
    // println!("x: {x}");
}
```

- –†–∞—Å–∫–æ–º–º–µ–Ω—Ç–∏—Ä—É–π—Ç–µ `x = 20`, —á—Ç–æ–±—ã —É–≤–∏–¥–µ—Ç—å, —á—Ç–æ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é —è–≤–ª—è—é—Ç—Å—è –∏–º–º—É—Ç–∞–±–µ–ª—å–Ω—ã–º–∏ (–Ω–µ–∏–∑–º–µ–Ω–Ω—ã–º–∏/–Ω–µ–∏–∑–º–µ–Ω—è–µ–º—ã–º–∏). –î–æ–±–∞–≤—å—Ç–µ –∫–ª—é—á–µ–≤–æ–µ —Å–ª–æ–≤–æ `mut` –ø–æ—Å–ª–µ `let`, —á—Ç–æ–±—ã —Å–¥–µ–ª–∞—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –º—É—Ç–∞–±–µ–ª—å–Ω–æ–π
- `i32` - —ç—Ç–æ —Ç–∏–ø –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π. –¢–∏–ø –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –∏–∑–≤–µ—Å—Ç–µ–Ω –≤–æ –≤—Ä–µ–º—è –∫–æ–º–ø–∏–ª—è—Ü–∏–∏, –Ω–æ –≤—ã–≤–µ–¥–µ–Ω–∏–µ —Ç–∏–ø–æ–≤ (—Ä–∞—Å—Å–º–∞—Ç—Ä–∏–≤–∞–µ–º–æ–µ –ø–æ–∑–∂–µ) –ø–æ–∑–≤–æ–ª—è–µ—Ç —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞–º –æ–ø—É—Å–∫–∞—Ç—å —Ç–∏–ø—ã –≤–æ –º–Ω–æ–≥–∏—Ö —Å–ª—É—á–∞—è—Ö

__–ó–Ω–∞—á–µ–Ω–∏—è__

–í–æ—Ç –Ω–µ–∫–æ—Ç–æ—Ä—ã–µ –±–∞–∑–æ–≤—ã–µ –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ —Ç–∏–ø—ã –∏ —Å–∏–Ω—Ç–∞–∫—Å–∏—Å –ª–∏—Ç–µ—Ä–∞–ª—å–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π –∫–∞–∂–¥–æ–≥–æ —Ç–∏–ø–∞:

||–¢–∏–ø—ã|–õ–∏—Ç–µ—Ä–∞–ª—ã|
|---|---|---|
|–¶–µ–ª—ã–µ —á–∏—Å–ª–∞ —Å–æ –∑–Ω–∞–∫–æ–º|i8, i16, i32, i64, i128, isize|-10, 0, 1_000, 123_i64|
|–¶–µ–ª—ã–µ —á–∏—Å–ª–∞ –±–µ–∑ –∑–Ω–∞–∫–∞|u8, u16, u32, u64, u128, usize|0, 123, 10_u16|
|–ß–∏—Å–ª–∞ —Å –ø–ª–∞–≤–∞—é—â–µ–π —Ç–æ—á–∫–æ–π|f32, f64|3.14, -10.0e20, 2_f32|
|–°–∫–∞–ª—è—Ä–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –Æ–Ω–∏–∫–æ–¥–∞|char|'a', 'Œ±', '‚àû'|
|–õ–æ–≥–∏—á–µ—Å–∫–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è|bool|true,false|

–¢–∏–ø—ã –∏–º–µ—é—Ç —Å–ª–µ–¥—É—é—â–∏–µ —Ä–∞–∑–º–µ—Ä—ã:

- `iN`, `uN` –∏ `fN` - `N` –±–∏—Ç
- `isize` –∏ `usize` - —Ä–∞–∑–º–µ—Ä —É–∫–∞–∑–∞—Ç–µ–ª—è
- `char` - 32 –±–∏—Ç–∞
- `bool` - 8 –±–∏—Ç

- –ù–∏–∂–Ω–∏–µ –ø–æ–¥—á–µ—Ä–∫–∏–≤–∞–Ω–∏—è –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω—ã –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è —á–∏—Ç–∞–µ–º–æ—Å—Ç–∏, –ø–æ—ç—Ç–æ–º—É –∏—Ö –º–æ–∂–Ω–æ –Ω–µ –ø–∏—Å–∞—Ç—å, —Ç.–µ. `1_000` –º–æ–∂–Ω–æ –∑–∞–ø–∏—Å–∞—Ç—å –∫–∞–∫ `1000` (–∏–ª–∏ `10_00`), –∞ `123_i64` –º–æ–∂–Ω–æ –∑–∞–ø–∏—Å–∞—Ç—å –∫–∞–∫ `123i64`

__–ê—Ä–∏—Ñ–º–µ—Ç–∏–∫–∞__

```rust
fn interproduct(a: i32, b: i32, c: i32) -> i32 {
    return a * b + b * c + c * a;
}

fn main() {
    println!("—Ä–µ–∑—É–ª—å—Ç–∞—Ç: {}", interproduct(120, 100, 248));
}
```

–í –∞—Ä–∏—Ñ–º–µ—Ç–∏–∫–µ `Rust` –Ω–µ—Ç –Ω–∏—á–µ–≥–æ –æ—Å–æ–±–µ–Ω–Ω–æ–≥–æ –ø–æ —Å—Ä–∞–≤–Ω–µ–Ω–∏—é —Å –¥—Ä—É–≥–∏–º–∏ —è–∑—ã–∫–∞–º–∏ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—è, –∑–∞ –∏—Å–∫–ª—é—á–µ–Ω–∏–µ–º –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –ø–æ–≤–µ–¥–µ–Ω–∏—è –ø—Ä–∏ –ø–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω–∏–∏ —Ü–µ–ª—ã—Ö —á–∏—Å–µ–ª: –ø—Ä–∏ —Å–±–æ—Ä–∫–µ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –ø—Ä–æ–≥—Ä–∞–º–º–∞ –∑–∞–ø–∞–Ω–∏–∫—É–µ—Ç, –∞ –ø—Ä–∏ —Ä–µ–ª–∏–∑–Ω–æ–π —Å–±–æ—Ä–∫–µ –ø–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω–∏–µ –±—É–¥–µ—Ç –æ–±–µ—Ä–Ω—É—Ç–æ (wrapped). –ö—Ä–æ–º–µ –ø–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω–∏—è, —Å—É—â–µ—Å—Ç–≤—É–µ—Ç —Ç–∞–∫–∂–µ –Ω–∞—Å—ã—â–µ–Ω–∏–µ (saturating) –∏ –∫–∞—Ä—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ (carrying), –∫–æ—Ç–æ—Ä—ã–µ –æ–±–µ—Å–ø–µ—á–∏–≤–∞—é—Ç—Å—è —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–º–∏ –º–µ—Ç–æ–¥–∞–º–∏, –Ω–∞–ø—Ä–∏–º–µ—Ä, `(a * b).saturating_add(b * c).saturating_add(c * a)`.

__–°—Ç—Ä–æ–∫–∏__

–í `Rust` —Å—É—â–µ—Å—Ç–≤—É–µ—Ç 2 —Ç–∏–ø–∞ –¥–ª—è –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è —Å—Ç—Ä–æ–∫, –æ–±–∞ –±—É–¥—É—Ç –ø–æ–¥—Ä–æ–±–Ω–æ —Ä–∞—Å—Å–º–æ—Ç—Ä–µ–Ω—ã –ø–æ–∑–∂–µ. –û–±–∞ —Ç–∏–ø–∞ –≤—Å–µ–≥–¥–∞ —Ö—Ä–∞–Ω—è—Ç –∑–∞–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –≤ `UTF-8` —Å—Ç—Ä–æ–∫–∏.

- `String` - –º–æ–¥–∏—Ñ–∏—Ü–∏—Ä—É–µ–º–∞—è, —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–∞—è (owned) —Å—Ç—Ä–æ–∫–∞
- `&str` - —Å—Ç—Ä–æ–∫–∞, –¥–æ—Å—Ç—É–ø–Ω–∞—è —Ç–æ–ª—å–∫–æ –¥–ª—è —á—Ç–µ–Ω–∏—è. –°—Ç—Ä–æ–∫–æ–≤—ã–µ –ª–∏—Ç–µ—Ä–∞–ª—ã –∏–º–µ—é—Ç —ç—Ç–æ—Ç —Ç–∏–ø

```rust
fn main() {
    let greeting: &str = "–ü—Ä–∏–≤–µ—Ç";
    let planet: &str = "ü™ê";
    let mut sentence = String::new();
    sentence.push_str(greeting);
    sentence.push_str(", ");
    sentence.push_str(planet);
    println!("–∏—Ç–æ–≥–æ–≤–æ–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ: {}", sentence);
    println!("{:?}", &sentence[0..5]);
    //println!("{:?}", &sentence[12..13]);
}
```

–†–µ–º–∞—Ä–∫–∏:

- –ø–æ–≤–µ–¥–µ–Ω–∏–µ –ø—Ä–∏ –Ω–∞–ª–∏—á–∏–∏ –≤ —Å—Ç—Ä–æ–∫–µ –Ω–µ–≤–∞–ª–∏–¥–Ω—ã—Ö —Å–∏–º–≤–æ–ª–æ–≤ `UTF-8` –≤ `Rust` —è–≤–ª—è–µ—Ç—Å—è –Ω–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–º, –ø–æ—ç—Ç–æ–º—É –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ç–∞–∫–∏—Ö —Å–∏–º–≤–æ–ª–æ–≤ –º–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ –ø–∞–Ω–∏–∫–µ
- `String` - —ç—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π —Ç–∏–ø —Å –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–æ–º (`::new()`) –∏ –º–µ—Ç–æ–¥–∞–º–∏ –≤—Ä–æ–¥–µ `push_str()`
- `&` –≤ `&str` —è–≤–ª—è–µ—Ç—Å—è –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–æ–º —Ç–æ–≥–æ, —á—Ç–æ —ç—Ç–æ —Å—Å—ã–ª–∫–∞. –ú—ã –ø–æ–≥–æ–≤–æ—Ä–∏–º –æ —Å—Å—ã–ª–∫–∞—Ö –ø–æ–∑–∂–µ, –ø–æ–∫–∞ –¥—É–º–∞–π—Ç–µ –æ `&str` –∫–∞–∫ –æ —Å—Ç—Ä–æ–∫–∞—Ö, –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —Ç–æ–ª—å–∫–æ –¥–ª—è —á—Ç–µ–Ω–∏—è
- –∑–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Å—Ç—Ä–æ–∫–∞ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç —Å–æ–±–æ–π –∏–Ω–¥–µ–∫—Å–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Ç—Ä–æ–∫–∏ –ø–æ –ø–æ–∑–∏—Ü–∏—è–º –±–∞–π—Ç. `12..13` –Ω–µ –ø–æ–ø–∞–¥–∞—é—Ç –≤ –≥—Ä–∞–Ω–∏—Ü—ã (boundaries) —Å–∏–º–≤–æ–ª–∞, –ø–æ—ç—Ç–æ–º—É –ø—Ä–æ–≥—Ä–∞–º–º–∞ –ø–∞–Ω–∏–∫—É–µ—Ç. –ò–∑–º–µ–Ω–∏—Ç–µ –¥–∏–∞–ø–∞–∑–æ–Ω –Ω–∞ –æ—Å–Ω–æ–≤–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–µ
- —Å—ã—Ä—ã–µ (raw) —Å—Ç—Ä–æ–∫–∏ –ø–æ–∑–≤–æ–ª—è—é—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å `&str` —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º —ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ–º —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã—Ö —Å–∏–º–≤–æ–ª–æ–≤: `r"\n" == "\\n"`. –î–≤–æ–π–Ω—ã–µ –∫–∞–≤—ã—á–∫–∏ –º–æ–∂–Ω–æ –≤—Å—Ç–∞–≤–∏—Ç—å, –æ–±–µ—Ä–Ω—É–≤ —Å—Ç—Ä–æ–∫—É –≤ –æ–¥–∏–Ω–∞–∫–æ–≤–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ `#` —Å –æ–±–µ–∏—Ö —Å—Ç–æ—Ä–æ–Ω:

```rust
fn main() {
    // –°—ã—Ä–∞—è —Å—Ç—Ä–æ–∫–∞
    println!(r#"<a href="link.html">—Å—Å—ã–ª–∫–∞</a>"#); // "<a href="link.html">—Å—Å—ã–ª–∫–∞</a>"
    // –≠–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ
    println!("<a href=\"link.html\">—Å—Å—ã–ª–∫–∞</a>"); // <a href="link.html">—Å—Å—ã–ª–∫–∞</a>
}
```

__–í—ã–≤–µ–¥–µ–Ω–∏–µ —Ç–∏–ø–æ–≤__

–î–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è/–≤—ã–≤–µ–¥–µ–Ω–∏—è —Ç–∏–ø–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π `Rust` "—Å–º–æ—Ç—Ä–∏—Ç" –Ω–∞ —Ç–æ, –∫–∞–∫ –æ–Ω–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è:

```rust
fn takes_u32(x: u32) {
    println!("u32: {x}");
}

fn takes_i8(y: i8) {
    println!("i8: {y}");
}

fn main() {
    let x = 10;
    let y = 20;

    takes_u32(x);
    takes_i8(y);
    // takes_u32(y);
}
```

–î–µ—Ñ–æ–ª—Ç–Ω—ã–º —Ü–µ–ª–æ—á–∏—Å–ª–µ–Ω–Ω—ã–º —Ç–∏–ø–æ–º —è–≤–ª—è–µ—Ç—Å—è `i32` (`{integer}` –≤ —Å–æ–æ–±—â–µ–Ω–∏—è—Ö –æ–± –æ—à–∏–±–∫–∞—Ö), –∞ –¥–µ—Ñ–æ–ª—Ç–Ω—ã–º "–ø–ª–∞–≤–∞—é—â–∏–º" —Ç–∏–ø–æ–º - `f64` (`{float}` –≤ —Å–æ–æ–±—â–µ–Ω–∏—è—Ö –æ–± –æ—à–∏–±–∫–∞—Ö).

```rust
fn main() {
    let x = 3.14;
    let y = 20;
    assert_eq!(x, y);
    // ERROR: no implementation for `{float} == {integer}`
    // –¶–µ–ª—ã–µ —á–∏—Å–ª–∞ –∏ —á–∏—Å–ª–∞ —Å –ø–ª–∞–≤–∞—é—â–µ–π —Ç–æ—á–∫–æ–π –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é —Å—Ä–∞–≤–Ω–∏–≤–∞—Ç—å –º–µ–∂–¥—É —Å–æ–±–æ–π –Ω–µ–ª—å–∑—è
}
```

__–£–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ: –§–∏–±–æ–Ω–∞—á—á–∏__

–ü–µ—Ä–≤–æ–µ –∏ –≤—Ç–æ—Ä–æ–µ —á–∏—Å–ª–∞ –§–∏–±–æ–Ω–∞—á—á–∏ - `1`. –î–ª—è `n > 2` `nth` (–∏—Ç–æ–µ) —á–∏—Å–ª–æ –§–∏–±–æ–Ω–∞—á—á–∏ –≤—ã—á–∏—Å–ª—è–µ—Ç—Å—è —Ä–µ–∫—É—Ä—Å–∏–≤–Ω–æ –∫–∞–∫ —Å—É–º–º–∞ `n - 1` –∏ `n - 2` —á–∏—Å–µ–ª –§–∏–±–æ–Ω–∞—á—á–∏.

–ù–∞–ø–∏—à–∏—Ç–µ —Ñ—É–Ω–∫—Ü–∏—é `fib(n)`, –∫–æ—Ç–æ—Ä–∞—è –≤—ã—á–∏—Å–ª—è–µ—Ç `nth-—á–∏—Å–ª–æ` –§–∏–±–æ–Ω–∞—á—á–∏.

```rust
fn fib(n: u32) -> u32 {
    if n <= 2 {
        // –ë–∞–∑–æ–≤—ã–π —Å–ª—É—á–∞–π
        todo!("—Ä–µ–∞–ª–∏–∑—É–π –º–µ–Ω—è")
    } else {
        // –†–µ–∫—É—Ä—Å–∏—è
        todo!("—Ä–µ–∞–ª–∏–∑—É–π –º–µ–Ω—è")
    }
}

fn main() {
    let n = 20;
    println!("fib(n) = {}", fib(n));
    // –ú–∞–∫—Ä–æ—Å –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –¥–≤—É—Ö –≤—ã—Ä–∞–∂–µ–Ω–∏–π –Ω–∞ —Ä–∞–≤–µ–Ω—Å—Ç–≤–æ.
    // –ù–µ—Ä–∞–≤–µ–Ω—Å—Ç–≤–æ –≤—ã–∑—ã–≤–∞–µ—Ç –ø–∞–Ω–∏–∫—É
    assert_eq!(fib(n), 6765);
}
```

<details>
<summary>–†–µ—à–µ–Ω–∏–µ:</summary>

```rust
fn fib(n: u32) -> u32 {
    if n <= 2 {
        return 1;
    } else {
        return fib(n - 1) + fib(n - 2);
    }
}

fn main() {
    let n = 20;
    println!("fib(n) = {}", fib(n));
    assert_eq!(fib(n), 6765);
}
```

</details>

## –ü–æ—Ç–æ–∫ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è

__–£—Å–ª–æ–≤–∏—è__

–ë–æ–ª—å—à–∞—è —á–∞—Å—Ç—å —Å–∏–Ω—Ç–∞–∫—Å–∏—Å–∞ –ø–æ—Ç–æ–∫–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è `Rust` –ø–æ—Ö–æ–∂–∞ –Ω–∞ `C`, `C++` –∏–ª–∏ `Java`:

- –±–ª–æ–∫–∏ —Ä–∞–∑–¥–µ–ª—è—é—Ç—Å—è —Ñ–∏–≥—É—Ä–Ω—ã–º–∏ —Å–∫–æ–±–∫–∞–º–∏
- —Å—Ç—Ä–æ—á–Ω—ã–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –Ω–∞—á–∏–Ω–∞—é—Ç—Å—è —Å `//`, –±–ª–æ—á–Ω—ã–µ - —Ä–∞–∑–¥–µ–ª—è—é—Ç—Å—è `/* ... */`
- –∫–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞ `if` –∏ `while` —Ä–∞–±–æ—Ç–∞—é—Ç, –∫–∞–∫ –æ–∂–∏–¥–∞–µ—Ç—Å—è
- –∑–Ω–∞—á–µ–Ω–∏—è –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º –ø—Ä–∏—Å–≤–∞–∏–≤–∞—é—Ç—Å—è —Å –ø–æ–º–æ—â—å—é `=`, —Å—Ä–∞–≤–Ω–µ–Ω–∏—è –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è —Å –ø–æ–º–æ—â—å—é `==`

_–í—ã—Ä–∞–∂–µ–Ω–∏—è if_

[–í—ã—Ä–∞–∂–µ–Ω–∏—è if](https://doc.rust-lang.org/reference/expressions/if-expr.html#if-expressions) –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –≤ —Ç–æ—á–Ω–æ—Å—Ç–∏, –∫–∞–∫ –≤ –¥—Ä—É–≥–∏—Ö —è–∑—ã–∫–∞—Ö:

```rust
fn main() {
    let x = 10;
    if x < 20 {
        println!("–º–∞–ª–µ–Ω—å–∫–æ–µ");
    } else if x < 100 {
        println!("–±–æ–ª—å—à–µ");
    } else {
        println!("–æ–≥—Ä–æ–º–Ω–æ–µ");
    }
}
```

–ö—Ä–æ–º–µ —Ç–æ–≥–æ, `if` –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–∞–∫ –≤—ã—Ä–∞–∂–µ–Ω–∏–µ, –≤–æ–∑–≤—Ä–∞—â–∞—é—â–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ. –ü–æ—Å–ª–µ–¥–Ω–µ–µ –≤—ã—Ä–∞–∂–µ–Ω–∏–µ –∫–∞–∂–¥–æ–≥–æ –±–ª–æ–∫–∞ —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –∑–Ω–∞—á–µ–Ω–∏–µ–º –≤—ã—Ä–∞–∂–µ–Ω–∏—è `if`:

```rust
fn main() {
    let x = 10;
    let size = if x < 20 { "–º–∞–ª–µ–Ω—å–∫–æ–µ" } else { "–±–æ–ª—å—à–æ–µ" };
    println!("—Ä–∞–∑–º–µ—Ä —á–∏—Å–ª–∞: {}", size);
}
```

–ü–æ—Å–∫–æ–ª—å–∫—É `if` —è–≤–ª—è–µ—Ç—Å—è –≤—ã—Ä–∞–∂–µ–Ω–∏–µ–º –∏ –¥–æ–ª–∂–Ω–æ –∏–º–µ—Ç—å –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–π —Ç–∏–ø, –∑–Ω–∞—á–µ–Ω–∏—è –æ–±–æ–∏—Ö –±–ª–æ–∫–æ–≤ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –æ–¥–Ω–æ–≥–æ —Ç–∏–ø–∞. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –¥–æ–±–∞–≤–∏—Ç—å `;` –ø–æ—Å–ª–µ `–º–∞–ª–µ–Ω—å–∫–æ–µ` –≤–æ –≤—Ç–æ—Ä–æ–º –ø—Ä–∏–º–µ—Ä–µ.

–ü—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ `if` –≤ –∫–∞—á–µ—Å—Ç–≤–µ –≤—ã—Ä–∞–∂–µ–Ω–∏—è, –æ–Ω–æ –¥–æ–ª–∂–Ω–æ –∑–∞–∫–∞–Ω—á–∏–≤–∞—Ç—å—Å—è `;` –¥–ª—è –µ–≥–æ –æ—Ç–¥–µ–ª–µ–Ω–∏—è –æ—Ç —Å–ª–µ–¥—É—é—â–µ–π –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —É–¥–∞–ª–∏—Ç—å `;` –ø–µ—Ä–µ–¥ `println!()`.

__–¶–∏–∫–ª—ã__

`Rust` –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç 3 –∫–ª—é—á–µ–≤—ã—Ö —Å–ª–æ–≤–∞ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Ü–∏–∫–ª–æ–≤: `while`, `loop` –∏ `for`.

_while_

–ö–ª—é—á–µ–≤–æ–µ —Å–ª–æ–≤–æ [while](https://doc.rust-lang.org/reference/expressions/loop-expr.html#predicate-loops) —Ä–∞–±–æ—Ç–∞–µ—Ç, –∫–∞–∫ –≤ –¥—Ä—É–≥–∏—Ö —è–∑—ã–∫–∞—Ö - —Ç–µ–ª–æ —Ü–∏–∫–ª–∞ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è, –ø–æ–∫–∞ —É—Å–ª–æ–≤–∏–µ —è–≤–ª—è–µ—Ç—Å—è –∏—Å—Ç–∏–Ω–Ω—ã–º:

```rust
fn main() {
    let mut x = 200;
    while x >= 10 {
        x = x / 2;
    }
    println!("–∏—Ç–æ–≥–æ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ x: {x}");
}
```

_for_

–¶–∏–∫–ª [for](https://doc.rust-lang.org/std/keyword.for.html) –ø–µ—Ä–µ–±–∏—Ä–∞–µ—Ç –¥–∏–∞–ø–∞–∑–æ–Ω –∑–Ω–∞—á–µ–Ω–∏–π:

```rust
fn main() {
    for x in 1..5 {
        println!("x: {x}");
    }
}
```

_loop_

–¶–∏–∫–ª [loop](https://doc.rust-lang.org/std/keyword.loop.html) –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç—Å—è –¥–æ –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏—è —Å –ø–æ–º–æ—â—å—é `break`:

```rust
fn main() {
    let mut i = 0;
    loop {
        i += 1;
        println!("{i}");
        if i > 100 {
            break;
        }
    }
}
```

- –ú—ã –ø–æ–¥—Ä–æ–±–Ω–æ –æ–±—Å—É–¥–∏–º –∏—Ç–µ—Ä–∞—Ç–æ—Ä—ã –ø–æ–∑–∂–µ
- –æ–±—Ä–∞—Ç–∏—Ç–µ –≤–Ω–∏–º–∞–Ω–∏–µ, —á—Ç–æ —Ü–∏–∫–ª `for` –∏—Ç–µ—Ä–∏—Ä—É–µ—Ç—Å—è –¥–æ 4. –î–ª—è "–≤–∫–ª—é—á–∞—é—â–µ–≥–æ" –¥–∏–∞–ø–∞–∑–æ–Ω–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Å–∏–Ω—Ç–∞–∫—Å–∏—Å `1..=5`

__break –∏ continue__

–ö–ª—é—á–µ–≤–æ–µ —Å–ª–æ–≤–æ [break](https://doc.rust-lang.org/reference/expressions/loop-expr.html#break-expressions) –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è —Ä–∞–Ω–Ω–µ–≥–æ –≤—ã—Ö–æ–¥–∞ (early exit) –∏–∑ —Ü–∏–∫–ª–∞. –î–ª—è `loop` `break` –º–æ–∂–µ—Ç –ø—Ä–∏–Ω–∏–º–∞—Ç—å –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–µ –≤—ã—Ä–∞–∂–µ–Ω–∏–µ, –∫–æ—Ç–æ—Ä–æ–µ —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –∑–Ω–∞—á–µ–Ω–∏–µ–º –≤—ã—Ä–∞–∂–µ–Ω–∏—è `loop`.

–î–ª—è –Ω–µ–∑–∞–º–µ–¥–ª–∏—Ç–µ–ª—å–Ω–æ–≥–æ –ø–µ—Ä–µ—Ö–æ–¥–∞ –∫ —Å–ª–µ–¥—É—é—â–µ–π –∏—Ç–µ—Ä–∞—Ü–∏–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∫–ª—é—á–µ–≤–æ–µ —Å–ª–æ–≤–æ [continue](https://doc.rust-lang.org/reference/expressions/loop-expr.html#continue-expressions).

```rust
fn main() {
    let (mut a, mut b) = (100, 52);
    let result = loop {
        if a == b {
            break a;
        }
        if a < b {
            b -= a;
        } else {
            a -= b;
        }
    };
    println!("{result}");
}
```

`continue` –∏ `break` –º–æ–≥—É—Ç –ø–æ–º–µ—á–∞—Ç—å—Å—è –º–µ—Ç–∫–∞–º–∏ (labels):

```rust
fn main() {
    'outer: for x in 1..5 {
        println!("x: {x}");
        let mut i = 0;
        while i < x {
            println!("x: {x}, i: {i}");
            i += 1;
            if i == 3 {
                break 'outer;
            }
        }
    }
}
```

–í –ø—Ä–∏–º–µ—Ä–µ –º—ã –ø—Ä–µ—Ä—ã–≤–∞–µ–º –≤–Ω–µ—à–Ω–∏–π —Ü–∏–∫–ª –ø–æ—Å–ª–µ 3 –∏—Ç–µ—Ä–∞—Ü–∏–π –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–≥–æ —Ü–∏–∫–ª–∞.

–û–±—Ä–∞—Ç–∏—Ç–µ –≤–Ω–∏–º–∞–Ω–∏–µ, —á—Ç–æ —Ç–æ–ª—å–∫–æ `loop` –º–æ–∂–µ—Ç –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å –∑–Ω–∞—á–µ–Ω–∏—è. –≠—Ç–æ —Å–≤—è–∑–∞–Ω–æ —Å —Ç–µ–º, —á—Ç–æ —Ü–∏–∫–ª `loop` –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–æ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è —Ö–æ—Ç—è –±—ã —Ä–∞–∑ (–≤ –æ—Ç–ª–∏—á–∏–µ –æ—Ç —Ü–∏–∫–ª–æ–≤ `while` –∏ `for`).

__–ë–ª–æ–∫–∏ –∏ –æ–±–ª–∞—Å—Ç–∏ –≤–∏–¥–∏–º–æ—Å—Ç–∏__

_–ë–ª–æ–∫–∏_

–ë–ª–æ–∫ –≤ `Rust` —Å–æ–¥–µ—Ä–∂–∏—Ç –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å –≤—ã—Ä–∞–∂–µ–Ω–∏–π. –£ –∫–∞–∂–¥–æ–≥–æ –±–ª–æ–∫–∞ –µ—Å—Ç—å –∑–Ω–∞—á–µ–Ω–∏–µ –∏ —Ç–∏–ø, —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ –ø–æ—Å–ª–µ–¥–Ω–µ–º—É –≤—ã—Ä–∞–∂–µ–Ω–∏—é –±–ª–æ–∫–∞:

```rust
fn main() {
    let z = 13;
    let x = {
        let y = 10;
        println!("y: {y}");
        z - y
    };
    println!("x: {x}");
}
```

–ï—Å–ª–∏ –ø–æ—Å–ª–µ–¥–Ω–µ–µ –≤—ã—Ä–∞–∂–µ–Ω–∏–µ –∑–∞–∫–∞–Ω—á–∏–≤–∞–µ—Ç—Å—è `;`, —Ä–µ–∑—É–ª—å—Ç–∏—Ä—É—é—â–∏–º –∑–Ω–∞—á–µ–Ω–∏–µ–º –∏ —Ç–∏–ø–æ–º —è–≤–ª—è–µ—Ç—Å—è `()` (–ø—É—Å—Ç–æ–π —Ç–∏–ø/–∫–æ—Ä—Ç–µ–∂ - unit type).

_–û–±–ª–∞—Å—Ç–∏ –≤–∏–¥–∏–º–æ—Å—Ç–∏ –∏ –∑–∞—Ç–µ–Ω–µ–Ω–∏–µ_

–û–±–ª–∞—Å—Ç—å—é –≤–∏–¥–∏–º–æ—Å—Ç–∏ (scope) –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π —è–≤–ª—è–µ—Ç—Å—è –±–ª–∏–∂–∞–π—à–∏–π –∫ –Ω–µ–π –±–ª–æ–∫.

–ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –º–æ–∂–Ω–æ –∑–∞—Ç–µ–Ω—è—Ç—å/–ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª—è—Ç—å (shadow), –∫–∞–∫ –≤–Ω–µ—à–Ω–∏–µ, —Ç–∞–∫ –∏ –∏–∑ —Ç–æ–π –∂–µ –æ–±–ª–∞—Å—Ç–∏ –≤–∏–¥–∏–º–æ—Å—Ç–∏:

```rust
fn main() {
    let a = 10;
    println!("–ø–µ—Ä–µ–¥: {a}");
    {
        let a = "–ø—Ä–∏–≤–µ—Ç";
        println!("–≤–Ω—É—Ç—Ä–µ–Ω–Ω—è—è –æ–±–ª–∞—Å—Ç—å –≤–∏–¥–∏–º–æ—Å—Ç–∏: {a}");

        let a = true;
        println!("–∑–∞—Ç–µ–Ω–µ–Ω–∏–µ –≤–æ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–π –æ–±–ª–∞—Å—Ç–∏ –≤–∏–¥–∏–º–æ—Å—Ç–∏: {a}");
    }

    println!("–ø–æ—Å–ª–µ: {a}");
}
```

- –î–ª—è —Ç–æ–≥–æ, —á—Ç–æ–±—ã —É–±–µ–¥–∏—Ç—å—Å—è –≤ —Ç–æ–º, —á—Ç–æ –æ–±–ª–∞—Å—Ç—å –≤–∏–¥–∏–º–æ—Å—Ç–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∞ —Ñ–∏–≥—É—Ä–Ω—ã–º–∏ —Å–∫–æ–±–∫–∞–º–∏, –¥–æ–±–∞–≤—å—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é `b` –≤–æ –≤–Ω—É—Ç—Ä–µ–Ω–Ω—é—é –æ–±–ª–∞—Å—Ç—å –≤–∏–¥–∏–º–æ—Å—Ç–∏ –∏ –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–ª—É—á–∏—Ç—å –∫ –Ω–µ–π –¥–æ—Å—Ç—É–ø –≤–æ –≤–Ω–µ—à–Ω–µ–π –æ–±–ª–∞—Å—Ç–∏ –≤–∏–¥–∏–º–æ—Å—Ç–∏
- –∑–∞—Ç–µ–Ω–µ–Ω–∏–µ –æ—Ç–ª–∏—á–∞–µ—Ç—Å—è –æ—Ç –º—É—Ç–∞—Ü–∏–∏, –ø–æ—Å–∫–æ–ª—å–∫—É –ø–æ—Å–ª–µ –∑–∞—Ç–µ–Ω–µ–Ω–∏—è –æ–±–µ –ª–æ–∫–∞—Ü–∏–∏ –ø–∞–º—è—Ç–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π —Å—É—â–µ—Å—Ç–≤—É—é—Ç –≤ –æ–¥–Ω–æ –≤—Ä–µ–º—è. –û–±–µ –¥–æ—Å—Ç—É–ø–Ω—ã –ø–æ–¥ –æ–¥–Ω–∏–º –Ω–∞–∑–≤–∞–Ω–∏–µ–º –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤ –∫–æ–¥–µ
- –∑–∞—Ç–µ–Ω—è–µ–º–∞—è –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è –º–æ–∂–µ—Ç –∏–º–µ—Ç—å –¥—Ä—É–≥–æ–π —Ç–∏–ø
- –ø–æ–Ω–∞—á–∞–ª—É –∑–∞—Ç–µ–Ω–µ–Ω–∏–µ –≤—ã–≥–ª—è–¥–∏—Ç –Ω–µ—è—Å–Ω—ã–º, –Ω–æ –æ–Ω–æ —É–¥–æ–±–Ω–æ –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∑–Ω–∞—á–µ–Ω–∏–π –ø–æ—Å–ª–µ `unwrap()` (—Ä–∞—Å–ø–∞–∫–æ–≤–∫–∏)

__–§—É–Ω–∫—Ü–∏–∏__

```rust
fn gcd(a: u32, b: u32) -> u32 {
    if b > 0 {
        gcd(b, a % b)
    } else {
        a
    }
}

fn main() {
    println!("–Ω–∞–∏–±–æ–ª—å—à–∏–π –æ–±—â–∏–π –¥–µ–ª–∏—Ç–µ–ª—å: {}", gcd(143, 52));
}
```

- –¢–∏–ø—ã –æ–ø—Ä–µ–¥–µ–ª—è—é—Ç—Å—è –∫–∞–∫ –¥–ª—è –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤, —Ç–∞–∫ –∏ –¥–ª—è –≤–æ–∑–≤—Ä–∞—â–∞–µ–º–æ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è
- –ø–æ—Å–ª–µ–¥–Ω–µ–µ –≤—ã—Ä–∞–∂–µ–Ω–∏–µ –≤ —Ç–µ–ª–µ —Ñ—É–Ω–∫—Ü–∏–∏ —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –≤–æ–∑–≤—Ä–∞—â–∞–µ–º—ã–º –∑–Ω–∞—á–µ–Ω–∏–µ–º (–ø–æ—Å–ª–µ –Ω–µ–≥–æ –Ω–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å `;`). –î–ª—è —Ä–∞–Ω–Ω–µ–≥–æ –≤–æ–∑–≤—Ä–∞—Ç–∞ –º–æ–∂–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –∫–ª—é—á–µ–≤–æ–µ —Å–ª–æ–≤–æ `return`
- –¥–µ—Ñ–æ–ª—Ç–Ω—ã–º —Ç–∏–ø–æ–º, –≤–æ–∑–≤—Ä–∞—â–∞–µ–º—ã–º —Ñ—É–Ω–∫—Ü–∏–µ–π, —è–≤–ª—è–µ—Ç—Å—è `()` (—ç—Ç–æ —Å–ø—Ä–∞–≤–µ–¥–ª–∏–≤–æ —Ç–∞–∫–∂–µ –¥–ª—è —Ñ—É–Ω–∫—Ü–∏–π, –∫–æ—Ç–æ—Ä—ã–µ –Ω–∏—á–µ–≥–æ –Ω–µ –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç —è–≤–Ω–æ)
- –ø–µ—Ä–µ–≥—Ä—É–∑–∫–∞ —Ñ—É–Ω–∫—Ü–∏–π –≤ `Rust` –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è
  - —á–∏—Å–ª–æ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –≤—Å–µ–≥–¥–∞ —è–≤–ª—è–µ—Ç—Å—è —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–º. –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è. –î–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Ñ—É–Ω–∫—Ü–∏–π —Å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –º–∞–∫—Ä–æ—Å—ã (macros)
  - –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∏–º–µ—é—Ç —Ç–∏–ø—ã. –≠—Ç–∏ —Ç–∏–ø—ã –º–æ–≥—É—Ç –±—ã—Ç—å –æ–±—â–∏–º–∏ (–¥–∂–µ–Ω–µ—Ä–∏–∫–∞–º–∏ - generics). –ú—ã –æ–±—Å—É–¥–∏–º —ç—Ç–æ –ø–æ–∑–∂–µ

__–ú–∞–∫—Ä–æ—Å—ã__

–ú–∞–∫—Ä–æ—Å—ã —Ä–∞—Å–∫—Ä—ã–≤–∞—é—Ç—Å—è (expanded) –≤ –∫–æ–¥–µ –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ –∫–æ–º–ø–∏–ª—è—Ü–∏–∏ –∏ –º–æ–≥—É—Ç –ø—Ä–∏–Ω–∏–º–∞—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤. –û–Ω–∏ –æ–±–æ–∑–Ω–∞—á–∞—é—Ç—Å—è —Å –ø–æ–º–æ—â—å—é `!` –≤ –∫–æ–Ω—Ü–µ. –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ `Rust` –≤–∫–ª—é—á–∞–µ—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ –ø–æ–ª–µ–∑–Ω—ã—Ö –º–∞–∫—Ä–æ—Å–æ–≤:

- `println!(format, ..)` - –ø–µ—á–∞—Ç–∞–µ—Ç —Å—Ç—Ä–æ–∫—É –≤ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –≤—ã–≤–æ–¥, –ø—Ä–∏–º–µ–Ω—è—è —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ, –æ–ø–∏—Å–∞–Ω–Ω–æ–µ –≤ [std::fmt](https://doc.rust-lang.org/std/fmt/index.html)
- `format!(format, ..)` - —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–∞–∫ `println!()`, –Ω–æ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å—Ç—Ä–æ–∫—É
- `dbg!(expression)` - –≤—ã–≤–æ–¥–∏—Ç –∑–Ω–∞—á–µ–Ω–∏–µ –≤—ã—Ä–∞–∂–µ–Ω–∏—è –≤ —Ç–µ—Ä–º–∏–Ω–∞–ª –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –µ–≥–æ
- `todo!()` - –ø–æ–º–µ—á–∞–µ—Ç –∫–æ–¥ –∫–∞–∫ –µ—â–µ –Ω–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π. –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ —ç—Ç–æ–≥–æ –∫–æ–¥–∞ –ø—Ä–∏–≤–æ–¥–∏—Ç –∫ –ø–∞–Ω–∏–∫–µ –ø—Ä–æ–≥—Ä–∞–º–º—ã
- `unreachable!()` - –ø–æ–º–µ—á–∞–µ—Ç –∫–æ–¥ –∫–∞–∫ –Ω–µ–¥–æ—Å—Ç–∏–∂–∏–º—ã–π. –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ —ç—Ç–æ–≥–æ –∫–æ–¥–∞ –ø—Ä–∏–≤–æ–¥–∏—Ç –∫ –ø–∞–Ω–∏–∫–µ –ø—Ä–æ–≥—Ä–∞–º–º—ã

```rust
fn factorial(n: u32) -> u32 {
    let mut product = 1;
    for i in 1..=n {
        product *= dbg!(i);
    }
    product
}

fn fizzbuzz(n: u32) -> u32 {
    todo!("—Ä–µ–∞–ª–∏–∑—É–π –º–µ–Ω—è")
}

fn main() {
    let n = 13;
    println!("{n}! = {}", factorial(4));
}
```

__–£–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ: –≥–∏–ø–æ—Ç–µ–∑–∞ –ö–æ–ª–ª–∞—Ç—Ü–∞__

–î–ª—è –æ–±—ä—è—Å–Ω–µ–Ω–∏—è —Å—É—Ç–∏ [–≥–∏–ø–æ—Ç–µ–∑—ã –ö–æ–ª–ª–∞—Ç—Ü–∞](https://ru.wikipedia.org/wiki/%D0%93%D0%B8%D0%BF%D0%BE%D1%82%D0%B5%D0%B7%D0%B0_%D0%9A%D0%BE%D0%BB%D0%BB%D0%B0%D1%82%D1%86%D0%B0) —Ä–∞—Å—Å–º–æ—Ç—Ä–∏–º —Å–ª–µ–¥—É—é—â—É—é –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å —á–∏—Å–µ–ª, –Ω–∞–∑—ã–≤–∞–µ–º—É—é —Å–∏—Ä–∞–∫—É–∑—Å–∫–æ–π –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å—é. –ë–µ—Ä–µ–º –ª—é–±–æ–µ –Ω–∞—Ç—É—Ä–∞–ª—å–Ω–æ–µ —á–∏—Å–ª–æ `n`. –ï—Å–ª–∏ –æ–Ω–æ —á–µ—Ç–Ω–æ–µ, —Ç–æ –¥–µ–ª–∏–º –µ–≥–æ –Ω–∞ 2, –∞ –µ—Å–ª–∏ –Ω–µ—á–µ—Ç–Ω–æ–µ, —Ç–æ —É–º–Ω–æ–∂–∞–µ–º –Ω–∞ 3 –∏ –ø—Ä–∏–±–∞–≤–ª—è–µ–º 1 (–ø–æ–ª—É—á–∞–µ–º `3n + 1`). –ù–∞–¥ –ø–æ–ª—É—á–µ–Ω–Ω—ã–º —á–∏—Å–ª–æ–º –≤—ã–ø–æ–ª–Ω—è–µ–º —Ç–µ –∂–µ —Å–∞–º—ã–µ –¥–µ–π—Å—Ç–≤–∏—è, –∏ —Ç–∞–∫ –¥–∞–ª–µ–µ. –ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å –ø—Ä–µ—Ä—ã–≤–∞–µ—Ç—Å—è –Ω–∞ `ni`, –µ—Å–ª–∏ `ni` —Ä–∞–≤–Ω—è–µ—Ç—Å—è 1.

–ù–∞–ø—Ä–∏–º–µ—Ä, –¥–ª—è —á–∏—Å–ª–∞ 3 –ø–æ–ª—É—á–∞–µ–º:

- 3 - –Ω–µ—á–µ—Ç–Ω–æ–µ, 3*3 + 1 = 10
- 10 - —á–µ—Ç–Ω–æ–µ, 10:2 = 5
- 5 - –Ω–µ—á–µ—Ç–Ω–æ–µ, 5*3 + 1 = 16
- 16 - —á–µ—Ç–Ω–æ–µ, 16/2 = 8
- 8 - —á–µ—Ç–Ω–æ–µ, 8/2 = 4
- 4 - —á–µ—Ç–Ω–æ–µ, 4/2 = 2
- 2 - —á–µ—Ç–Ω–æ–µ, 2/2 = 1
- 1 - –Ω–µ—á–µ—Ç–Ω–æ–µ (–ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å –ø—Ä–µ—Ä—ã–≤–∞–µ—Ç—Å—è, `n` —Ä–∞–≤–Ω—è–µ—Ç—Å—è 8)

–ù–∞–ø–∏—à–∏—Ç–µ —Ñ—É–Ω–∫—Ü–∏—é –¥–ª—è –≤—ã—á–∏—Å–ª–µ–Ω–∏—è —Å–∏—Ä–∞–∫—É–∑—Å–∫–æ–π –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –¥–ª—è —É–∫–∞–∑–∞–Ω–Ω–æ–≥–æ —á–∏—Å–ª–∞ `n`.

```rust
fn collatz_length(mut n: i32) -> u32 {
  todo!("—Ä–µ–∞–ª–∏–∑—É–π –º–µ–Ω—è")
}

fn main() {
  println!("–¥–ª–∏–Ω–∞ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏: {}", collatz_length(11));
  assert_eq!(collatz_length(11), 15);
}
```

<details>
<summary>–†–µ—à–µ–Ω–∏–µ:</summary>

```rust
fn collatz_length(mut n: i32) -> u32 {
    let mut len = 1;
    while n > 1 {
        n = if n % 2 == 0 { n / 2 } else { 3 * n + 1 };
        len += 1;
    }
    len
}

fn main() {
    println!("–¥–ª–∏–Ω–∞ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏: {}", collatz_length(11));
    assert_eq!(collatz_length(11), 15);
}
```

</details>

## –ö–æ—Ä—Ç–µ–∂–∏ –∏ –º–∞—Å—Å–∏–≤—ã

__–ö–æ—Ä—Ç–µ–∂–∏ –∏ –º–∞—Å—Å–∏–≤—ã__

–ö–æ—Ä—Ç–µ–∂–∏ (tuples) –∏ –º–∞—Å—Å–∏–≤—ã (arrays) - –ø–µ—Ä–≤—ã–µ "—Å–æ—Å—Ç–∞–≤–Ω—ã–µ" (compound) —Ç–∏–ø—ã, –∫–æ—Ç–æ—Ä—ã–µ –º—ã –∏–∑—É—á–∏–º. –í—Å–µ —ç–ª–µ–º–µ–Ω—Ç—ã –º–∞—Å—Å–∏–≤–∞ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –æ–¥–Ω–æ–≥–æ —Ç–∏–ø–∞, —ç–ª–µ–º–µ–Ω—Ç—ã –∫–æ—Ä—Ç–µ–∂–∞ –º–æ–≥—É—Ç –±—ã—Ç—å —Ä–∞–∑–Ω—ã—Ö —Ç–∏–ø–æ–≤. –ò –º–∞—Å—Å–∏–≤—ã, –∏ –∫–æ—Ä—Ç–µ–∂–∏ –∏–º–µ—é—Ç —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ä–∞–∑–º–µ—Ä.

||–¢–∏–ø—ã|–õ–∏—Ç–µ—Ä–∞–ª—ã|
|---|---|---|
|–ú–∞—Å—Å–∏–≤—ã|[T; N]|[20, 30, 40], [0; 3]|
|–ö–æ—Ä—Ç–µ–∂–∏|(), (T,), (T1, T2)|(), ('x',), ('x', 1.2)|

–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –º–∞—Å—Å–∏–≤–∞ –∏ –¥–æ—Å—Ç—É–ø –∫ –µ–≥–æ —ç–ª–µ–º–µ–Ω—Ç–∞–º:

```rust
fn main() {
    let mut a: [i8; 10] = [42; 10];
    a[5] = 0;
    println!("a: {a:?}");
}
```

–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∫–æ—Ä—Ç–µ–∂–∞ –∏ –¥–æ—Å—Ç—É–ø –∫ –µ–≥–æ —ç–ª–µ–º–µ–Ω—Ç–∞–º:

```rust
fn main() {
    let t: (i8, bool) = (7, true);
    println!("t.0: {}", t.0);
    println!("t.1: {}", t.1);
}
```

–ú–∞—Å—Å–∏–≤—ã:

- –∑–Ω–∞—á–µ–Ω–∏–µ–º –º–∞—Å—Å–∏–≤–∞ —Ç–∏–ø–∞ `[T; N]` —è–≤–ª—è–µ—Ç—Å—è `N` (–∫–æ–Ω—Å—Ç–∞–Ω—Ç–∞ –≤—Ä–µ–º–µ–Ω–∏ –∫–æ–º–ø–∏–ª—è—Ü–∏–∏) —ç–ª–µ–º–µ–Ω—Ç–æ–≤ —Ç–∏–ø–∞ `T`. –û–±—Ä–∞—Ç–∏—Ç–µ –≤–Ω–∏–º–∞–Ω–∏–µ, —á—Ç–æ –¥–ª–∏–Ω–∞ –º–∞—Å—Å–∏–≤–∞ —è–≤–ª—è–µ—Ç—Å—è —á–∞—Å—Ç—å—é –µ–≥–æ —Ç–∏–ø–∞, –ø–æ—ç—Ç–æ–º—É `[u8; 3]` –∏ `[u8; 4]` —Å—á–∏—Ç–∞—é—Ç—Å—è –¥–≤—É–º—è —Ä–∞–∑–Ω—ã–º–∏ —Ç–∏–ø–∞–º–∏. –°—Ä–µ–∑—ã (slices), –¥–ª–∏–Ω–∞ –∫–æ—Ç–æ—Ä—ã—Ö –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è –≤–æ –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è, –º—ã —Ä–∞—Å—Å–º–æ—Ç—Ä–∏–º –ø–æ–∑–∂–µ
- –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–ª—É—á–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ —ç–ª–µ–º–µ–Ω—Ç—É –∑–∞ –ø—Ä–µ–¥–µ–ª–∞–º–∏ –≥—Ä–∞–Ω–∏—Ü –º–∞—Å—Å–∏–≤–∞. –î–æ—Å—Ç—É–ø –∫ —ç–ª–µ–º–µ–Ω—Ç–∞–º –º–∞—Å—Å–∏–≤–∞ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è –≤–æ –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è. `Rust` –æ–±—ã—á–Ω–æ –≤—ã–ø–æ–ª–Ω—è–µ—Ç —Ä–∞–∑–ª–∏—á–Ω—ã–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ —Ç–∞–∫–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏, –∞ –≤ –Ω–µ–±–µ–∑–æ–ø–∞—Å–Ω–æ–º `Rust` –µ–µ –º–æ–∂–Ω–æ –æ—Ç–∫–ª—é—á–∏—Ç—å
- –¥–ª—è –ø—Ä–∏—Å–≤–æ–µ–Ω–∏—è –∑–Ω–∞—á–µ–Ω–∏—è –º–∞—Å—Å–∏–≤—É –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ª–∏—Ç–µ—Ä–∞–ª—ã
- –ø–æ—Å–∫–æ–ª—å–∫—É –º–∞—Å—Å–∏–≤—ã –∏–º–µ—é—Ç —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é —Ç–æ–ª—å–∫–æ –æ—Ç–ª–∞–¥–æ—á–Ω–æ–≥–æ –≤—ã–≤–æ–¥–∞, –æ–Ω–∏ —Ñ–æ—Ä–º–∞—Ç–∏—Ä—É—é—Ç—Å—è —Å –ø–æ–º–æ—â—å—é `{:?}` –∏–ª–∏ `{:#?}`

–ö–æ—Ä—Ç–µ–∂–∏:

- –∫–∞–∫ –∏ –º–∞—Å—Å–∏–≤—ã, –∫–æ—Ä—Ç–µ–∂–∏ –∏–º–µ—é—Ç —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ä–∞–∑–º–µ—Ä
- –∫–æ—Ä—Ç–µ–∂–∏ –≥—Ä—É–ø–ø–∏—Ä—É—é—Ç –∑–Ω–∞—á–µ–Ω–∏—è —Ä–∞–∑–Ω—ã—Ö —Ç–∏–ø–æ–≤ –≤ –æ–¥–∏–Ω —Å–æ—Å—Ç–∞–≤–Ω–æ–π —Ç–∏–ø
- –¥–æ—Å—Ç—É–ø –∫ –ø–æ–ª—è–º –∫–æ—Ä—Ç–µ–∂–∞ –º–æ–∂–Ω–æ –ø–æ–ª—É—á–∏—Ç—å —Å –ø–æ–º–æ—â—å—é —Ç–æ—á–∫–∏ –∏ –∏–Ω–¥–µ–∫—Å–∞, –Ω–∞–ø—Ä–∏–º–µ—Ä, `t.0`, `t.1`
- –ø—É—Å—Ç–æ–π –∫–æ—Ä—Ç–µ–∂ `()` —Ç–∞–∫–∂–µ –Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è "–µ–¥–∏–Ω–∏—á–Ω—ã–º/–ø—É—Å—Ç—ã–º —Ç–∏–ø–æ–º" (unit type). –≠—Ç–æ –∏ —Ç–∏–ø, –∏ –µ–≥–æ –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω–æ–µ –≤–∞–ª–∏–¥–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ. –ü—É—Å—Ç–æ–π —Ç–∏–ø —è–≤–ª—è–µ—Ç—Å—è –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–æ–º —Ç–æ–≥–æ, —á—Ç–æ —Ñ—É–Ω–∫—Ü–∏—è –∏–ª–∏ –≤—ã—Ä–∞–∂–µ–Ω–∏–µ –Ω–∏—á–µ–≥–æ –Ω–µ –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç (–≤ —ç—Ç–æ–º —Å–º—ã—Å–ª–µ –ø—É—Å—Ç–æ–π —Ç–∏–ø –ø–æ—Ö–æ–∂ –Ω–∞ `void` –≤ –¥—Ä—É–≥–∏—Ö —è–∑—ã–∫–∞—Ö)

__–ü–µ—Ä–µ–±–æ—Ä –º–∞—Å—Å–∏–≤–∞__

–î–ª—è –ø–µ—Ä–µ–±–æ—Ä–∞ –º–∞—Å—Å–∏–≤–∞ (–Ω–æ –Ω–µ –∫–æ—Ä—Ç–µ–∂–∞) –º–æ–∂–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è —Ü–∏–∫–ª `for`:

```rust
fn main() {
    let primes = [2, 3, 5, 7, 11, 13, 17, 19];
    for prime in primes {
        for i in 2..prime {
            assert_ne!(prime % i, 0);
        }
    }
}
```

–í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –ø–µ—Ä–µ–±–æ—Ä–∞ –º–∞—Å—Å–∏–≤–∞ –≤ —Ü–∏–∫–ª–µ `for` –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç—Å—è —Ç—Ä–µ–π—Ç–æ–º `IntoIterator`, –æ –∫–æ—Ç–æ—Ä–æ–º –º—ã –ø–æ–≥–æ–≤–æ—Ä–∏–º –ø–æ–∑–∂–µ.

–í –ø—Ä–∏–º–µ—Ä–µ –º—ã –≤–∏–¥–∏–º –Ω–æ–≤—ã–π –º–∞–∫—Ä–æ—Å `assert_ne!`. –°—É—â–µ—Å—Ç–≤—É—é—Ç —Ç–∞–∫–∂–µ –º–∞–∫—Ä–æ—Å—ã `assert_eq!` –∏ `assert!`. –≠—Ç–∏ –º–∞–∫—Ä–æ—Å—ã –ø—Ä–æ–≤–µ—Ä—è—é—Ç—Å—è –≤—Å–µ–≥–¥–∞, –≤ –æ—Ç–ª–∏—á–∏–µ –æ—Ç –∏—Ö –∞–Ω–∞–ª–æ–≥–æ–≤ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏ `debug_assert!` –∏ –¥—Ä., –∫–æ—Ç–æ—Ä—ã–µ —É–¥–∞–ª—è—é—Ç—Å—è –∏–∑ –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–µ–Ω–Ω–æ–π —Å–±–æ—Ä–∫–∏.

__–°–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ —Å –æ–±—Ä–∞–∑—Ü–æ–º__

–ö–ª—é—á–µ–≤–æ–µ —Å–ª–æ–≤–æ `match` –ø–æ–∑–≤–æ–ª—è–µ—Ç —Å–æ–ø–æ—Å—Ç–∞–≤–ª—è—Ç—å –∑–Ω–∞—á–µ–Ω–∏–µ —Å –æ–¥–Ω–∏–º –∏–ª–∏ –±–æ–ª–µ–µ –ø–∞—Ç—Ç–µ—Ä–Ω–∞–º–∏/—à–∞–±–ª–æ–Ω–∞–º–∏. –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è —Å–≤–µ—Ä—Ö—É –≤–Ω–∏–∑, –ø–æ–±–µ–∂–¥–∞–µ—Ç –ø–µ—Ä–≤–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ.

`match` –ø–æ—Ö–æ–∂ –Ω–∞ `switch` –∏–∑ –¥—Ä—É–≥–∏—Ö —è–∑—ã–∫–æ–≤:

```rust
#[rustfmt::skip]
fn main() {
    let input = 'x';
    match input {
        'q'                       => println!("–≤—ã—Ö–æ–¥"),
        'a' | 's' | 'w' | 'd'     => println!("–¥–≤–∏–∂–µ–Ω–∏–µ"),
        '0'..='9'                 => println!("—á–∏—Å–ª–æ"),
        key if key.is_lowercase() => println!("–±—É–∫–≤–∞ –≤ –Ω–∏–∂–Ω–µ–º —Ä–µ–≥–∏—Å—Ç—Ä–µ: {key}"),
        _                         => println!("–¥—Ä—É–≥–æ–µ"),
    }
}
```

–ü–∞—Ç—Ç–µ—Ä–Ω `_` - —ç—Ç–æ —à–∞–±–ª–æ–Ω –ø–æ–¥—Å—Ç–∞–Ω–æ–≤–æ—á–Ω–æ–≥–æ –∑–Ω–∞–∫–∞ (wildcard pattern), –∫–æ—Ç–æ—Ä—ã–π —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –ª—é–±–æ–º—É –∑–Ω–∞—á–µ–Ω–∏—é. –°–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏—è –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –∏—Å—á–µ—Ä–ø—ã–≤–∞—é—â–∏–º–∏, —Ç.–µ. –æ—Ö–≤–∞—Ç—ã–≤–∞—Ç—å –≤—Å–µ –≤–æ–∑–º–æ–∂–Ω—ã–µ —Å–ª—É—á–∞–∏, –ø–æ—ç—Ç–æ–º—É `_` —á–∞—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∫–∞–∫ —Ñ–∏–Ω–∞–ª—å–Ω—ã–π –ø–µ—Ä–µ—Ö–≤–∞—Ç—á–∏–∫.

–°–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –º–æ–∂–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –∫–∞–∫ –≤—ã—Ä–∞–∂–µ–Ω–∏–µ. –ö–∞–∫ –∏ –≤ —Å–ª—É—á–∞–µ —Å `if`, –±–ª–æ–∫–∏ `match` –¥–æ–ª–∂–Ω—ã –∏–º–µ—Ç—å –æ–¥–∏–Ω–∞–∫–æ–≤—ã–π —Ç–∏–ø. –¢–∏–ø–æ–º —è–≤–ª—è–µ—Ç—Å—è –ø–æ—Å–ª–µ–¥–Ω–µ–µ –≤—ã—Ä–∞–∂–µ–Ω–∏–µ –≤ –±–ª–æ–∫–µ, –µ—Å–ª–∏ —Ç–∞–∫–æ–≤–æ–µ –∏–º–µ–µ—Ç—Å—è. –í –ø—Ä–∏–º–µ—Ä–µ —Ç–∏–ø–æ–º —è–≤–ª—è–µ—Ç—Å—è `()`.

–ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è –≤ –ø–∞—Ç—Ç–µ—Ä–Ω–µ (`key` –≤ –ø—Ä–∏–º–µ—Ä–µ) —Å–æ–∑–¥–∞–µ—Ç –ø—Ä–∏–≤—è–∑–∫—É, –∫–æ—Ç–æ—Ä–∞—è –º–æ–∂–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –≤ –±–ª–æ–∫–µ.

–ó–∞—â–∏—Ç–Ω–∏–∫ —Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏—è (match guard - `if ...`) –¥–æ–ø—É—Å–∫–∞–µ—Ç —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ —Ç–æ–ª—å–∫–æ –ø—Ä–∏ —É–¥–æ–≤–ª–µ—Ç–≤–æ—Ä–µ–Ω–∏–∏ —É—Å–ª–æ–≤–∏—è.

–†–µ–º–∞—Ä–∫–∏:

- –≤—ã –º–æ–≥–ª–∏ –∑–∞–º–µ—Ç–∏—Ç—å –Ω–µ–∫–æ—Ç–æ—Ä—ã–µ —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ —Å–∏–º–≤–æ–ª—ã, –∫–æ—Ç–æ—Ä—ã–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –≤ —à–∞–±–ª–æ–Ω–∞—Ö:
  - `|` - —ç—Ç–æ `or` (–∏–ª–∏)
  - `..` - —Ä–∞—Å–ø–∞–∫–æ–≤–∫–∞ –∑–Ω–∞—á–µ–Ω–∏—è
  - `1..=5` - –≤–∫–ª—é—á–∞—é—â–∏–π –¥–∏–∞–ø–∞–∑–æ–Ω
  - `_` - –ø–æ–¥—Å—Ç–∞–Ω–æ–≤–æ—á–Ω—ã–π –∑–Ω–∞–∫
- –∑–∞—â–∏—Ç–∞ —Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏—è –≤–∞–∂–Ω–∞ –∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–∞, –∫–æ–≥–¥–∞ –º—ã —Ö–æ—Ç–∏–º –∫—Ä–∞—Ç–∫–æ –≤—ã—Ä–∞–∑–∏—Ç—å –±–æ–ª–µ–µ —Å–ª–æ–∂–Ω—ã–µ –∏–¥–µ–∏, —á–µ–º –ø–æ–∑–≤–æ–ª—è—é—Ç –æ–¥–Ω–∏ —Ç–æ–ª—å–∫–æ —à–∞–±–ª–æ–Ω—ã
- –∑–∞—â–∏—Ç–∞ —Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `if` –≤–Ω—É—Ç—Ä–∏ –±–ª–æ–∫–∞ `match` - —Ä–∞–∑–Ω—ã–µ –≤–µ—â–∏
- —É—Å–ª–æ–≤–∏–µ, –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–µ –≤ –∑–∞—â–∏—Ç–Ω–∏–∫–µ —Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏—è, –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –∫–æ –≤—Å–µ–º –≤—ã—Ä–∞–∂–µ–Ω–∏—è–º –ø–∞—Ç—Ç–µ—Ä–Ω–∞, –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–≥–æ —Å –ø–æ–º–æ—â—å—é `|`

__–î–µ—Å—Ç—Ä—É–∫—Ç—É—Ä–∏–∑–∞—Ü–∏—è__

–î–µ—Å—Ç—Ä—É–∫—Ç—É—Ä–∏–∑–∞—Ü–∏—è - —ç—Ç–æ —Å–ø–æ—Å–æ–± –∏–∑–≤–ª–µ—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –∏–∑ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–∞–Ω–Ω—ã—Ö —Å –ø–æ–º–æ—â—å—é —à–∞–±–ª–æ–Ω–∞, —Å–æ–≤–ø–∞–¥–∞—é—â–µ–≥–æ —Å–æ —Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π –¥–∞–Ω–Ω—ã—Ö. –≠—Ç–æ —Å–ø–æ—Å–æ–± –ø—Ä–∏–≤—è–∑–∫–∏ –∫ —Å—É–±–∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞–º (subcomponents) —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–∞–Ω–Ω—ã—Ö.

_–ö–æ—Ä—Ç–µ–∂–∏_

```rust
fn main() {
    describe_point((1, 0));
}

fn describe_point(point: (i32, i32)) {
    match point {
        (0, _) => println!("–Ω–∞ –æ—Å–∏ Y"),
        (_, 0) => println!("–Ω–∞ –æ—Å–∏ X"),
        (x, _) if x < 0 => println!("—Å–ª–µ–≤–∞ –æ—Ç –æ—Å–∏ Y"),
        (_, y) if y < 0 => println!("–Ω–∏–∂–µ –æ—Å–∏ X"),
        _ => println!("–ø–µ—Ä–≤—ã–π –∫–≤–∞–¥—Ä–∞–Ω—Ç"),
    }
}
```

_–ú–∞—Å—Å–∏–≤—ã_

```rust
#[rustfmt::skip]
fn main() {
    let triple = [0, -2, 3];
    println!("—Ä–∞—Å—Å–∫–∞–∂–∏ –º–Ω–µ –æ {triple:?}");
    match triple {
        [0, y, z] => println!("–ø–µ—Ä–≤—ã–π —ç–ª–µ–º–µ–Ω—Ç - —ç—Ç–æ 0, y = {y} –∏ z = {z}"),
        [1, ..]   => println!("–ø–µ—Ä–≤—ã–π —ç–ª–µ–º–µ–Ω—Ç - —ç—Ç–æ 1, –æ—Å—Ç–∞–ª—å–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã –∏–≥–Ω–æ—Ä–∏—Ä—É—é—Ç—Å—è"),
        _         => println!("–≤—Å–µ —ç–ª–µ–º–µ–Ω—Ç—ã –∏–≥–Ω–æ—Ä–∏—Ä—É—é—Ç—Å—è"),
    }
}
```

- –°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—ã–π —à–∞–±–ª–æ–Ω –º–∞—Å—Å–∏–≤–∞, –∏—Å–ø–æ–ª—å–∑—É—è `_` –¥–ª—è –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è —ç–ª–µ–º–µ–Ω—Ç–∞
- –¥–æ–±–∞–≤—å—Ç–µ –≤ –º–∞—Å—Å–∏–≤ –±–æ–ª—å—à–µ –∑–Ω–∞—á–µ–Ω–∏–π
- –æ–±—Ä–∞—Ç–∏—Ç–µ –≤–Ω–∏–º–∞–Ω–∏–µ, –∫–∞–∫ `..` —Ä–∞—Å—à–∏—Ä—è–µ—Ç—Å—è (expand) –¥–æ —Ä–∞–∑–Ω–æ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —ç–ª–µ–º–µ–Ω—Ç–æ–≤
- –ø–æ–∫–∞–∂–∏—Ç–µ —Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ —Å —Ö–≤–æ—Å—Ç–æ–º (tail) —Å –ø–æ–º–æ—â—å—é —à–∞–±–ª–æ–Ω–æ–≤ `[.., b]` –∏ `[a@.., b]`

__–£–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ: –≤–ª–æ–∂–µ–Ω–Ω—ã–µ –º–∞—Å—Å–∏–≤—ã__

–ú–∞—Å—Å–∏–≤—ã –º–æ–≥—É—Ç —Å–æ–¥–µ—Ä–∂–∞—Ç—å –¥—Ä—É–≥–∏–µ –º–∞—Å—Å–∏–≤—ã:

```rust
let matrix3x3 = [[1, 2, 3], [4, 5, 6], [7, 8, 9]];
```

–ö–∞–∫–æ–≤ —Ç–∏–ø —ç—Ç–æ–π –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π?

–ù–∞–ø–∏—à–∏—Ç–µ —Ñ—É–Ω–∫—Ü–∏—é `transpose()`, –∫–æ—Ç–æ—Ä–∞—è —Ç—Ä–∞–Ω—Å–ø–æ–Ω–∏—Ä—É–µ—Ç –º–∞—Ç—Ä–∏—Ü—É 3—Ö3 (–ø—Ä–µ–≤—Ä–∞—â–∞–µ—Ç —Å—Ç—Ä–æ–∫–∏ –≤ –∫–æ–ª–æ–Ω–∫–∏).

```rust
fn transpose(matrix: [[i32; 3]; 3]) -> [[i32; 3]; 3] {
    todo!("—Ä–µ–∞–ª–∏–∑—É–π –º–µ–Ω—è")
}

fn main() {
    let matrix = [
        [101, 102, 103], // <-- –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –Ω–µ –¥–∞–µ—Ç `rustfmt` —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞—Ç—å `matrix` –≤ –æ–¥–Ω—É —Å—Ç—Ä–æ–∫—É
        [201, 202, 203],
        [301, 302, 303],
    ];
    let transposed = transpose(matrix);
    println!("—Ç—Ä–∞–Ω—Å–ø–æ–Ω–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –º–∞—Ç—Ä–∏—Ü–∞: {:#?}", transposed);
    assert_eq!(
        transposed,
        [
            [101, 201, 301], //
            [102, 202, 302],
            [103, 203, 303],
        ]
    );
}
```

<details>
<summary>–†–µ—à–µ–Ω–∏–µ:</summary>

```rust
fn transpose(matrix: [[i32; 3]; 3]) -> [[i32; 3]; 3] {
    let mut result = [[0; 3]; 3];
    for i in 0..3 {
        for j in 0..3 {
            result[j][i] = matrix[i][j];
        }
    }
    result
}
```

</details>

## –°—Å—ã–ª–∫–∏

__–û–±—â–∏–µ —Å—Å—ã–ª–∫–∏__

–°—Å—ã–ª–∫–∞ (reference) - —ç—Ç–æ —Å–ø–æ—Å–æ–± –ø–æ–ª—É—á–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ –∑–Ω–∞—á–µ–Ω–∏—é –±–µ–∑ –ø—Ä–∏–Ω—è—Ç–∏—è –µ–≥–æ –≤–æ –≤–ª–∞–¥–µ–Ω–∏–µ, —Ç.–µ. –±–µ–∑ –∑–∞–∏–º—Å—Ç–≤–æ–≤–∞–Ω–∏—è (borrowing) —ç—Ç–æ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è. –û–±—â–∏–µ/—Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–µ (shared) —Å—Å—ã–ª–∫–∏ –¥–æ—Å—Ç—É–ø–Ω—ã —Ç–æ–ª—å–∫–æ –¥–ª—è —á—Ç–µ–Ω–∏—è: —Å—Å—ã–ª–æ—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –Ω–µ –º–æ–≥—É—Ç –º–æ–¥–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å—Å—è.

```rust
fn main() {
    let a = 'A';
    let b = 'B';
    let mut r: &char = &a;
    println!("r: {}", *r);
    r = &b;
    println!("r: {}", *r);
}
```

–û–±—â–∞—è —Å—Å—ã–ª–∫–∞ –Ω–∞ —Ç–∏–ø `T` –∏–º–µ–µ—Ç —Ç–∏–ø `&T`. –û–ø–µ—Ä–∞—Ç–æ—Ä `&` —É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ —Ç–æ, —á—Ç–æ —ç—Ç–æ —Å—Å—ã–ª–∫–∞. –û–ø–µ—Ä–∞—Ç–æ—Ä `*` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è —Ä–∞–∑—ã–º–µ–Ω–æ–≤–∞–Ω–∏—è (dereferencing) —Å—Å—ã–ª–∫–∏ - –ø–æ–ª—É—á–µ–Ω–∏—è —Å—Å—ã–ª–æ—á–Ω–æ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è.

`Rust` –∑–∞–ø—Ä–µ—â–∞–µ—Ç –≤–∏—Å—è—â–∏–µ —Å—Å—ã–ª–∫–∏ (dangling references):

```rust
fn x_axis(x: i32) -> &(i32, i32) {
    let point = (x, 0);
    return &point;
}
```

–†–µ–º–∞—Ä–∫–∏:

- —Å—Å—ã–ª–∫–∞ "–∑–∞–∏–º—Å—Ç–≤—É–µ—Ç" –∑–Ω–∞—á–µ–Ω–∏–µ, –Ω–∞ –∫–æ—Ç–æ—Ä–æ–µ –æ–Ω–∞ —Å—Å—ã–ª–∞–µ—Ç—Å—è. –ö–æ–¥ –º–æ–∂–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å—Å—ã–ª–∫—É –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ –∑–Ω–∞—á–µ–Ω–∏—é, –Ω–æ –µ–≥–æ "–≤–ª–∞–¥–µ–ª—å—Ü–µ–º" (owner) –±—É–¥–µ—Ç –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–∞—è –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è. –ú—ã –ø–æ–¥—Ä–æ–±–Ω–æ –ø–æ–≥–æ–≤–æ—Ä–∏–º –æ –≤–ª–∞–¥–µ–Ω–∏–∏ –≤ 3 —á–∞—Å—Ç–∏
- —Å—Å—ã–ª–∫–∏ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã –∫–∞–∫ —É–∫–∞–∑–∞—Ç–µ–ª–∏ (pointers) –≤ `C` –∏–ª–∏ `C++`, –∫–ª—é—á–µ–≤—ã–º –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–æ–º –∫–æ—Ç–æ—Ä—ã—Ö —è–≤–ª—è–µ—Ç—Å—è —Ç–æ, —á—Ç–æ –æ–Ω–∏ –º–æ–≥—É—Ç –±—ã—Ç—å –Ω–∞–º–Ω–æ–≥–æ –º–µ–Ω—å—à–µ, —á–µ–º –≤–µ—â–∏, –Ω–∞ –∫–æ—Ç–æ—Ä—ã–µ –æ–Ω–∏ —É–∫–∞–∑—ã–≤–∞—é—Ç. –ü–æ–∑–∂–µ –º—ã –±—É–¥–µ–º –≥–æ–≤–æ—Ä–∏—Ç—å –æ —Ç–æ–º, –∫–∞–∫ `Rust` –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –±–µ–∑–æ–ø–∞—Å–Ω—É—é —Ä–∞–±–æ—Ç—É —Å –ø–∞–º—è—Ç—å—é, –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞—è –±–∞–≥–∏, —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Å —Å—ã—Ä—ã–º–∏ (raw) —É–∫–∞–∑–∞—Ç–µ–ª—è–º–∏
- `Rust` –Ω–µ —Å–æ–∑–¥–∞–µ—Ç —Å—Å—ã–ª–∫–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
- –≤ –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö —Å–ª—É—á–∞—è—Ö `Rust` –≤—ã–ø–æ–ª–Ω—è–µ—Ç —Ä–∞–∑—ã–º–µ–Ω–æ–≤–∞–Ω–∏–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏, –Ω–∞–ø—Ä–∏–º–µ—Ä, –ø—Ä–∏ –≤—ã–∑–æ–≤–µ –º–µ—Ç–æ–¥–æ–≤ (`r.count_ones()`)
- –≤ –ø–µ—Ä–≤–æ–º –ø—Ä–∏–º–µ—Ä–µ –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è `r` —è–≤–ª—è–µ—Ç—Å—è –º—É—Ç–∞–±–µ–ª—å–Ω–æ–π, –ø–æ—ç—Ç–æ–º—É –µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –º–æ–∂–Ω–æ –º–µ–Ω—è—Ç—å (`r = &b`). –≠—Ç–æ –ø–æ–≤—Ç–æ—Ä–Ω–æ –ø—Ä–∏–≤—è–∑—ã–≤–∞–µ—Ç `r`, —Ç–µ–ø–µ—Ä—å –æ–Ω–∞ —É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ —á—Ç–æ-—Ç–æ –¥—Ä—É–≥–æ–µ. –≠—Ç–æ –æ—Ç–ª–∏—á–∞–µ—Ç—Å—è –æ—Ç `C++`, –≥–¥–µ –ø—Ä–∏—Å–≤–æ–µ–Ω–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è —Å—Å—ã–ª–∫–µ –º–µ–Ω—è–µ—Ç —Å—Å—ã–ª–æ—á–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ
- –æ–±—â–∞—è —Å—Å—ã–ª–∫–∞ –Ω–µ –ø–æ–∑–≤–æ–ª—è–µ—Ç –º–æ–¥–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å –∑–Ω–∞—á–µ–Ω–∏–µ, –Ω–∞ –∫–æ—Ç–æ—Ä–æ–µ –æ–Ω–∞ —Å—Å—ã–ª–∞–µ—Ç—Å—è, –¥–∞–∂–µ –µ—Å–ª–∏ —ç—Ç–æ –∑–Ω–∞—á–µ–Ω–∏–µ —è–≤–ª—è–µ—Ç—Å—è –º—É—Ç–∞–±–µ–ª—å–Ω—ã–º (–ø–æ–ø—Ä–æ–±—É–π—Ç–µ `*r = 'X'`)
- `Rust` –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç –≤—Ä–µ–º–µ–Ω–∞ –∂–∏–∑–Ω–∏ (lifetimes) –≤—Å–µ—Ö —Å—Å—ã–ª–æ–∫, —á—Ç–æ–±—ã —É–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –æ–Ω–∏ –∂–∏–≤—É—Ç –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–æ–ª–≥–æ. –í –±–µ–∑–æ–ø–∞—Å–Ω–æ–º `Rust` –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –≤–∏—Å—è—â–∏—Ö —Å—Å—ã–ª–æ–∫ (dangling pointers). `x_axis()` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å—Å—ã–ª–∫—É –Ω–∞ `point`, –Ω–æ `point` —É–Ω–∏—á—Ç–æ–∂–∞–µ—Ç—Å—è (–≤—ã–¥–µ–ª–µ–Ω–Ω–∞—è –ø–∞–º—è—Ç—å –æ—Å–≤–æ–±–æ–∂–¥–∞–µ—Ç—Å—è - deallocate) –ø–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∫–æ–¥–∞ —Ñ—É–Ω–∫—Ü–∏–∏, –∏ –∫–æ–¥ –Ω–µ –∫–æ–º–ø–∏–ª–∏—Ä—É–µ—Ç—Å—è

__–≠–∫—Å–∫–ª—é–∑–∏–≤–Ω—ã–µ —Å—Å—ã–ª–∫–∏__

–≠–∫—Å–∫–ª—é–∑–∏–≤–Ω—ã–µ —Å—Å—ã–ª–∫–∏ (exclusive references), —Ç–∞–∫–∂–µ –∏–∑–≤–µ—Å—Ç–Ω—ã–µ –∫–∞–∫ –º—É—Ç–∞–±–µ–ª—å–Ω—ã–µ —Å—Å—ã–ª–∫–∏ (mutable references), –ø–æ–∑–≤–æ–ª—è—é—Ç –º–µ–Ω—è—Ç—å –∑–Ω–∞—á–µ–Ω–∏–µ, –Ω–∞ –∫–æ—Ç–æ—Ä–æ–µ –æ–Ω–∏ —Å—Å—ã–ª–∞—é—Ç—Å—è. –û–Ω–∏ –∏–º–µ—é—Ç —Ç–∏–ø `&mut T`:

```rust
fn main() {
    let mut point = (1, 2);
    let x_coord = &mut point.0;
    *x_coord = 20;
    println!("point: {point:?}");
}
```

–†–µ–º–∞—Ä–∫–∏:

- "—ç–∫—Å–∫–ª—é–∑–∏–≤–Ω—ã–π" –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ —Ç–æ–ª—å–∫–æ —ç—Ç–∞ —Å—Å—ã–ª–∫–∞ –º–æ–∂–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ –∑–Ω–∞—á–µ–Ω–∏—é. –î—Ä—É–≥–∏—Ö —Å—Å—ã–ª–æ–∫ (–æ–±—â–∏—Ö –∏–ª–∏ —ç–∫—Å–∫–ª—é–∑–∏–≤–Ω—ã—Ö) —Å—É—â–µ—Å—Ç–≤–æ–≤–∞—Ç—å –Ω–µ –¥–æ–ª–∂–Ω–æ. –°—Å—ã–ª–æ—á–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ, –ø–æ–∫–∞ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç —ç–∫—Å–∫–ª—é–∑–∏–≤–Ω–∞—è —Å—Å—ã–ª–∫–∞. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–ª—É—á–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ `&point.0` –∏–ª–∏ –∏–∑–º–µ–Ω–∏—Ç—å `point.0`, –ø–æ–∫–∞ –∂–∏–≤–∞ `x_coord`
- —É–±–µ–¥–∏—Ç–µ—Å—å –≤ —Ç–æ–º, —á—Ç–æ –ø–æ–Ω–∏–º–∞–µ—Ç–µ —Ä–∞–∑–Ω–∏—Ü—É –º–µ–∂–¥—É `let mut x_coord: &i32` –∏ `let x_coord: &mut i32`. –ü–µ—Ä–≤–∞—è –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è - —ç—Ç–æ –æ–±—â–∞—è —Å—Å—ã–ª–∫–∞, –∫–æ—Ç–æ—Ä–∞—è –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—Ä–∏–≤—è–∑–∞–Ω–∞ –∫ —Ä–∞–∑–Ω—ã–º –∑–Ω–∞—á–µ–Ω–∏—è–º, –≤—Ç–æ—Ä–∞—è - —ç–∫—Å–∫–ª—é–∑–∏–≤–Ω–∞—è —Å—Å—ã–ª–∫–∞ –Ω–∞ –º—É—Ç–∞–±–µ–ª—å–Ω—É—é –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é

__–£–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ: –≥–µ–æ–º–µ—Ç—Ä–∏—è__

–í–∞—à–∞ –∑–∞–¥–∞—á–∞ - —Å–æ–∑–¥–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π –¥–ª—è —Ç—Ä–µ—Ö–º–µ—Ä–Ω–æ–π –≥–µ–æ–º–µ—Ç—Ä–∏–∏, –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è—é—â–µ–π —Ç–æ—á–∫—É –∫–∞–∫ `[f64; 3]`.

```rust
// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –≤—ã—á–∏—Å–ª–µ–Ω–∏—è –º–∞–≥–Ω–∏—Ç—É–¥—ã –≤–µ–∫—Ç–æ—Ä–∞: —Å—É–º–º–∏—Ä—É–µ–º –∫–≤–∞–¥—Ä–∞—Ç—ã –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç –≤–µ–∫—Ç–æ—Ä–∞
// –∏ –∏–∑–≤–ª–µ–∫–∞–µ–º –∏–∑ —ç—Ç–æ–π —Å—É–º–º—ã –∫–≤–∞–¥—Ä–∞—Ç–Ω—ã–π –∫–æ—Ä–µ–Ω—å.
// –ú–µ—Ç–æ–¥ –¥–ª—è –∏–∑–≤–ª–µ—á–µ–Ω–∏—è –∫–≤–∞–¥—Ä–∞—Ç–Ω–æ–≥–æ –∫–æ—Ä–Ω—è - `sqrt()` (`v.sqrt()`)
fn magnitude(...) -> f64 {
    todo!("—Ä–µ–∞–ª–∏–∑—É–π –º–µ–Ω—è")
}

// –§—É–Ω–∫—Ü–∏—è –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏ –≤–µ–∫—Ç–æ—Ä–∞: –≤—ã—á–∏—Å–ª—è–µ–º –º–∞–≥–Ω–∏—Ç—É–¥—É –≤–µ–∫—Ç–æ—Ä–∞
// –∏ –¥–µ–ª–∏–º –Ω–∞ –Ω–µ–µ –≤—Å–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –≤–µ–∫—Ç–æ—Ä–∞
fn normalize(...) {
    todo!("—Ä–µ–∞–ª–∏–∑—É–π –º–µ–Ω—è")
}

fn main() {
    println!("–º–∞–≥–Ω–∏—Ç—É–¥–∞ –µ–¥–∏–Ω–∏—á–Ω–æ–≥–æ –≤–µ–∫—Ç–æ—Ä–∞: {}", magnitude(&[0.0, 1.0, 0.0]));

    let mut v = [1.0, 2.0, 9.0];
    println!("–º–∞–≥–Ω–∏—Ç—É–¥–∞ {v:?}: {}", magnitude(&v));
    normalize(&mut v);
    println!("–º–∞–≥–Ω–∏—Ç—É–¥–∞ {v:?} –ø–æ—Å–ª–µ –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏: {}", magnitude(&v));
}
```

<details>
<summary>–†–µ—à–µ–Ω–∏–µ:</summary>

```rust
fn magnitude(vector: &[f64; 3]) -> f64 {
    let mut mag_squared = 0.0;
    for coord in vector {
        mag_squared += coord * coord;
    }
    mag_squared.sqrt()
}

fn normalize(vector: &mut [f64; 3]) {
    let mag = magnitude(vector);
    vector[0] /= mag;
    vector[1] /= mag;
    vector[2] /= mag;
}
```

</details>

## –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ —Ç–∏–ø—ã

__–ò–º–µ–Ω–æ–≤–∞–Ω–Ω—ã–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã__

`Rust` –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –∫–∞—Å—Ç–æ–º–Ω—ã–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã:

```rust
struct Person {
    name: String,
    age: u8,
}

fn describe(person: &Person) {
    println!("{} is {} years old", person.name, person.age);
}

fn main() {
    let mut peter = Person { name: String::from("Peter"), age: 27 };
    describe(&peter);

    peter.age = 28;
    describe(&peter);

    let name = String::from("Avery");
    let age = 39;
    let avery = Person { name, age };
    describe(&avery);

    let jackie = Person { name: String::from("Jackie"), ..avery };
    describe(&jackie);
}
```

–†–µ–º–∞—Ä–∫–∏:

- —Ç–∏–ø —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –æ—Ç–¥–µ–ª—å–Ω–æ –æ–ø—Ä–µ–¥–µ–ª—è—Ç—å –Ω–µ –Ω—É–∂–Ω–æ
- —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –Ω–µ –º–æ–≥—É—Ç –Ω–∞—Å–ª–µ–¥–æ–≤–∞—Ç—å –¥—Ä—É–≥ –¥—Ä—É–≥—É
- –¥–ª—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ —Ç—Ä–µ–π—Ç–∞ –Ω–∞ —Ç–∏–ø–µ, –≤ –∫–æ—Ç–æ—Ä–æ–º –Ω–µ –Ω—É–∂–Ω–æ —Ö—Ä–∞–Ω–∏—Ç—å –Ω–∏–∫–∞–∫–∏—Ö –∑–Ω–∞—á–µ–Ω–∏–π, –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É –Ω—É–ª–µ–≤–æ–≥–æ —Ä–∞–∑–º–µ—Ä–∞ (zero-sized), –Ω–∞–ø—Ä–∏–º–µ—Ä, `struct Foo;`
- –µ—Å–ª–∏ –Ω–∞–∑–≤–∞–Ω–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å –Ω–∞–∑–≤–∞–Ω–∏–µ–º –ø–æ–ª—è, —Ç–æ, –Ω–∞–ø—Ä–∏–º–µ—Ä, `name: name` –º–æ–∂–Ω–æ —Å–æ–∫—Ä–∞—Ç–∏—Ç—å –¥–æ `name`
- —Å–∏–Ω—Ç–∞–∫—Å–∏—Å `..avery` –ø–æ–∑–≤–æ–ª—è–µ—Ç –∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –±–æ–ª—å—à—É—é —á–∞—Å—Ç—å –ø–æ–ª–µ–π —Å—Ç–∞—Ä–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –≤ –Ω–æ–≤—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É. –û–Ω –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –ø–æ—Å–ª–µ–¥–Ω–∏–º —ç–ª–µ–º–µ–Ω—Ç–æ–º

__–ö–æ—Ä—Ç–µ–∂–Ω—ã–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã__

–ï—Å–ª–∏ –Ω–∞–∑–≤–∞–Ω–∏—è –ø–æ–ª–µ–π –Ω–µ–≤–∞–∂–Ω—ã, –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–æ—Ä—Ç–µ–∂–Ω—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É:

```rust
struct Point(i32, i32);

fn main() {
    let p = Point(17, 23);
    println!("({}, {})", p.0, p.1);
}
```

–≠—Ç–æ —á–∞—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –æ–±–µ—Ä—Ç–æ–∫ –µ–¥–∏–Ω–∏—á–Ω—ã—Ö –ø–æ–ª–µ–π (single-field wrappers), –∫–æ—Ç–æ—Ä—ã–µ –Ω–∞–∑—ã–≤–∞—é—Ç—Å—è `newtypes` (–Ω–æ–≤—ã–º–∏ —Ç–∏–ø–∞–º–∏):

```rust
struct PoundsOfForce(f64);
struct Newtons(f64);

fn compute_thruster_force() -> PoundsOfForce {
    todo!("Ask a rocket scientist at NASA")
}

fn set_thruster_force(force: Newtons) {
    // ...
}

fn main() {
    let force = compute_thruster_force();
    set_thruster_force(force);
}
```

–†–µ–º–∞—Ä–∫–∏:

- `newtype` - –æ—Ç–ª–∏—á–Ω—ã–π —Å–ø–æ—Å–æ–± –∑–∞–∫–æ–¥–∏—Ä–æ–≤–∞—Ç—å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –∑–Ω–∞—á–µ–Ω–∏–∏ –≤ –ø—Ä–∏–º–∏—Ç–∏–≤–Ω–æ–º —Ç–∏–ø–µ, –Ω–∞–ø—Ä–∏–º–µ—Ä:
  - —á–∏—Å–ª–æ –∏–∑–º–µ—Ä—è–µ—Ç—Å—è –≤ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã—Ö –µ–¥–∏–Ω–∏—Ü–∞—Ö (`Newtons`)
  - –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∑–Ω–∞—á–µ–Ω–∏–µ –ø—Ä–æ—Ö–æ–¥–∏—Ç –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—É—é –≤–∞–ª–∏–¥–∞—Ü–∏—é, –∫–æ—Ç–æ—Ä—É—é –Ω–µ –Ω—É–∂–Ω–æ –∫–∞–∂–¥—ã–π —Ä–∞–∑ –≤—ã–ø–æ–ª–Ω—è—Ç—å –≤—Ä—É—á–Ω—É—é: `PhoneNumber(String)` –∏–ª–∏ `OddNumber(u32)`
- –ø—Ä–∏–º–µ—Ä —è–≤–ª—è–µ—Ç—Å—è —Ç–æ–Ω–∫–æ–π –æ—Ç—Å—ã–ª–∫–æ–π –∫ –ø—Ä–æ–≤–∞–ª—É [Mars Climate Orbiter](https://en.wikipedia.org/wiki/Mars_Climate_Orbiter)

__–ü–µ—Ä–µ—á–∏—Å–ª–µ–Ω–∏—è__

–ö–ª—é—á–µ–≤–æ–µ —Å–ª–æ–≤–æ `enum` –ø–æ–∑–≤–æ–ª—è–µ—Ç —Å–æ–∑–¥–∞—Ç—å —Ç–∏–ø, –∫–æ—Ç–æ—Ä—ã–π –∏–º–µ–µ—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤:

```rust
#[derive(Debug)]
enum Direction {
    Left,
    Right,
}

#[derive(Debug)]
enum PlayerMove {
    Pass,                        // –ø—Ä–æ—Å—Ç–æ–π –≤–∞—Ä–∏–∞–Ω—Ç
    Run(Direction),              // –∫–æ—Ä—Ç–µ–∂–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç
    Teleport { x: u32, y: u32 }, // —Å—Ç—Ä—É–∫—Ç—É—Ä–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç
}

fn main() {
    let m: PlayerMove = PlayerMove::Run(Direction::Left);
    println!("On this turn: {:?}", m);
}
```

–†–µ–º–∞—Ä–∫–∏:

- –ø–µ—Ä–µ—á–∏—Å–ª–µ–Ω–∏–µ –ø–æ–∑–≤–æ–ª—è–µ—Ç —Å–æ–±—Ä–∞—Ç—å –Ω–∞–±–æ—Ä –∑–Ω–∞—á–µ–Ω–∏–π –≤ –æ–¥–∏–Ω —Ç–∏–ø
- `Direction` - —ç—Ç–æ —Ç–∏–ø —Å –¥–≤—É–º—è –≤–∞—Ä–∏–∞–Ω—Ç–∞–º–∏: `Direction::Left` –∏ `Direction::Right`
- `PlayerMove` - —ç—Ç–æ —Ç–∏–ø —Å —Ç—Ä–µ–º—è –≤–∞—Ä–∏–∞–Ω—Ç–∞–º–∏. –í –¥–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –∫ –ø–æ–ª–µ–∑–Ω—ã–º –Ω–∞–≥—Ä—É–∑–∫–∞–º (payloads) `Rust` –±—É–¥–µ—Ç —Ö—Ä–∞–Ω–∏—Ç—å –¥–∏—Å–∫—Ä–∏–º–∏–Ω–∞–Ω—Ç, —á—Ç–æ–±—ã –≤–æ –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–Ω–∞—Ç—å, –∫–∞–∫–æ–π –≤–∞—Ä–∏–∞–Ω—Ç –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ –∑–Ω–∞—á–µ–Ω–∏–∏ `PlayerMove`
- `Rust` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∏—Å–∫—Ä–∏–º–∏–Ω–∞–Ω—Ç–∞
  - –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è —Ü–µ–ª–æ–µ —á–∏—Å–ª–æ –Ω–∞–∏–º–µ–Ω—å—à–µ–≥–æ —Ç—Ä–µ–±—É–µ–º–æ–≥–æ —Ä–∞–∑–º–µ—Ä–∞
  - –µ—Å–ª–∏ —Ä–∞–∑—Ä–µ—à–µ–Ω–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –≤–∞—Ä–∏–∞–Ω—Ç–∞ –Ω–µ –æ—Ö–≤–∞—Ç—ã–≤–∞—é—Ç –≤—Å–µ –±–∏—Ç–æ–≤—ã–µ –∫–æ–º–±–∏–Ω–∞—Ü–∏–∏, –¥–ª—è –∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏—è –¥–∏—Å–∫—Ä–∏–º–∏–Ω–∞–Ω—Ç–∞ –±—É–¥—É—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –Ω–µ–¥–æ–ø—É—Å—Ç–∏–º—ã–µ –±–∏—Ç–æ–≤—ã–µ –∫–æ–º–±–∏–Ω–∞—Ü–∏–∏ ("–Ω–∏—à–µ–≤—ã–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏" (niche optimization)). –ù–∞–ø—Ä–∏–º–µ—Ä, `Option<&u8>` —Ö—Ä–∞–Ω–∏—Ç –ª–∏–±–æ —É–∫–∞–∑–∞—Ç–µ–ª—å –Ω–∞ —Ü–µ–ª–æ–µ —á–∏—Å–ª–æ, –ª–∏–±–æ `NULL` –¥–ª—è –≤–∞—Ä–∏–∞–Ω—Ç–∞ `None`
  - –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –¥–∏—Å–∫—Ä–∏–º–∏–Ω–∞–Ω—Ç–æ–º –º–æ–∂–Ω–æ —É–ø—Ä–∞–≤–ª—è—Ç—å (–Ω–∞–ø—Ä–∏–º–µ—Ä, –¥–ª—è –æ–±–µ—Å–ø–µ—á–µ–Ω–∏—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ —Å `C`):

```rust
#[repr(u32)]
enum Bar {
    A, // 0
    B = 10000,
    C, // 10001
}

fn main() {
    println!("A: {}", Bar::A as u32);
    println!("B: {}", Bar::B as u32);
    println!("C: {}", Bar::C as u32);
}
```

–ë–µ–∑ `repr` —Ç–∏–ø –¥–∏—Å–∫—Ä–∏–º–∏–Ω–∞–Ω—Ç–∞ –∑–∞–Ω–∏–º–∞–µ—Ç 2 –±–∞–π—Ç–∞, –ø–æ—Å–∫–æ–ª—å–∫—É `10001` —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –¥–≤—É–º –±–∞–π—Ç–∞–º.

__–°—Ç–∞—Ç–∏–∫–∏ –∏ –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã__

–°—Ç–∞—Ç–∏—á–Ω—ã–µ (static) –∏ –∫–æ–Ω—Å—Ç–∞–Ω—Ç–Ω—ã–µ (constant) –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ - —ç—Ç–æ 2 —Å–ø–æ—Å–æ–±–∞ —Å–æ–∑–¥–∞–Ω–∏—è –∑–Ω–∞—á–µ–Ω–∏–π —Å –≥–ª–æ–±–∞–ª—å–Ω–æ–π –æ–±–ª–∞—Å—Ç—å—é –≤–∏–¥–∏–º–æ—Å—Ç–∏, –∫–æ—Ç–æ—Ä—ã–µ –Ω–µ –º–æ–≥—É—Ç –±—ã—Ç—å –ø–µ—Ä–µ–º–µ—â–µ–Ω—ã –∏–ª–∏ –ø–µ—Ä–µ—Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω—ã –ø—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ –ø—Ä–æ–≥—Ä–∞–º–º—ã.

_const_

–ö–æ–Ω—Å—Ç–∞–Ω—Ç–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –æ—Ü–µ–Ω–∏–≤–∞—é—Ç—Å—è –≤–æ –≤—Ä–µ–º—è –∫–æ–º–ø–∏–ª—è—Ü–∏–∏ –∏ –∏—Ö –∑–Ω–∞—á–µ–Ω–∏—è [–≤—Å—Ç—Ä–∞–∏–≤–∞—é—Ç—Å—è –ø—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏](https://rust-lang.github.io/rfcs/0246-const-vs-static.html) (inlined upon use):

```rust
const DIGEST_SIZE: usize = 3;
const ZERO: Option<u8> = Some(42);

fn compute_digest(text: &str) -> [u8; DIGEST_SIZE] {
    let mut digest = [ZERO.unwrap_or(0); DIGEST_SIZE];
    for (idx, &b) in text.as_bytes().iter().enumerate() {
        digest[idx % DIGEST_SIZE] = digest[idx % DIGEST_SIZE].wrapping_add(b);
    }
    digest
}

fn main() {
    let digest = compute_digest("hello");
    println!("digest: {digest:?}");
}
```

–¢–æ–ª—å–∫–æ —Ñ—É–Ω–∫—Ü–∏–∏, –ø–æ–º–µ—á–µ–Ω–Ω—ã–µ —Å –ø–æ–º–æ—â—å—é `const`, –º–æ–≥—É—Ç –≤—ã–∑—ã–≤–∞—Ç—å—Å—è –≤–æ –≤—Ä–µ–º—è –∫–æ–º–ø–∏–ª—è—Ü–∏–∏ –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∑–Ω–∞—á–µ–Ω–∏–π `const`. –ù–æ —Ç–∞–∫–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ –º–æ–≥—É—Ç –≤—ã–∑—ã–≤–∞—Ç—å—Å—è –∏ –≤–æ –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è.

_static_

–°—Ç–∞—Ç–∏—á–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –∂–∏–≤—É—Ç –Ω–∞ –ø—Ä–æ—Ç—è–∂–µ–Ω–∏–∏ –≤—Å–µ–≥–æ –∂–∏–∑–Ω–µ–Ω–Ω–æ–≥–æ —Ü–∏–∫–ª–∞ –ø—Ä–æ–≥—Ä–∞–º–º—ã –∏ –Ω–µ –º–æ–≥—É—Ç –ø–µ—Ä–µ–º–µ—â–∞—Ç—å—Å—è:

```rust
static BANNER: &str = "welcome";

fn main() {
    println!("{BANNER}");
}
```

–ó–Ω–∞—á–µ–Ω–∏—è —Å—Ç–∞—Ç–∏—á–Ω—ã—Ö –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –Ω–µ –≤—Å—Ç—Ä–∞–∏–≤–∞—é—Ç—Å—è –ø—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ –∏ –∏–º–µ—é—Ç —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ª–æ–∫–∞—Ü–∏–∏ –≤ –ø–∞–º—è—Ç–∏. –≠—Ç–æ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø–æ–ª–µ–∑–Ω—ã–º –¥–ª—è –Ω–µ–±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ –∏ –≤—Å—Ç—Ä–æ–µ–Ω–Ω–æ–≥–æ –∫–æ–¥–∞ (FFI), –Ω–æ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –≥–ª–æ–±–∞–ª—å–Ω—ã—Ö –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `const`.

–†–µ–º–∞—Ä–∫–∏:

- `static` –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –∏–¥–µ–Ω—Ç–∏—á–Ω–æ—Å—Ç—å –æ–±—ä–µ–∫—Ç–∞ (object identity): –∞–¥—Ä–µ—Å –≤ –ø–∞–º—è—Ç–∏ –∏ —Å–æ—Å—Ç–æ—è–Ω–∏–µ, –∫–∞–∫ —Ç–æ–≥–æ —Ç—Ä–µ–±—É—é—Ç —Ç–∏–ø—ã —Å –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–π –∏–∑–º–µ–Ω—á–∏–≤–æ—Å—Ç—å—é, —Ç–∞–∫–∏–µ –∫–∞–∫ `Mutex<T>`
- –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã, –∫–æ—Ç–æ—Ä—ã–µ –æ—Ü–µ–Ω–∏–≤–∞—é—Ç—Å—è –≤–æ –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è, —Ç—Ä–µ–±—É—é—Ç—Å—è –Ω–µ—á–∞—Å—Ç–æ, –Ω–æ –∏–Ω–æ–≥–¥–∞ –æ–Ω–∏ –º–æ–≥—É—Ç –æ–∫–∞–∑–∞—Ç—å—Å—è –ø–æ–ª–µ–∑–Ω—ã–º–∏, –∏ –∏—Ö –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –±–µ–∑–æ–ø–∞—Å–Ω–µ–µ, —á–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Å—Ç–∞—Ç–∏–∫

__–°–∏–Ω–æ–Ω–∏–º—ã —Ç–∏–ø–æ–≤__

–°–∏–Ω–æ–Ω–∏–º —Ç–∏–ø–∞ (type alias) —Å–æ–∑–¥–∞–µ—Ç –Ω–∞–∑–≤–∞–Ω–∏–µ –¥–ª—è –¥—Ä—É–≥–æ–≥–æ —Ç–∏–ø–∞. –î–≤–∞ —Ç–∏–ø–∞ –º–æ–≥—É—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –≤–∑–∞–∏–º–æ–∑–∞–º–µ–Ω—è–µ–º–æ:

```rust
enum CarryableConcreteItem {
    Left,
    Right,
}

type Item = CarryableConcreteItem;

// –°–∏–Ω–æ–Ω–∏–º—ã –æ—Å–æ–±–µ–Ω–Ω–æ –ø–æ–ª–µ–∑–Ω—ã –¥–ª—è –¥–ª–∏–Ω–Ω—ã—Ö, —Å–ª–æ–∂–Ω—ã—Ö —Ç–∏–ø–æ–≤
use std::cell::RefCell;
use std::sync::{Arc, RwLock};
type PlayerInventory = RwLock<Vec<Arc<RefCell<Item>>>>;
```

__–£–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ: —Å–æ–±—ã—Ç–∏—è –≤ –ª–∏—Ñ—Ç–µ__

–í–∞—à–∞ –∑–∞–¥–∞—á–∞ —Å–æ—Å—Ç–æ–∏—Ç –≤ —Ç–æ–º, —á—Ç–æ–±—ã —Å–æ–∑–¥–∞—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è —Å–æ–±—ã—Ç–∏–π –≤ —Å–∏—Å—Ç–µ–º–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ª–∏—Ñ—Ç–æ–º. –í–∞–º –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å —Ç–∏–ø—ã –∏ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —Å–æ–±—ã—Ç–∏–π. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `#[derive(Debug)]`, —á—Ç–æ–±—ã —Ä–∞–∑—Ä–µ—à–∏—Ç—å —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–∏–ø–æ–≤ —Å –ø–æ–º–æ—â—å—é `{:?}`.

–≠—Ç–æ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ —Ç—Ä–µ–±—É–µ—Ç —Ç–æ–ª—å–∫–æ —Å–æ–∑–¥–∞–Ω–∏—è –∏ –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è —Å—Ç—Ä—É–∫—Ç—É—Ä –¥–∞–Ω–Ω—ã—Ö, —á—Ç–æ–±—ã —Ñ—É–Ω–∫—Ü–∏—è `main()` —Ä–∞–±–æ—Ç–∞–ª–∞ –±–µ–∑ –æ—à–∏–±–æ–∫.

```rust
#[derive(Debug)]
/// –°–æ–±—ã—Ç–∏–µ, –Ω–∞ –∫–æ—Ç–æ—Ä–æ–µ –¥–æ–ª–∂–µ–Ω —Ä–µ–∞–≥–∏—Ä–æ–≤–∞—Ç—å –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä
enum Event {
    todo!("–î–æ–±–∞–≤–∏—Ç—å –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã")
}

/// –ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–≤–∏–∂–µ–Ω–∏—è
#[derive(Debug)]
enum Direction {
    Up,
    Down,
}

/// –õ–∏—Ñ—Ç –ø—Ä–∏–±—ã–ª –Ω–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–π —ç—Ç–∞–∂
fn car_arrived(floor: i32) -> Event {
    todo!("—Ä–µ–∞–ª–∏–∑—É–π –º–µ–Ω—è")
}

/// –î–≤–µ—Ä–∏ –ª–∏—Ñ—Ç–∞ –æ—Ç–∫—Ä—ã–ª–∏—Å—å
fn car_door_opened() -> Event {
    todo!("—Ä–µ–∞–ª–∏–∑—É–π –º–µ–Ω—è")
}

/// –î–≤–µ—Ä–∏ –ª–∏—Ñ—Ç–∞ –∑–∞–∫—Ä—ã–ª–∏—Å—å
fn car_door_closed() -> Event {
    todo!("—Ä–µ–∞–ª–∏–∑—É–π –º–µ–Ω—è")
}

/// –í –≤–µ—Å—Ç–∏–±—é–ª–µ –ª–∏—Ñ—Ç–∞ –Ω–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–º —ç—Ç–∞–∂–µ –±—ã–ª–∞ –Ω–∞–∂–∞—Ç–∞ –∫–Ω–æ–ø–∫–∞ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è
fn lobby_call_button_pressed(floor: i32, dir: Direction) -> Event {
    todo!("—Ä–µ–∞–ª–∏–∑—É–π –º–µ–Ω—è")
}

/// –í –∫–∞–±–∏–Ω–µ –ª–∏—Ñ—Ç–∞ –±—ã–ª–∞ –Ω–∞–∂–∞—Ç–∞ –∫–Ω–æ–ø–∫–∞ —ç—Ç–∞–∂–∞
fn car_floor_button_pressed(floor: i32) -> Event {
    todo!("—Ä–µ–∞–ª–∏–∑—É–π –º–µ–Ω—è")
}

fn main() {
    println!(
        "–ü–∞—Å—Å–∞–∂–∏—Ä –ø–µ—Ä–≤–æ–≥–æ —ç—Ç–∞–∂–∞ –Ω–∞–∂–∞–ª –∫–Ω–æ–ø–∫—É –≤–≤–µ—Ä—Ö: {:?}",
        lobby_call_button_pressed(0, Direction::Up)
    );
    println!("–õ–∏—Ñ—Ç –ø—Ä–∏–±—ã–ª –Ω–∞ –ø–µ—Ä–≤—ã–π —ç—Ç–∞–∂: {:?}", car_arrived(0));
    println!("–î–≤–µ—Ä–∏ –ª–∏—Ñ—Ç–∞ –æ—Ç–∫—Ä—ã–ª–∏—Å—å: {:?}", car_door_opened());
    println!(
        "–ü–∞—Å—Å–∞–∂–∏—Ä –Ω–∞–∂–∞–ª –Ω–∞ –∫–Ω–æ–ø–∫—É —Ç—Ä–µ—Ç—å–µ–≥–æ —ç—Ç–∞–∂–∞: {:?}",
        car_floor_button_pressed(3)
    );
    println!("–î–≤–µ—Ä–∏ –ª–∏—Ñ—Ç–∞ –∑–∞–∫—Ä—ã–ª–∏—Å—å: {:?}", car_door_closed());
    println!("–õ–∏—Ñ—Ç –ø—Ä–∏–±—ã–ª –Ω–∞ —Ç—Ä–µ—Ç–∏–π —ç—Ç–∞–∂: {:?}", car_arrived(3));
}
```

<details>
<summary>–†–µ—à–µ–Ω–∏–µ:</summary>

```rust
#[derive(Debug)]
enum Event {
    /// –ë—ã–ª–∞ –Ω–∞–∂–∞—Ç–∞ –∫–Ω–æ–ø–∫–∞
    ButtonPressed(Button),
    /// –õ–∏—Ñ—Ç –ø—Ä–∏–±—ã–ª –Ω–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–π —ç—Ç–∞–∂
    CarArrived(Floor),
    /// –î–≤–µ—Ä–∏ –ª–∏—Ñ—Ç–∞ –æ—Ç–∫—Ä—ã–ª–∏—Å—å
    CarDoorOpened,
    /// –î–≤–µ—Ä–∏ –ª–∏—Ñ—Ç–∞ –∑–∞–∫—Ä—ã–ª–∏—Å—å
    CarDoorClosed,
}

/// –≠—Ç–∞–∂ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω —Ü–µ–ª—ã–º —á–∏—Å–ª–æ–º
type Floor = i32;

#[derive(Debug)]
enum Direction {
    Up,
    Down,
}

/// –î–æ—Å—Ç—É–ø–Ω–∞—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –∫–Ω–æ–ø–∫–∞
#[derive(Debug)]
enum Button {
    /// –ö–Ω–æ–ø–∫–∞ –≤—ã–∑–æ–≤–∞/–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤ –≤–µ—Å—Ç–∏–±—é–ª–µ –ª–∏—Ñ—Ç–∞ –Ω–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–º —ç—Ç–∞–∂–µ
    LobbyCall(Direction, Floor),
    /// –ö–Ω–æ–ø–∫–∞ —ç—Ç–∞–∂–∞ –≤ –∫–∞–±–∏–Ω–µ –ª–∏—Ñ—Ç–∞
    CarFloor(Floor),
}

fn car_arrived(floor: i32) -> Event {
    Event::CarArrived(floor)
}

fn car_door_opened() -> Event {
    Event::CarDoorOpened
}

fn car_door_closed() -> Event {
    Event::CarDoorClosed
}

fn lobby_call_button_pressed(floor: i32, dir: Direction) -> Event {
    Event::ButtonPressed(Button::LobbyCall(dir, floor))
}

fn car_floor_button_pressed(floor: i32) -> Event {
    Event::ButtonPressed(Button::CarFloor(floor))
}
```

</details>

## –°–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ —Å –æ–±—Ä–∞–∑—Ü–æ–º

__–î–µ—Å—Ç—Ä—É–∫—Ç—É—Ä–∏–∑–∞—Ü–∏—è__

–ö–∞–∫ –∏ –∫–æ—Ä—Ç–µ–∂–∏ (tuples), —Å—Ç—Ä—É–∫—Ç—É—Ä—ã (structs) –∏ –ø–µ—Ä–µ—á–∏—Å–ª–µ–Ω–∏—è (enums) —Ç–∞–∫–∂–µ –º–æ–≥—É—Ç –¥–µ—Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è (destructure) —Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ–º:

_–°—Ç—Ä—É–∫—Ç—É—Ä—ã_

```rust
struct Foo {
    x: (u32, u32),
    y: u32,
}

// –ó–∞–ø—Ä–µ—â–∞–µ–º —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
#[rustfmt::skip]
fn main() {
    let foo = Foo { x: (1, 2), y: 3 };
    match foo {
        Foo { x: (1, b), y } => println!("x.0 = 1, b = {b}, y = {y}"),
        Foo { y: 2, x: i }   => println!("y = 2, x = {i:?}"),
        Foo { y, .. }        => println!("y = {y}, –¥—Ä—É–≥–∏–µ –ø–æ–ª—è –∏–≥–Ω–æ—Ä–∏—Ä—É—é—Ç—Å—è"),
    }
}
```

_–ü–µ—Ä–µ—á–∏—Å–ª–µ–Ω–∏—è_

–®–∞–±–ª–æ–Ω—ã (patterns) –º–æ–≥—É—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –¥–ª—è –ø—Ä–∏–≤—è–∑–∫–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –∫ —á–∞—Å—Ç—è–º –∑–Ω–∞—á–µ–Ω–∏–π. –≠—Ç–æ, –ø–æ–º–∏–º–æ –ø—Ä–æ—á–µ–≥–æ, –ø–æ–∑–≤–æ–ª—è–µ—Ç –∏—Å—Å–ª–µ–¥–æ–≤–∞—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É —Ç–∏–ø–æ–≤. –ù–∞—á–Ω–µ–º —Å –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –ø—Ä–æ—Å—Ç–æ–≥–æ `enum`:

```rust
enum Result {
    Ok(i32),
    Err(String),
}

fn divide_in_two(n: i32) -> Result {
    if n % 2 == 0 {
        Result::Ok(n / 2)
    } else {
        Result::Err(format!("–Ω–µ–ª—å–∑—è —Ä–∞–∑–¥–µ–ª–∏—Ç—å {n} –Ω–∞ 2 —Ä–∞–≤–Ω—ã–µ —á–∞—Å—Ç–∏"))
    }
}

fn main() {
    let n = 100;
    match divide_in_two(n) {
        Result::Ok(half) => println!("{n}, –¥–µ–ª–µ–Ω–Ω–æ–µ –Ω–∞ 2: {half}"),
        Result::Err(msg) => println!("–≤–æ–∑–Ω–∏–∫–ª–∞ –æ—à–∏–±–∫–∞: {msg}"),
    }
}
```

–ó–¥–µ—Å—å –¥–ª—è –¥–µ—Å—Ç—Ä—É–∫—Ç—É—Ä–∏–∑–∞—Ü–∏–∏ `Result` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è 2 –±–ª–æ–∫–∞ (—Ä—É–∫–∏/—Ä—É–∫–∞–≤–∞ - arms). –í –ø–µ—Ä–≤–æ–º –±–ª–æ–∫–µ `half` –ø—Ä–∏–≤—è–∑—ã–≤–∞–µ—Ç—Å—è –∫ –∑–Ω–∞—á–µ–Ω–∏—é –≤–Ω—É—Ç—Ä–∏ –≤–∞—Ä–∏–∞–Ω—Ç–∞ `Ok`. –í–æ –≤—Ç–æ—Ä–æ–º –±–ª–æ–∫–µ `msg` –ø—Ä–∏–≤—è–∑—ã–≤–∞–µ—Ç—Å—è –∫ —Å–æ–æ–±—â–µ–Ω–∏—é –æ–± –æ—à–∏–±–∫–µ (–≤–Ω—É—Ç—Ä–∏ –≤–∞—Ä–∏–∞–Ω—Ç–∞ `Err`).

–°—Ç—Ä—É–∫—Ç—É—Ä—ã:

- –∏–∑–º–µ–Ω–∏—Ç–µ –ª–∏—Ç–µ—Ä–∞–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –≤ `foo` –¥–ª—è —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è —Å –¥—Ä—É–≥–∏–º–∏ —à–∞–±–ª–æ–Ω–∞–º–∏
- –¥–æ–±–∞–≤—å—Ç–µ –Ω–æ–≤–æ–µ –ø–æ–ª–µ –≤ `Foo` –∏ –º–æ–¥–∏—Ñ–∏—Ü–∏—Ä—É–π—Ç–µ —à–∞–±–ª–æ–Ω —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–º –æ–±—Ä–∞–∑–æ–º

–ü–µ—Ä–µ—á–∏—Å–ª–µ–Ω–∏—è:

- –≤—ã—Ä–∞–∂–µ–Ω–∏–µ `if-else` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø–µ—Ä–µ—á–∏—Å–ª–µ–Ω–∏–µ, –∫–æ—Ç–æ—Ä–æ–µ —Ä–∞—Å–ø–∞–∫–æ–≤—ã–≤–∞–µ—Ç—Å—è —Å –ø–æ–º–æ—â—å—é `match`
- –¥–æ–±–∞–≤—å—Ç–µ —Ç—Ä–µ—Ç–∏–π –≤–∞—Ä–∏–∞–Ω—Ç –≤ –ø–µ—Ä–µ—á–∏—Å–ª–µ–Ω–∏–µ –∏ –∏–∑—É—á–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ
- –¥–æ—Å—Ç—É–ø –∫ –∑–Ω–∞—á–µ–Ω–∏—è–º –≤ –≤–∞—Ä–∏–∞–Ω—Ç–∞—Ö –ø–µ—Ä–µ—á–∏—Å–ª–µ–Ω–∏—è –≤–æ–∑–º–æ–∂–µ–Ω —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ —Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏—è —Å —à–∞–±–ª–æ–Ω–æ–º
- –∏–∑—É—á–∏—Ç–µ –æ—à–∏–±–∫–∏, —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Å —Ç–µ–º, —á—Ç–æ —Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –Ω–µ —è–≤–ª—è–µ—Ç—Å—è –∏—Å—á–µ—Ä–ø—ã–≤–∞—é—â–∏–º

__–ü–æ—Ç–æ–∫ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è `let`__

`Rust` –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ü–∏–π —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–æ—Ç–æ–∫–æ–º –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –ø—Ä–æ–≥—Ä–∞–º–º—ã, –∫–æ—Ç–æ—Ä—ã—Ö –Ω–µ—Ç –≤ –¥—Ä—É–≥–∏—Ö —è–∑—ã–∫–∞—Ö –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –∫–æ—Ç–æ—Ä—ã–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –¥–ª—è —Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏—è —Å —à–∞–±–ª–æ–Ω–æ–º:

- `if let`
- `while let`
- `match`

_if let_

–í—ã—Ä–∞–∂–µ–Ω–∏–µ [if-let](https://doc.rust-lang.org/reference/expressions/if-expr.html#if-let-expressions) –ø–æ–∑–≤–æ–ª—è–µ—Ç –≤—ã–ø–æ–ª–Ω—è—Ç—å –∫–æ–¥ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è –∑–Ω–∞—á–µ–Ω–∏—è —Å —à–∞–±–ª–æ–Ω–æ–º:

```rust
fn sleep_for(secs: f32) {
    let dur = if let Ok(dur) = std::time::Duration::try_from_secs_f32(secs) {
        dur
    } else {
        std::time::Duration::from_millis(500)
    };
    std::thread::sleep(dur);
    println!("—Å–ø–∞–ª –≤ —Ç–µ—á–µ–Ω–∏–µ {:?}", dur);
}

fn main() {
    // –í—ã–ø–æ–ª–Ω–∏—Ç—Å—è –∫–æ–¥ –±–ª–æ–∫–∞ `else`
    sleep_for(-10.0);
    // –í—ã–ø–æ–ª–Ω–∏—Ç—Å—è –∫–æ–¥ –±–ª–æ–∫–∞ `if`
    sleep_for(0.8);
}
```

_let-else_

–î–ª—è –æ–±—ã—á–Ω–æ–≥–æ —Å–ª—É—á–∞—è —Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏—è —Å —à–∞–±–ª–æ–Ω–æ–º –∏ –≤–æ–∑–≤—Ä–∞—Ç–∞ –∏–∑ —Ñ—É–Ω–∫—Ü–∏–∏ —Å–ª–µ–¥—É–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å [let-else](https://doc.rust-lang.org/rust-by-example/flow_control/let_else.html). –ö–æ–¥ –±–ª–æ–∫–∞ `else` –¥–æ–ª–∂–µ–Ω –ø—Ä–µ—Ä—ã–≤–∞—Ç—å –ø–æ—Ç–æ–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –ø—Ä–æ–≥—Ä–∞–º–º—ã (`return`, `break`, `panic!` –∏ —Ç.–ø.).

```rust
fn hex_or_die_trying(maybe_string: Option<String>) -> Result<u32, String> {
    let s = if let Some(s) = maybe_string {
        s
    } else {
        return Err(String::from("–ø–æ–ª—É—á–µ–Ω–æ `None`"));
    };

    let first_byte_char = if let Some(first_byte_char) = s.chars().next() {
        first_byte_char
    } else {
        return Err(String::from("–ø–æ–ª—É—á–µ–Ω–∞ –ø—É—Å—Ç–∞—è —Å—Ç—Ä–æ–∫–∞"));
    };

    if let Some(digit) = first_byte_char.to_digit(16) {
        Ok(digit)
    } else {
        Err(String::from("–Ω–µ —à–µ—Å—Ç–Ω–∞–¥—Ü–∞—Ç–µ—Ä–∏—á–Ω–æ–µ —á–∏—Å–ª–æ"))
    }
}

fn main() {
    println!("—Ä–µ–∑—É–ª—å—Ç–∞—Ç: {:?}", hex_or_die_trying(Some(String::from("foo")))); // 15 - –±–∞–π—Ç–æ–≤–æ–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ —Å–∏–º–≤–æ–ª–∞ `f`
}
```

–í—ã—Ä–∞–∂–µ–Ω–∏–µ [while-let](https://doc.rust-lang.org/reference/expressions/loop-expr.html#predicate-pattern-loops) –ø–æ–≤—Ç–æ—Ä–Ω–æ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è —à–∞–±–ª–æ–Ω—É:

```rust
fn main() {
    let mut name = String::from("Comprehensive Rust ü¶Ä");
    while let Some(c) = name.pop() {
        println!("—Å–∏–º–≤–æ–ª: {c}");
    }
    // –°—É—â–µ—Å—Ç–≤—É—é—Ç –±–æ–ª–µ–µ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã–µ —Å–ø–æ—Å–æ–±—ã üòâ
}
```

–ó–¥–µ—Å—å [String::pop()](https://doc.rust-lang.org/stable/std/string/struct.String.html#method.pop) –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `Some(c)` –¥–æ —Ç–µ—Ö –ø–æ—Ä, –ø–æ–∫–∞ —Å—Ç—Ä–æ–∫–∞ –Ω–µ –æ–∫–∞–∂–µ—Ç—Å—è –ø—É—Å—Ç–æ–π, –ø–æ—Å–ª–µ —á–µ–≥–æ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è `None`. `while-let` –ø–æ–∑–≤–æ–ª—è–µ—Ç –ø–µ—Ä–µ–±–∏—Ä–∞—Ç—å –≤—Å–µ —ç–ª–µ–º–µ–Ω—Ç—ã.

if-let:

- –≤ –æ—Ç–ª–∏—á–∏–µ –æ—Ç `match`, `if-let` –Ω–µ –¥–æ–ª–∂–Ω–æ –æ—Ö–≤–∞—Ç—ã–≤–∞—Ç—å –≤—Å–µ —Å–ª—É—á–∞–∏. –ü–æ—ç—Ç–æ–º—É –µ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –º–µ–Ω–µ–µ –º–Ω–æ–≥–æ—Å–ª–æ–≤–Ω—ã–º, —á–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `match`
- –æ–±—ã—á–Ω—ã–º —Å–ø–æ—Å–æ–±–æ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è `if-let` —è–≤–ª—è–µ—Ç—Å—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ `Some` –ø—Ä–∏ —Ä–∞–±–æ—Ç–µ —Å `Option`
- –≤ –æ—Ç–ª–∏—á–∏–µ –æ—Ç `match`, `if-let` –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –∑–∞—â–∏—Ç–Ω–∏–∫–æ–≤ —Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏—è (match guards)

let-else:

- `let-else` –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Ä–∞—Å–ø–∞–∫–æ–≤–∫—É (flattening) –≤–ª–æ–∂–µ–Ω–Ω–æ–≥–æ –∫–æ–¥–∞. –ü–µ—Ä–µ–ø–∏—à–µ–º –ø—Ä–∏–º–µ—Ä —Å–ª–µ–¥—É—é—â–∏–º –æ–±—Ä–∞–∑–æ–º:

```rust
fn hex_or_die_trying(maybe_string: Option<String>) -> Result<u32, String> {
    let Some(s) = maybe_string else {
        return Err(String::from("–ø–æ–ª—É—á–µ–Ω–æ `None`"));
    };

    let Some(first_byte_char) = s.chars().next() else {
        return Err(String::from("–ø–æ–ª—É—á–µ–Ω–∞ –ø—É—Å—Ç–∞—è —Å—Ç—Ä–æ–∫–∞"));
    };

    let Some(digit) = first_byte_char.to_digit(16) else {
        return Err(String::from("–Ω–µ —à–µ—Å—Ç–Ω–∞–¥—Ü–∞—Ç–µ—Ä–∏—á–Ω–æ–µ —á–∏—Å–ª–æ"));
    };

    return Ok(digit);
}
```

while-let:

- —Ü–∏–∫–ª `while-let` –ø–æ–≤—Ç–æ—Ä—è–µ—Ç—Å—è, –ø–æ–∫–∞ –∑–Ω–∞—á–µ–Ω–∏–µ —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å —à–∞–±–ª–æ–Ω–æ–º
- —Ü–∏–∫–ª `while-let` –≤ –ø—Ä–∏–º–µ—Ä–µ –º–æ–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å –±–µ—Å–∫–æ–Ω–µ—á–Ω—ã–º —Å –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–µ–π `if` –≤–Ω—É—Ç—Ä–∏, –∫–æ—Ç–æ—Ä–∞—è –ø—Ä–µ—Ä—ã–≤–∞–µ—Ç —Ü–∏–∫–ª, –∫–æ–≥–¥–∞ `name.pop()` –Ω–∏—á–µ–≥–æ –Ω–µ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç

__–£–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ: –æ—Ü–µ–Ω–∫–∞ –≤—ã—Ä–∞–∂–µ–Ω–∏—è__

–ù–∞–ø–∏—à–µ–º –ø—Ä–æ—Å—Ç–æ–π —Ä–µ–∫—É—Ä—Å–∏–≤–Ω—ã–π –≤—ã—á–∏—Å–ª–∏—Ç–µ–ª—å –∞—Ä–∏—Ñ–º–µ—Ç–∏—á–µ—Å–∫–∏—Ö –≤—ã—Ä–∞–∂–µ–Ω–∏–π.

–¢–∏–ø `Box` –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç —Å–æ–±–æ–π —É–º–Ω—ã–π —É–∫–∞–∑–∞—Ç–µ–ª—å (smart pointer), –∫–æ—Ç–æ—Ä—ã–π –º—ã –ø–æ–¥—Ä–æ–±–Ω–æ —Ä–∞—Å—Å–º–æ—Ç—Ä–∏–º –ø–æ–∑–∂–µ. –í—ã—Ä–∞–∂–µ–Ω–∏–µ –º–æ–∂–Ω–æ "—É–ø–∞–∫–æ–≤–∞—Ç—å" —Å –ø–æ–º–æ—â—å—é `Box::new()`, –∫–∞–∫ –ø–æ–∫–∞–∑–∞–Ω–æ –≤ —Ç–µ—Å—Ç–∞—Ö. –î–ª—è –≤—ã—á–∏—Å–ª–µ–Ω–∏—è —É–ø–∞–∫–æ–≤–∞–Ω–Ω–æ–≥–æ –≤—ã—Ä–∞–∂–µ–Ω–∏—è, —Å–ª–µ–¥—É–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –æ–ø–µ—Ä–∞—Ç–æ—Ä —Ä–∞–∑—ã–º–µ–Ω–æ–≤–∞–Ω–∏—è (`*`): `eval(*boxed_expr)`.

–ù–µ–∫–æ—Ç–æ—Ä—ã–µ –≤—ã—Ä–∞–∂–µ–Ω–∏—è –Ω–µ –º–æ–≥—É—Ç –±—ã—Ç—å –≤—ã—á–∏—Å–ª–µ–Ω—ã –∏ –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç –æ—à–∏–±–∫—É. –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π —Ç–∏–ø `Result<Value, String>` - —ç—Ç–æ –ø–µ—Ä–µ—á–∏—Å–ª–µ–Ω–∏–µ, –∫–æ—Ç–æ—Ä–æ–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç —É—Å–ø–µ—à–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ (`Ok(Value)`) –∏–ª–∏ –æ—à–∏–±–∫—É (`Err(String)`). –ú—ã –ø–æ–¥—Ä–æ–±–Ω–æ —Ä–∞—Å—Å–º–æ—Ç—Ä–∏–º —ç—Ç–æ—Ç —Ç–∏–ø –ø–æ–∑–∂–µ.

```rust
// –û–ø–µ—Ä–∞—Ü–∏—è, –≤—ã–ø–æ–ª–Ω—è–µ–º–∞—è –Ω–∞–¥ –¥–≤—É–º—è –ø–æ–¥–≤—ã—Ä–∞–∂–µ–Ω–∏—è–º–∏
#[derive(Debug)]
enum Operation {
    Add,
    Sub,
    Mul,
    Div,
}

// –í—ã—Ä–∞–∂–µ–Ω–∏–µ –≤ —Ñ–æ—Ä–º–µ –¥–µ—Ä–µ–≤–∞
#[derive(Debug)]
enum Expression {
    // –û–ø–µ—Ä–∞—Ü–∏—è –Ω–∞–¥ –¥–≤—É–º—è –ø–æ–¥–≤—ã—Ä–∞–∂–µ–Ω–∏—è–º–∏
    Op {
        op: Operation,
        left: Box<Expression>,
        right: Box<Expression>,
    },

    // –õ–∏—Ç–µ—Ä–∞–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ
    Value(i64),
}

// –†–µ–∫—É—Ä—Å–∏–≤–Ω—ã–π –≤—ã—á–∏—Å–ª–∏—Ç–µ–ª—å –∞—Ä–∏—Ñ–º–µ—Ç–∏—á–µ—Å–∫–∏—Ö –≤—ã—Ä–∞–∂–µ–Ω–∏–π
fn eval(e: Expression) -> Result<i64, String> {
    todo!("—Ä–µ–∞–ª–∏–∑—É–π –º–µ–Ω—è")
}

fn main() {
    let expr = Expression::Op {
        op: Operation::Sub,
        left: Box::new(Expression::Value(20)),
        right: Box::new(Expression::Value(10)),
    };
    println!("–≤—ã—Ä–∞–∂–µ–Ω–∏–µ: {:?}", expr);
    println!("—Ä–µ–∑—É–ª—å—Ç–∞—Ç: {:?}", eval(expr));
}

// –ú–æ–¥—É–ª—å —Å —Ç–µ—Å—Ç–∞–º–∏ - –∫–æ–¥ –∫–æ–º–ø–∏–ª–∏—Ä—É–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ —Ç–µ—Å—Ç–æ–≤ —Å –ø–æ–º–æ—â—å—é –∫–æ–º–∞–Ω–¥—ã `cargo test`
#[cfg(test)]
mod tests {
    use super::*;

    #[test]
    fn test_value() {
        assert_eq!(eval(Expression::Value(19)), Ok(19));
    }

    #[test]
    fn test_sum() {
        assert_eq!(
            eval(Expression::Op {
                op: Operation::Add,
                left: Box::new(Expression::Value(10)),
                right: Box::new(Expression::Value(20)),
            }),
            Ok(30)
        );
    }

    #[test]
    fn test_recursion() {
        let term1 = Expression::Op {
            op: Operation::Mul,
            left: Box::new(Expression::Value(10)),
            right: Box::new(Expression::Value(9)),
        };
        let term2 = Expression::Op {
            op: Operation::Mul,
            left: Box::new(Expression::Op {
                op: Operation::Sub,
                left: Box::new(Expression::Value(3)),
                right: Box::new(Expression::Value(4)),
            }),
            right: Box::new(Expression::Value(5)),
        };
        assert_eq!(
            eval(Expression::Op {
                op: Operation::Add,
                left: Box::new(term1),
                right: Box::new(term2),
            }),
            Ok(85)
        );
    }

    #[test]
    fn test_error() {
        assert_eq!(
            eval(Expression::Op {
                op: Operation::Div,
                left: Box::new(Expression::Value(99)),
                right: Box::new(Expression::Value(0)),
            }),
            Err(String::from("–¥–µ–ª–µ–Ω–∏–µ –Ω–∞ –Ω–æ–ª—å"))
        );
    }
}
```

<details>
<summary>–†–µ—à–µ–Ω–∏–µ:</summary>

```rust
fn eval(e: Expression) -> Result<i64, String> {
    // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –≤–∞—Ä–∏–∞–Ω—Ç
    match e {
        // –û–ø–µ—Ä–∞—Ü–∏—è.
        // –î–µ—Å—Ç—Ä—É–∫—Ç—É—Ä–∏–∑–∞—Ü–∏—è
        Expression::Op { op, left, right } => {
            // –†–µ–∫—É—Ä—Å–∏–≤–Ω–æ –≤—ã—á–∏—Å–ª—è–µ–º –ª–µ–≤–æ–µ –ø–æ–¥–≤—ã—Ä–∞–∂–µ–Ω–∏–µ
            let left = match eval(*left) {
                Ok(v) => v,
                Err(e) => return e,
            };
            // –†–µ–∫—É—Ä—Å–∏–≤–Ω–æ –≤—ã—á–∏—Å–ª—è–µ–º –ø—Ä–∞–≤–æ–µ –ø–æ–¥–≤—ã—Ä–∞–∂–µ–Ω–∏–µ
            let right = match eval(*right) {
                Ok(v) => v,
                Err(e) => return e,
            };
            // –í–æ–∑–≤—Ä–∞—â–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç, —É–ø–∞–∫–æ–≤–∞–Ω–Ω—ã–π –≤ `Ok`
            Ok(
              // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ç–∏–ø –æ–ø–µ—Ä–∞—Ü–∏–∏
              match op {
                  Operation::Add => left + right,
                  Operation::Sub => left - right,
                  Operation::Mul => left * right,
                  Operation::Div => {
                      // –ï—Å–ª–∏ –ø—Ä–∞–≤—ã–π –æ–ø–µ—Ä–∞–Ω–¥ —Ä–∞–≤–Ω—è–µ—Ç—Å—è 0
                      if right == 0 {
                          // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –≤—ã–∑—ã–≤–∞—é—â–µ–º—É (caller) —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ, –æ–±–µ—Ä–Ω—É—Ç–æ–µ –≤ `Err`.
                          // –ú—ã —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω—è–µ–º (propagate) –æ—à–∏–±–∫—É, –ø–æ—ç—Ç–æ–º—É –æ–Ω–∞ –Ω–µ –æ–±–æ—Ä–∞—á–∏–≤–∞–µ—Ç—Å—è –≤ `Ok`
                          return Err(String::from("–¥–µ–ª–µ–Ω–∏–µ –Ω–∞ –Ω–æ–ª—å"));
                      } else {
                          left / right
                      }
                  }
              }
            )
        }
        // –ó–Ω–∞—á–µ–Ω–∏–µ.
        // –ü—Ä–æ—Å—Ç–æ –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –∑–Ω–∞—á–µ–Ω–∏–µ, —É–ø–∞–∫–æ–≤–∞–Ω–Ω–æ–µ –≤ `Ok`
        Expression::Value(v) => Ok(v),
    }
}
```

</details>

## –ú–µ—Ç–æ–¥—ã –∏ —Ç—Ä–µ–π—Ç—ã

__–ú–µ—Ç–æ–¥—ã__

`Rust` –ø–æ–∑–≤–æ–ª—è–µ—Ç –ø—Ä–∏–≤—è–∑—ã–≤–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏–∏ –∫ —Ç–∏–ø–∞–º (—Ç–∞–∫–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ –Ω–∞–∑—ã–≤–∞—é—Ç—Å—è –∞—Å—Å–æ—Ü–∏–∏—Ä–æ–≤–∞–Ω–Ω—ã–º–∏ - –º–µ—Ç–æ–¥—ã —ç–∫–∑–µ–º–ø–ª—è—Ä–æ–≤ –≤ –¥—Ä—É–≥–∏—Ö —è–∑—ã–∫–∞—Ö). –≠—Ç–æ –¥–µ–ª–∞–µ—Ç—Å—è —Å –ø–æ–º–æ—â—å—é –±–ª–æ–∫–∞ `impl`:

```rust
#[derive(Debug)]
struct Race {
    name: String,
    laps: Vec<i32>,
}

impl Race {
    // –ù–µ—Ç –ø–æ–ª—É—á–∞—Ç–µ–ª—è, —Å—Ç–∞—Ç–∏—á–Ω—ã–π –º–µ—Ç–æ–¥
    fn new(name: &str) -> Self {
        Self { name: String::from(name), laps: Vec::new() }
    }

    // –≠–∫—Å–∫–ª—é–∑–∏–≤–Ω–æ–µ –∑–∞–∏–º—Å—Ç–≤–æ–≤–∞–Ω–∏–µ (exclusive borrowing), –¥–æ–ø—É—Å–∫–∞—é—â–µ–µ —á—Ç–µ–Ω–∏–µ –∏ –∑–∞–ø–∏—Å—å –≤ `self`
    fn add_lap(&mut self, lap: i32) {
        self.laps.push(lap);
    }

    // –û–±—â–µ–µ, –¥–æ—Å—Ç—É–ø–Ω–æ–µ —Ç–æ–ª—å–∫–æ –¥–ª—è —á—Ç–µ–Ω–∏–µ –∑–∞–∏–º—Å—Ç–≤–æ–≤–∞–Ω–∏–µ (shared borrowing) `self`
    fn print_laps(&self) {
        println!("–ó–∞–ø–∏—Å–∞–Ω–æ –≤—Ä–µ–º—è {} –∫—Ä—É–≥–æ–≤ –¥–ª—è {}:", self.laps.len(), self.name);
        for (idx, lap) in self.laps.iter().enumerate() {
            println!("–ö—Ä—É–≥ {idx}: {lap} —Å–µ–∫—É–Ω–¥");
        }
    }

    // –≠–∫—Å–∫–ª—é–∑–∏–≤–Ω–æ–µ –≤–ª–∞–¥–µ–Ω–∏–µ (exclusive ownership) `self`
    fn finish(self) {
        let total: i32 = self.laps.iter().sum();
        println!("–ì–æ–Ω–∫–∞ {} –∑–∞–∫–æ–Ω—á–µ–Ω–∞, –æ–±—â–µ–µ –≤—Ä–µ–º—è: {}", self.name, total);
    }
}

fn main() {
    let mut race = Race::new("Monaco Grand Prix");
    race.add_lap(70);
    race.add_lap(68);
    race.print_laps();
    race.add_lap(71);
    race.print_laps();
    race.finish();
    // race.add_lap(42);
}
```

–ê—Ä–≥—É–º–µ–Ω—Ç—ã `self` –æ–ø—Ä–µ–¥–µ–ª—è—é—Ç "–ø–æ–ª—É—á–∞—Ç–µ–ª—è" (receiver) - –æ–±—ä–µ–∫—Ç, –Ω–∞ –∫–æ—Ç–æ—Ä–æ–º —Ä–µ–∞–ª–∏–∑—É–µ—Ç—Å—è –º–µ—Ç–æ–¥. –ü–æ–ª—É—á–∞—Ç–µ–ª–∏ –º–æ–≥—É—Ç –±—ã—Ç—å —Å–ª–µ–¥—É—é—â–∏–º–∏:

- `&self` - –∑–∞–∏–º—Å—Ç–≤—É–µ—Ç –æ–±—ä–µ–∫—Ç —É –≤—ã–∑—ã–≤–∞—é—â–µ–≥–æ —Å –ø–æ–º–æ—â—å—é –æ–±—â–µ–π –∏–º–º—É—Ç–∞–±–µ–ª—å–Ω–æ–π —Å—Å—ã–ª–∫–∏. –ü–æ—Å–ª–µ —ç—Ç–æ–≥–æ –æ–±—ä–µ–∫—Ç –º–æ–∂–µ—Ç –±—ã—Ç—å –ø–æ–≤—Ç–æ—Ä–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω
- `&mut self` - –∑–∞–∏–º—Å—Ç–≤—É–µ—Ç –æ–±—ä–µ–∫—Ç —É –≤—ã–∑—ã–≤–∞—é—â–µ–≥–æ —Å –ø–æ–º–æ—â—å—é —É–Ω–∏–∫–∞–ª—å–Ω–æ–π –º—É—Ç–∞–±–µ–ª—å–Ω–æ–π —Å—Å—ã–ª–∫–∏. –ü–æ—Å–ª–µ —ç—Ç–æ–≥–æ –æ–±—ä–µ–∫—Ç –º–æ–∂–µ—Ç –±—ã—Ç—å –ø–æ–≤—Ç–æ—Ä–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω
- `self` - –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –≤–ª–∞–¥–µ–Ω–∏–µ –æ–±—ä–µ–∫—Ç–æ–º –∏ –ø–µ—Ä–µ–º–µ—â–∞–µ—Ç –µ–≥–æ –æ—Ç –≤—ã–∑—ã–≤–∞—é—â–µ–≥–æ. –ú–µ—Ç–æ–¥ —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –≤–ª–∞–¥–µ–ª—å—Ü–µ–º –æ–±—ä–µ–∫—Ç–∞. –û–±—ä–µ–∫—Ç —É–¥–∞–ª—è–µ—Ç—Å—è (–æ—Å–≤–æ–±–æ–∂–¥–∞–µ—Ç—Å—è) –ø–æ—Å–ª–µ —Ç–æ–≥–æ, –∫–∞–∫ –º–µ—Ç–æ–¥ –≤–µ—Ä–Ω—É–ª –∑–Ω–∞—á–µ–Ω–∏–µ. –ü–æ–ª–Ω–æ–µ –≤–ª–∞–¥–µ–Ω–∏–µ –Ω–µ –æ–∑–Ω–∞—á–∞–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –º—É—Ç–∞–±–µ–ª—å–Ω–æ—Å—Ç–∏
- `mut self` - –∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ `self`, –Ω–æ –º–µ—Ç–æ–¥ –º–æ–∂–µ—Ç –º–æ–¥–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å –æ–±—ä–µ–∫—Ç
- –Ω–µ—Ç –ø–æ–ª—É—á–∞—Ç–µ–ª—è - —Ç–∞–∫–æ–π –º–µ—Ç–æ–¥ —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è —Å—Ç–∞—Ç–∏—á–Ω—ã–º. –û–±—ã—á–Ω–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ –ø–æ —Å–æ–≥–ª–∞—à–µ–Ω–∏—é –≤—ã–∑—ã–≤–∞—é—Ç—Å—è —Å –ø–æ–º–æ—â—å—é `new()`

–†–µ–º–∞—Ä–∫–∏:

- –º–µ—Ç–æ–¥—ã –æ—Ç–ª–∏—á–∞—é—Ç—Å—è –æ—Ç —Ñ—É–Ω–∫—Ü–∏–π —Å–ª–µ–¥—É—é—â–∏–º:
  - –º–µ—Ç–æ–¥—ã –≤—ã–∑—ã–≤–∞—é—Ç—Å—è –Ω–∞ —ç–∫–∑–µ–º–ø–ª—è—Ä–µ —Ç–∏–ø–∞ (—Ç–∞–∫–æ–≥–æ –∫–∞–∫ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –∏–ª–∏ –ø–µ—Ä–µ—á–∏—Å–ª–µ–Ω–∏–µ), –∏—Ö –ø–µ—Ä–≤—ã–π –ø–∞—Ä–∞–º–µ—Ç—Ä - —Å–∞–º —ç–∫–∑–µ–º–ø–ª—è—Ä (`self`)
  - –º–µ—Ç–æ–¥—ã –ø–æ–∑–≤–æ–ª—è—é—Ç –¥–µ—Ä–∂–∞—Ç—å –∫–æ–¥ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–∞ –≤ –æ–¥–Ω–æ–º –º–µ—Å—Ç–µ, —á—Ç–æ —Å–ø–æ—Å–æ–±—Å—Ç–≤—É–µ—Ç –ª—É—á—à–µ–π –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ –∫–æ–¥–∞
- –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –∫–ª—é—á–µ–≤–æ–≥–æ —Å–ª–æ–≤–∞ `self`:
  - `self` —è–≤–ª—è–µ—Ç—Å—è —Å–æ–∫—Ä–∞—â–µ–Ω–∏–µ–º –¥–ª—è `self: Self`, –≤–º–µ—Å—Ç–æ `Self` –º–æ–∂–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –Ω–∞–∑–≤–∞–Ω–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã, –Ω–∞–ø—Ä–∏–º–µ—Ä, `Race`
  - —Ç–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º, `Self` - —ç—Ç–æ —Å–∏–Ω–æ–Ω–∏–º —Ä–µ–∞–ª–∏–∑—É–µ–º–æ–≥–æ (`impl`) —Ç–∏–ø–∞ –∏ –º–æ–∂–µ—Ç –±—ã—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω –≤ –ª—é–±–æ–º –º–µ—Å—Ç–µ –≤–Ω—É—Ç—Ä–∏ –±–ª–æ–∫–∞
  - `self` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∫–∞–∫ –¥—Ä—É–≥–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã, –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ –µ–≥–æ –æ—Ç–¥–µ–ª—å–Ω—ã–º –ø–æ–ª—è–º –º–æ–∂–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è —Ç–æ—á–µ—á–Ω–∞—è –Ω–æ—Ç–∞—Ü–∏—è
  - –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏ —Ä–∞–∑–Ω–∏—Ü—ã –º–µ–∂–¥—É `&self` –∏ `self` –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –∑–∞–ø—É—Å—Ç–∏—Ç—å `finish()` –¥–≤–∞–∂–¥—ã
  - —Å—É—â–µ—Å—Ç–≤—É—é—Ç —Ç–∞–∫–∂–µ [—Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ –æ–±–µ—Ä—Ç–∫–∏ —Ç–∏–ø–æ–≤](https://doc.rust-lang.org/reference/special-types-and-traits.html), –∫–æ—Ç–æ—Ä—ã–µ –º–æ–≥—É—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –≤ –∫–∞—á–µ—Å—Ç–≤–µ —Ç–∏–ø–æ–≤ –ø–æ–ª—É—á–∞—Ç–µ–ª—è, –Ω–∞–ø—Ä–∏–º–µ—Ä, `Box<Self>`

__–¢—Ä–µ–π—Ç—ã__

`Rust` –ø–æ–∑–≤–æ–ª—è–µ—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å –∞–±—Å—Ç—Ä–∞–∫—Ç–Ω—ã–µ —Ç–∏–ø—ã —Å –ø–æ–º–æ—â—å—é —Ç—Ä–µ–π—Ç–æ–≤ (traits). –û–Ω–∏ –ø–æ—Ö–æ–∂–∏ –Ω–∞ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã –≤ –¥—Ä—É–≥–∏—Ö —è–∑—ã–∫–∞—Ö –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—è:

```rust
struct Dog {
    name: String,
    age: i8,
}
struct Cat {
    lives: i8,
}

trait Pet {
    fn talk(&self) -> String;

    fn greet(&self) {
        println!("–ö–∞–∫–∞—è –º–∏–ª–∞—Ö–∞! –ö–∞–∫ —Ç–µ–±—è –∑–æ–≤—É—Ç? {}", self.talk());
    }
}

impl Pet for Dog {
    fn talk(&self) -> String {
        format!("–ì–∞–≤, –º–µ–Ω—è –∑–æ–≤—É—Ç {}!", self.name)
    }
}

impl Pet for Cat {
    fn talk(&self) -> String {
        String::from("–ú–∞—É!")
    }
}

fn main() {
    let captain_floof = Cat { lives: 9 };
    let fido = Dog { name: String::from("–§–∏–¥–æ"), age: 5 };

    captain_floof.greet();
    fido.greet();
}
```

–†–µ–º–∞—Ä–∫–∏:

- —Ç—Ä–µ–π—Ç –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –º–µ—Ç–æ–¥—ã, –∫–æ—Ç–æ—Ä—ã–µ –¥–æ–ª–∂–µ–Ω –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è—Ç—å —Ç–∏–ø –¥–ª—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ —ç—Ç–æ–≥–æ —Ç—Ä–µ–π—Ç–∞
- —Ç—Ä–µ–π—Ç—ã —Ä–µ–∞–ª–∏–∑—É—é—Ç—Å—è –≤ –±–ª–æ–∫–µ `impl <trait> for <type> { .. }`
- —Ç—Ä–µ–π—Ç—ã –º–æ–≥—É—Ç –æ–ø—Ä–µ–¥–µ–ª—è—Ç—å –∫–∞–∫ –¥–µ—Ñ–æ–ª—Ç–Ω—ã–µ –º–µ—Ç–æ–¥—ã, —Ç–∞–∫ –∏ –º–µ—Ç–æ–¥—ã, –∫–æ—Ç–æ—Ä—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥–æ–ª–∂–µ–Ω —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ. –î–µ—Ñ–æ–ª—Ç–Ω—ã–µ –º–µ—Ç–æ–¥—ã –º–æ–≥—É—Ç –ø–æ–ª–∞–≥–∞—Ç—å—Å—è –Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ: `greet()` –∏–º–µ–µ—Ç —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –∏ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç `talk()`

__–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è —Ç—Ä–µ–π—Ç–æ–≤__

–í—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ/—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ —Ç—Ä–µ–π—Ç—ã –º–æ–≥—É—Ç –±—ã—Ç—å —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã –Ω–∞ –∫–∞—Å—Ç–æ–º–Ω—ã—Ö —Ç–∏–ø–∞—Ö –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:

```rust
#[derive(Debug, Clone, Default)]
struct Player {
    name: String,
    strength: u8,
    hit_points: u8,
}

fn main() {
    let p1 = Player::default(); // —Ç—Ä–µ–π—Ç `Default` –¥–æ–±–∞–≤–ª—è–µ—Ç –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä `default()`.
    let mut p2 = p1.clone(); // —Ç—Ä–µ–π—Ç `Clone` –¥–æ–±–∞–≤–ª—è–µ—Ç –º–µ—Ç–æ–¥ `clone()`
    p2.name = String::from("EldurScrollz");
    // –¢—Ä–µ–π—Ç `Debug` –¥–æ–±–∞–≤–ª—è–µ—Ç –ø–æ–¥–¥–µ—Ä–∂–∫—É –≤—ã–≤–æ–¥–∞ –≤ —Ç–µ—Ä–º–∏–Ω–∞–ª —Å –ø–æ–º–æ—â—å—é `{:?}`.
    println!("{:?} vs. {:?}", p1, p2);
}
```

–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è —Å –ø–æ–º–æ—â—å—é –º–∞–∫—Ä–æ—Å–æ–≤, –º–Ω–æ–≥–∏–µ –∫—Ä–µ–π—Ç—ã –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è—é—Ç –º–∞–∫—Ä–æ—Å—ã –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –ø–æ–ª–µ–∑–Ω–æ–≥–æ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–∞. –ù–∞–ø—Ä–∏–º–µ—Ä, –∫—Ä–µ–π—Ç [serde](https://crates.io/crates/serde) –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫—É—é —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏–∏ —Å –ø–æ–º–æ—â—å—é `#[derive(Serialize)]`.

__–¢—Ä–µ–π—Ç-–æ–±—ä–µ–∫—Ç—ã__

–¢—Ä–µ–π—Ç-–æ–±—ä–µ–∫—Ç—ã (trait objects) –ø–æ–∑–≤–æ–ª—è—é—Ç —Ö—Ä–∞–Ω–∏—Ç—å –∑–Ω–∞—á–µ–Ω–∏—è —Ä–∞–∑–Ω—ã—Ö —Ç–∏–ø–æ–≤, –Ω–∞–ø—Ä–∏–º–µ—Ä, –≤ –∫–æ–ª–ª–µ–∫—Ü–∏–∏:

```rust
struct Dog {
    name: String,
    age: i8,
}
struct Cat {
    lives: i8,
}

trait Pet {
    fn talk(&self) -> String;
}

impl Pet for Dog {
    fn talk(&self) -> String {
        format!("–ì–∞–≤, –º–µ–Ω—è –∑–æ–≤—É—Ç {}!", self.name)
    }
}

impl Pet for Cat {
    fn talk(&self) -> String {
        String::from("–ú–∞—É!")
    }
}

fn main() {
    // –¢—Ä–µ–π—Ç-–æ–±—ä–µ–∫—Ç, –∫–æ—Ç–æ—Ä—ã–π –º–æ–∂–µ—Ç —Å–æ–¥–µ—Ä–∂–∞—Ç—å –∑–Ω–∞—á–µ–Ω–∏–µ –ª—é–±–æ–≥–æ —Ç–∏–ø–∞, —Ä–µ–∞–ª–∏–∑—É—é—â–µ–≥–æ —Ç—Ä–µ–π—Ç `Pet`
    let pets: Vec<Box<dyn Pet>> = vec![
        Box::new(Cat { lives: 9 }),
        Box::new(Dog { name: String::from("–§–∏–¥–æ"), age: 5 }),
    ];
    for pet in pets {
        println!("–ü—Ä–∏–≤–µ—Ç, –∫—Ç–æ —Ç—ã? {}", pet.talk());
    }
}
```

–ü–∞–º—è—Ç—å –ø–æ—Å–ª–µ –≤—ã–¥–µ–ª–µ–Ω–∏—è `pets`:

<img src="https://habrastorage.org/webt/cf/ri/s6/cfris6v-ltwp4tskiepa4rghw9e.png" />
<br />

–†–µ–º–∞—Ä–∫–∏:

- —Ç–∏–ø—ã, —Ä–µ–∞–ª–∏–∑—É—é—â–∏–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–π —Ç—Ä–µ–π—Ç, –º–æ–≥—É—Ç –∏–º–µ—Ç—å —Ä–∞–∑–Ω—ã–π —Ä–∞–∑–º–µ—Ä. –≠—Ç–æ –¥–µ–ª–∞–µ—Ç –≤–æ–∑–º–æ–∂–Ω—ã–º —Ç–∞–∫–∏–µ –≤–µ—â–∏, –∫–∞–∫ `Vec<dyn Pet>` –≤ –ø—Ä–∏–º–µ—Ä–µ
- `dyn Pet` - —ç—Ç–æ —Å–ø–æ—Å–æ–± —Å–æ–æ–±—â–∏—Ç—å –∫–æ–º–ø–∏–ª—è—Ç–æ—Ä—É –æ —Ç–∏–ø–µ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–≥–æ —Ä–∞–∑–º–µ—Ä–∞, –∫–æ—Ç–æ—Ä—ã–π —Ä–µ–∞–ª–∏–∑—É–µ—Ç `Pet`
- –≤ –ø—Ä–∏–º–µ—Ä–µ `pets` –≤—ã–¥–µ–ª—è—é—Ç—Å—è –≤ —Å—Ç–µ–∫–µ (stack), –∞ –≤–µ–∫—Ç–æ—Ä - –≤ –∫—É—á–µ (heap). 2 —ç–ª–µ–º–µ–Ω—Ç–∞ –≤–µ–∫—Ç–æ—Ä–∞ —è–≤–ª—è—é—Ç—Å—è –∂–∏—Ä–Ω—ã–º–∏ —É–∫–∞–∑–∞—Ç–µ–ª—è–º–∏ (fat pointers):
  - –∂–∏—Ä–Ω—ã–π —É–∫–∞–∑–∞—Ç–µ–ª—å - —ç—Ç–æ —É–∫–∞–∑–∞—Ç–µ–ª—å –¥–≤–æ–π–Ω–æ–π —à–∏—Ä–∏–Ω—ã. –û–Ω —Å–æ—Å—Ç–æ–∏—Ç –∏–∑ –¥–≤—É—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤: —É–∫–∞–∑–∞—Ç–µ–ª—è –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–π –æ–±—ä–µ–∫—Ç –∏ —É–∫–∞–∑–∞—Ç–µ–ª—è –Ω–∞ [—Ç–∞–±–ª–∏—Ü—É –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã—Ö –º–µ—Ç–æ–¥–æ–≤](https://en.wikipedia.org/wiki/Virtual_method_table) (vtable) –¥–ª—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ `Pet` —ç—Ç–æ–≥–æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –æ–±—ä–µ–∫—Ç–∞
  - –¥–∞–Ω–Ω—ã–º–∏ –¥–ª—è `Dog` —è–≤–ª—è—é—Ç—Å—è `name` –∏ `age`. `Cat` –∏–º–µ–µ—Ç –ø–æ–ª–µ `lives`
- —Å—Ä–∞–≤–Ω–∏—Ç–µ —ç—Ç–∏ –≤—ã–≤–æ–¥—ã:

```rust
println!("{} {}", std::mem::size_of::<Dog>(), std::mem::size_of::<Cat>());
println!("{} {}", std::mem::size_of::<&Dog>(), std::mem::size_of::<&Cat>());
println!("{}", std::mem::size_of::<&dyn Pet>());
println!("{}", std::mem::size_of::<Box<dyn Pet>>());
```

__–£–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ: –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ GUI__

–°–ø—Ä–æ–µ–∫—Ç–∏—Ä—É–µ–º –∫–ª–∞—Å—Å–∏—á–µ—Å–∫—É—é –±–∏–±–ª–∏–æ—Ç–µ–∫—É GUI (graphical user interface - –≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å). –î–ª—è –ø—Ä–æ—Å—Ç–æ—Ç—ã —Ä–µ–∞–ª–∏–∑—É–µ–º —Ç–æ–ª—å–∫–æ –µ–≥–æ —Ä–∏—Å–æ–≤–∞–Ω–∏–µ - –≤—ã–≤–æ–¥ –≤ —Ç–µ—Ä–º–∏–Ω–∞–ª –≤ –≤–∏–¥–µ —Ç–µ–∫—Å—Ç–∞.

–í –Ω–∞—à–µ–π –±–∏–±–ª–∏–æ—Ç–µ–∫–µ –±—É–¥–µ—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ –≤–∏–¥–∂–µ—Ç–æ–≤:

- `Window` - –∏–º–µ–µ—Ç `title` –∏ —Å–æ–¥–µ—Ä–∂–∏—Ç –¥—Ä—É–≥–∏–µ –≤–∏–¥–∂–µ—Ç—ã
- `Button` - –∏–º–µ–µ—Ç `label`. –í —Ä–µ–∞–ª—å–Ω–æ–π –±–∏–±–ª–∏–æ—Ç–µ–∫–µ –∫–Ω–æ–ø–∫–∞ —Ç–∞–∫–∂–µ –±—É–¥–µ—Ç –ø—Ä–∏–Ω–∏–º–∞—Ç—å –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –µ–µ –Ω–∞–∂–∞—Ç–∏—è
- `Label` - –∏–º–µ–µ—Ç `label`

–í–∏–¥–∂–µ—Ç—ã —Ä–µ–∞–ª–∏–∑—É—é—Ç —Ç—Ä–µ–π—Ç `Widget`.

–ù–∞–ø–∏—à–∏—Ç–µ –º–µ—Ç–æ–¥—ã `draw_into()` –¥–ª—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ —Ç—Ä–µ–π—Ç–∞ `Widget`.

```rust
pub trait Widget {
    // –ù–∞—Ç—É—Ä–∞–ª—å–Ω–∞—è —à–∏—Ä–∏–Ω–∞ `self`.
    fn width(&self) -> usize;

    // –†–∏—Å—É–µ–º/–∑–∞–ø–∏—Å—ã–≤–∞–µ–º –≤–∏–¥–∂–µ—Ç –≤ –±—É—Ñ–µ—Ä
    fn draw_into(&self, buffer: &mut dyn std::fmt::Write);

    // –†–∏—Å—É–µ–º –≤–∏–¥–∂–µ—Ç –≤ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –≤—ã–≤–æ–¥
    fn draw(&self) {
        let mut buffer = String::new();
        self.draw_into(&mut buffer);
        println!("{buffer}");
    }
}

// –ü–æ–¥–ø–∏—Å—å –º–æ–∂–µ—Ç —Å–æ—Å—Ç–æ—è—Ç—å –∏–∑ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —Å—Ç—Ä–æ–∫
pub struct Label {
    label: String,
}

impl Label {
    // –ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä –ø–æ–¥–ø–∏—Å–∏
    fn new(label: &str) -> Label {
        Label { label: label.to_owned() }
    }
}

pub struct Button {
    label: Label,
}

impl Button {
    // –ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä –∫–Ω–æ–ø–∫–∏
    fn new(label: &str) -> Button {
        Button { label: Label::new(label) }
    }
}

pub struct Window {
    title: String,
    widgets: Vec<Box<dyn Widget>>,
}

impl Window {
    // –ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä –æ–∫–Ω–∞
    fn new(title: &str) -> Window {
        Window { title: title.to_owned(), widgets: Vec::new() }
    }

    // –ú–µ—Ç–æ–¥ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –≤–∏–¥–∂–µ—Ç–∞
    fn add_widget(&mut self, widget: Box<dyn Widget>) {
        self.widgets.push(widget);
    }

    // –ú–µ—Ç–æ–¥ –ø–æ–ª—É—á–µ–Ω–∏—è –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π —à–∏—Ä–∏–Ω—ã
    fn inner_width(&self) -> usize {
        std::cmp::max(
            self.title.chars().count(),
            self.widgets.iter().map(|w| w.width()).max().unwrap_or(0),
        )
    }
}

impl Widget for Window {
    todo!("—Ä–µ–∞–ª–∏–∑—É–π –º–µ–Ω—è")
}
impl Widget for Button {
    todo!("—Ä–µ–∞–ª–∏–∑—É–π –º–µ–Ω—è")
}
impl Widget for Label {
    todo!("—Ä–µ–∞–ª–∏–∑—É–π –º–µ–Ω—è")
}

fn main() {
    let mut window = Window::new("Rust GUI Demo 1.23");
    window.add_widget(Box::new(Label::new("This is a small text GUI demo.")));
    window.add_widget(Box::new(Button::new("Click me!")));
    window.draw();
}
```

–í—ã–≤–æ–¥ –ø—Ä–æ–≥—Ä–∞–º–º—ã –º–æ–∂–µ—Ç –±—ã—Ç—å –æ—á–µ–Ω—å –ø—Ä–æ—Å—Ç—ã–º:

```rust
========
Rust GUI Demo 1.23
========

This is a small text GUI demo.

| Click me! |
```

–ò–ª–∏ –∂–µ –º–æ–∂–Ω–æ –≤–æ—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞–º–∏ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è [–∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è/–≤—ã—Ä–∞–≤–Ω–∏–≤–∞–Ω–∏—è](https://doc.rust-lang.org/std/fmt/index.html#fillalignment) –¥–ª—è –≤—ã—Ä–∞–≤–Ω–∏–≤–∞–Ω–∏—è —Ç–µ–∫—Å—Ç–∞. –í–æ—Ç –∫–∞–∫ –º–æ–∂–Ω–æ —É–ø—Ä–∞–≤–ª—è—Ç—å –≤—ã—Ä–∞–≤–Ω–∏–≤–∞–Ω–∏–µ–º —Ç–µ–∫—Å—Ç–∞ —Å –ø–æ–º–æ—â—å—é —Ä–∞–∑–Ω—ã—Ö —Å–∏–º–≤–æ–ª–æ–≤ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `/`):

```rust
fn main() {
    let width = 10;
    println!("—Å–ª–µ–≤–∞:     |{:/<width$}|", "foo");
    println!("–ø–æ —Ü–µ–Ω—Ç—Ä—É: |{:/^width$}|", "foo");
    println!("—Å–ø—Ä–∞–≤–∞:    |{:/>width$}|", "foo");
}
```

–≠—Ç–∏ –ø—Ä–∏–µ–º—ã –ø–æ–∑–≤–æ–ª—è—é—Ç —Å–¥–µ–ª–∞—Ç—å –≤—ã–≤–æ–¥ –ø—Ä–æ–≥—Ä–∞–º–º—ã —Ç–∞–∫–∏–º:

```rust
+--------------------------------+
|       Rust GUI Demo 1.23       |
+================================+
| This is a small text GUI demo. |
| +-------------+                |
| |  Click me!  |                |
| +-------------+                |
+--------------------------------+
```

<details>
<summary>–†–µ—à–µ–Ω–∏–µ:</summary>

```rust
impl Widget for Window {
    fn width(&self) -> usize {
        // –î–æ–±–∞–≤–ª—è–µ–º –∫ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π —à–∏—Ä–∏–Ω–µ 4 –¥–ª—è –æ—Ç—Å—Ç—É–ø–æ–≤ –∏ –≥—Ä–∞–Ω–∏—Ü
        // (–ø–æ –æ–¥–Ω–æ–º—É –æ—Ç—Å—Ç—É–ø—É –∏ –≥—Ä–∞–Ω–∏—Ü–µ —Å –∫–∞–∂–¥–æ–π —Å—Ç–æ—Ä–æ–Ω—ã)
        self.inner_width() + 4
    }

    fn draw_into(&self, buffer: &mut dyn std::fmt::Write) {
        let mut inner = String::new();
        for widget in &self.widgets {
            widget.draw_into(&mut inner);
        }

        let inner_width = self.inner_width();

        // TODO: –ø–æ—Å–ª–µ –∏–∑—É—á–µ–Ω–∏—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫, –º–æ–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å —Ç–∞–∫,
        // —á—Ç–æ–±—ã –º–µ—Ç–æ–¥ `draw_into()` –≤–æ–∑–≤—Ä–∞—â–∞–ª `Result<(), std::fmt::Error>`
        // –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∑–¥–µ—Å—å –æ–ø–µ—Ä–∞—Ç–æ—Ä ? –≤–º–µ—Å—Ç–æ `unwrap()`
        writeln!(buffer, "+-{:-<inner_width$}-+", "").unwrap();
        writeln!(buffer, "| {:^inner_width$} |", &self.title).unwrap();
        writeln!(buffer, "+={:=<inner_width$}=+", "").unwrap();
        for line in inner.lines() {
            writeln!(buffer, "| {:inner_width$} |", line).unwrap();
        }
        writeln!(buffer, "+-{:-<inner_width$}-+", "").unwrap();
    }
}

impl Widget for Button {
    fn width(&self) -> usize {
        self.label.width() + 4 // –¥–æ–±–∞–≤–ª—è–µ–º –Ω–µ–º–Ω–æ–≥–æ –æ—Ç—Å—Ç—É–ø–æ–≤ (–ø–æ 2 —Å –∫–∞–∂–¥–æ–π —Å—Ç–æ—Ä–æ–Ω—ã)
    }

    fn draw_into(&self, buffer: &mut dyn std::fmt::Write) {
        let width = self.width();
        let mut label = String::new();
        self.label.draw_into(&mut label);

        writeln!(buffer, "+{:-<width$}+", "").unwrap();
        for line in label.lines() {
            writeln!(buffer, "|{:^width$}|", &line).unwrap();
        }
        writeln!(buffer, "+{:-<width$}+", "").unwrap();
    }
}

impl Widget for Label {
    fn width(&self) -> usize {
        self.label.lines().map(|line| line.chars().count()).max().unwrap_or(0)
    }

    fn draw_into(&self, buffer: &mut dyn std::fmt::Write) {
        writeln!(buffer, "{}", &self.label).unwrap();
    }
}
```

</details>

## –î–∂–µ–Ω–µ—Ä–∏–∫–∏

__–û–±—â–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏__

`Rust` –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –¥–∂–µ–Ω–µ—Ä–∏–∫–∏ (generics), –∫–æ—Ç–æ—Ä—ã–µ –ø–æ–∑–≤–æ–ª—è—é—Ç –∞–±—Å—Ç—Ä–∞–≥–∏—Ä–æ–≤–∞—Ç—å –∞–ª–≥–æ—Ä–∏—Ç–º—ã –∏–ª–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–∞–Ω–Ω—ã—Ö (–Ω–∞–ø—Ä–∏–º–µ—Ä, —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫—É –∏–ª–∏ –¥–≤–æ–∏—á–Ω–æ–µ –¥–µ—Ä–µ–≤–æ) –ø–æ –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–º –∏–ª–∏ —Ö—Ä–∞–Ω–∏–º—ã–º —Ç–∏–ø–∞–º:

```rust
// –§—É–Ω–∫—Ü–∏—è –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `even` –∏–ª–∏ `odd` –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –∑–Ω–∞—á–µ–Ω–∏—è `n`.
// –ó–¥–µ—Å—å `T` - —ç—Ç–æ –ø–∞—Ä–∞–º–µ—Ç—Ä —Ç–∏–ø–∞ (type parameter), –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –¥–∂–µ–Ω–µ—Ä–∏–∫–∞
fn pick<T>(n: i32, even: T, odd: T) -> T {
    if n % 2 == 0 {
        even
    } else {
        odd
    }
}

fn main() {
    println!("–≤–æ–∑–≤—Ä–∞—â–µ–Ω–Ω–æ–µ —á–∏—Å–ª–æ: {:?}", pick(97, 222, 333));
    println!("–≤–æ–∑–≤—Ä–∞—â–µ–Ω–Ω—ã–π –∫–æ—Ä—Ç–µ–∂: {:?}", pick(28, ("dog", 1), ("cat", 2)));
}
```

–†–µ–º–∞—Ä–∫–∏:

- `Rust` –≤—ã–≤–æ–¥–∏—Ç —Ç–∏–ø—ã –¥–ª—è `T` –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ç–∏–ø–æ–≤ –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤ –∏ —Ç–∏–ø–∞ –≤–æ–∑–≤—Ä–∞—â–∞–µ–º–æ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è
- —ç—Ç–æ –ø–æ—Ö–æ–∂–µ –Ω–∞ —à–∞–±–ª–æ–Ω—ã (templates) `C++`, –Ω–æ `Rust` —á–∞—Å—Ç–∏—á–Ω–æ –∫–æ–º–ø–∏–ª–∏—Ä—É–µ—Ç —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—É—é —Ñ—É–Ω–∫—Ü–∏—é —Å—Ä–∞–∑—É, –ø–æ—ç—Ç–æ–º—É —ç—Ç–∞ —Ñ—É–Ω–∫—Ü–∏—è –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –¥–æ–ø—É—Å—Ç–∏–º–æ–π –¥–ª—è –≤—Å–µ—Ö —Ç–∏–ø–æ–≤, —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏—Ö –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è–º. –ù–∞–ø—Ä–∏–º–µ—Ä, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å —Ñ—É–Ω–∫—Ü–∏—é `pick()` —Ç–∞–∫, —á—Ç–æ–±—ã –æ–Ω–∞ –≤–æ–∑–≤—Ä–∞—â–∞–ª–∞ `even + odd`, –µ—Å–ª–∏ `n == 0`. –î–∞–∂–µ –µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è `pick()` —Å —Ü–µ–ª—ã–º–∏ —á–∏—Å–ª–∞–º–∏, `Rust` –≤—Å–µ —Ä–∞–≤–Ω–æ —Å—á–∏—Ç–∞–µ—Ç –µ–µ –Ω–µ–¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ–π. `C++` –ø–æ–∑–≤–æ–ª–∏—Ç –≤–∞–º —ç—Ç–æ —Å–¥–µ–ª–∞—Ç—å
- –æ–±—â–∏–π –∫–æ–¥ –ø—Ä–µ–æ–±—Ä–∞–∑—É–µ—Ç—Å—è –≤ –æ–±—ã—á–Ω—ã–π (–Ω–µ–æ–±–æ–±—â–µ–Ω–Ω—ã–π) –∫–æ–¥ –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ç–æ–≥–æ, –∫–∞–∫ –∫–æ–¥ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è. –≠—Ç–æ –∞–±—Å—Ç—Ä–∞–∫—Ü–∏—è —Å –Ω—É–ª–µ–≤–æ–π —Å—Ç–æ–∏–º–æ—Å—Ç—å—é: –º—ã –ø–æ–ª—É—á–∞–µ–º —Ç–æ—á–Ω–æ —Ç–∞–∫–æ–π –∂–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç, –∫–∞–∫ –µ—Å–ª–∏ –±—ã –≤—Ä—É—á–Ω—É—é –∑–∞–∫–æ–¥–∏—Ä–æ–≤–∞–ª–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–∞–Ω–Ω—ã—Ö –±–µ–∑ –∞–±—Å—Ç—Ä–∞–∫—Ü–∏–∏

__–û–±—â–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã__

–î–∂–µ–Ω–µ—Ä–∏–∫–∏ –º–æ–≥—É—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –¥–ª—è –∞–±—Å—Ç—Ä–∞–≥–∏—Ä–æ–≤–∞–Ω–∏—è —Ç–∏–ø–æ–≤ –ø–æ–ª–µ–π —Å—Ç—Ä—É–∫—Ç—É—Ä:

```rust
#[derive(Debug)]
struct Point<T> {
    x: T,
    y: T,
}

impl<T> Point<T> {
    fn coords(&self) -> (&T, &T) {
        (&self.x, &self.y)
    }

    // fn set_x(&mut self, x: T)
}

fn main() {
    let integer = Point { x: 5, y: 10 };
    let float = Point { x: 1.0, y: 4.0 };
    println!("{integer:?} –∏ {float:?}");
    println!("–∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã: {:?}", integer.coords());
}
```

- –ü–æ—á–µ–º—É `T` –æ–ø—Ä–µ–¥–µ–ª–µ–Ω –¥–≤–∞–∂–¥—ã –≤ `impl<T> Point<T>`? –ü–æ—Ç–æ–º—É —á—Ç–æ:
  - —ç—Ç–æ –æ–±—â–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –æ–±—â–µ–≥–æ —Ç–∏–ø–∞ - —Ä–∞–∑–Ω—ã–µ –¥–∂–µ–Ω–µ—Ä–∏–∫–∏
  - —ç—Ç–∏ –º–µ—Ç–æ–¥—ã –æ–ø—Ä–µ–¥–µ–ª—è—é—Ç—Å—è –¥–ª—è –ª—é–±–æ–≥–æ `T`
  - –º–æ–∂–Ω–æ –Ω–∞–ø–∏—Å–∞—Ç—å `impl Point<u32>`, —Ç–æ–≥–¥–∞:
    - `Point` –ø–æ-–ø—Ä–µ–∂–Ω–µ–º—É –±—É–¥–µ—Ç –¥–∂–µ–Ω–µ—Ä–∏–∫–æ–º, –∏ –º—ã —Å–º–æ–∂–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `Point<f64>`, –Ω–æ –º–µ—Ç–æ–¥—ã –≤ —ç—Ç–æ–º –±–ª–æ–∫–µ –±—É–¥—É—Ç –¥–æ—Å—Ç—É–ø–Ω—ã —Ç–æ–ª—å–∫–æ –¥–ª—è `Point<u32>`
- –æ–ø—Ä–µ–¥–µ–ª–∏—Ç–µ –Ω–æ–≤—É—é –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é `let p = Point { x: 5, y: 10.0 };` –∏ –æ–±–Ω–æ–≤–∏—Ç–µ –∫–æ–¥, —á—Ç–æ–±—ã –æ–Ω —Ä–∞–±–æ—Ç–∞–ª —Å —Ä–∞–∑–Ω—ã–º–∏ —Ç–∏–ø–∞–º–∏ - –¥–ª—è —ç—Ç–æ–≥–æ –ø–æ—Ç—Ä–µ–±—É–µ—Ç—Å—è 2 –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ —Ç–∏–ø–∞, –Ω–∞–ø—Ä–∏–º–µ—Ä, `T` –∏ `U`

__–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ —Ç—Ä–µ–π—Ç–æ–º__

–ü—Ä–∏ —Ä–∞–±–æ—Ç–µ —Å –¥–∂–µ–Ω–µ—Ä–∏–∫–∞–º–∏ —á–∞—Å—Ç–æ —Ç—Ä–µ–±—É–µ—Ç—Å—è, —á—Ç–æ–±—ã —Ç–∏–ø—ã —Ä–µ–∞–ª–∏–∑–æ–≤—ã–≤–∞–ª–∏ –∫–∞–∫–æ–π-—Ç–æ —Ç—Ä–µ–π—Ç, —á—Ç–æ–±—ã –º–æ–∂–Ω–æ –±—ã–ª–æ –≤—ã–∑—ã–≤–∞—Ç—å –µ–≥–æ –º–µ—Ç–æ–¥—ã.

–≠—Ç–æ –¥–µ–ª–∞–µ—Ç—Å—è —Å –ø–æ–º–æ—â—å—é `T: Trait` –∏–ª–∏ `impl Trait`:

```rust
fn duplicate<T: Clone>(a: T) -> (T, T) {
    (a.clone(), a.clone())
}

// struct NotClonable;

fn main() {
    let foo = String::from("foo");
    let pair = duplicate(foo);
    println!("{pair:?}");
}
```

- –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–æ–∑–¥–∞—Ç—å `NotClonable` –∏ –ø–µ—Ä–µ–¥–∞—Ç—å –µ–µ –≤ `duplicate()`
- –¥–ª—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —Ç—Ä–µ–π—Ç–æ–≤ –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `+` –¥–ª—è –∏—Ö –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏—è
- —Ç—Ä–µ—Ç—å–∏–º –≤–∞—Ä–∏–∞–Ω—Ç–æ–º —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ —Ç—Ä–µ–π—Ç–∞ —è–≤–ª—è–µ—Ç—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∫–ª—é—á–µ–≤–æ–≥–æ —Å–ª–æ–≤–∞ `where`:

```rust
fn duplicate<T>(a: T) -> (T, T)
where
    T: Clone,
{
    (a.clone(), a.clone())
}
```

  - `where` "–æ—á–∏—â–∞–µ—Ç" —Å–∏–≥–Ω–∞—Ç—É—Ä—É —Ñ—É–Ω–∫—Ü–∏–∏, –µ—Å–ª–∏ —É –Ω–µ–µ –º–Ω–æ–≥–æ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤.
  - `where` –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏, —á—Ç–æ –¥–µ–ª–∞–µ—Ç –µ–≥–æ –±–æ–ª–µ–µ –º–æ—â–Ω—ã–º:
    - —Ç–∏–ø —Å–ª–µ–≤–∞ –æ—Ç `:` –º–æ–∂–µ—Ç –±—ã—Ç—å –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–º (`Option<T>`)
- –æ–±—Ä–∞—Ç–∏—Ç–µ –≤–Ω–∏–º–∞–Ω–∏–µ, —á—Ç–æ `Rust` (–ø–æ–∫–∞) –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é (–ø–µ—Ä–µ–≥—Ä—É–∑–∫—É —Ñ—É–Ω–∫—Ü–∏–∏). –ù–∞–ø—Ä–∏–º–µ—Ä, —É—á–∏—Ç—ã–≤–∞—è –∏—Å—Ö–æ–¥–Ω—É—é `duplicate()`, –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—É—é `duplicate(a: u32)`

__impl Trait__

–ü–æ –∞–Ω–∞–ª–æ–≥–∏–∏ —Å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ–º —Ç–∏–ø–∞ —Ç—Ä–µ–π—Ç–æ–º, —Å–∏–Ω—Ç–∞–∫—Å–∏—Å `impl Trait` –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞—Ö –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ–º–æ–º –∑–Ω–∞—á–µ–Ω–∏–∏ —Ñ—É–Ω–∫—Ü–∏–∏:

```rust
// –°–∏–Ω—Ç–∞–∫—Å–∏—á–µ—Å–∫–∏–π —Å–∞—Ö–∞—Ä –¥–ª—è:
//   fn add_42_millions<T: Into<i32>>(x: T) -> i32 {
fn add_42_millions(x: impl Into<i32>) -> i32 {
    x.into() + 42_000_000
}

fn pair_of(x: u32) -> impl std::fmt::Debug {
    (x + 1, x - 1)
}

fn main() {
    let many = add_42_millions(42_i8);
    println!("{many}");
    let many_more = add_42_millions(10_000_000);
    println!("{many_more}");
    let debuggable = pair_of(27);
    println!("–æ—Ç–ª–∞–∂–∏–≤–∞–µ–º—ã–π: {debuggable:?}");
}
```

- `impl Trait` –ø–æ–∑–≤–æ–ª—è–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å —Å –±–µ–∑—ã–º—è–Ω–Ω—ã–º–∏ —Ç–∏–ø–∞–º–∏. –ó–Ω–∞—á–µ–Ω–∏–µ `impl Trait` –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –º–µ—Å—Ç–∞ –µ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:
  - –¥–ª—è –ø–∞—Ä–∞–º–µ—Ç—Ä–∞ `impl Trait` –ø–æ—Ö–æ–∂ –Ω–∞ –∞–Ω–æ–Ω–∏–º–Ω—ã–π –æ–±—â–∏–π –ø–∞—Ä–∞–º–µ—Ç—Ä —Å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ–º —Ç—Ä–µ–π—Ç–æ–º
  - –¥–ª—è –≤–æ–∑–≤—Ä–∞—â–∞–µ–º–æ–≥–æ —Ç–∏–ø–∞ —ç—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ –æ–Ω - —ç—Ç–æ –Ω–µ–∫–∏–π –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π —Ç–∏–ø, —Ä–µ–∞–ª–∏–∑—É—é—â–∏–π –ø—Ä–∏–∑–Ω–∞–∫, –±–µ–∑ —É–∫–∞–∑–∞–Ω–∏—è —Ç–∏–ø–∞. –≠—Ç–æ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø–æ–ª–µ–∑–Ω—ã–º, –µ—Å–ª–∏ –º—ã –Ω–µ —Ö–æ—Ç–∏–º —Ä–∞—Å–∫—Ä—ã–≤–∞—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π —Ç–∏–ø –≤ –æ–±—â–µ–¥–æ—Å—Ç—É–ø–Ω–æ–º API
- –∫–∞–∫–æ–≤ —Ç–∏–ø `debuggable`? –ù–∞–ø–∏—à–∏—Ç–µ `let debuggable: () = ..` –∏ –∏–∑—É—á–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ

__–£–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ: –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–≥–æ –∑–Ω–∞—á–µ–Ω–∏–µ —Å –ø–æ–º–æ—â—å—é –¥–∂–µ–Ω–µ—Ä–∏–∫–∞__

–í —ç—Ç–æ–º –Ω–µ–±–æ–ª—å—à–æ–º —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–∏ –º—ã —Å –ø–æ–º–æ—â—å—é —Ç—Ä–µ–π—Ç–∞ `LessThan` —Ä–µ–∞–ª–∏–∑—É–µ–º –æ–±—â—É—é —Ñ—É–Ω–∫—Ü–∏—é `min()`, –∫–æ—Ç–æ—Ä–∞—è –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –Ω–∞–∏–º–µ–Ω—å—à–µ–µ –∏–∑ –¥–≤—É—Ö –∑–Ω–∞—á–µ–Ω–∏–π.

```rust
trait LessThan {
    // –í–æ–∑–≤—Ä–∞—â–∞–µ–º `true`, –µ—Å–ª–∏ `self` –º–µ–Ω—å—à–µ —á–µ–º `other`
    fn less_than(&self, other: &Self) -> bool;
}

#[derive(Debug, PartialEq, Eq, Clone, Copy)]
struct Citation {
    author: &'static str,
    year: u32,
}

impl LessThan for Citation {
    fn less_than(&self, other: &Self) -> bool {
        if self.author < other.author {
            true
        } else if self.author > other.author {
            false
        } else {
            self.year < other.year
        }
    }
}

fn min() {
    todo!("—Ä–µ–∞–ª–∏–∑—É–π –º–µ–Ω—è")
}

fn main() {
    let cit1 = Citation { author: "Shapiro", year: 2011 };
    let cit2 = Citation { author: "Baumann", year: 2010 };
    let cit3 = Citation { author: "Baumann", year: 2019 };
    // –û—Ç–ª–∞–¥–æ—á–Ω–∞—è –≤–µ—Ä—Å–∏—è `assert_eq!`, –∫–æ—Ç–æ—Ä–∞—è —É–¥–∞–ª—è–µ—Ç—Å—è –∏–∑ –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–µ–Ω–Ω—ã—Ö —Å–±–æ—Ä–æ–∫
    debug_assert_eq!(min(cit1, cit2), cit2);
    debug_assert_eq!(min(cit2, cit3), cit2);
    debug_assert_eq!(min(cit1, cit3), cit3);
}
```

<details>
<summary>–†–µ—à–µ–Ω–∏–µ:</summary>

```rust
fn min<T: LessThan>(l: T, r: T) -> T {
    if l.less_than(&r) {
        l
    } else {
        r
    }
}
```

</details>

## –¢–∏–ø—ã, –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ–º—ã–µ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–π –±–∏–±–ª–∏–æ—Ç–µ–∫–æ–π Rust

`Rust` –ø–æ—Å—Ç–∞–≤–ª—è–µ—Ç—Å—è —Å–æ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–π –±–∏–±–ª–∏–æ—Ç–µ–∫–æ–π, –∫–æ—Ç–æ—Ä–∞—è –ø–æ–º–æ–≥–∞–µ—Ç –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –Ω–∞–±–æ—Ä –æ–±—â–∏—Ö —Ç–∏–ø–æ–≤, –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö –±–∏–±–ª–∏–æ—Ç–µ–∫–∞–º–∏ –∏ –ø—Ä–æ–≥—Ä–∞–º–º–∞–º–∏ `Rust`. –¢–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º, –¥–≤–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ –º–æ–≥—É—Ç –±–µ—Å–ø—Ä–µ–ø—è—Ç—Å—Ç–≤–µ–Ω–Ω–æ —Ä–∞–±–æ—Ç–∞—Ç—å –≤–º–µ—Å—Ç–µ, –ø–æ—Å–∫–æ–ª—å–∫—É –æ–±–µ –æ–Ω–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç –æ–¥–∏–Ω –∏ —Ç–æ—Ç –∂–µ —Ç–∏–ø `String`, –Ω–∞–ø—Ä–∏–º–µ—Ä.

–ù–∞ —Å–∞–º–æ–º –¥–µ–ª–µ `Rust` —Å–æ–¥–µ—Ä–∂–∏—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–ª–æ–µ–≤ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–π –±–∏–±–ª–∏–æ—Ç–µ–∫–∏: `core`, `alloc` –∏ `std`:

- `core` —Å–æ–¥–µ—Ä–∂–∏—Ç —Å–∞–º—ã–µ –æ—Å–Ω–æ–≤–Ω—ã–µ —Ç–∏–ø—ã –∏ —Ñ—É–Ω–∫—Ü–∏–∏, –∫–æ—Ç–æ—Ä—ã–µ –Ω–µ –∑–∞–≤–∏—Å—è—Ç –æ—Ç `libc`, —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–∏—Ç–µ–ª—è (allocator) –∏–ª–∏ –¥–∞–∂–µ –Ω–∞–ª–∏—á–∏—è –æ–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã
- `alloc` –≤–∫–ª—é—á–∞–µ—Ç —Ç–∏–ø—ã, –¥–ª—è –∫–æ—Ç–æ—Ä—ã—Ö —Ç—Ä–µ–±—É–µ—Ç—Å—è –≥–ª–æ–±–∞–ª—å–Ω—ã–π —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–∏—Ç–µ–ª—å –∫—É—á–∏, –Ω–∞–ø—Ä–∏–º–µ—Ä `Vec`, `Box` –∏ `Arc`
- –≤—Å—Ç—Ä–∞–∏–≤–∞–µ–º—ã–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è, –Ω–∞–ø–∏—Å–∞–Ω–Ω—ã–µ –Ω–∞ `Rust`, —á–∞—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É—é—Ç —Ç–æ–ª—å–∫–æ `core` –∏ –∏–Ω–æ–≥–¥–∞ `alloc`

__–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è__

`Rust` –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –∑–∞–º–µ—á–∞—Ç–µ–ª—å–Ω—É—é –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é, –Ω–∞–ø—Ä–∏–º–µ—Ä:

- –æ–ø–∏—Å–∞–Ω–∏–µ –≤—Å–µ—Ö –ø–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–µ–π [—Ü–∏–∫–ª–æ–≤](https://doc.rust-lang.org/stable/reference/expressions/loop-expr.html)
- –æ–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–∏–º–∏—Ç–∏–≤–Ω—ã—Ö —Ç–∏–ø–æ–≤, –≤—Ä–æ–¥–µ [u8](https://doc.rust-lang.org/stable/std/primitive.u8.html)
- –æ–ø–∏—Å–∞–Ω–∏–µ —Ç–∏–ø–æ–≤ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–π –±–∏–±–ª–∏–æ—Ç–µ–∫–∏, —Ç–∞–∫–∏—Ö –∫–∞–∫ [Option](https://doc.rust-lang.org/stable/std/option/enum.Option.html) –∏–ª–∏ [BinaryHeap](https://doc.rust-lang.org/stable/std/collections/struct.BinaryHeap.html)

–ú—ã –º–æ–∂–µ–º –¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–π –∫–æ–¥:

```rust
/// –§—É–Ω–∫—Ü–∏—è –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç, –º–æ–∂–Ω–æ –ª–∏ –ø–µ—Ä–≤—ã–π –∞—Ä–≥—É–º–µ–Ω—Ç –¥–µ–ª–∏—Ç—å –Ω–∞ –≤—Ç–æ—Ä–æ–π
///
/// –ï—Å–ª–∏ –≤—Ç–æ—Ä—ã–º –∞—Ä–≥—É–º–µ–Ω—Ç–æ–º —è–≤–ª—è–µ—Ç—Å—è 0, —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–º —è–≤–ª—è–µ—Ç—Å—è `false`
fn is_divisible_by(lhs: u32, rhs: u32) -> bool {
    if rhs == 0 {
        return false;
    }
    lhs % rhs == 0
}
```

–°–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ä–∞—Å—Å–º–∞—Ç—Ä–∏–≤–∞–µ—Ç—Å—è –∫–∞–∫ `Markdown`. –í—Å–µ –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–Ω—ã–µ –±–∏–±–ª–∏–æ—Ç–µ—á–Ω—ã–µ –∫—Ä–µ–π—Ç—ã (crates) `Rust` –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä—É—é—Ç—Å—è –Ω–∞ [docs.rs](https://docs.rs/) —Å –ø–æ–º–æ—â—å—é –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞ [rusdoc](https://doc.rust-lang.org/rustdoc/what-is-rustdoc.html).

–ß—Ç–æ–±—ã –¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å —ç–ª–µ–º–µ–Ω—Ç –≤–Ω—É—Ç—Ä–∏ –¥—Ä—É–≥–æ–≥–æ —ç–ª–µ–º–µ–Ω—Ç–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –≤–Ω—É—Ç—Ä–∏ –º–æ–¥—É–ª—è), –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `//!` –∏–ª–∏ `/*! .. */`, –Ω–∞–∑—ã–≤–∞–µ–º—ã–µ "–≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–º–∏ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è–º–∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞":

```rust
//! –≠—Ç–æ—Ç –º–æ–¥–µ–ª—å —Å–æ–¥–µ—Ä–∂–∏—Ç —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª, —Å–≤—è–∑–∞–Ω–Ω—ã–π —Å –¥–µ–ª–µ–Ω–∏–µ–º —Ü–µ–ª—ã—Ö —á–∏—Å–µ–ª
```

- –í–∑–≥–ª—è–Ω–∏—Ç–µ –Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é –∫—Ä–µ–π—Ç–∞ [rand](https://docs.rs/rand)

__Option__

–ú—ã —É–∂–µ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ä–∞–∑ –≤—Å—Ç—Ä–µ—á–∞–ª–∏—Å—å —Å `Option`. –û–Ω —Ö—Ä–∞–Ω–∏—Ç –ª–∏–±–æ –Ω–µ–∫–æ—Ç–æ—Ä–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ `Some(T)`, –ª–∏–±–æ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –æ—Ç—Å—É—Ç—Å—Ç–≤–∏—è –∑–Ω–∞—á–µ–Ω–∏—è `None`. –ù–∞–ø—Ä–∏–º–µ—Ä, [String::find()](https://doc.rust-lang.org/stable/std/string/struct.String.html#method.find) –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `Option<usize>`:

```rust
fn main() {
    let name = "L√∂we ËÄÅËôé L√©opard Gepardi";
    let mut position: Option<usize> = name.find('√©');
    println!("find –≤–µ—Ä–Ω—É–ª {position:?}");
    assert_eq!(position.unwrap(), 14);
    position = name.find('Z');
    println!("find –≤–µ—Ä–Ω—É–ª {position:?}");
    assert_eq!(position.expect("—Å–∏–º–≤–æ–ª –Ω–µ –Ω–∞–π–¥–µ–Ω"), 0);
}
```

–†–µ–º–∞—Ä–∫–∏:

- `Option` —à–∏—Ä–æ–∫–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è, –Ω–µ —Ç–æ–ª—å–∫–æ –≤ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–π –±–∏–±–ª–∏–æ—Ç–µ–∫–µ
- `unwrap()` –ª–∏–±–æ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∑–Ω–∞—á–µ–Ω–∏–µ `Some`, –ª–∏–±–æ –ø–∞–Ω–∏–∫—É–µ—Ç. `expect()` –ø–æ—Ö–æ–∂ –Ω–∞ `unwrap()`, –Ω–æ –ø—Ä–∏–Ω–∏–º–∞–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ
  - –º—ã –º–æ–∂–µ–º –ø–∞–Ω–∏–∫–æ–≤–∞—Ç—å –Ω–∞ `None`, –Ω–æ –º—ã —Ç–∞–∫–∂–µ –º–æ–∂–µ–º "—Å–ª—É—á–∞–π–Ω–æ" –∑–∞–±—ã—Ç—å –ø—Ä–æ–≤–µ—Ä–∏—Ç—å `None`
  - `unwrap()`/`expect()` –æ–±—ã—á–Ω–æ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –¥–ª—è —Ä–∞—Å–ø–∞–∫–æ–≤–∫–∏ `Some` –≤ –º–µ—Å—Ç–∞—Ö, –≥–¥–µ –º—ã –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ —É–≤–µ—Ä–µ–Ω—ã –≤ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π —Ä–∞–±–æ—Ç–µ –∫–æ–¥–∞. –ö–∞–∫ –ø—Ä–∞–≤–∏–ª–æ, –≤ —Ä–µ–∞–ª—å–Ω—ã—Ö –ø—Ä–æ–≥—Ä–∞–º–º–∞—Ö `None` –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è –ª—É—á—à–∏–º —Å–ø–æ—Å–æ–±–æ–º
- –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –Ω–∏—à–∏ (niche optimization) –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ `Option<T>` —á–∞—Å—Ç–æ –∑–∞–Ω–∏–º–∞–µ—Ç —Å—Ç–æ–ª—å–∫–æ –∂–µ –ø–∞–º—è—Ç–∏, —Å–∫–æ–ª—å–∫–æ `T`

__Result__

`Result` –ø–æ—Ö–æ–∂ –Ω–∞ `Option`, –Ω–æ —è–≤–ª—è–µ—Ç—Å—è –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–æ–º —É—Å–ø–µ—Ö–∞ –∏–ª–∏ –ø—Ä–æ–≤–∞–ª–∞ –æ–ø–µ—Ä–∞—Ü–∏–∏, –∫–∞–∂–¥—ã–π —Å–æ —Å–≤–æ–∏–º —Ç–∏–ø–æ–º. –í –¥–∂–µ–Ω–µ—Ä–∏–∫–µ `Result<T, E>` `T` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ –≤–∞—Ä–∏–∞–Ω—Ç–µ `Ok`, –∞ `E` - –≤ –≤–∞—Ä–∏–∞–Ω—Ç–µ `Err`.

```rust
use std::fs::File;
use std::io::Read;

fn main() {
    let file: Result<File, std::io::Error> = File::open("diary.txt");
    match file {
        Ok(mut file) => {
            let mut contents = String::new();
            if let Ok(bytes) = file.read_to_string(&mut contents) {
                println!("{contents}\n({bytes} –±–∞–π—Ç)");
            } else {
                println!("–ù–µ–≤–æ–∑–º–æ–∂–Ω–æ –ø—Ä–æ—á–∏—Ç–∞—Ç—å —Ñ–∞–π–ª");
            }
        }
        Err(err) => {
            println!("–ù–µ–≤–æ–∑–º–æ–∂–Ω–æ –æ—Ç–∫—Ä—ã—Ç—å –¥–Ω–µ–≤–Ω–∏–∫: {err}");
        }
    }
}
```

–†–µ–º–∞—Ä–∫–∏:

- –∫–∞–∫ –∏ –≤ —Å–ª—É—á–∞–µ —Å `Option`, –∑–Ω–∞—á–µ–Ω–∏–µ `Result` –º–æ–∂–µ—Ç –±—ã—Ç—å –∏–∑–≤–ª–µ—á–µ–Ω–æ —Å –ø–æ–º–æ—â—å—é `unwrap()`/`expect()`
- `Result` —Å–æ–¥–µ—Ä–∂–∏—Ç –±–æ–ª—å—à–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–ª–µ–∑–Ω—ã—Ö –º–µ—Ç–æ–¥–æ–≤, –ø–æ—ç—Ç–æ–º—É —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –æ–∑–Ω–∞–∫–æ–º–∏—Ç—å—Å—è —Å –µ–≥–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–µ–π
- `Result` - —ç—Ç–æ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π —Å–ø–æ—Å–æ–± –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫, –æ —á–µ–º –º—ã –ø–æ–≥–æ–≤–æ—Ä–∏–º –≤ —Ç—Ä–µ—Ç—å–µ–π —á–∞—Å—Ç–∏ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–∞
- –ø—Ä–∏ —Ä–∞–±–æ—Ç–µ —Å –≤–≤–æ–¥–æ–º/–≤—ã–≤–æ–¥–æ–º —Ç–∏–ø `Result<T, std::io::Error>` —è–≤–ª—è–µ—Ç—Å—è –Ω–∞—Å—Ç–æ–ª—å–∫–æ —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω–µ–Ω–Ω—ã–º, —á—Ç–æ `std::io` –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–π `Result`, –ø–æ–∑–≤–æ–ª—è—é—â–∏–π —É–∫–∞–∑—ã–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ —Ç–∏–ø –∑–Ω–∞—á–µ–Ω–∏—è `Ok`:

```rust
use std::fs::File;
use std::io::{Read, Result};

// `main()` —Ç–æ–∂–µ –º–æ–∂–µ—Ç –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å `Result`
fn main() -> Result<()> {
    // –û–ø–µ—Ä–∞—Ç–æ—Ä `?` –ª–∏–±–æ —Ä–∞—Å–ø–∞–∫–æ–≤—ã–≤–∞–µ—Ç –∑–Ω–∞—á–µ–Ω–∏–µ `Ok`, –ª–∏–±–æ —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω—è–µ—Ç –æ—à–∏–±–∫—É (–≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –µ–µ –≤—ã–∑—ã–≤–∞—é—â–µ–º—É)
    let mut file = File::open("diary.txt")?;
    let mut contents = String::new();
    let bytes = file.read_to_string(&mut contents)?;
    println!("{contents}\n({bytes} –±–∞–π—Ç)");
    Ok(())
}
```

__String__

[String](https://doc.rust-lang.org/std/string/struct.String.html) - —ç—Ç–æ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –≤—ã–¥–µ–ª—è–µ–º—ã–π –≤ –∫—É—á–µ (heap-allocated) —Ä–∞—Å—à–∏—Ä—è–µ–º—ã–π (growable) UTF-8 —Å—Ç—Ä–æ–∫–æ–≤—ã–π –±—É—Ñ–µ—Ä:

```rust
fn main() {
    let mut s1 = String::new();
    s1.push_str("–ø—Ä–∏–≤–µ—Ç");
    println!("s1: –¥–ª–∏–Ω–∞ = {}, –µ–º–∫–æ—Å—Ç—å = {}", s1.len(), s1.capacity());

    let mut s2 = String::with_capacity(s1.len() + 1);
    s2.push_str(&s1);
    s2.push('!');
    println!("s2: –¥–ª–∏–Ω–∞ = {}, –µ–º–∫–æ—Å—Ç—å = {}", s2.len(), s2.capacity());

    let s3 = String::from("üá®üá≠");
    println!("s3: –¥–ª–∏–Ω–∞ = {}, –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–∏–º–≤–æ–ª–æ–≤ = {}", s3.len(), s3.chars().count());
}
```

`String` —Ä–µ–∞–ª–∏–∑—É–µ—Ç [`Deref<Target = str>`](https://doc.rust-lang.org/std/string/struct.String.html#deref-methods-str): –º—ã –º–æ–∂–µ–º –≤—ã–∑—ã–≤–∞—Ç—å –≤—Å–µ –º–µ—Ç–æ–¥—ã `str` –Ω–∞ `String`.

–†–µ–º–∞—Ä–∫–∏:

- `String::new()` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –Ω–æ–≤—É—é –ø—É—Å—Ç—É—é —Å—Ç—Ä–æ–∫—É. –ö–æ–≥–¥–∞ –∑–∞—Ä–∞–Ω–µ–µ –∏–∑–≤–µ—Å—Ç–µ–Ω —Ä–∞–∑–º–µ—Ä —Å—Ç—Ä–æ–∫–∏, –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `String::with_capacity()`
- `String::len()` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ä–∞–∑–º–µ—Ä `String` –≤ –±–∞–π—Ç–∞—Ö (–∫–æ—Ç–æ—Ä—ã–π –º–æ–∂–µ—Ç –æ—Ç–ª–∏—á–∞—Ç—å—Å—è –æ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —Å–∏–º–≤–æ–ª–æ–≤)
- `String::chars()` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∏—Ç–µ—Ä–∞—Ç–æ—Ä –ø–æ –Ω–∞—Å—Ç–æ—è—â–∏–º —Å–∏–º–≤–æ–ª–∞–º. –û–±—Ä–∞—Ç–∏—Ç–µ –≤–Ω–∏–º–∞–Ω–∏–µ, —á—Ç–æ `char` –º–æ–∂–µ—Ç –æ—Ç–ª–∏—á–∞—Ç—å—Å—è –æ—Ç —Ç–æ–≥–æ, —á—Ç–æ –º—ã –ø—Ä–∏–≤—ã–∫–ª–∏ —Å—á–∏—Ç–∞—Ç—å "—Å–∏–º–≤–æ–ª–æ–º", —Å–æ–≥–ª–∞—Å–Ω–æ [–∫–ª–∞—Å—Ç–µ—Ä–∞–º –≥—Ä–∞—Ñ–µ–º](https://docs.rs/unicode-segmentation/latest/unicode_segmentation/struct.Graphemes.html) (grapheme clusters)
- –∫–æ–≥–¥–∞ –º—ã –≥–æ–≤–æ—Ä–∏–º –æ —Å—Ç—Ä–æ–∫–∞—Ö, –º—ã –≥–æ–≤–æ—Ä–∏–º –æ `&str` –∏–ª–∏ `String`
- –∫–æ–≥–¥–∞ —Ç–∏–ø —Ä–µ–∞–ª–∏–∑—É–µ—Ç `Deref<Target = T>`, –∫–æ–º–ø–∏–ª—è—Ç–æ—Ä –ø–æ–∑–≤–æ–ª—è–µ—Ç –ø—Ä–æ–∑—Ä–∞—á–Ω–æ –≤—ã–∑—ã–≤–∞—Ç—å –º–µ—Ç–æ–¥—ã `T`
  - `String` —Ä–µ–∞–ª–∏–∑—É–µ—Ç `Deref<Target = str>`, —á—Ç–æ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –µ–π –¥–æ—Å—Ç—É–ø –∫ –º–µ—Ç–æ–¥–∞–º `str`
  - –Ω–∞–ø–∏—à–∏—Ç–µ –∏ —Å—Ä–∞–≤–Ω–∏—Ç–µ `let s3 = s1.deref();` –∏ `let s3 = &*s1;`
- `String` —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω –∫–∞–∫ –æ–±–µ—Ä—Ç–∫–∞ –Ω–∞–¥ –≤–µ–∫—Ç–æ—Ä–æ–º –±–∞–π—Ç, –º–Ω–æ–≥–∏–µ –º–µ—Ç–æ–¥—ã –≤–µ–∫—Ç–æ—Ä–∞ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è `String`, –Ω–æ —Å –Ω–µ–∫–æ—Ç–æ—Ä—ã–º–∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è–º–∏ (–≥–∞—Ä–∞–Ω—Ç–∏—è–º–∏)
- —Å—Ä–∞–≤–Ω–∏—Ç–µ —Ä–∞–∑–Ω—ã–µ —Å–ø–æ—Å–æ–±—ã –∏–Ω–¥–µ–∫—Å–∏—Ä–æ–≤–∞–Ω–∏—è `String`:
  - –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ —Å–∏–º–≤–æ–ª–∞ —Å –ø–æ–º–æ—â—å—é `s3.chars().nth(i).unwrap()`, –≥–¥–µ `i` –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ –≥—Ä–∞–Ω–∏—Ü–∞—Ö —Å—Ç—Ä–æ–∫–∏ –∏ –∑–∞ –∏—Ö –ø—Ä–µ–¥–µ–ª–∞–º–∏
  - –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ –ø–æ–¥—Å—Ç—Ä–æ–∫–∏ (—Å—Ä–µ–∑–∞ - slice) —Å –ø–æ–º–æ—â—å—é `s3[0..4]`, –≥–¥–µ –¥–∏–∞–ø–∞–∑–æ–Ω –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ –≥—Ä–∞–Ω–∏—Ü–∞—Ö —Å–∏–º–≤–æ–ª–æ–≤ (character boundaries) –∏ –∑–∞ –∏—Ö –ø—Ä–µ–¥–µ–ª–∞–º–∏

__Vec__

[Vec](https://doc.rust-lang.org/std/vec/struct.Vec.html) - —ç—Ç–æ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π —Ä–∞—Å—à–∏—Ä—è–µ–º—ã–π (resizable) –±—É—Ñ–µ—Ä, –≤—ã–¥–µ–ª—è–µ–º—ã–π –≤ –∫—É—á–µ:

```rust
fn main() {
    let mut v1 = Vec::new();
    v1.push(42);
    println!("v1: –¥–ª–∏–Ω–∞ = {}, –µ–º–∫–æ—Å—Ç—å = {}", v1.len(), v1.capacity());

    let mut v2 = Vec::with_capacity(v1.len() + 1);
    v2.extend(v1.iter());
    v2.push(9999);
    println!("v2: –¥–ª–∏–Ω–∞ = {}, –µ–º–∫–æ—Å—Ç—å = {}", v2.len(), v2.capacity());

    // –ö–∞–Ω–æ–Ω–∏—á–µ—Å–∫–∏–π –º–∞–∫—Ä–æ—Å –¥–ª—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –≤–µ–∫—Ç–æ—Ä–∞ —Å —ç–ª–µ–º–µ–Ω—Ç–∞–º–∏
    let mut v3 = vec![0, 0, 1, 2, 3, 4];

    // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–æ–ª—å–∫–æ —á–µ—Ç–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã
    v3.retain(|x| x % 2 == 0);
    println!("{v3:?}");

    // –£–¥–∞–ª—è–µ–º –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω—ã–µ –¥—É–±–ª–∏–∫–∞—Ç—ã
    v3.dedup();
    println!("{v3:?}");
}
```

`Vec` —Ä–µ–∞–ª–∏–∑—É–µ—Ç [`Deref<Target = [T]>`](https://doc.rust-lang.org/std/vec/struct.Vec.html#deref-methods-%5BT%5D): –º—ã –º–æ–∂–µ–º –≤—ã–∑—ã–≤–∞—Ç—å –º–µ—Ç–æ–¥—ã —Å—Ä–µ–∑–æ–≤ –Ω–∞ `Vec`.

–†–µ–º–∞—Ä–∫–∏:

- `Vec` - —ç—Ç–æ —Ç–∏–ø –∫–æ–ª–ª–µ–∫—Ü–∏–∏, –Ω–∞—Ä—è–¥—É —Å `String` –∏ `HashMap`. –î–∞–Ω–Ω—ã–µ, –∫–æ—Ç–æ—Ä—ã–µ –æ–Ω —Å–æ–¥–µ—Ä–∂–∏—Ç, —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ –∫—É—á–µ. –≠—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ —Ä–∞–∑–º–µ—Ä –¥–∞–Ω–Ω—ã—Ö –º–æ–∂–µ—Ç –±—ã—Ç—å –Ω–µ–∏–∑–≤–µ—Å—Ç–µ–Ω –≤–æ –≤—Ä–µ–º—è –∫–æ–º–ø–∏–ª—è—Ü–∏–∏. –û–Ω –º–æ–∂–µ—Ç —É–≤–µ–ª–∏—á–∏–≤–∞—Ç—å—Å—è –∏ —É–º–µ–Ω—å—à–∞—Ç—å—Å—è –≤–æ –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
- –æ–±—Ä–∞—Ç–∏—Ç–µ –≤–Ω–∏–º–∞–Ω–∏–µ, —á—Ç–æ `Vec<T>` - —ç—Ç–æ –¥–∂–µ–Ω–µ—Ä–∏–∫, –Ω–æ –Ω–∞–º –Ω–µ –Ω—É–∂–Ω–æ —è–≤–Ω–æ –æ–ø—Ä–µ–¥–µ–ª—è—Ç—å `T`. `Rust` —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ –≤—ã–≤–æ–¥–∏—Ç —Ç–∏–ø –≤–µ–∫—Ç–æ—Ä–∞ –ø–æ—Å–ª–µ –ø–µ—Ä–≤–æ–≥–æ –≤—ã–∑–æ–≤–∞ `push()`
- `vec![..]` - —ç—Ç–æ –∫–∞–Ω–æ–Ω–∏—á–µ—Å–∫–∏–π –º–∞–∫—Ä–æ—Å, –ø–æ–∑–≤–æ–ª—è—é—â–∏–π —Å–æ–∑–¥–∞–≤–∞—Ç—å –≤–µ–∫—Ç–æ—Ä—ã –ø–æ –∞–Ω–∞–ª–æ–≥–∏–∏ —Å `Vec::new()`, –Ω–æ —Å –Ω–∞—á–∞–ª—å–Ω—ã–º–∏ —ç–ª–µ–º–µ–Ω—Ç–∞–º–∏
- –¥–ª—è –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏ –≤–µ–∫—Ç–æ—Ä–∞ –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `[]`, –Ω–æ –ø—Ä–∏ –≤—ã—Ö–æ–¥–µ –∑–∞ –ø—Ä–µ–¥–µ–ª—ã –≤–µ–∫—Ç–æ—Ä–∞, –ø—Ä–æ–≥—Ä–∞–º–º–∞ –∑–∞–ø–∞–Ω–∏–∫—É–µ—Ç. –ë–æ–ª–µ–µ –±–µ–∑–æ–ø–∞—Å–Ω—ã–º –¥–æ—Å—Ç—É–ø–æ–º –∫ —ç–ª–µ–º–µ–Ω—Ç–∞–º –≤–µ–∫—Ç–æ—Ä–∞ —è–≤–ª—è–µ—Ç—Å—è `get()`, –≤–æ–∑–≤—Ä–∞—â–∞—é—â–∏–π `Option`. –ú–µ—Ç–æ–¥ `pop()` —É–¥–∞–ª—è–µ—Ç –ø–æ—Å–ª–µ–¥–Ω–∏–π —ç–ª–µ–º–µ–Ω—Ç –≤–µ–∫—Ç–æ—Ä–∞
- `Vec` –∏–º–µ–µ—Ç –¥–æ—Å—Ç—É–ø –∫–æ –≤—Å–µ–º –º–µ—Ç–æ–¥–æ–≤ —Å—Ä–µ–∑–æ–≤, –æ –∫–æ—Ç–æ—Ä—ã—Ö –º—ã –ø–æ–≥–æ–≤–æ—Ä–∏–º –≤ —Ç—Ä–µ—Ç—å–µ–π —á–∞—Å—Ç–∏ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–∞

__HashMap__

–°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è —Ö–µ—à-–∫–∞—Ä—Ç–∞ —Å –∑–∞—â–∏—Ç–æ–π –æ—Ç HashDoS-–∞—Ç–∞–∫:

```rust
use std::collections::HashMap;

fn main() {
    let mut page_counts = HashMap::new();
    page_counts.insert("Adventures of Huckleberry Finn".to_string(), 207);
    page_counts.insert("Grimms' Fairy Tales".to_string(), 751);
    page_counts.insert("Pride and Prejudice".to_string(), 303);

    if !page_counts.contains_key("Les Mis√©rables") {
        println!(
            "We know about {} books, but not Les Mis√©rables.",
            page_counts.len()
        );
    }

    for book in ["Pride and Prejudice", "Alice's Adventure in Wonderland"] {
        match page_counts.get(book) {
            Some(count) => println!("{book}: {count} pages"),
            None => println!("{book} is unknown."),
        }
    }

    // –ú–µ—Ç–æ–¥ `entry()` –ø–æ–∑–≤–æ–ª—è–µ—Ç –≤—Å—Ç–∞–≤–ª—è—Ç—å –∑–Ω–∞—á–µ–Ω–∏—è –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏—Ö –∫–ª—é—á–µ–π
    for book in ["Pride and Prejudice", "Alice's Adventure in Wonderland"] {
        let page_count: &mut i32 = page_counts.entry(book.to_string()).or_insert(0);
        *page_count += 1;
    }

    println!("{page_counts:#?}");
}
```

–†–µ–º–∞—Ä–∫–∏:

- `HashMap` –Ω–µ —Å–æ–¥–µ—Ä–∂–∏—Ç—Å—è –≤ –ø—Ä–µ–ª—é–¥–∏–∏ (prelude) –∏ –¥–æ–ª–∂–Ω–∞ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å—Å—è —è–≤–Ω–æ
- –ø–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–ª–µ–¥—É—é—â–∏–π –∫–æ–¥. –ü–µ—Ä–≤–∞—è —Å—Ç—Ä–æ–∫–∞ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç, —Å–æ–¥–µ—Ä–∂–∏—Ç—Å—è –ª–∏ –∫–Ω–∏–≥–∞ –≤ –∫–∞—Ä—Ç–µ –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –ø—Ä–∏ –µ–µ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏. –í—Ç–æ—Ä–∞—è —Å—Ç—Ä–æ–∫–∞ –≤—Å—Ç–∞–≤–ª—è–µ—Ç –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ, –µ—Å–ª–∏ –∫–Ω–∏–≥–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞ –≤ –∫–∞—Ä—Ç–µ:

```rust
let pc1 = page_counts
    .get("Harry Potter and the Sorcerer's Stone")
    .unwrap_or(&336);
let pc2 = page_counts
    .entry("The Hunger Games".to_string())
    .or_insert(374);
```

- –≤ –æ—Ç–ª–∏—á–∏–µ –æ—Ç `vec!`, `Rust`, –∫ —Å–æ–∂–∞–ª–µ–Ω–∏—é, –Ω–µ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –º–∞–∫—Ä–æ—Å `hashmap!`
  - –æ–¥–Ω–∞–∫–æ, –Ω–∞—á–∏–Ω–∞—è —Å `Rust 1.56`, `HashMap` —Ä–µ–∞–ª–∏–∑—É–µ—Ç [`From<[(K, V); N]>`](https://doc.rust-lang.org/std/collections/hash_map/struct.HashMap.html#impl-From%3C%5B(K,+V);+N%5D%3E-for-HashMap%3CK,+V,+RandomState%3E), –ø–æ–∑–≤–æ–ª—è—é—â–∏–π –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Ö—ç—à-–∫–∞—Ä—Ç—É —Å –ø–æ–º–æ—â—å—é –ª–∏—Ç–µ—Ä–∞–ª—å–Ω–æ–≥–æ –º–∞—Å—Å–∏–≤–∞:

```rust
let page_counts = HashMap::from([
  ("Harry Potter and the Sorcerer's Stone".to_string(), 336),
  ("The Hunger Games".to_string(), 374),
]);
```

- `HashMap` –º–æ–∂–µ—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å—Å—è –∏–∑ –ª—é–±–æ–≥–æ `Iterator`, –≤–æ–∑–≤—Ä–∞—â–∞—é—â–µ–≥–æ –∫–æ—Ä—Ç–µ–∂–∏ `(–∫–ª—é—á, –∑–Ω–∞—á–µ–Ω–∏–µ)`
- –≤ –ø—Ä–∏–º–µ—Ä–∞—Ö –º—ã –∏–∑–±–µ–≥–∞–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è `&str` –≤ –∫–∞—á–µ—Å—Ç–≤–µ –∫–ª—é—á–µ–π —Ö—ç—à-–∫–∞—Ä—Ç –¥–ª—è –ø—Ä–æ—Å—Ç–æ—Ç—ã. –≠—Ç–æ –≤–æ–∑–º–æ–∂–Ω–æ, –Ω–æ –º–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ –ø—Ä–æ–±–ª–µ–º–∞–º —Å –∑–∞–∏–º—Å—Ç–≤–æ–≤–∞–Ω–∏–µ–º
- —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –≤–Ω–∏–º–∞—Ç–µ–ª—å–Ω–æ –æ–∑–Ω–∞–∫–æ–º–∏—Ç—å—Å—è —Å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–µ–π `HashMap`

__–£–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ: —Å—á–µ—Ç—á–∏–∫__

–í —ç—Ç–æ–º —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–∏ –º—ã –≤–æ–∑—å–º–µ–º –æ—á–µ–Ω—å –ø—Ä–æ—Å—Ç—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É –¥–∞–Ω–Ω—ã—Ö –∏ —Å–¥–µ–ª–∞–µ–º –µ–µ —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–æ–π. –û–Ω–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `HashMap` –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è —Ç–æ–≥–æ, –∫–∞–∫–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è –±—ã–ª–∏ –ø—Ä–æ—Å–º–æ—Ç—Ä–µ–Ω—ã –∏ —Å–∫–æ–ª—å–∫–æ —Ä–∞–∑ –ø–æ—è–≤–ª—è–ª–æ—Å—å –∫–∞–∂–¥–æ–µ –∏–∑ –Ω–∏—Ö.

–ü–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω–∞—è –≤–µ—Ä—Å–∏—è `Counter` –∂–µ—Å—Ç–∫–æ –∑–∞–ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∞ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Ç–æ–ª—å–∫–æ —Å–æ –∑–Ω–∞—á–µ–Ω–∏—è–º–∏ `u32`. –°–¥–µ–ª–∞–π—Ç–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—É –∏ –µ–µ –º–µ—Ç–æ–¥—ã —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–º–∏ –¥–ª—è —Ç–∏–ø–∞ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ–º–æ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è, —á—Ç–æ–±—ã `Counter` –º–æ–≥ —Ä–∞–±–æ—Ç–∞—Ç—å —Å –ª—é–±—ã–º —Ç–∏–ø–æ–º.

–ï—Å–ª–∏ –∑–∞–¥–∞–Ω–∏–µ –ø–æ–∫–∞–∂–µ—Ç—Å—è –≤–∞–º —Å–ª–∏—à–∫–æ–º –ª–µ–≥–∫–∏–º –∏ –≤—ã –±—ã—Å—Ç—Ä–æ —Å –Ω–∏–º —Å–ø—Ä–∞–≤–∏—Ç–µ—Å—å, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –º–µ—Ç–æ–¥ `entry()`, —á—Ç–æ–±—ã –≤–¥–≤–æ–µ —Å–æ–∫—Ä–∞—Ç–∏—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–∏—Å–∫–æ–≤ —Ö–µ—à–∞, –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã—Ö –¥–ª—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –º–µ—Ç–æ–¥–∞ –ø–æ–¥—Å—á–µ—Ç–∞.

```rust
use std::collections::HashMap;

// `Counter` —Å—á–∏—Ç–∞–µ—Ç, —Å–∫–æ–ª—å–∫–æ —Ä–∞–∑ –≤—Å—Ç—Ä–µ—Ç–∏–ª–æ—Å—å –∫–∞–∂–¥–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ —Ç–∏–ø–∞ `T`
struct Counter {
    values: HashMap<u32, u64>,
}

impl Counter {
    // –°—Ç–∞—Ç–∏—á–Ω—ã–π –º–µ—Ç–æ–¥ —Å–æ–∑–¥–∞–Ω–∏—è –Ω–æ–≤–æ–≥–æ `Counter`
    fn new() -> Self {
        Counter {
            values: HashMap::new(),
        }
    }

    // –ú–µ—Ç–æ–¥ –ø–æ–¥—Å—á–µ—Ç–∞ –ø–æ—è–≤–ª–µ–Ω–∏–π –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è
    fn count(&mut self, value: u32) {
        if self.values.contains_key(&value) {
            *self.values.get_mut(&value).unwrap() += 1;
        } else {
            self.values.insert(value, 1);
        }
    }

    // –ú–µ—Ç–æ–¥ –≤–æ–∑–≤—Ä–∞—Ç–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –ø–æ—è–≤–ª–µ–Ω–∏–π –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è
    fn times_seen(&self, value: u32) -> u64 {
        self.values.get(&value).copied().unwrap_or_default()
    }
}

fn main() {
    let mut ctr = Counter::new();
    ctr.count(13);
    ctr.count(14);
    ctr.count(16);
    ctr.count(14);
    ctr.count(14);
    ctr.count(11);

    for i in 10..20 {
        println!("saw {} values equal to {}", ctr.times_seen(i), i);
    }

    let mut strctr = Counter::new();
    strctr.count("apple");
    strctr.count("orange");
    strctr.count("apple");
    println!("got {} apples", strctr.times_seen("apple"));
}
```

–ü–æ–¥—Å–∫–∞–∑–∫–∏:

- –æ–±—â–∏–º –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —Ç–æ–ª—å–∫–æ —Ç–∏–ø –∫–ª—é—á–∞
- –ø—Ä–∏—Å—Ç—É–ø–∏—Ç–µ –∫ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ `struct Counter<T>` –∏ –≤–Ω–∏–º–∞—Ç–µ–ª—å–Ω–æ –∏–∑—É—á–∏—Ç–µ –ø–æ–¥—Å–∫–∞–∑–∫—É –∫–æ–º–ø–∏–ª—è—Ç–æ—Ä–∞
- –æ–±—â–∏–π —Ç–∏–ø –¥–æ–ª–∂–µ–Ω —Ä–µ–∞–ª–∏–∑–æ–≤—ã–≤–∞—Ç—å 2 –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã—Ö —Ç–∏–ø–∞: –æ–¥–∏–Ω –∏–∑ –ø—Ä–µ–ª—é–¥–∏–∏, –¥—Ä—É–≥–æ–π –∏–∑ `std::hash`

<details>
<summary>–†–µ—à–µ–Ω–∏–µ:</summary>

```rust
// ...
use std::hash::Hash;

struct Counter<T: Eq + Hash> {
    values: HashMap<T, u64>,
}

impl<T: Eq + Hash> Counter<T> {
    // ...

    fn count(&mut self, value: T) {
        // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–µ –∑–∞–¥–∞–Ω–∏–µ.
        // –ó–¥–µ—Å—å —Ç–∞–∫–∂–µ –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `or_insert(0)`
        *self.values.entry(value).or_default() += 1;
    }

    fn times_seen(&self, value: T) -> u64 {
        self.values.get(&value).copied().unwrap_or_default()
    }
}
```

</details>

## –¢—Ä–µ–π—Ç—ã, –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ–º—ã–µ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–π –±–∏–±–ª–∏–æ—Ç–µ–∫–æ–π Rust

–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –≤–Ω–∏–º–∞—Ç–µ–ª—å–Ω–æ –æ–∑–Ω–∞–∫–æ–º–∏—Ç—å—Å—è —Å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–µ–π –∫–∞–∂–¥–æ–≥–æ —Ç—Ä–µ–π—Ç–∞.

__–°—Ä–∞–≤–Ω–µ–Ω–∏—è__

–≠—Ç–∏ —Ç—Ä–µ–π—Ç—ã –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ –º–µ–∂–¥—É –∑–Ω–∞—á–µ–Ω–∏—è–º–∏. –û–Ω–∏ –º–æ–≥—É—Ç —Ä–µ–∞–ª–∏–∑–æ–≤—ã–≤–∞—Ç—å—Å—è –Ω–∞ —Ç–∏–ø–∞—Ö, —Å–æ–¥–µ—Ä–∂–∞—â–∏—Ö –ø–æ–ª—è, –∫–æ—Ç–æ—Ä—ã–µ —Ä–µ–∞–ª–∏–∑—É—é—Ç —ç—Ç–∏ —Ç—Ä–µ–π—Ç—ã.

_PartialEq –∏ Eq_

`PartialEq` - —ç—Ç–æ –æ—Ç–Ω–æ—à–µ–Ω–∏–µ —á–∞—Å—Ç–∏—á–Ω–æ–π —ç–∫–≤–∏–≤–∞–ª–µ–Ω—Ç–Ω–æ—Å—Ç–∏ (partial equivalence relation), —Å —Ç—Ä–µ–±—É–µ–º—ã–º –º–µ—Ç–æ–¥–æ–º `eq()` –∏ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ–º—ã–º –º–µ—Ç–æ–¥–æ–º `ne()`. –≠—Ç–∏ –º–µ—Ç–æ–¥—ã –≤—ã–∑—ã–≤–∞—é—Ç—Å—è –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞–º–∏ `==` –∏ `!=`.

```rust
struct Key {
    id: u32,
    metadata: Option<String>,
}

impl PartialEq for Key {
    fn eq(&self, other: &Self) -> bool {
        self.id == other.id
    }
}
```

`Eq` - —ç—Ç–æ –æ—Ç–Ω–æ—à–µ–Ω–∏–µ –ø–æ–ª–Ω–æ–π —ç–∫–≤–∏–≤–∞–ª–µ–Ω—Ç–Ω–æ—Å—Ç–∏ (—Ä–µ—Ñ–ª–µ–∫—Å–∏–≤–Ω–æ–µ, —Å–∏–º–º–µ—Ç—Ä–∏—á–Ω–æ–µ –∏ —Ç—Ä–∞–Ω–∑–∏—Ç–∏–≤–Ω–æ–µ), —Ä–µ–∞–ª–∏–∑—É—é—â–µ–µ `PartialEq`. –§—É–Ω–∫—Ü–∏–∏, —Ç—Ä–µ–±—É—é—â–∏–µ –ø–æ–ª–Ω—É—é —ç–∫–≤–∏–≤–∞–ª–µ–Ω—Ç–Ω–æ—Å—Ç—å, –∏—Å–ø–æ–ª—å–∑—É—é—Ç `Eq` –∫–∞–∫ –æ–≥—Ä–∞–Ω–∏—á–∏–≤–∞—é—â–∏–π —Ç—Ä–µ–π—Ç (trait bound).

`PartialEq` –º–æ–∂–µ—Ç –±—ã—Ç—å —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Ç–∏–ø–æ–≤, –∞ `Eq` –Ω–µ—Ç, –ø–æ—Å–∫–æ–ª—å–∫—É –æ–Ω —è–≤–ª—è–µ—Ç—Å—è —Ä–µ—Ñ–ª–µ–∫—Å–∏–≤–Ω—ã–º:

```rust
struct Key {
    id: u32,
    metadata: Option<String>,
}

impl PartialEq<u32> for Key {
    fn eq(&self, other: &u32) -> bool {
        self.id == *other
    }
}
```

_PartialOrd –∏ Ord_

`PartialOrd` –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç —á–∞—Å—Ç–∏—á–Ω—ã–π –ø–æ—Ä—è–¥–æ–∫ (partial ordering), —Å –º–µ—Ç–æ–¥–æ–º `partial_cmp()`. –≠—Ç–æ—Ç –º–µ—Ç–æ–¥ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –æ–ø–µ—Ä–∞—Ç–æ—Ä–æ–≤ `<`, `<=`, `>=` –∏ `>`.

```rust
use std::cmp::Ordering;

#[derive(Eq, PartialEq)]
struct Citation {
    author: String,
    year: u32,
}

impl PartialOrd for Citation {
    fn partial_cmp(&self, other: &Self) -> Option<Ordering> {
        match self.author.partial_cmp(&other.author) {
            Some(Ordering::Equal) => self.year.partial_cmp(&other.year),
            author_ord => author_ord,
        }
    }
}
```

`Ord` - —ç—Ç–æ —Ç–æ—Ç–∞–ª—å–Ω—ã–π (total) –ø–æ—Ä—è–¥–æ–∫, —Å –º–µ—Ç–æ–¥–æ–º `cmp()`, –≤–æ–∑–≤—Ä–∞—â–∞—é—â–∏–º `Ordering`.

–ù–∞ –ø—Ä–∞–∫—Ç–∏–∫–µ —ç—Ç–∏ —Ç—Ä–µ–π—Ç—ã —á–∞—â–µ —Ä–µ–∞–ª–∏–∑—É—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ (`derive`), —á–µ–º –≤—Ä—É—á–Ω—É—é.

__–û–ø–µ—Ä–∞—Ç–æ—Ä—ã__

–ü–µ—Ä–µ–≥—Ä—É–∑–∫–∞ –æ–ø–µ—Ä–∞—Ç–æ—Ä–æ–≤ —Ä–µ–∞–ª–∏–∑—É–µ—Ç—Å—è —Å –ø–æ–º–æ—â—å—é —Ç—Ä–µ–π—Ç–∞ [std::ops](https://doc.rust-lang.org/std/ops/index.html):

```rust
#[derive(Debug, Copy, Clone)]
struct Point {
    x: i32,
    y: i32,
}

impl std::ops::Add for Point {
    type Output = Self;

    fn add(self, other: Self) -> Self {
        Self { x: self.x + other.x, y: self.y + other.y }
    }
}

fn main() {
    let p1 = Point { x: 10, y: 20 };
    let p2 = Point { x: 100, y: 200 };
    println!("{:?} + {:?} = {:?}", p1, p2, p1 + p2);
}
```

- –ú—ã –º–æ–∂–µ–º —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `Add` –¥–ª—è `&Point`. –í –∫–∞–∫–∏—Ö —Å–ª—É—á–∞—è—Ö —ç—Ç–æ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø–æ–ª–µ–∑–Ω—ã–º?
  - –û—Ç–≤–µ—Ç: `Add::add()` –ø–æ—Ç—Ä–µ–±–ª—è–µ—Ç `self`. –ï—Å–ª–∏ —Ç–∏–ø `T`, –¥–ª—è –∫–æ—Ç–æ—Ä–æ–≥–æ –ø–µ—Ä–µ–≥—Ä—É–∂–∞–µ—Ç—Å—è –æ–ø–µ—Ä–∞—Ç–æ—Ä, –Ω–µ —è–≤–ª—è–µ—Ç—Å—è `Copy` (–∫–æ–ø–∏—Ä—É–µ–º—ã–º), –º—ã –¥–æ–ª–∂–Ω—ã —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –ø–µ—Ä–µ–≥—Ä—É–∑–∫—É –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞ –¥–ª—è `&T`. –≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –∏–∑–±–µ–∂–∞—Ç—å –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ —è–≤–Ω–æ–≥–æ –∫–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –ø—Ä–∏ –≤—ã–∑–æ–≤–µ
- –ü–æ—á–µ–º—É `Output` —è–≤–ª—è–µ—Ç—Å—è –∞—Å—Å–æ—Ü–∏–∏—Ä–æ–≤–∞–Ω–Ω—ã–º —Ç–∏–ø–æ–º? –ú–æ–∂–µ–º –ª–∏ –º—ã —Å–¥–µ–ª–∞—Ç—å –µ–≥–æ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–º —Ç–∏–ø–∞ –∏–ª–∏ –º–µ—Ç–æ–¥–∞?
  - –ö–æ—Ä–æ—Ç–∫–∏–π –æ—Ç–≤–µ—Ç: –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —Ç–∏–ø–∞ —Ñ—É–Ω–∫—Ü–∏–∏ –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É—é—Ç—Å—è –≤—ã–∑—ã–≤–∞—é—â–∏–º, –∞ –∞—Å—Å–æ—Ü–∏–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ç–∏–ø—ã (`Output`) - —Ç–µ–º, –∫—Ç–æ —Ä–µ–∞–ª–∏–∑—É–µ—Ç —Ç—Ä–µ–π—Ç
- –ú—ã –º–æ–∂–µ–º —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `Add` –¥–ª—è –¥–≤—É—Ö —Ä–∞–∑–Ω—ã—Ö —Ç–∏–ø–æ–≤, –Ω–∞–ø—Ä–∏–º–µ—Ä, `impl Add<(i32, i32)> for Point` –¥–æ–±–∞–≤–∏—Ç –∫–æ—Ä—Ç–µ–∂ –≤ `Point`

__From –∏ Into__

–¢–∏–ø—ã, —Ä–µ–∞–ª–∏–∑—É—é—â–∏–µ —Ç—Ä–µ–π—Ç—ã [From](https://doc.rust-lang.org/std/convert/trait.From.html) –∏ [Into](https://doc.rust-lang.org/std/convert/trait.Into.html), –º–æ–≥—É—Ç –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤—ã–≤–∞—Ç—å—Å—è –≤ –¥—Ä—É–≥–∏–µ —Ç–∏–ø—ã:

```rust
fn main() {
    let s = String::from("hello");
    let addr = std::net::Ipv4Addr::from([127, 0, 0, 1]);
    let one = i16::from(true);
    let bigger = i32::from(123_i16);
    println!("{s}, {addr}, {one}, {bigger}");
}
```

`Into` –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Ä–µ–∞–ª–∏–∑—É–µ—Ç—Å—è –ø—Ä–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ `From`:

```rust
fn main() {
    let s: String = "hello".into();
    let addr: std::net::Ipv4Addr = [127, 0, 0, 1].into();
    let one: i16 = true.into();
    let bigger: i32 = 123_i16.into();
    println!("{s}, {addr}, {one}, {bigger}");
}
```

__–ü—Ä–∏–≤–µ–¥–µ–Ω–∏–µ —Ç–∏–ø–æ–≤__

`Rust` –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –∫–∞–∫ –Ω–µ—è–≤–Ω–æ–µ –ø—Ä–∏–≤–µ–¥–µ–Ω–∏–µ (–ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ) —Ç–∏–ø–æ–≤ (casting), —Ç–∞–∫ –∏ —è–≤–Ω–æ–µ —Å –ø–æ–º–æ—â—å—é `as`:

```rust
fn main() {
    let value: i64 = 1000;
    println!("as u16: {}", value as u16);
    println!("as i16: {}", value as i16);
    println!("as u8: {}", value as u8);
}
```

–†–µ–∑—É–ª—å—Ç–∞—Ç—ã `as` –≤—Å–µ–≥–¥–∞ –æ–ø—Ä–µ–¥–µ–ª—è—é—Ç—Å—è –≤ `Rust`, –ø–æ—ç—Ç–æ–º—É —è–≤–ª—è—é—Ç—Å—è —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω—ã–º–∏ –Ω–∞ —Ä–∞–∑–Ω—ã—Ö –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞—Ö. –≠—Ç–æ –º–æ–∂–µ—Ç –Ω–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–æ–≤–∞—Ç—å –Ω–∞—à–µ–º—É –∏–Ω—Ç—É–∏—Ç–∏–≤–Ω–æ–º—É –º–Ω–µ–Ω–∏—é –æ–± –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –∑–Ω–∞–∫–∞ –∏–ª–∏ –ø—Ä–∏–≤–µ–¥–µ–Ω–∏–∏ –∫ –º–µ–Ω—å—à–µ–º—É —Ç–∏–ø—É.

–ü—Ä–∏–≤–µ–¥–µ–Ω–∏–µ —Ç–∏–ø–æ–≤ —Å –ø–æ–º–æ—â—å—é `as` - —ç—Ç–æ –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ —Å–ª–æ–∂–Ω—ã–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç, –∫–æ—Ç–æ—Ä—ã–π –ª–µ–≥–∫–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ –∏ –∫–æ—Ç–æ—Ä—ã–π –º–æ–∂–µ—Ç —Å—Ç–∞—Ç—å –∏—Å—Ç–æ—á–Ω–∏–∫–æ–º –º–µ–ª–∫–∏—Ö –æ—à–∏–±–æ–∫, –ø–æ—Å–∫–æ–ª—å–∫—É –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Ç–∏–ø—ã –∏–ª–∏ –¥–∏–∞–ø–∞–∑–æ–Ω—ã –∑–Ω–∞—á–µ–Ω–∏–π –≤ –Ω–∏—Ö –º–æ–≥—É—Ç –ª–µ–≥–∫–æ –∏–∑–º–µ–Ω–∏—Ç—å—Å—è. –ü—Ä–∏–≤–µ–¥–µ–Ω–∏–µ –ª—É—á—à–µ –≤—Å–µ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–æ–≥–¥–∞, –∫–æ–≥–¥–∞ —Ü–µ–ª—å—é —è–≤–ª—è–µ—Ç—Å—è —É–∫–∞–∑–∞—Ç—å –±–µ–∑—É—Å–ª–æ–≤–Ω–æ–µ —É—Å–µ—á–µ–Ω–∏–µ (unconditional truncation) (–Ω–∞–ø—Ä–∏–º–µ—Ä, –≤—ã–±–æ—Ä –Ω–∏–∂–Ω–∏—Ö 32 –±–∏—Ç–æ–≤ `u64` —Å –ø–æ–º–æ—â—å—é `as u32`, –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –æ—Ç —Ç–æ–≥–æ, —á—Ç–æ –±—ã–ª–æ –≤ —Å—Ç–∞—Ä—à–∏—Ö –±–∏—Ç–∞—Ö).

–î–ª—è –ø—Ä–∏–≤–µ–¥–µ–Ω–∏—è, –∫–æ—Ç–æ—Ä–æ–µ –≤—Å–µ–≥–¥–∞ –º–æ–∂–Ω–æ –≤—ã–ø–æ–ª–Ω–∏—Ç—å —É—Å–ø–µ—à–Ω–æ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –∏–∑ `u32` –≤ `u64`), –ø—Ä–µ–¥–ø–æ—á—Ç–∏—Ç–µ–ª—å–Ω–µ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `From` –∏–ª–∏ `Into`. –î–ª—è –ø—Ä–∏–≤–µ–¥–µ–Ω–∏—è, –∫–æ—Ç–æ—Ä–æ–µ –≤ –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö —Å–ª—É—á–∞—è—Ö –≤—ã–ø–æ–ª–Ω–∏—Ç—å –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ, –¥–æ—Å—Ç—É–ø–Ω—ã `TryFrom` –∏ `TryInto`, –∫–æ—Ç–æ—Ä—ã–µ –ø–æ–∑–≤–æ–ª—è—é—Ç –ø–æ-—Ä–∞–∑–Ω–æ–º—É –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å —Å–ª—É—á–∞–∏ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –∏ –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –ø—Ä–∏–≤–µ–¥–µ–Ω–∏—è –æ–¥–Ω–æ–≥–æ —Ç–∏–ø–∞ –∫ –¥—Ä—É–≥–æ–º—É.

__Read –∏ Write__

[Read](https://doc.rust-lang.org/std/io/trait.Read.html) –∏ [BufRead](https://doc.rust-lang.org/std/io/trait.BufRead.html) –ø–æ–∑–≤–æ–ª—è—é—Ç –∞–±—Å—Ç—Ä–∞–≥–∏—Ä–æ–≤–∞—Ç—å—Å—è –æ—Ç –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ (sources) `u8`:

```rust
use std::io::{BufRead, BufReader, Read, Result};

fn count_lines<R: Read>(reader: R) -> usize {
    let buf_reader = BufReader::new(reader);
    buf_reader.lines().count()
}

// –ó–¥–µ—Å—å `Result<T>` –∏–∑ `std::io` == `Result<T, std::io::Error>`
fn main() -> Result<()> {
    let slice: &[u8] = b"foo\nbar\nbaz\n";
    println!("—Å—Ç—Ä–æ–∫ –≤ —Å—Ä–µ–∑–µ: {}", count_lines(slice));

    let file = std::fs::File::open(std::env::current_exe()?)?;
    println!("—Å—Ç—Ä–æ–∫ –≤ —Ñ–∞–π–ª–µ: {}", count_lines(file));
    Ok(())
}
```

[Write](https://doc.rust-lang.org/std/io/trait.Write.html), –≤ —Å–≤–æ—é –æ—á–µ—Ä–µ–¥—å, –ø–æ–∑–≤–æ–ª—è–µ—Ç –∞–±—Å—Ç—Ä–∞–≥–∏—Ä–æ–≤–∞—Ç—å—Å—è –æ—Ç –ø—Ä–∏–µ–º–Ω–∏–∫–æ–≤ (sinks) `u8`:

```rust
use std::io::{Result, Write};

fn log<W: Write>(writer: &mut W, msg: &str) -> Result<()> {
    writer.write_all(msg.as_bytes())?;
    writer.write_all("\n".as_bytes())
}

fn main() -> Result<()> {
    let mut buffer = Vec::new();
    log(&mut buffer, "Hello")?;
    log(&mut buffer, "World")?;
    println!("{:?}", buffer);
    Ok(())
}
```

__–¢—Ä–µ–π—Ç Default__

–¢—Ä–µ–π—Ç [Default](https://doc.rust-lang.org/std/default/trait.Default.html) –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –¥–µ—Ñ–æ–ª—Ç–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ —Ç–∏–ø–∞:

```rust
#[derive(Debug, Default)]
struct Derived {
    x: u32,
    y: String,
    z: Implemented,
}

#[derive(Debug)]
struct Implemented(String);

impl Default for Implemented {
    fn default() -> Self {
        Self("–ò–≤–∞–Ω –ü–µ—Ç—Ä–æ–≤".into())
    }
}

fn main() {
    let default_struct = Derived::default();
    println!("{default_struct:#?}");

    let almost_default_struct =
        Derived { y: "Y —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞!".into(), ..Derived::default() };
    println!("{almost_default_struct:#?}");

    let nothing: Option<Derived> = None;
    println!("{:#?}", nothing.unwrap_or_default());
}
```

–†–µ–º–∞—Ä–∫–∏:

- `Default` –º–æ–∂–µ—Ç –±—ã—Ç—å —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω –∫–∞–∫ –≤—Ä—É—á–Ω—É—é, —Ç–∞–∫ –∏ —Å –ø–æ–º–æ—â—å—é `derive`
- –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è —Å–æ–∑–¥–∞–µ—Ç –∑–Ω–∞—á–µ–Ω–∏–µ, –≤ –∫–æ—Ç–æ—Ä–æ–º –¥–ª—è –≤—Å–µ—Ö –ø–æ–ª–µ–π —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –∑–Ω–∞—á–µ–Ω–∏—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
  - —ç—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ –≤—Å–µ –ø–æ–ª—è —Å—Ç—Ä—É–∫—Ç—É—Ä—ã —Ç–∞–∫–∂–µ –¥–æ–ª–∂–Ω—ã —Ä–µ–∞–ª–∏–∑–æ–≤—ã–≤–∞—Ç—å `Default`
- —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ —Ç–∏–ø—ã `Rust` —á–∞—Å—Ç–æ —Ä–µ–∞–ª–∏–∑—É—é—Ç `Default` —Å —Ä–∞–∑—É–º–Ω—ã–º–∏ –∑–Ω–∞—á–µ–Ω–∏—è–º–∏ (`0`, `""` –∏ —Ç.–¥.)
- —á–∞—Å—Ç–∏—á–Ω–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å—Ç—Ä—É–∫—Ç—É—Ä—ã —Ö–æ—Ä–æ—à–æ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å `Default`
- —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ `Rust` –∑–Ω–∞–µ—Ç, —á—Ç–æ —Ç–∏–ø—ã –º–æ–≥—É—Ç —Ä–µ–∞–ª–∏–∑–æ–≤—ã–≤–∞—Ç—å `Default`, –∏ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç —É–¥–æ–±–Ω—ã–µ –º–µ—Ç–æ–¥—ã, –∫–æ—Ç–æ—Ä—ã–µ –µ–≥–æ –∏—Å–ø–æ–ª—å–∑—É—é—Ç
- —Å–∏–Ω—Ç–∞–∫—Å–∏—Å `..` –Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è [—Å–∏–Ω—Ç–∞–∫—Å–∏—Å–æ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ç—Ä—É–∫—Ç—É—Ä—ã](https://doc.rust-lang.org/book/ch05-01-defining-structs.html#creating-instances-from-other-instances-with-struct-update-syntax)

__–ó–∞–º—ã–∫–∞–Ω–∏—è__

–ó–∞–º—ã–∫–∞–Ω–∏—è (closures) –∏–ª–∏ –ª—è–º–±–¥–∞-–≤—ã—Ä–∞–∂–µ–Ω–∏—è –∏–º–µ—é—Ç —Ç–∏–ø—ã, –∫–æ—Ç–æ—Ä—ã–º –Ω–µ–ª—å–∑—è –¥–∞—Ç—å –∏–º—è. –û–¥–Ω–∞–∫–æ –æ–Ω–∏ —Ä–µ–∞–ª–∏–∑—É—é—Ç —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ —Ç—Ä–µ–π—Ç—ã [Fn](https://doc.rust-lang.org/std/ops/trait.Fn.html), [FnMut](https://doc.rust-lang.org/std/ops/trait.FnMut.html) –∏ [FnOnce](https://doc.rust-lang.org/std/ops/trait.FnOnce.html):

```rust
fn apply_with_log(func: impl FnOnce(i32) -> i32, input: i32) -> i32 {
    println!("–≤—ã–∑–æ–≤ —Ñ—É–Ω–∫—Ü–∏–∏ –Ω–∞ {input}");
    func(input)
}

fn main() {
    let add_3 = |x| x + 3;
    println!("add_3: {}", apply_with_log(add_3, 10));
    println!("add_3: {}", apply_with_log(add_3, 20));

    let mut v = Vec::new();
    let mut accumulate = |x: i32| {
        v.push(x);
        v.iter().sum::<i32>()
    };
    println!("accumulate: {}", apply_with_log(&mut accumulate, 4));
    println!("accumulate: {}", apply_with_log(&mut accumulate, 5));

    let multiply_sum = |x| x * v.into_iter().sum::<i32>();
    println!("multiply_sum: {}", apply_with_log(multiply_sum, 3));
}
```

–†–µ–º–∞—Ä–∫–∏:

- `Fn` (–Ω–∞–ø—Ä–∏–º–µ—Ä, `add_3`) –Ω–µ –ø–æ—Ç—Ä–µ–±–ª—è–µ—Ç –∏ –Ω–µ –∏–∑–º–µ–Ω—è–µ—Ç –∑–∞—Ö–≤–∞—á–µ–Ω–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –∏–ª–∏, –≤–æ–∑–º–æ–∂–Ω–æ, –≤–æ–æ–±—â–µ –Ω–∏—á–µ–≥–æ –Ω–µ –∑–∞—Ö–≤–∞—Ç—ã–≤–∞–µ—Ç. –ï–µ –º–æ–∂–Ω–æ –≤—ã–∑—ã–≤–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ä–∞–∑ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ
- `FnMut` (–Ω–∞–ø—Ä–∏–º–µ—Ä, `accumulate`) –º–æ–∂–µ—Ç –º–µ–Ω—è—Ç—å –∑–∞—Ö–≤–∞—á–µ–Ω–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è. –ï–µ –º–æ–∂–Ω–æ –≤—ã–∑—ã–≤–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ä–∞–∑, –Ω–æ –Ω–µ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ
- `FnOnce` (–Ω–∞–ø—Ä–∏–º–µ—Ä, `multiply_sum`) –º–æ–∂–Ω–æ –≤—ã–∑–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω —Ä–∞–∑. –û–Ω–∞ –º–æ–∂–µ—Ç –ø–æ—Ç—Ä–µ–±–ª—è—Ç—å –∑–∞—Ö–≤–∞—á–µ–Ω–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è
- `FnMut` - —ç—Ç–æ –ø–æ–¥—Ç–∏–ø (–ø–æ–¥—Ç—Ä–µ–π—Ç - subtrait) `FnOnce`. `Fn` - —ç—Ç–æ –ø–æ–¥—Ç–∏–ø `FnMut` –∏ `FnOnce`. –≠—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ –º—ã –º–æ–∂–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `FnMut` —Ç–∞–º, –≥–¥–µ –æ–∂–∏–¥–∞–µ—Ç—Å—è `FnOnce`, –∏ `Fn` —Ç–∞–º, –≥–¥–µ –æ–∂–∏–¥–∞–µ—Ç—Å—è `FnMut` –∏–ª–∏ `FnOnce`
- –ø—Ä–∏ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–∏ —Ñ—É–Ω–∫—Ü–∏–∏, –ø—Ä–∏–Ω–∏–º–∞—é—â–µ–π –∑–∞–º—ã–∫–∞–Ω–∏–µ, –º—ã –¥–æ–ª–∂–Ω—ã —Å–Ω–∞—á–∞–ª–∞ –±—Ä–∞—Ç—å `FnOnce`, –∑–∞—Ç–µ–º `FnMut` –∏ –≤ –∫–æ–Ω—Ü–µ `Fn` –∫–∞–∫ –Ω–∞–∏–±–æ–ª–µ–µ –≥–∏–±–∫–∏–π —Ç–∏–ø
- –Ω–∞–ø—Ä–æ—Ç–∏–≤, –ø—Ä–∏ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–∏ –∑–∞–º—ã–∫–∞–Ω–∏—è –º—ã –Ω–∞—á–∏–Ω–∞–µ–º —Å `Fn`
- –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –∑–∞–º—ã–∫–∞–Ω–∏–µ –∑–∞—Ö–≤–∞—Ç—ã–≤–∞—é—Ç –∑–Ω–∞—á–µ–Ω–∏–µ –ø–æ —Å—Å—ã–ª–∫–µ. –ö–ª—é—á–µ–≤–æ–µ —Å–ª–æ–≤–æ `move` –ø–æ–∑–≤–æ–ª—è–µ—Ç –∑–∞–º—ã–∫–∞–Ω–∏—é –∑–∞—Ö–≤–∞—Ç—ã–≤–∞—Ç—å —Å–∞–º–æ –∑–Ω–∞—á–µ–Ω–∏–µ

```rust
fn make_greeter(prefix: String) -> impl Fn(&str) {
    return move |name| println!("{} {}", prefix, name);
}

fn main() {
    let hi = make_greeter("–ø—Ä–∏–≤–µ—Ç".to_string());
    hi("–≤—Å–µ–º");
}
```

__–£–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ: ROT13__

–í —ç—Ç–æ–º —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–∏ –º—ã —Ä–µ–∞–ª–∏–∑—É–µ–º –∫–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–π —à–∏—Ñ—Ä ["ROT13"](https://ru.wikipedia.org/wiki/ROT13).

–ú–µ–Ω—è–π—Ç–µ —Ç–æ–ª—å–∫–æ –∞–ª—Ñ–∞–≤–∏—Ç–Ω—ã–µ —Å–∏–º–≤–æ–ª—ã `ASCII`, —á—Ç–æ–±—ã —Ä–µ–∑—É–ª—å—Ç–∞—Ç –æ—Å—Ç–∞–≤–∞–ª—Å—è –≤–∞–ª–∏–¥–Ω—ã–º `UTF-8`.

```rust
use std::io::Read;

struct RotDecoder<R: Read> {
    input: R,
    rot: u8,
}

impl<R: Read> Read for RotDecoder<R> {
    fn read(&mut self, buf: &mut [u8]) -> std::io::Result<usize> {
        todo!("—Ä–µ–∞–ª–∏–∑—É–π –º–µ–Ω—è")
    }
}

fn main() {
    let mut rot =
        RotDecoder { input: "Gb trg gb gur bgure fvqr!".as_bytes(), rot: 13 };
    let mut result = String::new();
    // `read_to_string()` –≤—ã–∑—ã–≤–∞–µ—Ç `read()` –ø–æ–¥ –∫–∞–ø–æ—Ç–æ–º –∏ –ø—Ä–µ–æ–±—Ä–∞–∑—É–µ—Ç –µ–≥–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤ —Å—Ç—Ä–æ–∫—É
    rot.read_to_string(&mut result).unwrap();
    println!("{}", result);
}

#[cfg(test)]
mod test {
    use super::*;

    #[test]
    fn joke() {
        let mut rot =
            RotDecoder { input: "Gb trg gb gur bgure fvqr!".as_bytes(), rot: 13 };
        let mut result = String::new();
        rot.read_to_string(&mut result).unwrap();
        assert_eq!(&result, "To get to the other side!");
    }

    #[test]
    fn binary() {
        let input: Vec<u8> = (0..=255u8).collect();
        let mut rot = RotDecoder::<&[u8]> { input: input.as_ref(), rot: 13 };
        let mut buf = [0u8; 256];
        assert_eq!(rot.read(&mut buf).unwrap(), 256);
        for i in 0..=255 {
            if input[i] != buf[i] {
                assert!(input[i].is_ascii_alphabetic());
                assert!(buf[i].is_ascii_alphabetic());
            }
        }
    }
}
```

<details>
<summary>–†–µ—à–µ–Ω–∏–µ:</summary>

```rust
impl<R: Read> Read for RotDecoder<R> {
    fn read(&mut self, buf: &mut [u8]) -> std::io::Result<usize> {
        // –ß–∏—Ç–∞–µ–º –¥–∞–Ω–Ω—ã–µ –≤ –±—É—Ñ–µ—Ä
        let size = self.input.read(buf)?;
        // –ü–µ—Ä–µ–±–∏—Ä–∞–µ–º –±–∞–π—Ç—ã
        for b in &mut buf[..size] {
            // –¢–æ–ª—å–∫–æ –±—É–∫–≤—ã –∞–ª—Ñ–∞–≤–∏—Ç–∞
            if b.is_ascii_alphabetic() {
                // –ë–∞–∑–∞
                let base = if b.is_ascii_uppercase() { 'A' } else { 'a' } as u8;
                // –°–¥–≤–∏–≥–∞–µ–º –Ω–∞ `rot` –≤ –ø—Ä–µ–¥–µ–ª–∞—Ö 26 (–∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –±—É–∫–≤ –≤ –∞–Ω–≥–ª–∏–π—Å–∫–æ–º –∞–ª—Ñ–∞–≤–∏—Ç–µ)
                *b = (*b - base + self.rot) % 26 + base;
            }
        }
        // –í–æ–∑–≤—Ä–∞—â–∞–µ–º "—Å–¥–≤–∏–Ω—É—Ç—ã–µ" –±–∞–π—Ç—ã
        Ok(size)
    }
}
```

</details>

## –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–∞–º—è—Ç—å—é

__–û–±–∑–æ—Ä –ø–∞–º—è—Ç–∏ –ø—Ä–æ–≥—Ä–∞–º–º—ã__

–ü—Ä–æ–≥—Ä–∞–º–º—ã –≤—ã–¥–µ–ª—è—é—Ç (allocate) –ø–∞–º—è—Ç—å –¥–≤—É–º—è —Å–ø–æ—Å–æ–±–∞–º–∏:

- —Å—Ç–µ–∫ (stack): –Ω–µ–ø—Ä–µ—Ä—ã–≤–Ω–∞—è –æ–±–ª–∞—Å—Ç—å –ø–∞–º—è—Ç–∏ –¥–ª—è –ª–æ–∫–∞–ª—å–Ω—ã—Ö –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö
  - –∑–Ω–∞—á–µ–Ω–∏—è –∏–º–µ—é—Ç —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ä–∞–∑–º–µ—Ä, –∏–∑–≤–µ—Å—Ç–Ω—ã–π –≤–æ –≤—Ä–µ–º—è –∫–æ–º–ø–∏–ª—è—Ü–∏–∏
  - –æ—á–µ–Ω—å –±—ã—Å—Ç—Ä—ã–π: –ø—Ä–æ—Å—Ç–æ –ø–µ—Ä–µ–º–µ—â–∞–µ–º —É–∫–∞–∑–∞—Ç–µ–ª—å —Å—Ç–µ–∫–∞ (stack pointer)
  - –ª–µ–≥–∫–æ —É–ø—Ä–∞–≤–ª—è—Ç—å: —Å–ª–µ–¥—É–µ–º –∑–∞ –≤—ã–∑–æ–≤–∞–º–∏ —Ñ—É–Ω–∫—Ü–∏–π
  - –æ—Ç–ª–∏—á–Ω–∞—è –ª–æ–∫–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ—Å—Ç—å –ø–∞–º—è—Ç–∏ (–ø–∞–º—è—Ç—å –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ –æ–¥–Ω–æ–º –º–µ—Å—Ç–µ)
- –∫—É—á–∞ (heap): —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –∑–Ω–∞—á–µ–Ω–∏–π –∑–∞ –ø—Ä–µ–¥–µ–ª–∞–º–∏ –≤—ã–∑–æ–≤–æ–≤ —Ñ—É–Ω–∫—Ü–∏–π
  - –∑–Ω–∞—á–µ–Ω–∏—è –∏–º–µ—é—Ç –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π —Ä–∞–∑–º–µ—Ä, –æ–ø—Ä–µ–¥–µ–ª—è–µ–º—ã–π –≤–æ –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
  - –Ω–µ–º–Ω–æ–≥–æ –º–µ–¥–ª–µ–Ω–Ω–µ–µ, —á–µ–º —Å—Ç–µ–∫: –∏–º–µ—é—Ç—Å—è –Ω–µ–∫–æ—Ç–æ—Ä—ã–µ –Ω–∞–∫–ª–∞–¥–Ω—ã–µ —Ä–∞—Å—Ö–æ–¥—ã
  - –Ω–µ—Ç –≥–∞—Ä–∞–Ω—Ç–∏–∏ –ª–æ–∫–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ—Å—Ç–∏ –ø–∞–º—è—Ç–∏

_–ü—Ä–∏–º–µ—Ä_

–°–æ–∑–¥–∞–Ω–∏–µ `String` –ø–æ–º–µ—â–∞–µ—Ç –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ —Ä–∞–∑–º–µ—Ä–∞ –≤ —Å—Ç–µ–∫ –∏ –¥–∞–Ω–Ω—ã–µ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–≥–æ —Ä–∞–∑–º–µ—Ä–∞ (–Ω–∞—Å—Ç–æ—è—â—É—é —Å—Ç—Ä–æ–∫—É) –≤ –∫—É—á—É:

```rust
fn main() {
    let s1 = String::from("–ü—Ä–∏–≤–µ—Ç");
}
```

<img src="https://habrastorage.org/webt/_t/il/gp/_tilgpmiwllocf2uws7ks0rnqiq.png" />
<br />

–ú—ã –º–æ–∂–µ–º –∏—Å—Å–ª–µ–¥–æ–≤–∞—Ç—å –ø–∞–º—è—Ç—å, –Ω–æ —ç—Ç–æ —Å–æ–≤–µ—Ä—à–µ–Ω–Ω–æ –Ω–µ–±–µ–∑–æ–ø–∞—Å–Ω–æ:

```rust
fn main() {
    let mut s1 = String::from("–ü—Ä–∏–≤–µ—Ç");
    s1.push(' ');
    s1.push_str("–≤—Å–µ–º");
    // –¢–æ–ª—å–∫–æ –¥–ª—è —Ü–µ–ª–µ–π –æ–±—É—á–µ–Ω–∏—è.
    // –≠—Ç–æ –º–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ –Ω–µ–ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º–æ–º—É –ø–æ–≤–µ–¥–µ–Ω–∏—é
    unsafe {
        let (ptr, capacity, len): (usize, usize, usize) = std::mem::transmute(s1);
        println!("ptr = {ptr:#x}, len = {len}, capacity = {capacity}");
    }
}
```

__–ü–æ–¥—Ö–æ–¥—ã –∫ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—é –ø–∞–º—è—Ç—å—é__

–¢—Ä–∞–¥–∏—Ü–∏–æ–Ω–Ω–æ, —è–∑—ã–∫–∏ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—è –¥–µ–ª—è—Ç—Å—è –Ω–∞ 2 –∫–∞—Ç–µ–≥–æ—Ä–∏–∏:

- –ø–æ–ª–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª—å —á–µ—Ä–µ–∑ —Ä—É—á–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–∞–º—è—Ç—å—é: C, C++, Pascal –∏ –¥—Ä.
  - –∫–æ–≥–¥–∞ –≤—ã–¥–µ–ª—è—Ç—å –∏ –æ—Å–≤–æ–±–æ–∂–¥–∞—Ç—å –ø–∞–º—è—Ç—å –≤ –∫—É—á–µ —Ä–µ—à–∞–µ—Ç –ø—Ä–æ–≥—Ä–∞–º–º–∏—Å—Ç
  - –ø—Ä–æ–≥—Ä–∞–º–º–∏—Å—Ç –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç, —É–∫–∞–∑—ã–≤–∞–µ—Ç –ª–∏ —É–∫–∞–∑–∞—Ç–µ–ª—å –Ω–∞ –≤–∞–ª–∏–¥–Ω—É—é –ø–∞–º—è—Ç—å
  - –æ–ø—ã—Ç –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç, —á—Ç–æ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Å—Ç—ã —Å–æ–≤–µ—Ä—à–∞—é—Ç –æ—à–∏–±–∫–∏
- –ø–æ–ª–Ω–∞—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å —á–µ—Ä–µ–∑ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–∞–º—è—Ç—å—é –≤–æ –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:
  - —Å–∏—Å—Ç–µ–º–∞ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç, —á—Ç–æ –ø–∞–º—è—Ç—å –Ω–µ –æ—Å–≤–æ–±–æ–∂–¥–∞–µ—Ç—Å—è –¥–æ —Ç–µ—Ö –ø–æ—Ä, –ø–æ–∫–∞ –Ω–∞ –Ω–µ–µ –∏–º–µ—é—Ç—Å—è —Å—Å—ã–ª–∫–∏
  - –æ–±—ã—á–Ω–æ —Ä–µ–∞–ª–∏–∑—É–µ—Ç—Å—è —Å –ø–æ–º–æ—â—å—é –ø–æ–¥—Å—á–µ—Ç–∞ —Å—Å—ã–ª–æ–∫ (reference counting), —Å–±–æ—Ä–∫—É –º—É—Å–æ—Ä–∞ (garbage collection) –∏–ª–∏ [RAII](https://ru.wikipedia.org/wiki/%D0%9F%D0%BE%D0%BB%D1%83%D1%87%D0%B5%D0%BD%D0%B8%D0%B5_%D1%80%D0%B5%D1%81%D1%83%D1%80%D1%81%D0%B0_%D0%B5%D1%81%D1%82%D1%8C_%D0%B8%D0%BD%D0%B8%D1%86%D0%B8%D0%B0%D0%BB%D0%B8%D0%B7%D0%B0%D1%86%D0%B8%D1%8F)

`Rust` –ø—Ä–µ–¥–ª–∞–≥–∞–µ—Ç –Ω–æ–≤—ã–π –ø–æ–¥—Ö–æ–¥ - –ø–æ–ª–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª—å –∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –≤–æ –≤—Ä–µ–º—è –∫–æ–º–ø–∏–ª—è—Ü–∏–∏ –æ–±–µ—Å–ø–µ—á–∏–≤–∞—é—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–∞–º—è—Ç—å—é.

–≠—Ç–æ –¥–µ–ª–∞–µ—Ç—Å—è —Å –ø–æ–º–æ—â—å—é –≤–ª–∞–¥–µ–Ω–∏—è (ownership).

- –≤ `C` —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–∞–º—è—Ç—å—é –æ—Å—É—â–µ—Å—Ç–≤–ª—è–µ—Ç—Å—è —Å –ø–æ–º–æ—â—å—é —Ñ—É–Ω–∫—Ü–∏–π `malloc` –∏ `free`. –ß–∞—Å—Ç–æ –æ—à–∏–±–∫–∏ –∑–∞–∫–ª—é—á–∞—é—Ç—Å—è –≤ –Ω–µ –≤—ã–∑–æ–≤–µ `free`, –µ–µ –º–Ω–æ–≥–æ–∫—Ä–∞—Ç–Ω–æ–º –≤—ã–∑–æ–≤–µ –∏–ª–∏ —Ä–∞–∑—ã–º–µ–Ω–æ–≤–∞–Ω–∏–∏ —É–∫–∞–∑–∞—Ç–µ–ª—è –Ω–∞ –æ—Å–≤–æ–±–æ–∂–¥–µ–Ω–Ω—ã–π —Ä–µ—Å—É—Ä—Å
- `C++` –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã, —Ç–∞–∫–∏–µ –∫–∞–∫ —É–º–Ω—ã–µ —É–∫–∞–∑–∞—Ç–µ–ª–∏ (`unique_ptr`, `shared_ptr`), –∫–æ—Ç–æ—Ä—ã–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤—ã–∑—ã–≤–∞—é—Ç –¥–µ—Å—Ç—Ä—É–∫—Ç–æ—Ä—ã –¥–ª—è –æ—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏—è –ø–∞–º—è—Ç–∏ –ø–æ—Å–ª–µ –≤–æ–∑–≤—Ä–∞—Ç–∞ –∑–Ω–∞—á–µ–Ω–∏—è –∏–∑ —Ñ—É–Ω–∫—Ü–∏–∏. –û–¥–Ω–∞–∫–æ —ç—Ç–æ —Ä–µ—à–∞–µ—Ç –¥–∞–ª–µ–∫–æ –Ω–µ –≤—Å–µ –ø—Ä–æ–±–ª–µ–º—ã `C`
- `Java`, `Go`, `Python`, `JavaScript` –∏ –¥—Ä. –ø–æ–ª–∞–≥–∞—é—Ç—Å—è –Ω–∞ —Å–±–æ—Ä—â–∏–∫ –º—É—Å–æ—Ä–∞ (garbage collector) –≤ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–∏ –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º–æ–π –ø–∞–º—è—Ç–∏ –∏ –µ–µ –æ—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏–∏. –≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –∏–∑–±–µ–∂–∞—Ç—å –±–∞–≥–æ–≤, —Å–≤—è–∑–∞–Ω–Ω—ã—Ö —Å —Ä–∞–∑—ã–º–µ–Ω–æ–≤–∞–Ω–∏–µ–º —É–∫–∞–∑–∞—Ç–µ–ª–µ–π –Ω–∞ –æ—Å–≤–æ–±–æ–∂–¥–µ–Ω–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã –∏ —Ç.–ø. –û–¥–Ω–∞–∫–æ GC –∏–º–µ–µ—Ç —Å–≤–æ—é —Ü–µ–Ω—É –≤—Ä–µ–º–µ–Ω–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∏ –µ–≥–æ —Å–ª–æ–∂–Ω–æ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—Ç—å

–ú–æ–¥–µ–ª—å –≤–ª–∞–¥–µ–Ω–∏—è –∏ –∑–∞–∏–º—Å—Ç–≤–æ–≤–∞–Ω–∏—è `Rust` –ø–æ–∑–≤–æ–ª—è–µ—Ç –¥–æ–±–∏—Ç—å—Å—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ `C` –±–µ–∑ —Å–≤–æ–π—Å—Ç–≤–µ–Ω–Ω—ã—Ö –µ–º—É –ø—Ä–æ–±–ª–µ–º —Å –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å—é –ø–∞–º—è—Ç–∏. `Rust` —Ç–∞–∫–∂–µ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç —É–º–Ω—ã–µ —É–∫–∞–∑–∞—Ç–µ–ª–∏, –ø–æ—Ö–æ–∂–∏–µ –Ω–∞ —É–º–Ω—ã–µ —É–∫–∞–∑–∞—Ç–µ–ª–∏ `C++`. –î–æ—Å—Ç—É–ø–Ω—ã –∏ –¥—Ä—É–≥–∏–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã, —Ç–∞–∫–∏–µ –∫–∞–∫ –ø–æ–¥—Å—á–µ—Ç —Å—Å—ã–ª–æ–∫. –°—É—â–µ—Å—Ç–≤—É—é—Ç –¥–∞–∂–µ —Å—Ç–æ—Ä–æ–Ω–Ω–∏–µ –∫—Ä–µ–π—Ç—ã, –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—â–∏–µ —Å–±–æ—Ä–∫—É –º—É—Å–æ—Ä–∞ –≤–æ –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è (–º—ã –Ω–µ –±—É–¥–µ–º –∏—Ö —Ä–∞—Å—Å–º–∞—Ç—Ä–∏–≤–∞—Ç—å).

__–í–ª–∞–¥–µ–Ω–∏–µ__

–í—Å–µ –ø—Ä–∏–≤—è–∑–∫–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –∏–º–µ—é—Ç —Å–≤–æ—é –æ–±–ª–∞—Å—Ç—å –≤–∏–¥–∏–º–æ—Å—Ç–∏ (scope). –ü–æ–ø—ã—Ç–∫–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –∑–∞ –ø—Ä–µ–¥–µ–ª–∞–º–∏ –µ–µ –æ–±–ª–∞—Å—Ç–∏ –≤–∏–¥–∏–º–æ—Å—Ç–∏ –ø—Ä–∏–≤–æ–¥–∏—Ç –∫ –æ—à–∏–±–∫–µ:

```rust
struct Point(i32, i32);

fn main() {
    {
        let p = Point(3, 4);
        println!("x: {}", p.0);
    }
    println!("y: {}", p.1);
}
```

–ú—ã –≥–æ–≤–æ—Ä–∏–º, —á—Ç–æ –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è –≤–ª–∞–¥–µ–µ—Ç (own) –∑–Ω–∞—á–µ–Ω–∏–µ–º. –ö–∞–∂–¥–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –º–æ–∂–µ—Ç –∏–º–µ—Ç—å —Ç–æ–ª—å–∫–æ –æ–¥–Ω–æ–≥–æ –≤–ª–∞–¥–µ–ª—å—Ü–∞.

–í –∫–æ–Ω—Ü–µ –æ–±–ª–∞—Å—Ç–∏ –≤–∏–¥–∏–º–æ—Å—Ç–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è —É–Ω–∏—á—Ç–æ–∂–∞–µ—Ç—Å—è (dropped), –∞ –ø–∞–º—è—Ç—å –æ—Å–≤–æ–±–æ–∂–¥–∞–µ—Ç—Å—è (freed). –ó–¥–µ—Å—å –º–æ–∂–µ—Ç –∑–∞–ø—É—Å–∫–∞—Ç—å—Å—è –¥–µ—Å—Ç—Ä—É–∫—Ç–æ—Ä –¥–ª—è –æ—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏—è —Ä–µ—Å—É—Ä—Å–æ–≤.

GC –Ω–∞—á–∏–Ω–∞–µ—Ç —Å –∫–æ—Ä–Ω–µ–≤—ã—Ö —É–∑–ª–æ–≤ (roots) –¥–ª—è –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏—è –≤—Å–µ—Ö –¥–æ—Å—Ç–∏–∂–∏–º—ã—Ö (reachable) –æ–±—ä–µ–∫—Ç–æ–≤. –≠—Ç–æ –ø–æ—Ö–æ–∂–µ –Ω–∞ –ø—Ä–∏–Ω—Ü–∏–ø "–æ–¥–Ω–æ–≥–æ –≤–ª–∞–¥–µ–ª—å—Ü–∞" –≤ `Rust`.

__–ü–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ__

–ü—Ä–∏—Å–≤–æ–µ–Ω–∏–µ –ø–µ—Ä–µ–º–µ—â–∞–µ—Ç (move) –≤–ª–∞–¥–µ–Ω–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è –º–µ–∂–¥—É –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º–∏:

```rust
fn main() {
    let s1: String = String::from("–ü—Ä–∏–≤–µ—Ç");
    let s2: String = s1;
    println!("s2: {s2}");
    // println!("s1: {s1}");
}
```

- –ü—Ä–∏—Å–≤–æ–µ–Ω–∏–µ `s1` `s2` –ø–µ—Ä–µ–º–µ—â–∞–µ—Ç –≤–ª–∞–¥–µ–Ω–∏–µ —Å—Ç—Ä–æ–∫–æ–π `"–ü—Ä–∏–≤–µ—Ç"`
- –∫–æ–≥–¥–∞ `s1` –≤—ã—Ö–æ–¥–∏—Ç –∑–∞ –ø—Ä–µ–¥–µ–ª—ã –æ–±–ª–∞—Å—Ç–∏ –≤–∏–¥–∏–º–æ—Å—Ç–∏, –Ω–∏—á–µ–≥–æ –Ω–µ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç, –ø–æ—Ç–æ–º—É —á—Ç–æ —ç—Ç–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è –±–æ–ª—å—à–µ –Ω–∏—á–µ–º –Ω–µ –≤–ª–∞–¥–µ–µ—Ç
- –∫–æ–≥–¥–∞ `s2` –≤—ã—Ö–æ–¥–∏—Ç –∑–∞ –ø—Ä–µ–¥–µ–ª—ã –æ–±–ª–∞—Å—Ç–∏ –≤–∏–¥–∏–º–æ—Å—Ç–∏, –¥–∞–Ω–Ω—ã–µ —Å—Ç—Ä–æ–∫–∏ –æ—Å–≤–æ–±–æ–∂–¥–∞—é—Ç—Å—è

–ü–µ—Ä–µ–¥ –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ–º –≤–ª–∞–¥–µ–Ω–∏—è:

<img src="https://habrastorage.org/webt/-h/w5/ne/-hw5net5riimnnzzzzlfkatb7cs.png" />
<br />

–ü–æ—Å–ª–µ:

<img src="https://habrastorage.org/webt/cl/vm/z2/clvmz2cl_5fnzorhlgty4r8nwwm.png" />
<br />

–ö–æ–≥–¥–∞ –º—ã –ø–µ—Ä–µ–¥–∞–µ–º –∑–Ω–∞—á–µ–Ω–∏–µ –≤ —Ñ—É–Ω–∫—Ü–∏—é, –æ–Ω–æ –ø—Ä–∏—Å–≤–∞–∏–≤–∞–µ—Ç—Å—è –µ–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—É, –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ –≤–ª–∞–¥–µ–Ω–∏—è:

```rust
fn say_hello(name: String) {
    println!("–ü—Ä–∏–≤–µ—Ç {name}")
}

fn main() {
    let name = String::from("–ê–ª–∏—Å–∞");
    // –í–ª–∞–¥–µ–Ω–∏–µ –ø–µ—Ä–µ–º–µ—â–∞–µ—Ç—Å—è –≤ `say_hello`
    say_hello(name);
    // say_hello(name);
}
```

- –í—ã–∑—ã–≤–∞—è —Ñ—É–Ω–∫—Ü–∏—é `say_hello`, —Ñ—É–Ω–∫—Ü–∏—è `main` –ø–µ—Ä–µ–¥–∞–µ—Ç –µ–π –≤–ª–∞–¥–µ–Ω–∏–µ –∑–Ω–∞—á–µ–Ω–∏–µ–º `name`. –ü–æ—Å–ª–µ —ç—Ç–æ–≥–æ `name` –±–æ–ª—å—à–µ –Ω–µ –º–æ–∂–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –≤ `main`
- –ø–∞–º—è—Ç—å, –≤—ã–¥–µ–ª–µ–Ω–Ω–∞—è –≤ –∫—É—á–µ –¥–ª—è `name`, –±—É–¥–µ—Ç –æ—Å–≤–æ–±–æ–∂–¥–µ–Ω–∞ –ø–æ—Å–ª–µ –≤—ã–∑–æ–≤–∞ `say_hello`
- `main` –º–æ–∂–µ—Ç —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤–ª–∞–¥–µ–Ω–∏–µ –∑–Ω–∞—á–µ–Ω–∏–µ–º `name`, –µ—Å–ª–∏ –ø–µ—Ä–µ–¥–∞—Å—Ç –≤ `say_hello` —Å—Å—ã–ª–∫—É –Ω–∞ –Ω–µ–≥–æ (`&name`), –∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–º, –ø—Ä–∏–Ω–∏–º–∞–µ–º—ã–º `say_hello`, –±—É–¥–µ—Ç —Å—Å—ã–ª–∫–∞ (`name: &String`)
- –≤—Ç–æ—Ä—ã–º –≤–∞—Ä–∏–∞–Ω—Ç–æ–º —è–≤–ª—è–µ—Ç—Å—è –ø–µ—Ä–µ–¥–∞—á–∞ `say_hello` –∫–æ–ø–∏–∏/–∫–ª–æ–Ω–∞ `name` (`name.clone()`)
- –≤ `Rust`, –≤ –æ—Ç–ª–∏—á–∏–µ –æ—Ç `C++`, –∫–æ–ø–∏–∏ –∑–Ω–∞—á–µ–Ω–∏–π —á–∞—â–µ –≤—Å–µ–≥–æ –ø—Ä–∏—Ö–æ–¥–∏—Ç—Å—è —Å–æ–∑–¥–∞–≤–∞—Ç—å —è–≤–Ω–æ

__Clone__

–ò–Ω–æ–≥–¥–∞ –Ω–∞–º –Ω—É–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å –∫–æ–ø–∏—é –∑–Ω–∞—á–µ–Ω–∏—è. –î–ª—è —ç—Ç–æ–≥–æ –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω —Ç—Ä–µ–π—Ç `Clone`:

```rust
#[derive(Default)]
struct Backends {
    hostnames: Vec<String>,
    weights: Vec<f64>,
}

impl Backends {
    fn set_hostnames(&mut self, hostnames: &Vec<String>) {
        // –í–µ–∫—Ç–æ—Ä —Ä–µ–∞–ª–∏–∑—É–µ—Ç —Ç—Ä–µ–π—Ç `Clone` –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
        self.hostnames = hostnames.clone();
        self.weights = hostnames.iter().map(|_| 1.0).collect();
    }
}
```

–ò–¥–µ—è `Clone` –∑–∞–∫–ª—é—á–∞–µ—Ç—Å—è –≤ —Ç–æ–º, —á—Ç–æ–±—ã –æ–±–ª–µ–≥—á–∏—Ç—å –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –º–µ—Å—Ç–∞ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –∫—É—á–∏.

–ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —á–∞—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ —Ä–µ—à–µ–Ω–∏—è –ø—Ä–æ–±–ª–µ–º, —Å–≤—è–∑–∞–Ω–Ω—ã—Ö —Å –≤–ª–∞–¥–µ–Ω–∏–µ–º –∏ –∑–∞–∏–º—Å—Ç–≤–æ–≤–∞–Ω–∏–µ–º, —Å –ø–æ—Å–ª–µ–¥—É—é—â–µ–π –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–µ–π –∑–∞ —Å—á–µ—Ç –∏—Ö —É–¥–∞–ª–µ–Ω–∏—è.

__–ö–æ–ø–∏—Ä—É–µ–º—ã–µ —Ç–∏–ø—ã__

–•–æ—Ç—è —Å–µ–º–∞–Ω—Ç–∏–∫–∞ –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏—è –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é, –Ω–µ–∫–æ—Ç–æ—Ä—ã–µ —Ç–∏–ø—ã –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –∫–æ–ø–∏—Ä—É—é—Ç—Å—è:

```rust
fn main() {
    let x = 42;
    let y = x;
    println!("x: {x}"); // –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è `x` –Ω–µ –±—ã–ª–∞ –±—ã –¥–æ—Å—Ç—É–ø–Ω–æ–π –±–µ–∑ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è
    println!("y: {y}");
}
```

–¢–∞–∫–∏–µ —Ç–∏–ø—ã —Ä–µ–∞–ª–∏–∑—É—é—Ç —Ç—Ä–µ–π—Ç `Copy`.

–ú—ã –º–æ–∂–µ–º —Å–¥–µ–ª–∞—Ç—å —Ç–∞–∫, —á—Ç–æ–±—ã –Ω–∞—à–∏ —Ç–∏–ø—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∏ —Å–µ–º–∞–Ω—Ç–∏–∫—É –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è:

```rust
#[derive(Copy, Clone, Debug)]
struct Point(i32, i32);

fn main() {
    let p1 = Point(3, 4);
    let p2 = p1;
    println!("p1: {p1:?}");
    println!("p2: {p2:?}");
}
```

- –ü–æ—Å–ª–µ –ø—Ä–∏—Å–≤–æ–µ–Ω–∏—è `p1` –∏ `p2` –≤–ª–∞–¥–µ—é—Ç —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏
- –º—ã —Ç–∞–∫–∂–µ –º–æ–∂–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `p1.clone()` –¥–ª—è —è–≤–Ω–æ–≥–æ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö

–ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –∫–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ - —ç—Ç–æ —Ä–∞–∑–Ω—ã–µ –≤–µ—â–∏:

- –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç–Ω–æ—Å–∏—Ç—Å—è –∫ –ø–æ–±–∏—Ç–æ–≤–æ–º—É –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—é –æ–±–ª–∞—Å—Ç–µ–π –ø–∞–º—è—Ç–∏ –∏ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å –ø—Ä–æ–∏–∑–≤–æ–ª—å–Ω—ã–º–∏ –æ–±—ä–µ–∫—Ç–∞–º–∏
- –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–µ –ø–æ–∑–≤–æ–ª—è–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—É—é –ª–æ–≥–∏–∫—É (–≤ –æ—Ç–ª–∏—á–∏–µ –æ—Ç –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–æ–≤ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è –≤ `C++`)
- –∫–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ - —ç—Ç–æ –±–æ–ª–µ–µ –æ–±—â–∞—è –æ–ø–µ—Ä–∞—Ü–∏—è, –∫–æ—Ç–æ—Ä–∞—è —Ç–∞–∫–∂–µ –ø–æ–∑–≤–æ–ª—è–µ—Ç –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—Ç—å –ø–æ–≤–µ–¥–µ–Ω–∏–µ –ø—É—Ç–µ–º —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ —Ç—Ä–µ–π—Ç–∞ `Clone`
- –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ —Ç–∏–ø–∞—Ö, –∫–æ—Ç–æ—Ä—ã–µ —Ä–µ–∞–ª–∏–∑—É—é—Ç —Ç—Ä–µ–π—Ç `Drop`

–ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–¥–µ–ª–∞—Ç—å —Å–ª–µ–¥—É—é—â–µ–µ –≤ –ø—Ä–∏–º–µ—Ä–µ:

- –¥–æ–±–∞–≤—å—Ç–µ –ø–æ–ª–µ `String` –≤ —Å—Ç—Ä—É–∫—Ç—É—Ä—É `Point`. –ü—Ä–∏–º–µ—Ä –Ω–µ –±—É–¥–µ—Ç –∫–æ–º–ø–∏–ª–∏—Ä–æ–≤–∞—Ç—å—Å—è, –ø–æ—Å–∫–æ–ª—å–∫—É `String` –Ω–µ —è–≤–ª—è–µ—Ç—Å—è –∫–æ–ø–∏—Ä—É–µ–º—ã–º —Ç–∏–ø–æ–º
- —É–¥–∞–ª–∏—Ç–µ `Copy` –∏–∑ –∞—Ç—Ä–∏–±—É—Ç–∞ `derive`. –ü—Ä–∏ –ø–æ–ø—ã—Ç–∫–µ –≤—ã–≤–µ—Å—Ç–∏ –∑–Ω–∞—á–µ–Ω–∏–µ `p1` –≤ —Ç–µ—Ä–º–∏–Ω–∞–ª –≤–æ–∑–Ω–∏–∫–Ω–µ—Ç –æ—à–∏–±–∫–∞
- –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –∫–ª–æ–Ω–∏—Ä–æ–≤–∞—Ç—å `p1` —è–≤–Ω–æ

__–¢—Ä–µ–π—Ç Drop__

–ó–Ω–∞—á–µ–Ω–∏—è, —Ä–µ–∞–ª–∏–∑—É—é—â–∏–µ —Ç—Ä–µ–π—Ç `Drop`, –º–æ–≥—É—Ç –æ–ø—Ä–µ–¥–µ–ª—è—Ç—å –∫–æ–¥, –∫–æ—Ç–æ—Ä—ã–π –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –ø—Ä–∏ –∏—Ö –≤—ã—Ö–æ–¥–µ –∑–∞ –ø—Ä–µ–¥–µ–ª—ã –æ–±–ª–∞—Å—Ç–∏ –≤–∏–¥–∏–º–æ—Å—Ç–∏:

```rust
struct Droppable {
    name: &'static str,
}

impl Drop for Droppable {
    fn drop(&mut self) {
        println!("—É–Ω–∏—á—Ç–æ–∂–µ–Ω–∏–µ {}", self.name);
    }
}

fn main() {
    let a = Droppable { name: "a" };
    {
        let b = Droppable { name: "b" };
        {
            let c = Droppable { name: "c" };
            let d = Droppable { name: "d" };
            println!("–≤—ã—Ö–æ–¥ –∏–∑ –±–ª–æ–∫–∞ B");
        }
        println!("–≤—ã—Ö–æ–¥ –∏–∑ –±–ª–æ–∫–∞ A");
    }
    drop(a);
    println!("–≤—ã—Ö–æ–¥ –∏–∑ main");
}
```

–†–µ–º–∞—Ä–∫–∏:

- –æ–±—Ä–∞—Ç–∏—Ç–µ –≤–Ω–∏–º–∞–Ω–∏–µ, —á—Ç–æ `std::mem::drop` –∏ `std::ops::Drop::drop` - —ç—Ç–æ —Ä–∞–∑–Ω—ã–µ –≤–µ—â–∏
- –∑–Ω–∞—á–µ–Ω–∏—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É–Ω–∏—á—Ç–æ–∂–∞—é—Ç—Å—è –ø—Ä–∏ –≤—ã—Ö–æ–¥–µ –∑–∞ –ø—Ä–µ–¥–µ–ª—ã –∏—Ö –æ–±–ª–∞—Å—Ç–∏ –≤–∏–¥–∏–º–æ—Å—Ç–∏
- –ø–æ—Å–ª–µ —É–Ω–∏—á—Ç–æ–∂–µ–Ω–∏—è –∑–Ω–∞—á–µ–Ω–∏—è, –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –µ–≥–æ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è `Drop::drop`, –µ—Å–ª–∏ –∑–Ω–∞—á–µ–Ω–∏–µ —Ä–µ–∞–ª–∏–∑—É–µ—Ç `std::ops::Drop`
- –≤—Å–µ –ø–æ–ª—è —Å—Ç—Ä—É–∫—Ç—É—Ä—ã —Ç–∞–∫–∂–µ —É–Ω–∏—á—Ç–æ–∂–∞—é—Ç—Å—è, –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –æ—Ç —Ç–æ–≥–æ, —Ä–µ–∞–ª–∏–∑—É—é—Ç –æ–Ω–∏ `Drop` –∏–ª–∏ –Ω–µ—Ç
- `std::mem::drop` - —ç—Ç–æ –ø—É—Å—Ç–∞—è —Ñ—É–Ω–∫—Ü–∏—è, –Ω–µ –ø—Ä–∏–Ω–∏–º–∞—é—â–∞—è –Ω–∏–∫–∞–∫–∏—Ö –∑–Ω–∞—á–µ–Ω–∏–π. –í–∞–∂–Ω–æ —Ç–æ, —á—Ç–æ –æ–Ω–∞ –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –≤–ª–∞–¥–µ–Ω–∏–µ –∑–Ω–∞—á–µ–Ω–∏–µ–º, –∫–æ—Ç–æ—Ä–æ–µ —É–Ω–∏—á—Ç–æ–∂–∞–µ—Ç—Å—è –ø–æ—Å–ª–µ –µ–µ –≤—ã–∑–æ–≤–∞. –° –ø–æ–º–æ—â—å—é —ç—Ç–æ–π —Ñ—É–Ω–∫—Ü–∏–∏ –º–æ–∂–Ω–æ —É–Ω–∏—á—Ç–æ–∂–∞—Ç—å –∑–Ω–∞—á–µ–Ω–∏—è –¥–æ —Ç–æ–≥–æ, –∫–∞–∫ –æ–Ω–∏ –≤—ã–π–¥—É—Ç –∑–∞ –ø—Ä–µ–¥–µ–ª—ã –∏—Ö –æ–±–ª–∞—Å—Ç–∏ –≤–∏–¥–∏–º–æ—Å—Ç–∏
  - —ç—Ç–æ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø–æ–ª–µ–∑–Ω—ã–º –¥–ª—è –æ–±—ä–µ–∫—Ç–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ –≤—ã–ø–æ–ª–Ω—è—é—Ç –∫–∞–∫—É—é-—Ç–æ —Ä–∞–±–æ—Ç—É –ø—Ä–∏ —É–Ω–∏—á—Ç–æ–∂–µ–Ω–∏–∏: —Å–Ω—è—Ç–∏–µ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ (releasing lock), –∑–∞–∫—Ä—ã—Ç–∏–µ —Ñ–∞–π–ª–∞ (–¥–µ—Å–∫—Ä–∏–ø—Ç–æ—Ä–∞) –∏ –¥—Ä.

- –ü–æ—á–µ–º—É `Drop::drop` –Ω–µ –ø—Ä–∏–Ω–∏–º–∞–µ—Ç `self`?
  - –ö–æ—Ä–æ—Ç–∫–∏–π –æ—Ç–≤–µ—Ç: –≤ —ç—Ç–æ–º —Å–ª—É—á–∞–µ `std::mem::drop` –±—É–¥–µ—Ç –≤—ã–∑–≤–∞–Ω–∞ –≤ –∫–æ–Ω—Ü–µ –±–ª–æ–∫–∞, —á—Ç–æ –ø—Ä–∏–≤–µ–¥–µ—Ç –∫ –¥—Ä—É–≥–æ–º—É –≤—ã–∑–æ–≤—É `Drop::drop` –∏ –ø–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω–∏—é —Å—Ç–µ–∫–∞!
- –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∑–∞–º–µ–Ω–∏—Ç—å `drop(a)` –Ω–∞ `a.drop()`

__–£–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ: —Ç–∏–ø "–°—Ç—Ä–æ–∏—Ç–µ–ª—å"__

–í —ç—Ç–æ–º —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–∏ –º—ã —Ä–µ–∞–ª–∏–∑—É–µ–º —Å–ª–æ–∂–Ω—ã–π —Ç–∏–ø, –∫–æ—Ç–æ—Ä—ã–π –≤–ª–∞–¥–µ–µ—Ç –≤—Å–µ–º–∏ —Å–≤–æ–∏–º–∏ –¥–∞–Ω–Ω—ã–º–∏. –ú—ã –±—É–¥–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å ["—à–∞–±–ª–æ–Ω –ø–æ—Å—Ç—Ä–æ–∏—Ç–µ–ª—è"](https://refactoring.guru/ru/design-patterns/builder/rust/example) (builder patterm) –¥–ª—è –ø–æ—ç—Ç–∞–ø–Ω–æ–≥–æ –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏—è –Ω–æ–≤–æ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º —É–¥–æ–±–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π.

```rust
#[derive(Debug)]
enum Language {
    Rust,
    Java,
    Perl,
}

#[derive(Clone, Debug)]
struct Dependency {
    name: String,
    version_expression: String,
}

// –ü—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –ø–∞–∫–µ—Ç–∞ –ü–û
#[derive(Debug)]
struct Package {
    name: String,
    version: String,
    authors: Vec<String>,
    dependencies: Vec<Dependency>,
    // –≠—Ç–æ –ø–æ–ª–µ —è–≤–ª—è–µ—Ç—Å—è –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–º
    language: Option<Language>,
}

impl Package {
    // –ú–µ—Ç–æ–¥ –¥–ª—è –≤–æ–∑–≤—Ä–∞—Ç–∞ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è –ø–∞–∫–µ—Ç–∞ –∫–∞–∫ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
    // –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤ —Å–æ–∑–¥–∞–Ω–∏–∏ –¥—Ä—É–≥–∏—Ö –ø–∞–∫–µ—Ç–æ–≤
    fn as_dependency(&self) -> Dependency {
        todo!("1")
    }
}

// –°—Ç—Ä–æ–∏—Ç–µ–ª—å –ø–∞–∫–µ—Ç–∞. –î–ª—è —Å–æ–∑–¥–∞–Ω–∏—è `Package` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –º–µ—Ç–æ–¥ `build`
struct PackageBuilder(Package);

impl PackageBuilder {
    fn new(name: impl Into<String>) -> Self {
        todo!("2")
    }

    // –ú–µ—Ç–æ–¥ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –≤–µ—Ä—Å–∏–∏ –ø–∞–∫–µ—Ç–∞
    fn version(mut self, version: impl Into<String>) -> Self {
        self.0.version = version.into();
        self
    }

    // –ú–µ—Ç–æ–¥ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –∞–≤—Ç–æ—Ä–∞ –ø–∞–∫–µ—Ç–∞
    fn authors(mut self, authors: Vec<String>) -> Self {
        todo!("3")
    }

    // –ú–µ—Ç–æ–¥ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–π –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
    fn dependency(mut self, dependency: Dependency) -> Self {
        todo!("4")
    }

    // –ú–µ—Ç–æ–¥ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ —è–∑—ã–∫–∞. –ï—Å–ª–∏ –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω, –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –∏–º–µ–µ—Ç –∑–Ω–∞—á–µ–Ω–∏–µ `None`
    fn language(mut self, language: Language) -> Self {
        todo!("5")
    }

    fn build(self) -> Package {
        self.0
    }
}

fn main() {
    let base64 = PackageBuilder::new("base64").version("0.13").build();
    println!("base64: {base64:?}");
    let log =
        PackageBuilder::new("log").version("0.4").language(Language::Rust).build();
    println!("log: {log:?}");
    let serde = PackageBuilder::new("serde")
        .authors(vec!["djmitche".into()])
        .version(String::from("4.0"))
        .dependency(base64.as_dependency())
        .dependency(log.as_dependency())
        .build();
    println!("serde: {serde:?}");
}
```

<details>
<summary>–†–µ—à–µ–Ω–∏–µ:</summary>

```rust
impl Package {
    fn as_dependency(&self) -> Dependency {
        Dependency {
            name: self.name.clone(),
            version_expression: self.version.clone(),
        }
    }
}

impl PackageBuilder {
    fn new(name: impl Into<String>) -> Self {
        Self(Package {
            name: name.into(),
            version: "0.1".into(),
            authors: vec![],
            dependencies: vec![],
            language: None,
        })
    }

    fn version(mut self, version: impl Into<String>) -> Self {
        self.0.version = version.into();
        self
    }

    fn authors(mut self, authors: Vec<String>) -> Self {
        self.0.authors = authors;
        self
    }

    fn dependency(mut self, dependency: Dependency) -> Self {
        self.0.dependencies.push(dependency);
        self
    }

    fn language(mut self, language: Language) -> Self {
        self.0.language = Some(language);
        self
    }

    fn build(self) -> Package {
        self.0
    }
}
```

</details>

## –£–º–Ω—ã–µ —É–∫–∞–∑–∞—Ç–µ–ª–∏

__`Box<T>`__

[Box](https://doc.rust-lang.org/std/boxed/struct.Box.html) - —ç—Ç–æ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–π —É–∫–∞–∑–∞—Ç–µ–ª—å –Ω–∞ –¥–∞–Ω–Ω—ã–µ –≤ –∫—É—á–µ:

```rust
fn main() {
    let five = Box::new(5);
    println!("–ø—è—Ç—å: {}", *five);
}
```

`Box<T>` —Ä–µ–∞–ª–∏–∑—É–µ—Ç `Deref<Target = T>`: –º—ã –º–æ–∂–µ–º [–≤—ã–∑—ã–≤–∞—Ç—å –º–µ—Ç–æ–¥—ã `T` –ø—Ä—è–º–æ –Ω–∞ `Box<T>`](https://doc.rust-lang.org/std/ops/trait.Deref.html#more-on-deref-coercion).

–†–µ–∫—É—Ä—Å–∏–≤–Ω—ã–µ —Ç–∏–ø—ã –∏–ª–∏ —Ç–∏–ø—ã –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–≥–æ —Ä–∞–∑–º–µ—Ä–∞ –¥–æ–ª–∂–Ω—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `Box`:

```rust
#[derive(Debug)]
enum List<T> {
    // –ù–µ–ø—É—Å—Ç–æ–π —Å–ø–∏—Å–æ–∫: –ø–µ—Ä–≤—ã–π —ç–ª–µ–º–µ–Ω—Ç –∏ –æ—Å—Ç–∞–ª—å–Ω–∞—è —á–∞—Å—Ç—å —Å–ø–∏—Å–∫–∞
    Element(T, Box<List<T>>),
    // –ü—É—Å—Ç–æ–π —Å–ø–∏—Å–æ–∫
    Nil,
}

fn main() {
    let list: List<i32> =
        List::Element(1, Box::new(List::Element(2, Box::new(List::Nil))));
    println!("{list:?}");
}
```

<img src="https://habrastorage.org/webt/y_/mi/gm/y_migm2n3g0zfpdq8v7nc0ujmxm.png" />
<br />

–†–µ–º–∞—Ä–∫–∏:

- `Box` –ø–æ—Ö–æ–∂ –Ω–∞ `std::unique_ptr` –≤ `C++`, –∑–∞ –∏—Å–∫–ª—é—á–µ–Ω–∏–µ–º —Ç–æ–≥–æ, —á—Ç–æ –æ–Ω –Ω–µ –º–æ–∂–µ—Ç –∏–º–µ—Ç—å –∑–Ω–∞—á–µ–Ω–∏–µ `NULL`
- `Box` –º–æ–∂–µ—Ç –±—ã—Ç—å –ø–æ–ª–µ–∑–Ω—ã–º, –∫–æ–≥–¥–∞
  - —É –Ω–∞—Å –µ—Å—Ç—å —Ç–∏–ø, —Ä–∞–∑–º–µ—Ä –∫–æ—Ç–æ—Ä–æ–≥–æ –Ω–µ–∏–∑–≤–µ—Å—Ç–µ–Ω –≤–æ –≤—Ä–µ–º—è –∫–æ–º–ø–∏–ª—è—Ü–∏–∏, –∞ –∫–æ–º–ø–∏–ª—è—Ç–æ—Ä—É `Rust` –Ω—É–∂–µ–Ω —Ç–æ—á–Ω—ã–π —Ä–∞–∑–º–µ—Ä
  - –º—ã —Ö–æ—Ç–∏–º –ø–µ—Ä–µ–¥–∞—Ç—å –≤–ª–∞–¥–µ–Ω–∏–µ –±–æ–ª—å—à–æ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –¥–∞–Ω–Ω—ã—Ö. –í–º–µ—Å—Ç–æ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è –±–æ–ª—å—à–æ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –¥–∞–Ω–Ω—ã—Ö –≤ —Å—Ç–µ–∫–µ, –º—ã —Ö—Ä–∞–Ω–∏–º –¥–∞–Ω–Ω—ã–µ –≤ –∫—É—á–µ –≤ `Box` –∏ –ø–µ—Ä–µ–º–µ—â–∞–µ–º —Ç–æ–ª—å–∫–æ —É–∫–∞–∑–∞—Ç–µ–ª—å
- –µ—Å–ª–∏ –º—ã –ø–æ–ø—ã—Ç–∞–µ–º—Å—è –≤–Ω–µ–¥—Ä–∏—Ç—å `List` –ø—Ä—è–º–æ –≤ `List` –±–µ–∑ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è `Box`, –∫–æ–º–ø–∏–ª—è—Ç–æ—Ä –Ω–µ —Å–º–æ–∂–µ—Ç –≤—ã—á–∏—Å–ª–∏—Ç—å —Ç–æ—á–Ω—ã–π —Ä–∞–∑–º–µ—Ä —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –≤ –ø–∞–º—è—Ç–∏ (`List` –±—É–¥–µ—Ç –∏–º–µ—Ç—å –±–µ—Å–∫–æ–Ω–µ—á–Ω—ã–π —Ä–∞–∑–º–µ—Ä)
- `Box` —Ä–µ—à–∞–µ—Ç —ç—Ç—É –ø—Ä–æ–±–ª–µ–º—É, –ø–æ—Å–∫–æ–ª—å–∫—É –æ–Ω –∏–º–µ–µ—Ç —Ç–∞–∫–æ–π –∂–µ —Ä–∞–∑–º–µ—Ä, —á—Ç–æ –æ–±—ã—á–Ω—ã–π —É–∫–∞–∑–∞—Ç–µ–ª—å –∏ –ø—Ä–æ—Å—Ç–æ —É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ —Å–ª–µ–¥—É—é—â–∏–π —ç–ª–µ–º–µ–Ω—Ç —Å–ø–∏—Å–∫–∞ –≤ –∫—É—á–µ
- —É–¥–∞–ª–∏—Ç–µ `Box` –∏–∑ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è `List` –∏ –∏–∑—É—á–∏—Ç–µ –æ—à–∏–±–∫—É –∫–æ–º–ø–∏–ª—è—Ç–æ—Ä–∞

_–ù–∏—à–µ–≤–∞—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è_

```rust
#[derive(Debug)]
enum List<T> {
    Element(T, Box<List<T>>),
    Nil,
}

fn main() {
    let list: List<i32> =
        List::Element(1, Box::new(List::Element(2, Box::new(List::Nil))));
    println!("{list:?}");
}
```

`Box` –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—É—Å—Ç—ã–º, –ø–æ—ç—Ç–æ–º—É —É–∫–∞–∑–∞—Ç–µ–ª—å –≤—Å–µ–≥–¥–∞ —è–≤–ª—è–µ—Ç—Å—è –≤–∞–ª–∏–¥–Ω—ã–º –∏ –Ω–µ –º–æ–∂–µ—Ç –∏–º–µ—Ç—å –∑–Ω–∞—á–µ–Ω–∏–µ `NULL`. –≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –∫–æ–º–ø–∏–ª—è—Ç–æ—Ä—É –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Å–ª–æ–π –ø–∞–º—è—Ç–∏:

<img src="https://habrastorage.org/webt/1h/nk/vy/1hnkvyqurluuqpnyhm2zk68jax0.png" />
<br />

__Rc__

[Rc](https://doc.rust-lang.org/std/rc/struct.Rc.html) - —ç—Ç–æ –æ–±—â–∏–π —É–∫–∞–∑–∞—Ç–µ–ª—å —Å –ø–æ–¥—Å—á–µ—Ç–æ–º —Å—Å—ã–ª–æ–∫. –û–Ω –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è, –∫–æ–≥–¥–∞ –Ω—É–∂–Ω–æ —Å–æ—Å–ª–∞—Ç—å—Å—è –Ω–∞ –æ–¥–Ω–∏ –∏ —Ç–µ –∂–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –º–µ—Å—Ç:

```rust
use std::rc::Rc;

fn main() {
    let a = Rc::new(10);
    let b = Rc::clone(&a);

    println!("a: {a}");
    println!("b: {b}");
}
```

- –í –º–Ω–æ–≥–æ–ø–æ—Ç–æ—á–Ω—ã—Ö –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞—Ö —Å–ª–µ–¥—É–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å [Arc](https://google.github.io/comprehensive-rust/concurrency/shared_state/arc.html) –∏ [Mutex](https://doc.rust-lang.org/std/sync/struct.Mutex.html)
- –º—ã –º–æ–∂–µ–º –ø–æ–Ω–∏–∑–∏—Ç—å –æ–±—â–∏–π —É–∫–∞–∑–∞—Ç–µ–ª—å –¥–æ —Å–ª–∞–±–æ–≥–æ —É–∫–∞–∑–∞—Ç–µ–ª—è ([Weak](https://doc.rust-lang.org/std/rc/struct.Weak.html)) –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Ü–∏–∫–ª–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ –±—É–¥—É—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ —É–Ω–∏—á—Ç–æ–∂–µ–Ω—ã –≤ —Å–≤–æ–µ –≤—Ä–µ–º—è

–†–µ–º–∞—Ä–∫–∏:

- —Å—á–µ—Ç—á–∏–∫ `Rc` –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç, —á—Ç–æ —Å–æ–¥–µ—Ä–∂–∞—â–µ–µ—Å—è –≤ –Ω–µ–º –∑–Ω–∞—á–µ–Ω–∏–µ –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ –¥–æ —Ç–µ—Ö –ø–æ—Ä, –ø–æ–∫–∞ —Å—É—â–µ—Å—Ç–≤—É—é—Ç —Å—Å—ã–ª–∫–∏ –Ω–∞ –Ω–µ–≥–æ
- `Rc` –≤ `Rust` –ø–æ—Ö–æ–∂ –Ω–∞ `std::shared_ptr` –≤ `C++`
- `Rc::clone` –æ–±—Ö–æ–¥–∏—Ç—Å—è –¥–µ—à–µ–≤–æ: –æ–Ω —Å–æ–∑–¥–∞–µ—Ç —É–∫–∞–∑–∞—Ç–µ–ª—å –Ω–∞ –æ–¥–Ω–æ –∏ —Ç–æ –∂–µ –º–µ—Å—Ç–æ –≤ –ø–∞–º—è—Ç–∏ –∏ —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç —Å—á–µ—Ç—á–∏–∫ —Å—Å—ã–ª–æ–∫. –û–Ω –Ω–µ —Å–æ–∑–¥–∞–µ—Ç –≥–ª—É–±–æ–∫–∏—Ö –∫–ª–æ–Ω–æ–≤, –∏ –µ–≥–æ –æ–±—ã—á–Ω–æ –º–æ–∂–Ω–æ –∏–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–∏ –ø–æ–∏—Å–∫–µ –≤ –∫–æ–¥–µ –ø—Ä–æ–±–ª–µ–º —Å –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å—é
- `make_mut` —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–∏ –∫–ª–æ–Ω–∏—Ä—É–µ—Ç –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ ("–∫–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–∏ –∑–∞–ø–∏—Å–∏" - clone-on-write) –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∏–∑–º–µ–Ω—è–µ–º—É—é —Å—Å—ã–ª–∫—É
- `Rc::strong_count` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –∞–∫—Ç–∏–≤–Ω—ã—Ö —Å—Å—ã–ª–æ–∫
- `Rc::downgrade` (–≤–µ—Ä–æ—è—Ç–Ω–æ, –≤ —Å–æ—á–µ—Ç–∞–Ω–∏–∏ —Å `RefCell`) –ø–æ–∑–≤–æ–ª—è–µ—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å –æ–±—ä–µ–∫—Ç—ã —Å–æ —Å–ª–∞–±—ã–º –ø–æ–¥—Å—á–µ—Ç–æ–º —Å—Å—ã–ª–æ–∫ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Ü–∏–∫–ª–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ –±—É–¥—É—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ —É–¥–∞–ª–µ–Ω—ã –≤ –±—É–¥—É—â–µ–º

__–£–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ: –¥–≤–æ–∏—á–Ω–æ–µ –¥–µ—Ä–µ–≤–æ__

–ë–∏–Ω–∞—Ä–Ω–æ–µ –¥–µ—Ä–µ–≤–æ (binary tree) - —ç—Ç–æ –¥—Ä–µ–≤–æ–≤–∏–¥–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö, –≤ –∫–æ—Ç–æ—Ä–æ–π –∫–∞–∂–¥—ã–π —É–∑–µ–ª –∏–º–µ–µ—Ç 2 –¥–æ—á–µ—Ä–Ω–∏—Ö —ç–ª–µ–º–µ–Ω—Ç–∞ (–ª–µ–≤—ã–π –∏ –ø—Ä–∞–≤—ã–π). –ú—ã —Å–æ–∑–¥–∞–¥–∏–º –¥–µ—Ä–µ–≤–æ, –≤ –∫–æ—Ç–æ—Ä–æ–º –∫–∞–∂–¥—ã–π —É–∑–µ–ª —Ö—Ä–∞–Ω–∏—Ç –∑–Ω–∞—á–µ–Ω–∏–µ. –î–ª—è –¥–∞–Ω–Ω–æ–≥–æ —É–∑–ª–∞ `N` –≤—Å–µ —É–∑–ª—ã –≤ –ª–µ–≤–æ–º –ø–æ–¥–¥–µ—Ä–µ–≤–µ `N` —Å–æ–¥–µ—Ä–∂–∞—Ç –º–µ–Ω—å—à–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è, –∞ –≤—Å–µ —É–∑–ª—ã –≤ –ø—Ä–∞–≤–æ–º –ø–æ–¥–¥–µ—Ä–µ–≤–µ `N` - –±–æ–ª—å—à–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è.

–ï—Å–ª–∏ –∑–∞–¥–∞–Ω–∏–µ –ø–æ–∫–∞–∂–µ—Ç—Å—è –≤–∞–º –ª–µ–≥–∫–∏–º –∏ –≤—ã –±—ã—Å—Ç—Ä–æ —Å –Ω–∏–º —Å–ø—Ä–∞–≤–∏—Ç–µ—Å—å, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –∏—Ç–µ—Ä–∞—Ç–æ—Ä –ø–æ –¥–µ—Ä–µ–≤—É, –∫–æ—Ç–æ—Ä—ã–π –±—É–¥–µ—Ç –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å –≤—Å–µ –∑–Ω–∞—á–µ–Ω–∏—è –ø–æ –ø–æ—Ä—è–¥–∫—É.

```rust
// –£–∑–µ–ª –¥–µ—Ä–µ–≤–∞
#[derive(Debug)]
struct Node<T: Ord> {
    value: T,
    left: Subtree<T>,
    right: Subtree<T>,
}

// –ü–æ–¥–¥–µ—Ä–µ–≤–æ, –∫–æ—Ç–æ—Ä–æ–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—É—Å—Ç—ã–º
#[derive(Debug)]
struct Subtree<T: Ord>(Option<Box<Node<T>>>);

// –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä, —Ö—Ä–∞–Ω—è—â–∏–π –Ω–∞–±–æ—Ä –∑–Ω–∞—á–µ–Ω–∏–π —Å –ø–æ–º–æ—â—å—é –¥–≤–æ–∏—á–Ω–æ–≥–æ –¥–µ—Ä–µ–≤–∞.
// –ó–Ω–∞—á–µ–Ω–∏–µ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω —Ä–∞–∑, –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –æ—Ç —Ç–æ–≥–æ, —Å–∫–æ–ª—å–∫–æ —Ä–∞–∑ –æ–Ω–æ –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è
#[derive(Debug)]
pub struct BinaryTree<T: Ord> {
    root: Subtree<T>,
}

impl<T: Ord> BinaryTree<T> {
    fn new() -> Self {
        todo!("—Ä–µ–∞–ª–∏–∑—É–π –º–µ–Ω—è")
    }

    fn insert(&mut self, value: T) {
        todo!("—Ä–µ–∞–ª–∏–∑—É–π –º–µ–Ω—è")
    }

    fn has(&self, value: &T) -> bool {
        todo!("—Ä–µ–∞–ª–∏–∑—É–π –º–µ–Ω—è")
    }

    fn len(&self) -> usize {
        todo!("—Ä–µ–∞–ª–∏–∑—É–π –º–µ–Ω—è")
    }
}

impl<T: Ord> Subtree<T> {
    fn new() -> Self {
        todo!("—Ä–µ–∞–ª–∏–∑—É–π –º–µ–Ω—è")
    }

    fn insert(&mut self, value: T) {
        todo!("—Ä–µ–∞–ª–∏–∑—É–π –º–µ–Ω—è")
    }

    fn has(&self, value: &T) -> bool {
        todo!("—Ä–µ–∞–ª–∏–∑—É–π –º–µ–Ω—è")
    }

    fn len(&self) -> usize {
        todo!("—Ä–µ–∞–ª–∏–∑—É–π –º–µ–Ω—è")
    }
}

impl<T: Ord> Node<T> {
    fn new(value: T) -> Self {
        todo!("—Ä–µ–∞–ª–∏–∑—É–π –º–µ–Ω—è")
    }
}

fn main() {
    let mut tree = BinaryTree::new();
    tree.insert("foo");
    assert_eq!(tree.len(), 1);
    tree.insert("bar");
    assert!(tree.has(&"foo"));
}

#[cfg(test)]
mod tests {
    use super::*;

    #[test]
    fn len() {
        let mut tree = BinaryTree::new();
        assert_eq!(tree.len(), 0);
        tree.insert(2);
        assert_eq!(tree.len(), 1);
        tree.insert(1);
        assert_eq!(tree.len(), 2);
        tree.insert(2); // –¥—É–±–ª–∏–∫–∞—Ç
        assert_eq!(tree.len(), 2);
    }

    #[test]
    fn has() {
        let mut tree = BinaryTree::new();
        fn check_has(tree: &BinaryTree<i32>, exp: &[bool]) {
            let got: Vec<bool> =
                (0..exp.len()).map(|i| tree.has(&(i as i32))).collect();
            assert_eq!(&got, exp);
        }

        check_has(&tree, &[false, false, false, false, false]);
        tree.insert(0);
        check_has(&tree, &[true, false, false, false, false]);
        tree.insert(4);
        check_has(&tree, &[true, false, false, false, true]);
        tree.insert(4);
        check_has(&tree, &[true, false, false, false, true]);
        tree.insert(3);
        check_has(&tree, &[true, false, false, true, true]);
    }

    #[test]
    fn unbalanced() {
        let mut tree = BinaryTree::new();
        for i in 0..100 {
            tree.insert(i);
        }
        assert_eq!(tree.len(), 100);
        assert!(tree.has(&50));
    }
}
```

–ü–æ–¥—Å–∫–∞–∑–∫–∞: –¥–ª—è —Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏—è —Å —à–∞–±–ª–æ–Ω–æ–º –ø—Ä–∏ —Å—Ä–∞–≤–Ω–µ–Ω–∏–∏ –∑–Ω–∞—á–µ–Ω–∏–π —Å–ª–µ–¥—É–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `std::cmp::Ordering`.

<details>
<summary>–†–µ—à–µ–Ω–∏–µ:</summary>

```rust
impl<T: Ord> BinaryTree<T> {
    fn new() -> Self {
        Self { root: Subtree::new() }
    }

    fn insert(&mut self, value: T) {
        self.root.insert(value);
    }

    fn has(&self, value: &T) -> bool {
        self.root.has(value)
    }

    fn len(&self) -> usize {
        self.root.len()
    }
}

impl<T: Ord> Subtree<T> {
    fn new() -> Self {
        Self(None)
    }

    fn insert(&mut self, value: T) {
        match &mut self.0 {
            None => self.0 = Some(Box::new(Node::new(value))),
            Some(n) => match value.cmp(&n.value) {
                Ordering::Less => n.left.insert(value),
                Ordering::Equal => {}
                Ordering::Greater => n.right.insert(value),
            },
        }
    }

    fn has(&self, value: &T) -> bool {
        match &self.0 {
            None => false,
            Some(n) => match value.cmp(&n.value) {
                Ordering::Less => n.left.has(value),
                Ordering::Equal => true,
                Ordering::Greater => n.right.has(value),
            },
        }
    }

    fn len(&self) -> usize {
        match &self.0 {
            None => 0,
            Some(n) => 1 + n.left.len() + n.right.len(),
        }
    }
}

impl<T: Ord> Node<T> {
    fn new(value: T) -> Self {
        Self { value, left: Subtree::new(), right: Subtree::new() }
    }
}
```

</details>

## –ó–∞–∏–º—Å—Ç–≤–æ–≤–∞–Ω–∏–µ

__–ó–∞–∏–º—Å—Ç–≤–æ–≤–∞–Ω–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è__

–ö–∞–∫ –º—ã –∑–Ω–∞–µ–º, –≤–º–µ—Å—Ç–æ –ø–µ—Ä–µ–¥–∞—á–∏ –≤–ª–∞–¥–µ–Ω–∏—è (ownership) –∑–Ω–∞—á–µ–Ω–∏–µ–º –ø—Ä–∏ –≤—ã–∑–æ–≤–µ —Ñ—É–Ω–∫—Ü–∏–∏, –º–æ–∂–Ω–æ –ø–æ–∑–≤–æ–ª–∏—Ç—å —Ñ—É–Ω–∫—Ü–∏–∏ –∑–∞–∏–º—Å—Ç–≤–æ–≤–∞—Ç—å (borrow) —ç—Ç–æ –∑–Ω–∞—á–µ–Ω–∏–µ:

```rust
#[derive(Debug)]
struct Point(i32, i32);

fn add(p1: &Point, p2: &Point) -> Point {
    Point(p1.0 + p2.0, p1.1 + p2.1)
}

fn main() {
    let p1 = Point(3, 4);
    let p2 = Point(10, 20);
    let p3 = add(&p1, &p2);
    println!("{p1:?} + {p2:?} = {p3:?}");
}
```

- –§—É–Ω–∫—Ü–∏—è `add` –∑–∞–∏–º—Å—Ç–≤—É–µ—Ç 2 —Ç–æ—á–∫–∏ (point) –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –Ω–æ–≤—É—é —Ç–æ—á–∫—É
- –≤—ã–∑—ã–≤–∞—é—â–∏–π (caller, `main`) —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –≤–ª–∞–¥–µ–Ω–∏–µ —Ç–æ—á–∫–∞–º–∏

–†–µ–º–∞—Ä–∫–∏:

- –≤–æ–∑–≤—Ä–∞—Ç –∑–Ω–∞—á–µ–Ω–∏—è –∏–∑ —Ñ—É–Ω–∫—Ü–∏–∏ `add` –æ–±—Ö–æ–¥–∏—Ç—Å—è –¥–µ—à–µ–≤–æ, –ø–æ—Å–∫–æ–ª—å–∫—É –∫–æ–º–ø–∏–ª—è—Ç–æ—Ä –º–æ–∂–µ—Ç –∏—Å–∫–ª—é—á–∏—Ç—å –æ–ø–µ—Ä–∞—Ü–∏—é –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è
- –∫–æ–º–ø–∏–ª—è—Ç–æ—Ä `Rust` —É–º–µ–µ—Ç –≤—ã–ø–æ–ª–Ω—è—Ç—å –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—é –≤–æ–∑–≤—Ä–∞—â–∞–µ–º–æ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è (return value optimization - RVO)
- –≤ `C++` –∏—Å–∫–ª—é—á–µ–Ω–∏–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–æ –≤ —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–∏ —è–∑—ã–∫–∞, –ø–æ—Å–∫–æ–ª—å–∫—É –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä—ã –º–æ–≥—É—Ç –∏–º–µ—Ç—å –ø–æ–±–æ—á–Ω—ã–µ —ç—Ñ—Ñ–µ–∫—Ç—ã. –í `Rust` —ç—Ç–æ –Ω–µ –ø—Ä–æ–±–ª–µ–º–∞. –ï—Å–ª–∏ `RVO` –Ω–µ –ø—Ä–æ–∏–∑–æ—à–ª–æ, `Rust` –≤—ã–ø–æ–ª–Ω—è–µ—Ç –ø—Ä–æ—Å—Ç–æ–µ –∏ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ `memcpy`

__–ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–∏–º—Å—Ç–≤–æ–≤–∞–Ω–∏–π__

–ö–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä –∑–∞–∏–º—Å—Ç–≤–æ–≤–∞–Ω–∏–π (borrow checker) –æ–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ—Ç —Å–ø–æ—Å–æ–±—ã –∑–∞–∏–º—Å—Ç–≤–æ–≤–∞–Ω–∏—è –∑–Ω–∞—á–µ–Ω–∏–π. –î–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è –≤ –ª—é–±–æ–µ –≤—Ä–µ–º—è:

- –º—ã –º–æ–∂–µ–º –∏–º–µ—Ç—å –æ–¥–Ω—É –∏–ª–∏ –±–æ–ª–µ–µ –æ–±—â–∏–µ/—Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–µ (shared) —Å—Å—ã–ª–∫–∏ –Ω–∞ –∑–Ω–∞—á–µ–Ω–∏–µ –∏–ª–∏
- –º—ã –º–æ–∂–µ–º –∏–º–µ—Ç—å —Ç–æ–ª—å–∫–æ –æ–¥–Ω—É —ç–∫—Å–∫–ª—é–∑–∏–≤–Ω—É—é/–∏—Å–∫–ª—é—á–∏—Ç–µ–ª—å–Ω—É—é (exclusive) —Å—Å—ã–ª–∫—É –Ω–∞ –∑–Ω–∞—á–µ–Ω–∏–µ

```rust
fn main() {
    let mut a: i32 = 10;
    let b: &i32 = &a;

    {
        let c: &mut i32 = &mut a;
        *c = 20;
    }

    println!("a: {a}");
    println!("b: {b}");
}
```

–†–µ–º–∞—Ä–∫–∏:

- –æ–±—Ä–∞—Ç–∏—Ç–µ –≤–Ω–∏–º–∞–Ω–∏–µ: —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–µ —Å–æ—Å—Ç–æ–∏—Ç –≤ —Ç–æ–º, —á—Ç–æ–±—ã –∫–æ–Ω—Ñ–ª–∏–∫—Ç—É—é—â–∏–µ —Å—Å—ã–ª–∫–∏ –Ω–µ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–ª–∏ –≤ –æ–¥–Ω–æ –≤—Ä–µ–º—è. –ù–µ –∏–º–µ–µ—Ç –∑–Ω–∞—á–µ–Ω–∏—è, –≥–¥–µ —Å—Å—ã–ª–∫–∞ —Ä–∞–∑—ã–º–µ–Ω–æ–≤—ã–≤–∞–µ—Ç—Å—è
- –∫–æ–¥ –ø—Ä–∏–º–µ—Ä–∞ –Ω–µ –∫–æ–º–ø–∏–ª–∏—Ä—É–µ—Ç—Å—è, –ø–æ—Å–∫–æ–ª—å–∫—É `a` –∑–∞–∏–º—Å—Ç–≤—É–µ—Ç—Å—è –∫–∞–∫ –º—É—Ç–∞–±–µ–ª—å–Ω–∞—è (—á–µ—Ä–µ–∑ `c`) –∏ –∫–∞–∫ –∏–º–º—É—Ç–∞–±–µ–ª—å–Ω–∞—è (—á–µ—Ä–µ–∑ `b`) –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ
- –ø–µ—Ä–µ–º–µ—Å—Ç–∏—Ç–µ `println!("b: {b}");` –ø–µ—Ä–µ–¥ –æ–±–ª–∞—Å—Ç—å—é –≤–∏–¥–∏–º–æ—Å—Ç–∏ `c`, —á—Ç–æ–±—ã —Å–∫–æ–º–ø–∏–ª–∏—Ä–æ–≤–∞—Ç—å –∫–æ–¥
- –ø–æ—Å–ª–µ —ç—Ç–æ–≥–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∫–æ–º–ø–∏–ª—è—Ç–æ—Ä –ø–æ–Ω–∏–º–∞–µ—Ç, —á—Ç–æ `b` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –¥–æ –Ω–æ–≤–æ–≥–æ –º—É—Ç–∞–±–µ–ª—å–Ω–æ–≥–æ –∑–∞–∏–º—Å—Ç–≤–æ–≤–∞–Ω–∏—è `a`. –≠—Ç–æ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç—å –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞ –∑–∞–∏–º—Å—Ç–≤–æ–≤–∞–Ω–∏–π, –∫–æ—Ç–æ—Ä–∞—è –Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è "–Ω–µ–ª–µ–∫—Å–∏—á–µ—Å–∫–∏–º –≤—Ä–µ–º–µ–Ω–µ–º –∂–∏–∑–Ω–∏" (non-lexical lifetimes)
- –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ —ç–∫—Å–∫–ª—é–∑–∏–≤–Ω–æ–π —Å—Å—ã–ª–∫–∏ —è–≤–ª—è–µ—Ç—Å—è –¥–æ–≤–æ–ª—å–Ω–æ —Å—Ç—Ä–æ–≥–∏–º. `Rust` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –µ–≥–æ, —á—Ç–æ–±—ã –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –≥–æ–Ω–æ–∫ –∑–∞ –¥–∞–Ω–Ω—ã–º–∏ (data races). `Rust` —Ç–∞–∫–∂–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —ç—Ç–æ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –∫–æ–¥–∞. –ù–∞–ø—Ä–∏–º–µ—Ä, –∑–Ω–∞—á–µ–Ω–∏–µ –æ–±—â–µ–π —Å—Å—ã–ª–∫–∏ –º–æ–∂–Ω–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ –∫—ç—à–∏—Ä–æ–≤–∞—Ç—å –≤ —Ä–µ–≥–∏—Å—Ç—Ä–µ –Ω–∞ –≤—Ä–µ–º—è –µ–µ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è
- –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä –∑–∞–∏–º—Å—Ç–≤–æ–≤–∞–Ω–∏–π –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –º–Ω–æ–≥–∏—Ö —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω–µ–Ω–Ω—ã—Ö —à–∞–±–ª–æ–Ω–æ–≤, —Ç–∞–∫–∏—Ö –∫–∞–∫ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–µ –ø–æ–ª—É—á–µ–Ω–∏–µ —ç–∫—Å–∫–ª—é–∑–∏–≤–Ω—ã—Ö —Å—Å—ã–ª–æ–∫ –Ω–∞ —Ä–∞–∑–Ω—ã–µ –ø–æ–ª—è –≤ —Å—Ç—Ä—É–∫—Ç—É—Ä–µ. –ù–æ –≤ –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö —Å–∏—Ç—É–∞—Ü–∏—è—Ö –æ–Ω –Ω–µ –ø–æ–Ω–∏–º–∞–µ—Ç, —á—Ç–æ –º—ã —Ö–æ—Ç–∏–º —Å–¥–µ–ª–∞—Ç—å, –∏ —Å –Ω–∏–º –ø—Ä–∏—Ö–æ–¥–∏—Ç—Å—è –±–æ—Ä–æ—Ç—å—Å—è

__–í–Ω—É—Ç—Ä–µ–Ω–Ω—è—è –∏–∑–º–µ–Ω—á–∏–≤–æ—Å—Ç—å__

`Rust` –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ –±–µ–∑–æ–ø–∞—Å–Ω—ã—Ö —Å–ø–æ—Å–æ–±–æ–≤ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∑–Ω–∞—á–µ–Ω–∏—è, –∏—Å–ø–æ–ª—å–∑—É—è —Ç–æ–ª—å–∫–æ –æ–±—â—É—é —Å—Å—ã–ª–∫—É –Ω–∞ —ç—Ç–æ –∑–Ω–∞—á–µ–Ω–∏–µ. –í—Å–µ –æ–Ω–∏ –∑–∞–º–µ–Ω—è—é—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ –≤–æ –≤—Ä–µ–º—è –∫–æ–º–ø–∏–ª—è—Ü–∏–∏ –ø—Ä–æ–≤–µ—Ä–∫–∞–º–∏ –≤–æ –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è.

_Cell –∏ RefCell_

[Cell](https://doc.rust-lang.org/std/cell/struct.Cell.html) –∏ [RefCell](https://doc.rust-lang.org/std/cell/struct.RefCell.html) —Ä–µ–∞–ª–∏–∑—É—é—Ç —Ç–æ, —á—Ç–æ –≤ `Rust` –Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–π –∏–∑–º–µ–Ω—á–∏–≤–æ—Å—Ç—å—é (interior mutability): –º—É—Ç–∞—Ü–∏–µ–π –∑–Ω–∞—á–µ–Ω–∏–π –≤ –Ω–µ–∏–∑–º–µ–Ω—è–µ–º–æ–º –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ.

`Cell` –æ–±—ã—á–Ω–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –ø—Ä–æ—Å—Ç—ã—Ö —Ç–∏–ø–æ–≤, –ø–æ—Å–∫–æ–ª—å–∫—É —Ç—Ä–µ–±—É–µ—Ç –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è –∏–ª–∏ –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏—è –∑–Ω–∞—á–µ–Ω–∏–π. –ë–æ–ª–µ–µ —Å–ª–æ–∂–Ω—ã–µ —Ç–∏–ø—ã –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–≥–æ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–∞ –æ–±—ã—á–Ω–æ –∏—Å–ø–æ–ª—å–∑—É—é—Ç `RefCell`, –∫–æ—Ç–æ—Ä—ã–π –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç –æ–±—â–∏–µ –∏ —ç–∫—Å–∫–ª—é–∑–∏–≤–Ω—ã–µ —Å—Å—ã–ª–∫–∏ –≤–æ –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∏ –ø–∞–Ω–∏–∫—É–µ—Ç, –µ—Å–ª–∏ –æ–Ω–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ.

```rust
use std::cell::RefCell;
use std::rc::Rc;

#[derive(Debug, Default)]
struct Node {
    value: i64,
    children: Vec<Rc<RefCell<Node>>>,
}

impl Node {
    fn new(value: i64) -> Rc<RefCell<Node>> {
        Rc::new(RefCell::new(Node { value, ..Node::default() }))
    }

    fn sum(&self) -> i64 {
        self.value + self.children.iter().map(|c| c.borrow().sum()).sum::<i64>()
    }
}

fn main() {
    let root = Node::new(1);
    root.borrow_mut().children.push(Node::new(5));
    let subtree = Node::new(10);
    subtree.borrow_mut().children.push(Node::new(11));
    subtree.borrow_mut().children.push(Node::new(12));
    root.borrow_mut().children.push(subtree);

    println!("graph: {root:#?}");
    println!("graph sum: {}", root.borrow().sum());
}
```

–†–µ–º–∞—Ä–∫–∏:

- –µ—Å–ª–∏ –±—ã –≤ —ç—Ç–æ–º –ø—Ä–∏–º–µ—Ä–µ –º—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∏ `Cell` –≤–º–µ—Å—Ç–æ `RefCell`, –Ω–∞–º –ø—Ä–∏—à–ª–æ—Å—å –±—ã –ø–µ—Ä–µ–º–µ—Å—Ç–∏—Ç—å `Node` –∏–∑ `Rc`, —á—Ç–æ–±—ã –¥–æ–±–∞–≤–∏—Ç—å –¥–æ—á–µ—Ä–Ω–∏–µ —ç–ª–µ–º–µ–Ω—Ç—ã, –∞ –∑–∞—Ç–µ–º –≤–µ—Ä–Ω—É—Ç—å –µ–≥–æ –æ–±—Ä–∞—Ç–Ω–æ. –≠—Ç–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ, –ø–æ—Å–∫–æ–ª—å–∫—É –≤ —è—á–µ–π–∫–µ –≤—Å–µ–≥–¥–∞ –µ—Å—Ç—å –æ–¥–Ω–æ –∑–Ω–∞—á–µ–Ω–∏–µ, –Ω–∞ –∫–æ—Ç–æ—Ä–æ–µ –Ω–µ—Ç —Å—Å—ã–ª–∫–∏, –Ω–æ —ç—Ç–æ –Ω–µ —ç—Ä–≥–æ–Ω–æ–º–∏—á–Ω–æ
- –¥–ª—è —Ç–æ–≥–æ, —á—Ç–æ–±—ã —Å–¥–µ–ª–∞—Ç—å —á—Ç–æ-—Ç–æ —Å `Node`, –Ω—É–∂–Ω–æ –≤—ã–∑–≤–∞—Ç—å –∫–∞–∫–æ–π-–Ω–∏–±—É–¥—å –º–µ—Ç–æ–¥ `RefCell`, –æ–±—ã—á–Ω–æ `borrow` –∏–ª–∏ `borrow_mut`
- —Å—Å—ã–ª–æ—á–Ω—ã–µ —Ü–∏–∫–ª—ã –º–æ–≥—É—Ç –±—ã—Ç—å —Å–æ–∑–¥–∞–Ω—ã –ø—É—Ç–µ–º –¥–æ–±–∞–≤–ª–µ–Ω–∏—è `root` –≤ `subtree.children` (–Ω–µ –ø—ã—Ç–∞–π—Ç–µ—Å—å –≤—ã–≤–µ—Å—Ç–∏ –∏—Ö –≤ —Ç–µ—Ä–º–∏–Ω–∞–ª)
- –¥–ª—è —Ç–æ–≥–æ, —á—Ç–æ–±—ã –≤—ã–∑–≤–∞—Ç—å –ø–∞–Ω–∏–∫—É –≤–æ –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è, –¥–æ–±–∞–≤—å—Ç–µ `fn inc(&mut self)`, –∫–æ—Ç–æ—Ä—ã–π —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç `self.value` –∏ –≤—ã–∑—ã–≤–∞–µ—Ç —Ç–æ—Ç –∂–µ –º–µ—Ç–æ–¥ –¥–ª—è —Å–≤–æ–∏—Ö –¥–æ—á–µ—Ä–Ω–∏—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤. –≠—Ç–æ –≤—ã–∑–æ–≤–µ—Ç –ø–∞–Ω–∏–∫—É –∏–∑-–∑–∞ –Ω–∞–ª–∏—á–∏—è —Å—Å—ã–ª–æ—á–Ω–æ–≥–æ —Ü–∏–∫–ª–∞: `thread 'main' panicked at 'already borrowed: BorrowMutError'`

__–£–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ: –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏ –∑–¥–æ—Ä–æ–≤—å—è__

–í—ã —Ä–∞–±–æ—Ç–∞–µ—Ç–µ –Ω–∞–¥ –≤–Ω–µ–¥—Ä–µ–Ω–∏–µ–º —Å–∏—Å—Ç–µ–º—ã –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –∑–¥–æ—Ä–æ–≤—å—è. –í —Ä–∞–º–∫–∞—Ö —ç—Ç–æ–≥–æ –≤–∞–º –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏ –∑–¥–æ—Ä–æ–≤—å—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π.

–í–∞—à–∞ –∑–∞–¥–∞—á–∞ - —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –º–µ—Ç–æ–¥ `visit_doctor` –≤ —Å—Ç—Ä—É–∫—Ç—É—Ä–µ `User`.

```rust
#![allow(dead_code)]
pub struct User {
    name: String,
    age: u32,
    height: f32,
    visit_count: usize,
    // –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–µ –ø–æ–ª–µ
    last_blood_pressure: Option<(u32, u32)>,
}

pub struct Measurements {
    height: f32,
    blood_pressure: (u32, u32),
}

// 'a - —ç—Ç–æ –≤—Ä–µ–º—è –∂–∏–∑–Ω–∏, –º—ã –ø–æ–≥–æ–≤–æ—Ä–∏–º –æ–± —ç—Ç–æ–º –≤ —Å–ª–µ–¥—É—é—â–µ–º —Ä–∞–∑–¥–µ–ª–µ
pub struct HealthReport<'a> {
    patient_name: &'a str,
    visit_count: u32,
    height_change: f32,
    // –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–µ –ø–æ–ª–µ
    blood_pressure_change: Option<(i32, i32)>,
}

impl User {
    pub fn new(name: String, age: u32, height: f32) -> Self {
        Self {
            name,
            age,
            height,
            visit_count: 0,
            last_blood_pressure: None,
        }
    }

    pub fn visit_doctor(&mut self, measurements: Measurements) -> HealthReport {
        todo!("–û–±–Ω–æ–≤–ª—è–µ–º –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏ –∑–¥–æ—Ä–æ–≤—å—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–∞ –æ—Å–Ω–æ–≤–µ –∏–∑–º–µ—Ä–µ–Ω–∏–π –≤ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–µ –ø–æ—Å–µ—â–µ–Ω–∏—è –≤—Ä–∞—á–∞")
    }
}

fn main() {
    let bob = User::new(String::from("Bob"), 32, 155.2);
    println!("I'm {} and my age is {}", bob.name, bob.age);
}

#[cfg(test)]
mod tests {
    use super::*;

    #[test]
    fn test_visit() {
        let mut bob = User::new(String::from("Bob"), 32, 155.2);
        assert_eq!(bob.visit_count, 0);
        let report = bob.visit_doctor(Measurements {
            height: 156.1,
            blood_pressure: (120, 80),
        });
        assert_eq!(report.patient_name, "Bob");
        assert_eq!(report.visit_count, 1);
        assert_eq!(report.blood_pressure_change, None);

        let report = bob.visit_doctor(Measurements {
            height: 156.1,
            blood_pressure: (115, 76),
        });

        assert_eq!(report.visit_count, 2);
        assert_eq!(report.blood_pressure_change, Some((-5, -4)));
    }
}
```

<details>
<summary>–†–µ—à–µ–Ω–∏–µ:</summary>

```rust
impl User {
    // ...

    pub fn visit_doctor(&mut self, measurements: Measurements) -> HealthReport {
        // –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ—Å–µ—â–µ–Ω–∏–π –≤—Ä–∞—á–∞
        self.visit_count += 1;
        // –ü–æ–∫–∞–∑–∞—Ç–µ–ª–∏ –∫—Ä–æ–≤—è–Ω–æ–≥–æ –¥–∞–≤–ª–µ–Ω–∏—è –∏–∑ –∏–∑–º–µ—Ä–µ–Ω–∏–π
        let bp = measurements.blood_pressure;
        // –û—Ç—á–µ—Ç
        let report = HealthReport {
            patient_name: &self.name,
            visit_count: self.visit_count as u32,
            // –ò–∑–º–µ–Ω–µ–Ω–∏–µ —Ä–æ—Å—Ç–∞
            height_change: measurements.height - self.height,
            // –ò–∑–º–µ–Ω–µ–Ω–∏–µ –¥–∞–≤–ª–µ–Ω–∏—è.
            // –ü–æ—Å–ª–µ–¥–Ω–µ–µ –∏–∑–º–µ—Ä–µ–Ω–∏–µ –¥–∞–≤–ª–µ–Ω–∏—è –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—É—Å—Ç—ã–º,
            // –ø–æ—ç—Ç–æ–º—É –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è —Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ —Å —à–∞–±–ª–æ–Ω–æ–º
            blood_pressure_change: match self.last_blood_pressure {
                Some(lbp) => {
                    Some((bp.0 as i32 - lbp.0 as i32, bp.1 as i32 - lbp.1 as i32))
                }
                None => None,
            },
        };
        self.height = measurements.height;
        self.last_blood_pressure = Some(bp);
        report
    }
}
```

</details>

## –°—Ä–µ–∑—ã –∏ –≤—Ä–µ–º–µ–Ω–∞ –∂–∏–∑–Ω–∏

__–°—Ä–µ–∑—ã__

–°—Ä–µ–∑ (slice) - —ç—Ç–æ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ (view) (—á–∞—Å—Ç—å) –±–æ–ª—å—à–æ–π –∫–æ–ª–ª–µ–∫—Ü–∏–∏ –∑–Ω–∞—á–µ–Ω–∏–π:

```rust
fn main() {
    let mut a: [i32; 6] = [10, 20, 30, 40, 50, 60];
    println!("a: {a:?}");

    let s: &[i32] = &a[2..4];

    println!("s: {s:?}");
}
```

- –°—Ä–µ–∑—ã –∑–∞–∏–º—Å—Ç–≤—É—é—Ç –¥–∞–Ω–Ω—ã–µ –∏–∑ –∏—Å—Ö–æ–¥–Ω–æ–≥–æ —Ç–∏–ø–∞
- –í–æ–ø—Ä–æ—Å: —á—Ç–æ –ø—Ä–æ–∏–∑–æ–π–¥–µ—Ç, –µ—Å–ª–∏ –º–æ–¥–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å `a[3]` –ø–µ—Ä–µ–¥ –≤—ã–≤–æ–¥–æ–º `s` –≤ —Ç–µ—Ä–º–∏–Ω–∞–ª?

–†–µ–º–∞—Ä–∫–∏:

- –º—ã —Å–æ–∑–¥–∞–µ–º —Å—Ä–µ–∑ –ø—É—Ç–µ–º –∑–∞–∏–º—Å—Ç–≤–æ–≤–∞–Ω–∏—è `a` –∏ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –Ω–∞—á–∞–ª—å–Ω–æ–≥–æ –∏ –∫–æ–Ω–µ—á–Ω–æ–≥–æ –∏–Ω–¥–µ–∫—Å–æ–≤ –≤ –∫–≤–∞–¥—Ä–∞—Ç–Ω—ã—Ö —Å–∫–æ–±–∫–∞—Ö
- –µ—Å–ª–∏ —Å—Ä–µ–∑ –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å –∏–Ω–¥–µ–∫—Å–∞ `0`, —Å–∏–Ω—Ç–∞–∫—Å–∏—Å –¥–∏–∞–ø–∞–∑–æ–Ω–∞ `Rust` –ø–æ–∑–≤–æ–ª—è–µ—Ç –Ω–µ —É–∫–∞–∑—ã–≤–∞—Ç—å –Ω–∞—á–∞–ª—å–Ω—ã–π –∏–Ω–¥–µ–∫—Å: `&a[0..a.len()]` == `&a[..a.len()]`
- —Ç–æ–∂–µ —Å–ø—Ä–∞–≤–µ–¥–ª–∏–≤–æ –¥–ª—è –∫–æ–Ω–µ—á–Ω–æ–≥–æ –∏–Ω–¥–µ–∫—Å–∞: `&a[2..a.len()]` == `&a[2..]`
- —Å—Ä–µ–∑ –≤—Å–µ–≥–æ –º–∞—Å—Å–∏–≤–∞ –º–æ–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å —Å –ø–æ–º–æ—â—å—é `&a[..]`
- `s` - —ç—Ç–æ —Å—Å—ã–ª–∫–∞ –Ω–∞ —Å—Ä–µ–∑ —Ü–µ–ª—ã—Ö —á–∏—Å–µ–ª —Å–æ –∑–Ω–∞–∫–æ–º. –û–±—Ä–∞—Ç–∏—Ç–µ –≤–Ω–∏–º–∞–Ω–∏–µ, —á—Ç–æ –≤ —Ç–∏–ø–µ `s` (`&[i32]`) –Ω–µ —É–ø–æ–º–∏–Ω–∞–µ—Ç—Å—è –¥–ª–∏–Ω–∞ –º–∞—Å—Å–∏–≤–∞. –≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –≤—ã—á–∏—Å–ª—è—Ç—å —Å—Ä–µ–∑—ã —Ä–∞–∑–Ω—ã—Ö —Ä–∞–∑–º–µ—Ä–æ–≤
- —Å—Ä–µ–∑—ã –≤—Å–µ–≥–¥–∞ –∑–∞–∏–º—Å—Ç–≤—É—é—Ç –∑–Ω–∞—á–µ–Ω–∏—è –æ–±—ä–µ–∫—Ç–æ–≤. –í –ø—Ä–∏–º–µ—Ä–µ `a` –æ—Å—Ç–∞–µ—Ç—Å—è "–∂–∏–≤–æ–π" (–≤ –æ–±–ª–∞—Å—Ç–∏ –≤–∏–¥–∏–º–æ—Å—Ç–∏) –¥–æ —Ç–µ—Ö –ø–æ—Ä, –ø–æ–∫–∞ "–∂–∏–≤" –µ–≥–æ —Å—Ä–µ–∑
- –≤–æ–ø—Ä–æ—Å –æ–± –∏–∑–º–µ–Ω–µ–Ω–∏–∏ `a[3]` –º–æ–∂–µ—Ç –≤—ã–∑–≤–∞—Ç—å –∏–Ω—Ç–µ—Ä–µ—Å–Ω—É—é –¥–∏—Å–∫—É—Å—Å–∏—é, –Ω–æ –æ—Ç–≤–µ—Ç –∑–∞–∫–ª—é—á–∞–µ—Ç—Å—è –≤ —Ç–æ–º, —á—Ç–æ –∏–∑ —Å–æ–æ–±—Ä–∞–∂–µ–Ω–∏–π –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –ø–∞–º—è—Ç–∏ –º—ã –Ω–µ –º–æ–∂–µ–º —Å–¥–µ–ª–∞—Ç—å —ç—Ç–æ —á–µ—Ä–µ–∑ `a` –Ω–∞ –¥–∞–Ω–Ω–æ–º —ç—Ç–∞–ø–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∫–æ–¥–∞, –Ω–æ –º—ã –º–æ–∂–µ–º –±–µ–∑–æ–ø–∞—Å–Ω–æ —á–∏—Ç–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –∫–∞–∫ –∏–∑ `a`, —Ç–∞–∫ –∏ –∏–∑ `s`. –≠—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç –¥–æ —Å–æ–∑–¥–∞–Ω–∏—è —Å—Ä–µ–∑–∞ –∏ –ø–æ—Å–ª–µ –≤—ã–∑–æ–≤–∞ `println!`, –∫–æ–≥–¥–∞ —Å—Ä–µ–∑ –±–æ–ª—å—à–µ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è

__–°—Ç—Ä–æ–∫–∏__

–¢–µ–ø–µ—Ä—å –º—ã –º–æ–∂–µ–º —Ä–∞–∑–æ–±—Ä–∞—Ç—å—Å—è —Å —Ç–∏–ø–æ–º `&str`: —ç—Ç–æ –ø–æ—á—Ç–∏ `&[char]`, –Ω–æ —Å –¥–∞–Ω–Ω—ã–º–∏, —Ö—Ä–∞–Ω—è—â–∏–º–∏—Å—è –≤ –∫–æ–¥–∏—Ä–æ–≤–∫–µ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π –¥–ª–∏–Ω—ã (UTF-8).

```rust
fn main() {
    let s1: &str = "World";
    println!("s1: {s1}");

    let mut s2: String = String::from("Hello ");
    println!("s2: {s2}");
    s2.push_str(s1);
    println!("s2: {s2}");

    let s3: &str = &s2[6..];
    println!("s3: {s3}");
}
```

- `&str` - –∏–º–º—É—Ç–∞–±–µ–ª—å–Ω–∞—è —Å—Å—ã–ª–∫–∞ –Ω–∞ —Å—Ç—Ä–æ–∫–æ–≤—ã–π —Å—Ä–µ–∑
- `String` - –º—É—Ç–∞–±–µ–ª—å–Ω–∞—è —Å—Å—ã–ª–∫–∞ –Ω–∞ –±—É—Ñ–µ—Ä

–†–µ–º–∞—Ä–∫–∏:

- `&str` - —ç—Ç–æ —Å—Ä–µ–∑ —Å—Ç—Ä–æ–∫–∏, –∏–º–º—É—Ç–∞–±–µ–ª—å–Ω–∞—è —Å—Å—ã–ª–∫–∞ –Ω–∞ –∑–∞–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –≤ UTF-8 —Ç–µ–∫—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ, —Ö—Ä–∞–Ω—è—â–∏–µ—Å—è –≤ –±–ª–æ–∫–µ –ø–∞–º—è—Ç–∏. –°—Ç—Ä–æ–∫–æ–≤—ã–µ –ª–∏—Ç–µ—Ä–∞–ª—ã (`"Hello"`) —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ –±–∏–Ω–∞—Ä–Ω–∏–∫–µ (–∏—Å–ø–æ–ª–Ω—è–µ–º–æ–º —Ñ–∞–π–ª–µ) –ø—Ä–æ–≥—Ä–∞–º–º—ã
- —Ç–∏–ø `String` - —ç—Ç–æ –æ–±–µ—Ä—Ç–∫–∞ –Ω–∞–¥ –≤–µ–∫—Ç–æ—Ä–æ–º –±–∞–π—Ç–æ–≤. –ö–∞–∫ –∏ `Vec<T>`, –æ–Ω —è–≤–ª—è–µ—Ç—Å—è —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–º (owned)
- `String::from()` —Å–æ–∑–¥–∞–µ—Ç —Å—Ç—Ä–æ–∫—É –∏–∑ –ª–∏—Ç–µ—Ä–∞–ª–∞ —Å—Ç—Ä–æ–∫–∏; `String::new()` —Å–æ–∑–¥–∞–µ—Ç –Ω–æ–≤—É—é –ø—É—Å—Ç—É—é —Å—Ç—Ä–æ–∫—É, –≤ –∫–æ—Ç–æ—Ä—É—é –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–ª—è—Ç—å —Å—Ç—Ä–æ–∫–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ —Å –ø–æ–º–æ—â—å—é –º–µ—Ç–æ–¥–æ–≤ `push` –∏ `push_str`
- –º–∞–∫—Ä–æ—Å `format!` –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—É—é —Å—Ç—Ä–æ–∫—É –∏–∑ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏—Ö –∑–Ω–∞—á–µ–Ω–∏–π. –°—Ç–∏–ª—å –µ–≥–æ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Å—Ö–æ–∂ —Å `println!`
- –º—ã –º–æ–∂–µ–º –∑–∞–∏–º—Å—Ç–≤–æ–≤–∞—Ç—å —Å—Ä–µ–∑—ã `&str` –∏–∑ `String` —á–µ—Ä–µ–∑ `&` –∏ –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π –¥–∏–∞–ø–∞–∑–æ–Ω –≤—ã–±–æ—Ä–∞ (range selection). –ï—Å–ª–∏ –≤—ã–±—Ä–∞–Ω –¥–∏–∞–ø–∞–∑–æ–Ω –±–∞–π—Ç–æ–≤, –∫–æ—Ç–æ—Ä—ã–π –Ω–µ —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å –≥—Ä–∞–Ω–∏—Ü–∞–º–∏ —Å–∏–º–≤–æ–ª–æ–≤ (character boundaries), –≤—ã—Ä–∞–∂–µ–Ω–∏–µ –∑–∞–ø–∞–Ω–∏–∫—É–µ—Ç. –ò—Ç–µ—Ä–∞—Ç–æ—Ä `chars` –ø–µ—Ä–µ–±–∏—Ä–∞–µ—Ç —Å–∏–º–≤–æ–ª—ã –∏ —è–≤–ª—è–µ—Ç—Å—è –ø—Ä–µ–¥–ø–æ—á—Ç–∏—Ç–µ–ª—å–Ω—ã–º —Å–ø–æ—Å–æ–±–æ–º –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ –∏–∑–≤–ª–µ—á–µ–Ω–∏—è —Å–∏–º–≤–æ–ª–æ–≤
- –±–∞–π—Ç–æ–≤—ã–µ —Å—Ç—Ä–æ–∫–∏ –ø–æ–∑–≤–æ–ª—è—é—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å `&[u8]` –Ω–∞–ø—Ä—è–º—É—é:

```rust
fn main() {
    let byte_string = b"abc";
    println!("{:?}", byte_string);
    assert_eq!(byte_string, &[97, 98, 99])
}
```

__–ê–Ω–Ω–æ—Ç–∞—Ü–∏–∏ –≤—Ä–µ–º–µ–Ω –∂–∏–∑–Ω–∏__

–°—Å—ã–ª–∫–∞ –∏–º–µ–µ—Ç –≤—Ä–µ–º—è –∂–∏–∑–Ω–∏ (lifetime), –æ–Ω–∞ –Ω–µ –¥–æ–ª–∂–Ω–∞ "–ø–µ—Ä–µ–∂–∏–≤–∞—Ç—å" –∑–Ω–∞—á–µ–Ω–∏–µ, –Ω–∞ –∫–æ—Ç–æ—Ä–æ–µ —Å—Å—ã–ª–∞–µ—Ç—Å—è. –°–æ–±–ª—é–¥–µ–Ω–∏–µ —ç—Ç–æ–≥–æ –ø—Ä–∞–≤–∏–ª–∞ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç—Å—è –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–æ–º –∑–∞–∏–º—Å—Ç–≤–æ–≤–∞–Ω–∏–π (borrow checker).

–í—Ä–µ–º—è –∂–∏–∑–Ω–∏ –º–æ–∂–µ—Ç –æ–ø—Ä–µ–¥–µ–ª—è—Ç—å—Å—è –Ω–µ—è–≤–Ω–æ - —Ç–æ, —á—Ç–æ –º—ã –≤–∏–¥–µ–ª–∏ –¥–æ —Å–∏—Ö –ø–æ—Ä. –í—Ä–µ–º–µ–Ω–∞ –∂–∏–∑–Ω–∏ —Ç–∞–∫–∂–µ –º–æ–≥—É—Ç –±—ã—Ç—å —è–≤–Ω—ã–º–∏: `&'a Point`, `&'static str`. –í—Ä–µ–º–µ–Ω–∞ –∂–∏–∑–Ω–∏ –Ω–∞—á–∏–Ω–∞—é—Ç—Å—è —Å `'` –∏ `'a` - –∏–º—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é. `&'a Point` —á–∏—Ç–∞–µ—Ç—Å—è –∫–∞–∫ "–∑–∞–∏–º—Å—Ç–≤–æ–≤–∞–Ω–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã `Point`, –∫–æ—Ç–æ—Ä–æ–µ —è–≤–ª—è–µ—Ç—Å—è –≤–∞–ª–∏–¥–Ω—ã–º –Ω–∞ –ø—Ä–æ—Ç—è–∂–µ–Ω–∏–∏ –≤—Ä–µ–º–µ–Ω–∏ –∂–∏–∑–Ω–∏ `a`".

–í—Ä–µ–º–µ–Ω–∞ –∂–∏–∑–Ω–∏ –≤—Å–µ–≥–¥–∞ –≤—ã–≤–æ–¥—è—Ç—Å—è (inferred) –∫–æ–º–ø–∏–ª—è—Ç–æ—Ä–æ–º, –æ–Ω–∏ –Ω–µ –º–æ–≥—É—Ç –ø—Ä–∏—Å–≤–∞–∏–≤–∞—Ç—å—Å—è —è–≤–Ω–æ. –Ø–≤–Ω—ã–µ –∞–Ω–Ω–æ—Ç–∞—Ü–∏–∏ (annotations) –≤—Ä–µ–º–µ–Ω –∂–∏–∑–Ω–∏ —Å–æ–∑–¥–∞—é—Ç –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –≤ —Å–ª—É—á–∞–µ –Ω–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ—Å—Ç–∏; –∫–æ–º–ø–∏–ª—è—Ç–æ—Ä –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –≤–∞–ª–∏–¥–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ –≤ —Ä–∞–º–∫–∞—Ö —ç—Ç–∏—Ö –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π.

–í—Ä–µ–º–µ–Ω–∞ –∂–∏–∑–Ω–∏ —Å—Ç–∞–Ω–æ–≤—è—Ç—Å—è —Å–ª–æ–∂–Ω—ã–º–∏, –∫–æ–≥–¥–∞ –∑–Ω–∞—á–µ–Ω–∏—è –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è –≤ –∏ –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç—Å—è –∏–∑ —Ñ—É–Ω–∫—Ü–∏–∏:

```rust
#[derive(Debug)]
struct Point(i32, i32);

fn left_most(p1: &Point, p2: &Point) -> &Point {
    if p1.0 < p2.0 {
        p1
    } else {
        p2
    }
}

fn main() {
    let p1: Point = Point(10, 10);
    let p2: Point = Point(20, 20);
    let p3 = left_most(&p1, &p2); // –∫–∞–∫–æ–≤–æ –≤—Ä–µ–º—è –∂–∏–∑–Ω–∏ `p3`?
    println!("p3: {p3:?}");
}
```

–í –ø—Ä–∏–º–µ—Ä–µ –∫–æ–º–ø–∏–ª—è—Ç–æ—Ä –Ω–µ –º–æ–∂–µ—Ç —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –≤—Ä–µ–º—è –∂–∏–∑–Ω–∏ `p3`. –ï–º—É —Ç—Ä–µ–±—É–µ—Ç—Å—è –Ω–∞—à–∞ –ø–æ–º–æ—â—å:

```rust
fn left_most<'a>(p1: &'a Point, p2: &'a Point) -> &'a Point { .. }
```

–í–æ–∑–≤—Ä–∞—â–∞–µ–º–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –¥–æ–ª–∂–Ω–æ –∂–∏—Ç—å –∫–∞–∫ –º–∏–Ω–∏–º—É–º —Ç–∞–∫–∂–µ –¥–æ–ª–≥–æ, –∫–∞–∫ –ø–µ—Ä–µ–¥–∞–≤–∞–µ–º—ã–µ –∞—Ä–≥—É–º–µ–Ω—Ç—ã.

–í –æ–±—ã—á–Ω—ã—Ö —Å–∏—Ç—É–∞—Ü–∏—è—Ö —è–≤–Ω—ã–µ –∞–Ω–Ω–æ—Ç–∞—Ü–∏–∏ –≤—Ä–µ–º–µ–Ω –∂–∏–∑–Ω–∏ –Ω–µ —Ç—Ä–µ–±—É—é—Ç—Å—è.

__–í—Ä–µ–º–µ–Ω–∞ –∂–∏–∑–Ω–∏ –≤ —Ñ—É–Ω–∫—Ü–∏—è—Ö__

–í—Ä–µ–º–µ–Ω–∞ –∂–∏–∑–Ω–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ —Ñ—É–Ω–∫—Ü–∏–∏ –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ–º–æ–≥–æ —Ñ—É–Ω–∫—Ü–∏–µ–π –∑–Ω–∞—á–µ–Ω–∏—è –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –ø–æ–ª–Ω–æ—Å—Ç—å—é –æ–ø—Ä–µ–¥–µ–ª–µ–Ω—ã, –Ω–æ –≤ —Ä—è–¥–µ —Å–ª—É—á–∞–µ–≤ `Rust` –ø–æ–∑–≤–æ–ª—è–µ—Ç –æ–ø—É—Å—Ç–∏—Ç—å (elide) –∞–Ω–Ω–æ—Ç–∞—Ü–∏–∏ –≤—Ä–µ–º–µ–Ω –∂–∏–∑–Ω–∏. –ù–∞ —ç—Ç–æ—Ç —Å—á–µ—Ç —Å—É—â–µ—Å—Ç–≤—É–µ—Ç [–Ω–µ—Å–∫–æ–ª—å–∫–æ –ø—Ä–æ—Å—Ç—ã—Ö –ø—Ä–∞–≤–∏–ª](https://doc.rust-lang.org/nomicon/lifetime-elision.html):

- –∫–∞–∂–¥–æ–º—É –∞—Ä–≥—É–º–µ–Ω—Ç—É –ø—Ä–∏—Å–≤–∞–∏–≤–∞–µ—Ç—Å—è –∞–Ω–Ω–æ—Ç–∞—Ü–∏—è –≤—Ä–µ–º–µ–Ω–∏ –∂–∏–∑–Ω–∏ –ø—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏
- –µ—Å–ª–∏ —Ñ—É–Ω–∫—Ü–∏—è –ø—Ä–∏–Ω–∏–º–∞–µ—Ç —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω –ø–∞—Ä–∞–º–µ—Ç—Ä, –µ–≥–æ –≤—Ä–µ–º—è –∂–∏–∑–Ω–∏ —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –≤—Ä–µ–º–µ–Ω–µ–º –∂–∏–∑–Ω–∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ–º–æ–≥–æ —Ñ—É–Ω–∫—Ü–∏–µ–π –∑–Ω–∞—á–µ–Ω–∏—è
- –µ—Å–ª–∏ —Ñ—É–Ω–∫—Ü–∏—è –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤, –Ω–æ –ø–µ—Ä–≤—ã–º –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–º —è–≤–ª—è–µ—Ç—Å—è `self`, –≤—Ä–µ–º—è –∂–∏–∑–Ω–∏ `self` —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –≤—Ä–µ–º–µ–Ω–µ–º –∂–∏–∑–Ω–∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ–º–æ–≥–æ —Ñ—É–Ω–∫—Ü–∏–µ–π –∑–Ω–∞—á–µ–Ω–∏—è

```rust
#[derive(Debug)]
struct Point(i32, i32);

fn cab_distance(p1: &Point, p2: &Point) -> i32 {
    (p1.0 - p2.0).abs() + (p1.1 - p2.1).abs()
}

fn nearest<'a>(points: &'a [Point], query: &Point) -> Option<&'a Point> {
    let mut nearest = None;
    for p in points {
        if let Some((_, nearest_dist)) = nearest {
            let dist = cab_distance(p, query);
            if dist < nearest_dist {
                nearest = Some((p, dist));
            }
        } else {
            nearest = Some((p, cab_distance(p, query)));
        };
    }
    nearest.map(|(p, _)| p)
}

fn main() {
    println!(
        "{:?}",
        nearest(
            &[Point(1, 0), Point(1, 0), Point(-1, 0), Point(0, -1),],
            &Point(0, 2)
        )
    );
}
```

–§—É–Ω–∫—Ü–∏—è `cab_distance` –Ω–µ —Ç—Ä–µ–±—É–µ—Ç —è–≤–Ω—ã—Ö –∞–Ω–Ω–æ—Ç–∞—Ü–∏–π –≤—Ä–µ–º–µ–Ω –∂–∏–∑–Ω–∏, –ø–æ—Å–∫–æ–ª—å–∫—É `p1` –∏ `p2` –∏–º–µ—é—Ç –æ–¥–∏–Ω–∞–∫–æ–≤—ã–π —Ç–∏–ø.

–ü–∞—Ä–∞–º–µ—Ç—Ä—ã —Ñ—É–Ω–∫—Ü–∏–∏ `nearest` –∏–º–µ—é—Ç —Ä–∞–∑–Ω—ã–µ —Ç–∏–ø—ã, –ø–æ—ç—Ç–æ–º—É —Ñ—É–Ω–∫—Ü–∏—è —Ç—Ä–µ–±—É–µ—Ç —è–≤–Ω—ã—Ö –∞–Ω–Ω–æ—Ç–∞—Ü–∏–π –≤—Ä–µ–º–µ–Ω –∂–∏–∑–Ω–∏. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–µ—Ä–µ–ø–∏—Å–∞—Ç—å –µ–µ —Å–∏–≥–Ω–∞—Ç—É—Ä—É —Å–ª–µ–¥—É—é—â–∏–º –æ–±—Ä–∞–∑–æ–º:

```rust
fn nearest<'a, 'q'>(points: &'a [Point], query: &'q Point) -> Option<&'q Point> { .. }
```

–¢–∞–∫–æ–π –∫–æ–¥ –Ω–µ –∫–æ–º–ø–∏–ª–∏—Ä—É–µ—Ç—Å—è. –≠—Ç–æ –¥–æ–∫–∞–∑—ã–≤–∞–µ—Ç, —á—Ç–æ –∞–Ω–Ω–æ—Ç–∞—Ü–∏–∏ –ø—Ä–æ–≤–µ—Ä—è—é—Ç—Å—è –∫–æ–º–ø–∏–ª—è—Ç–æ—Ä–æ–º –Ω–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å.

–í –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–µ —Å–ª—É—á–∞–µ–≤ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –≤—ã–≤–æ–¥ –∞–Ω–Ω–æ—Ç–∞—Ü–∏–π –∏ —Ç–∏–ø–æ–≤ –æ–∑–Ω–∞—á–∞—é—Ç, —á—Ç–æ –∏—Ö –Ω–µ –Ω—É–∂–Ω–æ —É–∫–∞–∑—ã–≤–∞—Ç—å —è–≤–Ω–æ. –í –±–æ–ª–µ–µ —Å–ª–æ–∂–Ω—ã—Ö —Å–∏—Ç—É–∞—Ü–∏—è—Ö –∞–Ω–Ω–æ—Ç–∞—Ü–∏–∏ –≤—Ä–µ–º–µ–Ω–∏ –∂–∏–∑–Ω–∏ –º–æ–≥—É—Ç –ø–æ–º–æ—á—å —É—Å—Ç—Ä–∞–Ω–∏—Ç—å –Ω–µ–æ–¥–Ω–æ–∑–Ω–∞—á–Ω–æ—Å—Ç—å. –ß–∞—Å—Ç–æ, –æ—Å–æ–±–µ–Ω–Ω–æ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –ø—Ä–æ—Ç–æ—Ç–∏–ø–æ–≤, –ø—Ä–æ—â–µ —Ä–∞–±–æ—Ç–∞—Ç—å —Å —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏, –∫–ª–æ–Ω–∏—Ä—É—è –∑–Ω–∞—á–µ–Ω–∏—è —Ç–∞–º, –≥–¥–µ —ç—Ç–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ.

__–í—Ä–µ–º–µ–Ω–∞ –∂–∏–∑–Ω–∏ –≤ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞—Ö__

–ï—Å–ª–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ö—Ä–∞–Ω–∏—Ç –∑–∞–∏–º—Å—Ç–≤–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ, –æ–Ω–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –∞–Ω–Ω–æ—Ç–∏—Ä–æ–≤–∞–Ω–∞ –≤—Ä–µ–º–µ–Ω–µ–º –∂–∏–∑–Ω–∏:

```rust
#[derive(Debug)]
struct Highlight<'doc>(&'doc str);

fn erase(text: String) {
    println!("Bye {text}!");
}

fn main() {
    let text = String::from("The quick brown fox jumps over the lazy dog.");
    let fox = Highlight(&text[4..19]);
    let dog = Highlight(&text[35..43]);
    // erase(text);
    println!("{fox:?}");
    println!("{dog:?}");
}
```

- –∞–Ω–Ω–æ—Ç–∞—Ü–∏—è `Highlight` –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç, —á—Ç–æ–±—ã –¥–∞–Ω–Ω—ã–µ, —Ö—Ä–∞–Ω—è—â–∏–µ—Å—è –≤ `&str`, —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–ª–∏ –ø–æ –∫—Ä–∞–π–Ω–µ–π –º–µ—Ä–µ —Ç–∞–∫–∂–µ –¥–æ–ª–≥–æ, –∫–∞–∫ –ª—é–±–æ–π —ç–∫–∑–µ–º–ø–ª—è—Ä `Highlight`, –∏—Å–ø–æ–ª—å–∑—É—é—â–∏–π —ç—Ç–∏ –¥–∞–Ω–Ω—ã–µ
- –µ—Å–ª–∏ `text` –±—É–¥–µ—Ç –ø–æ—Ç—Ä–µ–±–ª–µ–Ω –¥–æ –æ–∫–æ–Ω—á–∞–Ω–∏—è –∂–∏–∑–Ω–∏ `fox` (–∏–ª–∏ `dog`), –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä –∑–∞–∏–º—Å—Ç–≤–æ–≤–∞–Ω–∏–π –≤—ã–±—Ä–æ—Å–∏—Ç –æ—à–∏–±–∫—É
- —Ç–∏–ø—ã —Å –∑–∞–∏–º—Å—Ç–≤–æ–≤–∞–Ω–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏ –≤—ã–Ω—É–∂–¥–∞—é—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å–æ—Ö—Ä–∞–Ω—è—Ç—å –∏—Å—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ. –≠—Ç–æ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø–æ–ª–µ–∑–Ω–æ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —É–ø—Ä–æ—â–µ–Ω–Ω—ã—Ö –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–π (lightweight views), –Ω–æ –æ–±—ã—á–Ω–æ —ç—Ç–æ –Ω–µ—Å–∫–æ–ª—å–∫–æ —É—Å–ª–æ–∂–Ω—è–µ—Ç –∏—Ö –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
- –ø–æ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –¥–µ–ª–∞–π—Ç–µ —Ç–∞–∫, —á—Ç–æ–±—ã —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –≤–ª–∞–¥–µ–ª–∏ —Å–≤–æ–∏–º–∏ –¥–∞–Ω–Ω—ã–º–∏
- –Ω–µ–∫–æ—Ç–æ—Ä—ã–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã —Å –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ —Å—Å—ã–ª–∫–∞–º–∏ –≤–Ω—É—Ç—Ä–∏ –º–æ–≥—É—Ç –∏–º–µ—Ç—å –±–æ–ª–µ–µ –æ–¥–Ω–æ–π –∞–Ω–Ω–æ—Ç–∞—Ü–∏–∏ –≤—Ä–µ–º–µ–Ω–∏ –∂–∏–∑–Ω–∏. –≠—Ç–æ –º–æ–∂–µ—Ç –±—ã—Ç—å –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ, –µ—Å–ª–∏ –ø–æ–º–∏–º–æ –≤—Ä–µ–º–µ–Ω–∏ –∂–∏–∑–Ω–∏ —Å–∞–º–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä—ã, –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –æ–ø–∏—Å–∞—Ç—å –æ—Ç–Ω–æ—à–µ–Ω–∏—è –º–µ–∂–¥—É –≤—Ä–µ–º–µ–Ω–∞–º–∏ –∂–∏–∑–Ω–∏ —Å–∞–º–∏—Ö —Å—Å—ã–ª–æ–∫. –≠—Ç–æ –æ—á–µ–Ω—å –ø—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

__–£–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ: –∞–Ω–∞–ª–∏–∑ Protobuf__

–í —ç—Ç–æ–º —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–∏ –≤—ã —Å–æ–∑–¥–∞–¥–∏—Ç–µ –∞–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä [–¥–≤–æ–∏—á–Ω–æ–π –∫–æ–¥–∏—Ä–æ–≤–∫–∏ protobuf](https://protobuf.dev/programming-guides/encoding/). –ù–µ –≤–æ–ª–Ω—É–π—Ç–µ—Å—å, —ç—Ç–æ –ø—Ä–æ—â–µ, —á–µ–º –∫–∞–∂–µ—Ç—Å—è! –£–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ –∏–ª–ª—é—Å—Ç—Ä–∏—Ä—É–µ—Ç –æ–±—â–∏–π —à–∞–±–ª–æ–Ω –ø–∞—Ä—Å–∏–Ω–≥–∞ –¥–∞–Ω–Ω—ã—Ö, —Ä–∞–∑–¥–µ–ª–µ–Ω–Ω—ã—Ö –Ω–∞ —Ñ—Ä–∞–≥–º–µ–Ω—Ç—ã (—Å—Ä–µ–∑—ã). –ò—Å—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ –∫–æ–ø–∏—Ä—É—é—Ç—Å—è.

–ü–æ–ª–Ω—ã–π –∞–Ω–∞–ª–∏–∑ —Å–æ–æ–±—â–µ–Ω–∏—è protobuf —Ç—Ä–µ–±—É–µ—Ç –∑–Ω–∞–Ω–∏—è —Ç–∏–ø–æ–≤ –ø–æ–ª–µ–π, –∏–Ω–¥–µ–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –ø–æ –Ω–æ–º–µ—Ä–∞–º –ø–æ–ª–µ–π. –û–±—ã—á–Ω–æ —ç—Ç–æ –æ–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è –≤ —Ñ–∞–π–ª–µ `proto`. –í —ç—Ç–æ–º —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–∏ –º—ã –∑–∞–∫–æ–¥–∏—Ä—É–µ–º —ç—Ç—É –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –≤ –æ–ø–µ—Ä–∞—Ç–æ—Ä—ã —Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏—è –≤ —Ñ—É–Ω–∫—Ü–∏—è—Ö, –∫–æ—Ç–æ—Ä—ã–µ –≤—ã–∑—ã–≤–∞—é—Ç—Å—è –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ø–æ–ª—è.

–ú—ã –±—É–¥–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å–ª–µ–¥—É—é—â–∏–π –ø—Ä–æ—Ç–æ—Ç–∏–ø:

```
message PhoneNumber {
  optional string number = 1;
  optional string type = 2;
}

message Person {
  optional string name = 1;
  optional int32 id = 2;
  repeated PhoneNumber phones = 3;
}
```

–ü—Ä–æ—Ç–æ—Å–æ–æ–±—â–µ–Ω–∏–µ –∫–æ–¥–∏—Ä—É–µ—Ç—Å—è –∫–∞–∫ —Å–µ—Ä–∏—è –ø–æ–ª–µ–π, –∏–¥—É—â–∏—Ö –æ–¥–Ω–æ –∑–∞ –¥—Ä—É–≥–∏–º. –ö–∞–∂–¥—ã–π –∏–∑ –Ω–∏—Ö —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω –∫–∞–∫ "—Ç–µ–≥", –∑–∞ –∫–æ—Ç–æ—Ä—ã–º —Å–ª–µ–¥—É–µ—Ç –∑–Ω–∞—á–µ–Ω–∏–µ. –¢–µ–≥ —Å–æ–¥–µ—Ä–∂–∏—Ç –Ω–æ–º–µ—Ä –ø–æ–ª—è (–Ω–∞–ø—Ä–∏–º–µ—Ä, `2` –¥–ª—è –ø–æ–ª—è `id` —Å–æ–æ–±—â–µ–Ω–∏—è `Person`) –∏ —Ç–∏–ø –ø–æ–ª—è, –æ–ø—Ä–µ–¥–µ–ª—è—é—â–∏–π, –∫–∞–∫ –ø–æ–ª–µ–∑–Ω–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞ –¥–æ–ª–∂–Ω–∞ –∏–∑–≤–ª–µ–∫–∞—Ç—å—Å—è –∏–∑ –ø–æ—Ç–æ–∫–∞ –±–∞–π—Ç–æ–≤.

–¶–µ–ª—ã–µ —á–∏—Å–ª–∞, –≤–∫–ª—é—á–∞—è —Ç–µ–≥, –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω—ã —Å –ø–æ–º–æ—â—å—é –∫–æ–¥–∏—Ä–æ–≤–∫–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π –¥–ª–∏–Ω—ã, –Ω–∞–∑—ã–≤–∞–µ–º–æ–π `VARINT`. –§—É–Ω–∫—Ü–∏—è `parse_varint` —É–∂–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∞ –≤ –∫–æ–¥–µ. –¢–∞–∫–∂–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω—ã –∫–æ–ª–ª–±–µ–∫–∏ –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –ø–æ–ª–µ–π `Person` –∏ `PhoneNumber` –∏ –¥–ª—è –ø–∞—Ä—Å–∏–Ω–≥–∞ —Å–æ–æ–±—â–µ–Ω–∏—è –≤ –≤–∏–¥–µ —Å–µ—Ä–∏–∏ –≤—ã–∑–æ–≤–æ–≤ —ç—Ç–∏—Ö –∫–æ–ª–ª–±–µ–∫–æ–≤.

–í–∞–º –æ—Å—Ç–∞–ª–æ—Å—å —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏—é `parse_field` –∏ —Ç—Ä–µ–π—Ç `ProtoMessage` –¥–ª—è `Person` –∏ `PhoneNumber`.

–û–±—Ä–∞—Ç–∏—Ç–µ –≤–Ω–∏–º–∞–Ω–∏–µ: —ç—Ç–æ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è —è–≤–ª—è–µ—Ç—Å—è —Å–ª–æ–∂–Ω—ã–º –∏ –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–º. –≠—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ –Ω–∞ –¥–∞–Ω–Ω–æ–º —ç—Ç–∞–ø–µ –æ—Å–≤–æ–µ–Ω–∏—è `Rust` –≤—ã –º–æ–∂–µ—Ç–µ –µ–≥–æ –ø—Ä–æ–ø—É—Å—Ç–∏—Ç—å –∏ –≤–µ—Ä–Ω—É—Ç—å—Å—è –∫ –Ω–µ–º—É –ø–æ–∑–∂–µ.

```rust
use std::convert::TryFrom;
use thiserror::Error;

#[derive(Debug, Error)]
enum Error {
    #[error("Invalid varint")]
    InvalidVarint,
    #[error("Invalid wire-type")]
    InvalidWireType,
    #[error("Unexpected EOF")]
    UnexpectedEOF,
    #[error("Invalid length")]
    InvalidSize(#[from] std::num::TryFromIntError),
    #[error("Unexpected wire-type)")]
    UnexpectedWireType,
    #[error("Invalid string (not UTF-8)")]
    InvalidString,
}

// –¢–∏–ø –ø–æ–ª—è
enum WireType {
    // –¢–∏–ø Varint —É–∫–∞–∑—ã–≤–∞–µ—Ç, —á—Ç–æ –∑–Ω–∞—á–µ–Ω–∏–µ —è–≤–ª—è–µ—Ç—Å—è –µ–¥–∏–Ω–∏—á–Ω—ã–º `VARINT`
    Varint,
    // –¢–∏–ø `Len` —É–∫–∞–∑—ã–≤–∞–µ—Ç, —á—Ç–æ –∑–Ω–∞—á–µ–Ω–∏–µ - —ç—Ç–æ –¥–ª–∏–Ω–∞, –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–Ω–∞—è –∫–∞–∫
    // `VARINT`, —Ç–æ—á–Ω–æ —Å–ª–µ–¥—É—é—â–∏–π –∑–∞ —ç—Ç–∏–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º –±–∞–π—Ç–æ–≤
    Len,
    // –¢–∏–ø `I32` —É–∫–∞–∑—ã–≤–∞–µ—Ç, —á—Ç–æ –∑–Ω–∞—á–µ–Ω–∏–µ - —ç—Ç–æ —Ç–æ—á–Ω–æ 4 –±–∞–π—Ç–∞ –≤ –ø—Ä—è–º–æ–º –ø–æ—Ä—è–¥–∫–µ (little-endian order),
    // —Å–æ–¥–µ—Ä–∂–∞—â–∏–µ 32-–±–∏—Ç–Ω–æ–µ —Ü–µ–ª–æ–µ —á–∏—Å–ª–æ —Å–æ –∑–Ω–∞–∫–æ–º
    I32,
    // –¢–∏–ø `I64` –¥–ª—è —ç—Ç–æ–≥–æ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è –Ω–µ –Ω—É–∂–µ–Ω
}

#[derive(Debug)]
// –ó–Ω–∞—á–µ–Ω–∏–µ –ø–æ–ª—è, —Ç–∏–ø–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ç–∏–ø–∞ –ø–æ–ª—è
enum FieldValue<'a> {
    Varint(u64),
    // `I64(i64)` –¥–ª—è —ç—Ç–æ–≥–æ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è –Ω–µ –Ω—É–∂–µ–Ω
    Len(&'a [u8]),
    I32(i32),
}

#[derive(Debug)]
// –ü–æ–ª–µ, —Å–æ–¥–µ—Ä–∂–∞—â–µ–µ –Ω–æ–º–µ—Ä –ø–æ–ª—è –∏ –µ–≥–æ –∑–Ω–∞—á–µ–Ω–∏–µ
struct Field<'a> {
    field_num: u64,
    value: FieldValue<'a>,
}

trait ProtoMessage<'a>: Default + 'a {
    fn add_field(&mut self, field: Field<'a>) -> Result<(), Error>;
}

impl TryFrom<u64> for WireType {
    type Error = Error;

    fn try_from(value: u64) -> Result<WireType, Error> {
        Ok(match value {
            0 => WireType::Varint,
            // `1 => WireType::I64` –¥–ª—è —ç—Ç–æ–≥–æ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è –Ω–µ –Ω—É–∂–µ–Ω
            2 => WireType::Len,
            5 => WireType::I32,
            _ => return Err(Error::InvalidWireType),
        })
    }
}

impl<'a> FieldValue<'a> {
    fn as_string(&self) -> Result<&'a str, Error> {
        let FieldValue::Len(data) = self else {
            return Err(Error::UnexpectedWireType);
        };
        std::str::from_utf8(data).map_err(|_| Error::InvalidString)
    }

    fn as_bytes(&self) -> Result<&'a [u8], Error> {
        let FieldValue::Len(data) = self else {
            return Err(Error::UnexpectedWireType);
        };
        Ok(data)
    }

    fn as_u64(&self) -> Result<u64, Error> {
        let FieldValue::Varint(value) = self else {
            return Err(Error::UnexpectedWireType);
        };
        Ok(*value)
    }
}

// –§—É–Ω–∫—Ü–∏—è —Ä–∞–∑–±–æ—Ä–∞ VARINT, –≤–æ–∑–≤—Ä–∞—â–∞—é—â–∞—è —Ä–∞–∑–æ–±—Ä–∞–Ω–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –∏ –æ—Å—Ç–∞–≤—à–∏–µ—Å—è –±–∞–π—Ç—ã
fn parse_varint(data: &[u8]) -> Result<(u64, &[u8]), Error> {
    for i in 0..7 {
        let Some(b) = data.get(i) else {
            return Err(Error::InvalidVarint);
        };
        if b & 0x80 == 0 {
            // –≠—Ç–æ –ø–æ—Å–ª–µ–¥–Ω–∏–π –±–∞–π—Ç `VARINT`, –ø—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –µ–≥–æ
            // –≤ `u64` –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ–º
            let mut value = 0u64;
            for b in data[..=i].iter().rev() {
                value = (value << 7) | (b & 0x7f) as u64;
            }
            return Ok((value, &data[i + 1..]));
        }
    }

    // –ï—Å–ª–∏ –±–∞–π—Ç–æ–≤ –±–æ–ª—å—à–µ 7, –∑–Ω–∞—á–∏—Ç `VARINT` –Ω–µ —è–≤–ª—è–µ—Ç—Å—è –≤–∞–ª–∏–¥–Ω—ã–º
    Err(Error::InvalidVarint)
}

// –§—É–Ω–∫—Ü–∏—è –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è —Ç–µ–≥–∞ –≤ –Ω–æ–º–µ—Ä –ø–æ–ª—è –∏ —Ç–∏–ø –ø–æ–ª—è
fn unpack_tag(tag: u64) -> Result<(u64, WireType), Error> {
    let field_num = tag >> 3;
    let wire_type = WireType::try_from(tag & 0x7)?;
    Ok((field_num, wire_type))
}

// –§—É–Ω–∫—Ü–∏—è —Ä–∞–∑–±–æ—Ä–∞ –ø–æ–ª—è, –≤–æ–∑–≤—Ä–∞—â–∞—é—â–∞—è –æ—Å—Ç–∞–≤—à–∏–µ—Å—è –±–∞–π—Ç—ã
fn parse_field(data: &[u8]) -> Result<(Field, &[u8]), Error> {
    let (tag, remainder) = parse_varint(data)?;
    let (field_num, wire_type) = unpack_tag(tag)?;
    let (fieldvalue, remainder) = match wire_type {
        _ => todo!("–ù–∞ –æ—Å–Ω–æ–≤–µ —Ç–∏–ø–∞ –ø–æ–ª—è —Å–æ–∑–¥–∞–µ–º –ø–æ–ª–µ, —É–ø–æ—Ç—Ä–µ–±–∏–≤ —Å—Ç–æ–ª—å–∫–æ –±–∞–π—Ç–æ–≤, —Å–∫–æ–ª—å–∫–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ")
    };
    todo!("–í–æ–∑–≤—Ä–∞—â–∞–µ–º –ø–æ–ª–µ –∏ –æ—Å—Ç–∞–≤—à–∏–µ—Å—è –±–∞–π—Ç—ã")
}

// –§—É–Ω–∫—Ü–∏—è —Ä–∞–∑–±–æ—Ä–∞ —Å–æ–æ–±—â–µ–Ω–∏—è –≤ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ, –≤—ã–∑—ã–≤–∞—é—â–∞—è `T::add_field` –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ø–æ–ª—è.
// –í—Å–µ –≤—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –ø–æ—Ç—Ä–µ–±–ª—è—é—Ç—Å—è
fn parse_message<'a, T: ProtoMessage<'a>>(mut data: &'a [u8]) -> Result<T, Error> {
    let mut result = T::default();
    while !data.is_empty() {
        let parsed = parse_field(data)?;
        result.add_field(parsed.0)?;
        data = parsed.1;
    }
    Ok(result)
}

#[derive(Debug, Default)]
struct PhoneNumber<'a> {
    number: &'a str,
    type_: &'a str,
}

#[derive(Debug, Default)]
struct Person<'a> {
    name: &'a str,
    id: u64,
    phone: Vec<PhoneNumber<'a>>,
}

impl<'a> ProtoMessage<'a> for Person<'a> {
    fn add_field(&mut self, field: Field<'a>) -> Result<(), Error> {
        todo!("—Ä–µ–∞–ª–∏–∑—É–π –º–µ–Ω—è")
    }
}

impl<'a> ProtoMessage<'a> for PhoneNumber<'a> {
    fn add_field(&mut self, field: Field<'a>) -> Result<(), Error> {
        todo!("—Ä–µ–∞–ª–∏–∑—É–π –º–µ–Ω—è")
    }
}

fn main() {
    let person: Person = parse_message(&[
        0x0a, 0x07, 0x6d, 0x61, 0x78, 0x77, 0x65, 0x6c, 0x6c, 0x10, 0x2a, 0x1a,
        0x16, 0x0a, 0x0e, 0x2b, 0x31, 0x32, 0x30, 0x32, 0x2d, 0x35, 0x35, 0x35,
        0x2d, 0x31, 0x32, 0x31, 0x32, 0x12, 0x04, 0x68, 0x6f, 0x6d, 0x65, 0x1a,
        0x18, 0x0a, 0x0e, 0x2b, 0x31, 0x38, 0x30, 0x30, 0x2d, 0x38, 0x36, 0x37,
        0x2d, 0x35, 0x33, 0x30, 0x38, 0x12, 0x06, 0x6d, 0x6f, 0x62, 0x69, 0x6c,
        0x65,
    ])
    .unwrap();
    println!("{:#?}", person);
}

#[cfg(test)]
mod test {
    use super::*;

    #[test]
    fn as_string() {
        assert!(FieldValue::Varint(10).as_string().is_err());
        assert!(FieldValue::I32(10).as_string().is_err());
        assert_eq!(FieldValue::Len(b"hello").as_string().unwrap(), "hello");
    }

    #[test]
    fn as_bytes() {
        assert!(FieldValue::Varint(10).as_bytes().is_err());
        assert!(FieldValue::I32(10).as_bytes().is_err());
        assert_eq!(FieldValue::Len(b"hello").as_bytes().unwrap(), b"hello");
    }

    #[test]
    fn as_u64() {
        assert_eq!(FieldValue::Varint(10).as_u64().unwrap(), 10u64);
        assert!(FieldValue::I32(10).as_u64().is_err());
        assert!(FieldValue::Len(b"hello").as_u64().is_err());
    }
}
```

<details>
<summary>–†–µ—à–µ–Ω–∏–µ:</summary>

```rust
fn parse_field(data: &[u8]) -> Result<(Field, &[u8]), Error> {
    let (tag, remainder) = parse_varint(data)?;
    let (field_num, wire_type) = unpack_tag(tag)?;
    let (fieldvalue, remainder) = match wire_type {
        WireType::Varint => {
            let (value, remainder) = parse_varint(remainder)?;
            (FieldValue::Varint(value), remainder)
        }
        WireType::Len => {
            let (len, remainder) = parse_varint(remainder)?;
            let len: usize = len.try_into()?;
            if remainder.len() < len {
                return Err(Error::UnexpectedEOF);
            }
            let (value, remainder) = remainder.split_at(len);
            (FieldValue::Len(value), remainder)
        }
        WireType::I32 => {
            if remainder.len() < 4 {
                return Err(Error::UnexpectedEOF);
            }
            let (value, remainder) = remainder.split_at(4);
            let value = i32::from_le_bytes(value.try_into().unwrap());
            (FieldValue::I32(value), remainder)
        }
    };
    Ok((Field { field_num, value: fieldvalue }, remainder))
}

// ...

impl<'a> ProtoMessage<'a> for Person<'a> {
    fn add_field(&mut self, field: Field<'a>) -> Result<(), Error> {
        match field.field_num {
            1 => self.name = field.value.as_string()?,
            2 => self.id = field.value.as_u64()?,
            3 => self.phone.push(parse_message(field.value.as_bytes()?)?),
            _ => {} // –æ—Å—Ç–∞–ª—å–Ω–æ–µ –ø—Ä–æ–ø—É—Å–∫–∞–µ–º
        }
        Ok(())
    }
}

impl<'a> ProtoMessage<'a> for PhoneNumber<'a> {
    fn add_field(&mut self, field: Field<'a>) -> Result<(), Error> {
        match field.field_num {
            1 => self.number = field.value.as_string()?,
            2 => self.type_ = field.value.as_string()?,
            _ => {} // –æ—Å—Ç–∞–ª—å–Ω–æ–µ –ø—Ä–æ–ø—É—Å–∫–∞–µ–º
        }
        Ok(())
    }
}
```

</details>

## –ò—Ç–µ—Ä–∞—Ç–æ—Ä—ã

__Iterator__

–¢—Ä–µ–π—Ç [Iterator](https://doc.rust-lang.org/std/iter/trait.Iterator.html) –ø–æ–∑–≤–æ–ª—è–µ—Ç –ø–µ—Ä–µ–±–∏—Ä–∞—Ç—å –∑–Ω–∞—á–µ–Ω–∏—è –∫–æ–ª–ª–µ–∫—Ü–∏–∏. –û–Ω —Ç—Ä–µ–±—É–µ—Ç —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –º–µ—Ç–æ–¥–∞ `next` –∏ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –±–æ–ª—å—à–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–ª–µ–∑–Ω—ã—Ö –º–µ—Ç–æ–¥–æ–≤. –ú–Ω–æ–≥–∏–µ —Ç–∏–ø—ã —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–π –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ —Ä–µ–∞–ª–∏–∑—É—é—Ç `Iterator`, –∏ –º—ã —Ç–∞–∫–∂–µ –º–æ–∂–µ–º –µ–≥–æ —Ä–µ–∞–ª–∏–∑–æ–≤—ã–≤–∞—Ç—å –Ω–∞ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã—Ö —Ç–∏–ø–∞—Ö:

```rust
struct Fibonacci {
    curr: u32,
    next: u32,
}

impl Iterator for Fibonacci {
    type Item = u32;

    fn next(&mut self) -> Option<Self::Item> {
        let new_next = self.curr + self.next;
        self.curr = self.next;
        self.next = new_next;
        Some(self.curr)
    }
}

fn main() {
    let fib = Fibonacci { curr: 0, next: 1 };
    for (i, n) in fib.enumerate().take(5) {
        println!("fib({i}): {n}");
    }
}
```

–†–µ–º–∞—Ä–∫–∏:

- —Ç—Ä–µ–π—Ç `Iterator` —Ä–µ–∞–ª–∏–∑—É–µ—Ç –º–Ω–æ–≥–æ –ø–æ–ø—É–ª—è—Ä–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–≥–æ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—è –Ω–∞–¥ –∫–æ–ª–ª–µ–∫—Ü–∏—è–º–∏ (`map`, `filter`, `reduce` –∏ —Ç.–¥.). –í `Rust` —ç—Ç–∏ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–æ–ª–∂–Ω—ã —Å–æ–∑–¥–∞–≤–∞—Ç—å –∫–æ–¥, —Å—Ç–æ–ª—å –∂–µ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã–π, –∫–∞–∫ –∏ —ç–∫–≤–∏–≤–∞–ª–µ–Ω—Ç–Ω—ã–µ –∏–º–ø–µ—Ä–∞—Ç–∏–≤–Ω—ã–µ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏
- `IntoIterator` - —ç—Ç–æ —Ç—Ä–µ–π—Ç, –æ–±–µ—Å–ø–µ—á–∏–≤–∞—é—â–∏–π —Ä–∞–±–æ—Ç—É —Ü–∏–∫–ª–∞ `for`. –û–Ω —Ä–µ–∞–ª–∏–∑—É–µ—Ç—Å—è —Ç–∏–ø–∞–º–∏ –∫–æ–ª–ª–µ–∫—Ü–∏–π, —Ç–∞–∫–∏–º–∏ –∫–∞–∫ `Vec<T>`, –∏ —Å—Å—ã–ª–∫–∞–º–∏ –Ω–∞ –Ω–∏—Ö, —Ç–∞–∫–∏–º–∏ –∫–∞–∫ `&Vec<T>` –∏ `&[T]`. –î–∏–∞–ø–∞–∑–æ–Ω—ã (ranges) —Ç–∞–∫–∂–µ —Ä–µ–∞–ª–∏–∑—É—é—Ç —ç—Ç–æ—Ç —Ç—Ä–µ–π—Ç. –í–æ—Ç –ø–æ—á–µ–º—É –º—ã –º–æ–∂–µ–º –ø–µ—Ä–µ–±–∏—Ä–∞—Ç—å —ç–ª–µ–º–µ–Ω—Ç—ã –≤–µ–∫—Ç–æ—Ä–∞ —Å –ø–æ–º–æ—â—å—é `for i in some_vec { .. }`, –Ω–æ `some_vec.next()` –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç

__IntoIterator__

–¢—Ä–µ–π—Ç `Iterator` —Å–æ–æ–±—â–∞–µ—Ç, –∫–∞–∫ –≤—ã–ø–æ–ª–Ω—è—Ç—å –∏—Ç–µ—Ä–∞—Ü–∏—é –ø–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è –∏—Ç–µ—Ä–∞—Ç–æ—Ä–∞. –¢—Ä–µ–π—Ç [IntoIterator](https://doc.rust-lang.org/std/iter/trait.IntoIterator.html) –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç, –∫–∞–∫ —Å–æ–∑–¥–∞—Ç—å –∏—Ç–µ—Ä–∞—Ç–æ—Ä –¥–ª—è —Ç–∏–ø–∞. –û–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ü–∏–∫–ª–æ–º `for`.

```rust
struct Grid {
    x_coords: Vec<u32>,
    y_coords: Vec<u32>,
}

impl IntoIterator for Grid {
    type Item = (u32, u32);
    type IntoIter = GridIter;

    fn into_iter(self) -> GridIter {
        GridIter { grid: self, i: 0, j: 0 }
    }
}

struct GridIter {
    grid: Grid,
    i: usize,
    j: usize,
}

impl Iterator for GridIter {
    type Item = (u32, u32);

    fn next(&mut self) -> Option<(u32, u32)> {
        if self.i >= self.grid.x_coords.len() {
            self.i = 0;
            self.j += 1;
            if self.j >= self.grid.y_coords.len() {
                return None;
            }
        }
        let res = Some((self.grid.x_coords[self.i], self.grid.y_coords[self.j]));
        self.i += 1;
        res
    }
}

fn main() {
    let grid = Grid { x_coords: vec![3, 5, 7, 9], y_coords: vec![10, 20, 30, 40] };
    for (x, y) in grid {
        println!("point = {x}, {y}");
    }
}
```

–ö–∞–∂–¥–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è `IntoIterator` –¥–æ–ª–∂–Ω–∞ –æ–ø—Ä–µ–¥–µ–ª—è—Ç—å 2 —Ç–∏–ø–∞:

- `Item` - –ø–µ—Ä–µ–±–∏—Ä–∞–µ–º—ã–π —Ç–∏–ø, —Ç–∞–∫–æ–π –∫–∞–∫ `i8`
- `IntoIter` - —Ç–∏–ø `Iterator`, –≤–æ–∑–≤—Ä–∞—â–∞–µ–º—ã–π –º–µ—Ç–æ–¥–æ–º `into_iter`

–û–±—Ä–∞—Ç–∏—Ç–µ –≤–Ω–∏–º–∞–Ω–∏–µ, —á—Ç–æ `IntoIter` –∏ `Iter` —Å–≤—è–∑–∞–Ω—ã: –∏—Ç–µ—Ä–∞—Ç–æ—Ä –¥–æ–ª–∂–µ–Ω –∏–º–µ—Ç—å —Ç–∞–∫–æ–π –∂–µ —Ç–∏–ø `Item`. –≠—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ –æ–Ω –¥–æ–ª–∂–µ–Ω –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å `Option<Type>`.

–í –ø—Ä–∏–º–µ—Ä–µ –ø–µ—Ä–µ–±–∏—Ä–∞—é—Ç—Å—è –≤—Å–µ –∫–æ–º–±–∏–Ω–∞—Ü–∏–∏ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç `x` –∏ `y`.

–û–±—Ä–∞—Ç–∏—Ç–µ –≤–Ω–∏–º–∞–Ω–∏–µ, —á—Ç–æ `IntoIterator::into_iter` –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –≤–ª–∞–¥–µ–Ω–∏–µ (ownership) –Ω–∞–¥ `self`. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –¥–≤–∞–∂–¥—ã –ø–µ—Ä–µ–±—Ä–∞—Ç—å `grid` –≤ —Ñ—É–Ω–∫—Ü–∏–∏ `main`.

–†–µ—à–∏—Ç–µ —ç—Ç—É –ø—Ä–æ–±–ª–µ–º—É –ø—É—Ç–µ–º —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ `IntoIterator` –¥–ª—è `&Grid` –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Å—Å—ã–ª–∫–∏ –Ω–∞ `Grid` –≤ `GridIter`.

–ê–Ω–∞–ª–æ–≥–∏—á–Ω–∞—è –ø—Ä–æ–±–ª–µ–º–∞ –º–æ–∂–µ—Ç –≤–æ–∑–Ω–∏–∫–Ω—É—Ç—å –ø—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã—Ö —Ç–∏–ø–æ–≤: `for e in some_vec` –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –≤–ª–∞–¥–µ–Ω–∏–µ –Ω–∞–¥ `some_vec` –∏ –ø–µ—Ä–µ–±–∏—Ä–∞–µ—Ç —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã –≤–µ–∫—Ç–æ—Ä–∞. –î–ª—è –ø–µ—Ä–µ–±–æ—Ä–∞ —Å—Å—ã–ª–æ–∫ –Ω–∞ —ç–ª–µ–º–µ–Ω—Ç—ã –≤–µ–∫—Ç–æ—Ä–∞ —Å–ª–µ–¥—É–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `for e in &some_vec`.

__FromIterator__

–¢—Ä–µ–π—Ç [FromIterator](https://doc.rust-lang.org/std/iter/trait.FromIterator.html) –ø–æ–∑–≤–æ–ª—è–µ—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å –∫–æ–ª–ª–µ–∫—Ü–∏–∏ –∏–∑ `Iterator`:

```rust
fn main() {
    let primes = vec![2, 3, 5, 7];
    let prime_squares = primes.into_iter().map(|p| p * p).collect::<Vec<_>>();
    println!("prime_squares: {prime_squares:?}");
}
```

`Iterator` —Ä–µ–∞–ª–∏–∑—É–µ—Ç

```rust
fn collect<B>(self) -> B
where
    B: FromIterator<Self::Item>,
    Self: Sized
```

–°—É—â–µ—Å—Ç–≤—É–µ—Ç 2 —Å–ø–æ—Å–æ–±–∞ –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å `B` –¥–ª—è —ç—Ç–æ–≥–æ –º–µ—Ç–æ–¥–∞:

- —Å –ø–æ–º–æ—â—å—é turbofish: `some_iterator.collect::<COLLECTION_TYPE>()`, –∫–∞–∫ –ø–æ–∫–∞–∑–∞–Ω–æ –≤ –ø—Ä–∏–º–µ—Ä–µ. –°–æ–∫—Ä–∞—â–µ–Ω–∏–µ `_` –ø–æ–∑–≤–æ–ª—è–µ—Ç `Rust` –≤—ã–≤–µ—Å—Ç–∏ —Ç–∏–ø —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –≤–µ–∫—Ç–æ—Ä–∞ —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ
- —Å –ø–æ–º–æ—â—å—é –≤—ã–≤–æ–¥–∞ —Ç–∏–ø–æ–≤: `let prime_squares: Vec<_> = some_iterator.collect()`

–ë–∞–∑–æ–≤—ã–µ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ `IntoIterator` —Å—É—â–µ—Å—Ç–≤—É—é—Ç –¥–ª—è `Vec`, `HashMap` –∏ –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö –¥—Ä—É–≥–∏—Ö —Ç–∏–ø–æ–≤. –°—É—â–µ—Å—Ç–≤—É—é—Ç —Ç–∞–∫–∂–µ –±–æ–ª–µ–µ —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏, –ø–æ–∑–≤–æ–ª—è—é—â–∏–µ –¥–µ–ª–∞—Ç—å –∫–ª–µ–≤—ã–µ –≤–µ—â–∏, –≤—Ä–æ–¥–µ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è `Iterator<Item = Result<V, E>>` –≤ `Result<Vec<V>, E>`

__–£–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ: —Ü–µ–ø–æ—á–∫–∞ –º–µ—Ç–æ–¥–æ–≤ –∏—Ç–µ—Ä–∞—Ç–æ—Ä–∞__

–í —ç—Ç–æ–º —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–∏ –≤–∞–º –Ω—É–∂–Ω–æ –Ω–∞–π—Ç–∏ –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –Ω–µ–∫–æ—Ç–æ—Ä—ã–µ –º–µ—Ç–æ–¥—ã —Ç—Ä–µ–π—Ç–∞ [Iterator](https://doc.rust-lang.org/std/iter/trait.Iterator.html) –¥–ª—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ —Å–ª–æ–∂–Ω—ã—Ö –≤—ã—á–∏—Å–ª–µ–Ω–∏–π.

–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –≤—ã—Ä–∞–∂–µ–Ω–∏–µ –∏—Ç–µ—Ä–∞—Ç–æ—Ä–∞ –∏ —Å–æ–±–µ—Ä–∏—Ç–µ (`collect`) —Ä–µ–∑—É–ª—å—Ç–∞—Ç –¥–ª—è –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏—è –≤–æ–∑–≤—Ä–∞—â–∞–µ–º–æ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è.

```rust
// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –≤—ã—á–∏—Å–ª–µ–Ω–∏—è —Ä–∞–∑–Ω–∏—Ü—ã –º–µ–∂–¥—É —ç–ª–µ–º–µ–Ω—Ç–∞–º–∏ `values`, —Å–º–µ—â–µ–Ω–Ω—ã–º–∏ –Ω–∞ `offset`.
// `values` –ø–µ—Ä–µ–±–∏—Ä–∞—é—Ç—Å—è –ø–æ –∫—Ä—É–≥—É.
//
// –≠–ª–µ–º–µ–Ω—Ç `n` —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ - `values[(n+offset)%len] - values[n]`.
fn offset_differences<N>(offset: usize, values: Vec<N>) -> Vec<N>
where
    N: Copy + std::ops::Sub<Output = N>,
{
    todo!("—Ä–µ–∞–ª–∏–∑—É–π –º–µ–Ω—è")
}

fn main() {
    let res = offset_differences(1, vec![1, 3, 5, 7]);
    println!("{:?}", res);
}

#[cfg(test)]
mod tests {
    use super::*;

    #[test]
    fn test_offset_one() {
        assert_eq!(offset_differences(1, vec![1, 3, 5, 7]), vec![2, 2, 2, -6]);
        assert_eq!(offset_differences(1, vec![1, 3, 5]), vec![2, 2, -4]);
        assert_eq!(offset_differences(1, vec![1, 3]), vec![2, -2]);
    }

    #[test]
    fn test_larger_offsets() {
        assert_eq!(offset_differences(2, vec![1, 3, 5, 7]), vec![4, 4, -4, -4]);
        assert_eq!(offset_differences(3, vec![1, 3, 5, 7]), vec![6, -2, -2, -2]);
        assert_eq!(offset_differences(4, vec![1, 3, 5, 7]), vec![0, 0, 0, 0]);
        assert_eq!(offset_differences(5, vec![1, 3, 5, 7]), vec![2, 2, 2, -6]);
    }

    #[test]
    fn test_custom_type() {
        assert_eq!(
            offset_differences(1, vec![1.0, 11.0, 5.0, 0.0]),
            vec![10.0, -6.0, -5.0, 1.0]
        );
    }

    #[test]
    fn test_degenerate_cases() {
        assert_eq!(offset_differences(1, vec![0]), vec![0]);
        assert_eq!(offset_differences(1, vec![1]), vec![0]);
        let empty: Vec<i32> = vec![];
        assert_eq!(offset_differences(1, empty), vec![]);
    }
}
```

<details>
<summary>–†–µ—à–µ–Ω–∏–µ:</summary>

```rust
fn offset_differences<N>(offset: usize, values: Vec<N>) -> Vec<N>
where
    N: Copy + std::ops::Sub<Output = N>,
{
    let a = (&values).into_iter();
    let b = (&values).into_iter().cycle().skip(offset);
    a.zip(b).map(|(a, b)| *b - *a).take(values.len()).collect()
}
```

</details>

## –ú–æ–¥—É–ª–∏

__–ú–æ–¥—É–ª–∏__

–ú—ã –≤–∏–¥–µ–ª–∏, –∫–∞–∫ –±–ª–æ–∫–∏ `impl` –ø–æ–∑–≤–æ–ª—è—é—Ç –Ω–∞–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏–∏ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–∞ –∏–º–µ–Ω (namespace) –¥–ª—è —Ç–∏–ø–∞.

–ê–Ω–∞–ª–æ–≥–∏—á–Ω–æ, `mod` –ø–æ–∑–≤–æ–ª—è–µ—Ç –Ω–∞–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–∏–ø—ã –∏ —Ñ—É–Ω–∫—Ü–∏–∏ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–∞ –∏–º–µ–Ω:

```rust
mod foo {
    pub fn do_something() {
        println!("–≤ –º–æ–¥—É–ª–µ foo");
    }
}

mod bar {
    pub fn do_something() {
        println!("–≤ –º–æ–¥—É–ª–µ bar");
    }
}

fn main() {
    foo::do_something();
    bar::do_something();
}
```

–†–µ–º–∞—Ä–∫–∏:

- –ø–∞–∫–µ—Ç—ã (packages) –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è—é—Ç —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª –∏ –≤–∫–ª—é—á–∞—é—Ç —Ñ–∞–π–ª `Cargo.toml`, –æ–ø–∏—Å—ã–≤–∞—é—â–∏–π —Å–±–æ—Ä–∫—É –∏–∑ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –∫—Ä–µ–π—Ç–æ–≤
- –∫—Ä–µ–π—Ç—ã (crates) - —ç—Ç–æ –¥–µ—Ä–µ–≤–æ –º–æ–¥—É–ª–µ–π, –≥–¥–µ –±–∏–Ω–∞—Ä–Ω—ã–π –∫—Ä–µ–π—Ç —è–≤–ª—è–µ—Ç—Å—è –∏—Å–ø–æ–ª–Ω—è–µ–º—ã–º —Ñ–∞–π–ª–æ–º, –∞ –±–∏–±–ª–∏–æ—Ç–µ—á–Ω—ã–π –∫—Ä–µ–π—Ç –∫–æ–º–ø–∏–ª–∏—Ä—É–µ—Ç—Å—è –≤ –±–∏–±–ª–∏–æ—Ç–µ–∫—É
- –º–æ–¥—É–ª–∏ –æ–ø—Ä–µ–¥–µ–ª—è—é—Ç –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—é –∏ –æ–±–ª–∞—Å—Ç—å –≤–∏–¥–∏–º–æ—Å—Ç–∏ –∫–æ–¥–∞

__–ò–µ—Ä–∞—Ä—Ö–∏—è —Ñ–∞–π–ª–æ–≤–æ–π —Å–∏—Å—Ç–µ–º—ã__

–ï—Å–ª–∏ –æ–ø—É—Å—Ç–∏—Ç—å —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –º–æ–¥—É–ª—è, `Rust` –±—É–¥–µ—Ç –∏—Å–∫–∞—Ç—å –µ–≥–æ –≤ –¥—Ä—É–≥–æ–º —Ñ–∞–π–ª–µ:

```rust
mod garden;
```

–≠—Ç–æ —Å–æ–æ–±—â–∞–µ—Ç `Rust`, —á—Ç–æ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –º–æ–¥—É–ª—è `Garden` –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –ø–æ –∞–¥—Ä–µ—Å—É `src/garden.rs`. –ê–Ω–∞–ª–æ–≥–∏—á–Ω–æ, –º–æ–¥—É–ª—å `Garden::vegetables` —Å–ª–µ–¥—É–µ—Ç –∏—Å–∫–∞—Ç—å –ø–æ –∞–¥—Ä–µ—Å—É `src/garden/vegetables.rs`.

–ö–æ—Ä–Ω–µ–≤–æ–π `crate` –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤:

- `src/lib.rs` (–¥–ª—è –±–∏–±–ª–∏–æ—Ç–µ—á–Ω–æ–≥–æ –∫—Ä–µ–π—Ç–∞)
- `src/main.rs` (–¥–ª—è –±–∏–Ω–∞—Ä–Ω–æ–≥–æ –∫—Ä–µ–π—Ç–∞)

–ú–æ–¥—É–ª–∏, –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–µ –≤ —Ñ–∞–π–ª–∞—Ö, –º–æ–∂–Ω–æ –¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å —Å –ø–æ–º–æ—â—å—é "–≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏—Ö –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤ –¥–æ–∫—É–º–µ–Ω—Ç–∞". –û–Ω–∏ –¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä—É—é—Ç —ç–ª–µ–º–µ–Ω—Ç, –∫–æ—Ç–æ—Ä—ã–π –∏—Ö —Å–æ–¥–µ—Ä–∂–∏—Ç - –≤ –¥–∞–Ω–Ω–æ–º —Å–ª—É—á–∞–µ –º–æ–¥—É–ª—å.

```rust
//! This module implements the garden, including a highly performant germination
//! implementation.

// Re-export types from this module.
pub use garden::Garden;
pub use seeds::SeedPacket;

/// Sow the given seed packets.
pub fn sow(seeds: Vec<SeedPacket>) {
    todo!()
}

/// Harvest the produce in the garden that is ready.
pub fn harvest(garden: &mut Garden) {
    todo!()
}
```

–†–µ–º–∞—Ä–∫–∏:

- –¥–æ `Rust 2018` –º–æ–¥—É–ª–∏ –¥–æ–ª–∂–Ω—ã –±—ã–ª–∏ –Ω–∞—Ö–æ–¥–∏—Ç—å—Å—è –≤ `module/mod.rs` –≤–º–µ—Å—Ç–æ `module.rs`, –∏ —ç—Ç–æ –ø–æ-–ø—Ä–µ–∂–Ω–µ–º—É —Ä–∞–±–æ—Ç–∞–µ—Ç
- –æ—Å–Ω–æ–≤–Ω–∞—è –ø—Ä–∏—á–∏–Ω–∞ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è `filename.rs` –≤ –∫–∞—á–µ—Å—Ç–≤–µ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤—ã `filename/mod.rs` –∑–∞–∫–ª—é—á–∞–µ—Ç—Å—è –≤ —Ç–æ–º, —á—Ç–æ –ø—Ä–∏ –±–æ–ª—å—à–æ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–µ —Ñ–∞–π–ª–æ–≤ `mod.rs` —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è —Å–ª–æ–∂–Ω–æ –≤ –Ω–∏—Ö —Ä–∞–∑–±–∏—Ä–∞—Ç—å—Å—è
- –ø—Ä–∏ –±–æ–ª–µ–µ –≥–ª—É–±–æ–∫–æ–π –≤–ª–æ–∂–µ–Ω–Ω–æ—Å—Ç–∏ –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏, –¥–∞–∂–µ –µ—Å–ª–∏ –æ—Å–Ω–æ–≤–Ω–æ–π –º–æ–¥—É–ª—å —è–≤–ª—è–µ—Ç—Å—è —Ñ–∞–π–ª–æ–º:

```
src/
‚îú‚îÄ‚îÄ main.rs
‚îú‚îÄ‚îÄ top_module.rs
‚îî‚îÄ‚îÄ top_module/
    ‚îî‚îÄ‚îÄ sub_module.rs
```

- –º–µ—Å—Ç–æ –ø–æ–∏—Å–∫–∞ –º–æ–¥—É–ª–µ–π –º–æ–∂–µ—Ç –±—ã—Ç—å –∏–∑–º–µ–Ω–µ–Ω–æ —Å –ø–æ–º–æ—â—å—é –¥–∏—Ä–µ–∫—Ç–∏–≤—ã –∫–æ–º–ø–∏–ª—è—Ç–æ—Ä–∞:

```rust
#[path = "some/path.rs"]
mod some_module;
```

–≠—Ç–æ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø–æ–ª–µ–∑–Ω—ã–º, –Ω–∞–ø—Ä–∏–º–µ—Ä, –∫–æ–≥–¥–∞ –º—ã —Ö–æ—Ç–∏–º –ø–æ–º–µ—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç—ã –¥–ª—è –º–æ–¥—É–ª—è –≤ —Ñ–∞–π–ª —Å –∏–º–µ–Ω–µ–º `some_module_test.rs`.

__–í–∏–¥–∏–º–æ—Å—Ç—å__

–ú–æ–¥—É–ª–∏ —è–≤–ª—è—é—Ç—Å—è –ø—Ä–∏–≤–∞—Ç–Ω—ã–º–∏/–∑–∞–∫—Ä—ã—Ç—ã–º–∏:

- —ç–ª–µ–º–µ–Ω—Ç—ã –º–æ–¥—É–ª–µ–π —è–≤–ª—è—é—Ç—Å—è –ø—Ä–∏–≤–∞—Ç–Ω—ã–º–∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é (—Å–∫—Ä—ã–≤–∞—é—Ç –¥–µ—Ç–∞–ª–∏ —Å–≤–æ–µ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏)
- —Ä–æ–¥–∏—Ç–µ–ª–∏ –∏ —Å–∏–±–ª–∏–Ω–≥–∏ –≤—Å–µ–≥–¥–∞ —è–≤–ª—è—é—Ç—Å—è –≤–∏–¥–∏–º—ã–º–∏ (–¥–ª—è —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –º–æ–¥—É–ª–µ–π)
- –µ—Å–ª–∏ —ç–ª–µ–º–µ–Ω—Ç –≤–∏–¥–∏–º –≤ –º–æ–¥—É–ª–µ `foo`, –æ–Ω –≤–∏–¥–∏–º –≤—Å–µ–º –ø–æ—Ç–æ–º–∫–∞–º `foo`

```rust
mod outer {
    fn private() {
        println!("outer::private");
    }

    pub fn public() {
        println!("outer::public");
    }

    mod inner {
        fn private() {
            println!("outer::inner::private");
        }

        pub fn public() {
            println!("outer::inner::public");
            super::private();
        }
    }
}

fn main() {
    outer::public();
}
```

–†–µ–º–∞—Ä–∫–∏:

- –¥–ª—è —Ç–æ–≥–æ, —á—Ç–æ–±—ã —Å–¥–µ–ª–∞—Ç—å –º–æ–¥—É–ª—å –ø—É–±–ª–∏—á–Ω—ã–º/–æ—Ç–∫—Ä—ã—Ç—ã–º, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∫–ª—é—á–µ–≤–æ–µ —Å–ª–æ–≤–æ `pub`
- —Å—É—â–µ—Å—Ç–≤—É—é—Ç [–ø—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–µ —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ç–æ—Ä—ã `pub`](https://doc.rust-lang.org/reference/visibility-and-privacy.html#pubin-path-pubcrate-pubsuper-and-pubself), –ø–æ–∑–≤–æ–ª—è—é—â–∏–µ –æ–≥—Ä–∞–Ω–∏—á–∏–≤–∞—Ç—å –æ–±–ª–∞—Å—Ç—å –ø—É–±–ª–∏—á–Ω–æ–π –≤–∏–¥–∏–º–æ—Å—Ç–∏

__use, super, self__

–ú–æ–¥—É–ª—å –º–æ–∂–µ—Ç –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å —ç–ª–µ–º–µ–Ω—Ç—ã –¥—Ä—É–≥–æ–≥–æ –º–æ–¥—É–ª—è –≤ —Å–≤–æ—é –æ–±–ª–∞—Å—Ç—å –≤–∏–¥–∏–º–æ—Å—Ç–∏ —Å –ø–æ–º–æ—â—å—é –∫–ª—é—á–µ–≤–æ–≥–æ —Å–ª–æ–≤–∞ `use`. –í –Ω–∞—á–∞–ª–µ –∫–∞–∂–¥–æ–≥–æ –º–æ–¥—É–ª—è –º–æ–∂–Ω–æ —É–≤–∏–¥–µ—Ç—å —á—Ç–æ-—Ç–æ –≤—Ä–æ–¥–µ —ç—Ç–æ–≥–æ:

```rust
use std::collections::HashSet;
use std::process::abort;
```

_–ü—É—Ç–∏_

–ü—É—Ç—å (path) —Ä–∞–∑—Ä–µ—à–∞–µ—Ç—Å—è —Å–ª–µ–¥—É—é—â–∏–º –æ–±—Ä–∞–∑–æ–º:

1. –ö–∞–∫ –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω—ã–π –ø—É—Ç—å:
   - `foo` –∏–ª–∏ `self::foo` —Å—Å—ã–ª–∞–µ—Ç—Å—è –Ω–∞ `foo` –≤ —Ç–µ–∫—É—â–µ–º –º–æ–¥—É–ª–µ
   - `super::foo` —Å—Å—ã–ª–∞–µ—Ç—Å—è –Ω–∞ `foo` –≤ —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–º –º–æ–¥—É–ª–µ
2. –ö–∞–∫ –∞–±—Å–æ–ª—é—Ç–Ω—ã–π –ø—É—Ç—å:
   - `crate:foo` —Å—Å—ã–ª–∞–µ—Ç—Å—è –Ω–∞ `foo` –≤ –∫–æ—Ä–Ω–µ —Ç–µ–∫—É—â–µ–≥–æ –∫—Ä–µ–π—Ç–∞
   - `bar::foo` —Å—Å—ã–ª–∞–µ—Ç—Å—è –Ω–∞ `foo` –≤ –∫—Ä–µ–π—Ç–µ `bar`

–†–µ–º–∞—Ä–∫–∏:

- —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω–µ–Ω–Ω–æ–π –ø—Ä–∞–∫—Ç–∏–∫–æ–π —è–≤–ª—è–µ—Ç—Å—è –ø–æ–≤—Ç–æ—Ä–Ω—ã–π —ç–∫—Å–ø–æ—Ä—Ç —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –º–æ–¥—É–ª–µ–π. –ù–∞–ø—Ä–∏–º–µ—Ä, –∫–æ—Ä–Ω–µ–≤–æ–π —Ñ–∞–π–ª `lib.rs` –º–æ–∂–µ—Ç —Å–æ–¥–µ—Ä–∂–∞—Ç—å:

```rust
mod storage;

pub use storage::disk::DiskStorage;
pub use storage::network::NetworkStorage;
```

–≠—Ç–æ —Å–¥–µ–ª–∞–µ—Ç `DiskStorage` –∏ `NetworkStorage` –¥–æ—Å—Ç—É–ø–Ω—ã–º–∏ –¥—Ä—É–≥–∏–º –∫—Ä–µ–π—Ç–∞–º –ø–æ –∫–æ—Ä–æ—Ç–∫–æ–º—É –ø—É—Ç–∏.

- –≤ –æ—Å–Ω–æ–≤–Ω–æ–º, –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ `use` (–∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å) —Ç–æ–ª—å–∫–æ —ç–ª–µ–º–µ–Ω—Ç—ã, –∫–æ—Ç–æ—Ä—ã–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –≤ –º–æ–¥—É–ª–µ. –û–¥–Ω–∞–∫–æ –¥–ª—è —Ç–æ–≥–æ, —á—Ç–æ–±—ã –≤—ã–∑—ã–≤–∞—Ç—å –º–µ—Ç–æ–¥—ã —Ç—Ä–µ–π—Ç–∞, –æ–Ω –¥–æ–ª–∂–µ–Ω –Ω–∞—Ö–æ–¥–∏—Ç—å—Å—è –≤ –æ–±–ª–∞—Å—Ç–∏ –≤–∏–¥–∏–º–æ—Å—Ç–∏, –¥–∞–∂–µ –µ—Å–ª–∏ —Ç–∏–ø, —Ä–µ–∞–ª–∏–∑—É—é—â–∏–π —ç—Ç–æ—Ç —Ç—Ä–µ–π—Ç, —É–∂–µ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ –Ω–µ–π. –ù–∞–ø—Ä–∏–º–µ—Ä, —á—Ç–æ–±—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –º–µ—Ç–æ–¥ `read_to_string` –¥–ª—è —Ç–∏–ø–∞, —Ä–µ–∞–ª–∏–∑—É—é—â–µ–≥–æ —Ç—Ä–µ–π—Ç `Read`, –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ `use std::io::Read`
- –≤ –æ–ø–µ—Ä–∞—Ç–æ—Ä–µ `use` –º–æ–∂–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –ø–æ–¥—Å—Ç–∞–Ω–æ–≤–æ—á–Ω—ã–π –∑–Ω–∞–∫: `use std::io::*`. –î–µ–ª–∞—Ç—å —Ç–∞–∫ –Ω–µ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è, –ø–æ—Å–∫–æ–ª—å–∫—É –Ω–µ—è—Å–Ω–æ, –∫–∞–∫–∏–µ —ç–ª–µ–º–µ–Ω—Ç—ã –∏–º–ø–æ—Ä—Ç–∏—Ä—É—é—Ç—Å—è, –∏ —ç—Ç–∏ —ç–ª–µ–º–µ–Ω—Ç—ã –º–æ–≥—É—Ç –∏–∑–º–µ–Ω–∏—Ç—å—Å—è —Å–æ –≤—Ä–µ–º–µ–Ω–µ–º

__–£–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ: –º–æ–¥—É–ª–∏ –¥–ª—è –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–≥–æ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞__

–í —ç—Ç–æ–º —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–∏ –≤—ã —Ä–µ–æ—Ä–≥–∞–Ω–∏–∑—É–µ—Ç–µ –∫–æ–¥ "–ë–∏–±–ª–∏–æ—Ç–µ–∫–∏ –≥—Ä–∞—Ñ–∏—á–µ—Å–∫–æ–≥–æ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞" –∏–∑ —Ä–∞–∑–¥–µ–ª–∞ "–ú–µ—Ç–æ–¥—ã –∏ —Ç—Ä–µ–π—Ç—ã" –≤ –Ω–∞–±–æ—Ä –º–æ–¥—É–ª–µ–π. –û–±—ã—á–Ω–æ –∫–∞–∂–¥—ã–π —Ç–∏–ø –∏–ª–∏ –Ω–∞–±–æ—Ä —Ç–µ—Å–Ω–æ —Å–≤—è–∑–∞–Ω–Ω—ã—Ö —Ç–∏–ø–æ–≤ –ø–æ–º–µ—â–∞—é—Ç –≤ –æ—Ç–¥–µ–ª—å–Ω—ã–π –º–æ–¥—É–ª—å, –ø–æ—ç—Ç–æ–º—É –∫–∞–∂–¥—ã–π —Ç–∏–ø –≤–∏–¥–∂–µ—Ç–∞ –¥–æ–ª–∂–µ–Ω –∏–º–µ—Ç—å —Å–≤–æ–π —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–π –º–æ–¥—É–ª—å.

–ö–æ–¥:

```rust
pub trait Widget {
    fn width(&self) -> usize;

    fn draw_into(&self, buffer: &mut dyn std::fmt::Write);

    fn draw(&self) {
        let mut buffer = String::new();
        self.draw_into(&mut buffer);
        println!("{buffer}");
    }
}

pub struct Label {
    label: String,
}

impl Label {
    fn new(label: &str) -> Label {
        Label { label: label.to_owned() }
    }
}

pub struct Button {
    label: Label,
}

impl Button {
    fn new(label: &str) -> Button {
        Button { label: Label::new(label) }
    }
}

pub struct Window {
    title: String,
    widgets: Vec<Box<dyn Widget>>,
}

impl Window {
    fn new(title: &str) -> Window {
        Window { title: title.to_owned(), widgets: Vec::new() }
    }

    fn add_widget(&mut self, widget: Box<dyn Widget>) {
        self.widgets.push(widget);
    }

    fn inner_width(&self) -> usize {
        std::cmp::max(
            self.title.chars().count(),
            self.widgets.iter().map(|w| w.width()).max().unwrap_or(0),
        )
    }
}

impl Widget for Window {
    fn width(&self) -> usize {
        self.inner_width() + 4
    }

    fn draw_into(&self, buffer: &mut dyn std::fmt::Write) {
        let mut inner = String::new();
        for widget in &self.widgets {
            widget.draw_into(&mut inner);
        }

        let inner_width = self.inner_width();

        writeln!(buffer, "+-{:-<inner_width$}-+", "").unwrap();
        writeln!(buffer, "| {:^inner_width$} |", &self.title).unwrap();
        writeln!(buffer, "+={:=<inner_width$}=+", "").unwrap();
        for line in inner.lines() {
            writeln!(buffer, "| {:inner_width$} |", line).unwrap();
        }
        writeln!(buffer, "+-{:-<inner_width$}-+", "").unwrap();
    }
}

impl Widget for Button {
    fn width(&self) -> usize {
        self.label.width() + 4
    }

    fn draw_into(&self, buffer: &mut dyn std::fmt::Write) {
        let width = self.width();
        let mut label = String::new();
        self.label.draw_into(&mut label);

        writeln!(buffer, "+{:-<width$}+", "").unwrap();
        for line in label.lines() {
            writeln!(buffer, "|{:^width$}|", &line).unwrap();
        }
        writeln!(buffer, "+{:-<width$}+", "").unwrap();
    }
}

impl Widget for Label {
    fn width(&self) -> usize {
        self.label.lines().map(|line| line.chars().count()).max().unwrap_or(0)
    }

    fn draw_into(&self, buffer: &mut dyn std::fmt::Write) {
        writeln!(buffer, "{}", &self.label).unwrap();
    }
}

fn main() {
    let mut window = Window::new("Rust GUI Demo 1.23");
    window.add_widget(Box::new(Label::new("This is a small text GUI demo.")));
    window.add_widget(Box::new(Button::new("Click me!")));
    window.draw();
}
```

–£–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ –º–æ–∂–Ω–æ –Ω–∞—á–∞—Ç—å —Å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —Å–ª–µ–¥—É—é—â–∏—Ö –∫–æ–º–∞–Ω–¥:

```bash
cargo init gui-modules
cd gui-modules
cargo run
```

–û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ —Ñ–∞–π–ª `src/main.rs`, –¥–æ–±–∞–≤–∏–≤ –≤ –Ω–µ–≥–æ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ `mod`, –∏ —Å–æ–∑–¥–∞–π—Ç–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ —Ñ–∞–π–ª—ã –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ `src`.

<details>
<summary>–†–µ—à–µ–Ω–∏–µ:</summary>

```
src
‚îú‚îÄ‚îÄ main.rs
‚îú‚îÄ‚îÄ widgets
‚îÇ¬†¬† ‚îú‚îÄ‚îÄ button.rs
‚îÇ¬†¬† ‚îú‚îÄ‚îÄ label.rs
‚îÇ¬†¬† ‚îî‚îÄ‚îÄ window.rs
‚îî‚îÄ‚îÄ widgets.rs
```

```rust
// src/widgets.rs
mod button;
mod label;
mod window;

pub trait Widget {
    fn width(&self) -> usize;

    fn draw_into(&self, buffer: &mut dyn std::fmt::Write);

    fn draw(&self) {
        let mut buffer = String::new();
        self.draw_into(&mut buffer);
        println!("{buffer}");
    }
}

pub use button::Button;
pub use label::Label;
pub use window::Window;
```

```rust
// src/widgets/label.rs
use super::Widget;

pub struct Label {
    label: String,
}

impl Label {
    pub fn new(label: &str) -> Label {
        Label { label: label.to_owned() }
    }
}

impl Widget for Label {
    fn width(&self) -> usize {
        self.label.lines().map(|line| line.chars().count()).max().unwrap_or(0)
    }

    fn draw_into(&self, buffer: &mut dyn std::fmt::Write) {
        writeln!(buffer, "{}", &self.label).unwrap();
    }
}
```

```rust
// src/widgets/button.rs
use super::{Label, Widget};

pub struct Button {
    label: Label,
}

impl Button {
    pub fn new(label: &str) -> Button {
        Button { label: Label::new(label) }
    }
}

impl Widget for Button {
    fn width(&self) -> usize {
        self.label.width() + 4
    }

    fn draw_into(&self, buffer: &mut dyn std::fmt::Write) {
        let width = self.width();
        let mut label = String::new();
        self.label.draw_into(&mut label);

        writeln!(buffer, "+{:-<width$}+", "").unwrap();
        for line in label.lines() {
            writeln!(buffer, "|{:^width$}|", &line).unwrap();
        }
        writeln!(buffer, "+{:-<width$}+", "").unwrap();
    }
}
```

```rust
// src/widgets/window.rs
use super::Widget;

pub struct Window {
    title: String,
    widgets: Vec<Box<dyn Widget>>,
}

impl Window {
    pub fn new(title: &str) -> Window {
        Window { title: title.to_owned(), widgets: Vec::new() }
    }

    pub fn add_widget(&mut self, widget: Box<dyn Widget>) {
        self.widgets.push(widget);
    }

    fn inner_width(&self) -> usize {
        std::cmp::max(
            self.title.chars().count(),
            self.widgets.iter().map(|w| w.width()).max().unwrap_or(0),
        )
    }
}

impl Widget for Window {
    fn width(&self) -> usize {
        self.inner_width() + 4
    }

    fn draw_into(&self, buffer: &mut dyn std::fmt::Write) {
        let mut inner = String::new();
        for widget in &self.widgets {
            widget.draw_into(&mut inner);
        }

        let inner_width = self.inner_width();

        writeln!(buffer, "+-{:-<inner_width$}-+", "").unwrap();
        writeln!(buffer, "| {:^inner_width$} |", &self.title).unwrap();
        writeln!(buffer, "+={:=<inner_width$}=+", "").unwrap();
        for line in inner.lines() {
            writeln!(buffer, "| {:inner_width$} |", line).unwrap();
        }
        writeln!(buffer, "+-{:-<inner_width$}-+", "").unwrap();
    }
}
```

```rust
// src/main.rs
mod widgets;

use widgets::Widget;

fn main() {
    let mut window = widgets::Window::new("Rust GUI Demo 1.23");
    window
        .add_widget(Box::new(widgets::Label::new("This is a small text GUI demo.")));
    window.add_widget(Box::new(widgets::Button::new("Click me!")));
    window.draw();
}
```

</details>

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

__–ú–æ–¥—É–ª—å–Ω—ã–µ/—é–Ω–∏—Ç-—Ç–µ—Å—Ç—ã__

`Rust` –∏ `Cargo` –ø–æ—Å—Ç–∞–≤–ª—è—é—Ç—Å—è —Å —Ñ—Ä–µ–π–º–≤–æ—Ä–∫–æ–º –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:

- –º–æ–¥—É–ª—å–Ω—ã–µ (unit) —Ç–µ—Å—Ç—ã –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è –ø—Ä—è–º–æ –≤ –∫–æ–¥–µ, –∫–æ—Ç–æ—Ä—ã–π –º—ã –ø–∏—à–µ–º
- –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ (integration) —Ç–µ—Å—Ç—ã –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é `tests`

–¢–µ—Å—Ç—ã –ø–æ–º–µ—á–∞—é—Ç—Å—è —Å –ø–æ–º–æ—â—å—é –¥–∏—Ä–µ–∫—Ç–∏–≤—ã `#[test]`. –Æ–Ω–∏—Ç-—Ç–µ—Å—Ç—ã —á–∞—Å—Ç–æ –ø–æ–º–µ—â–∞—é—Ç—Å—è –≤–æ –≤–ª–æ–∂–µ–Ω–Ω—ã–π –º–æ–¥—É–ª—å `tests`. –î–∏—Ä–µ–∫—Ç–∏–≤–∞ `#[cfg(test)]` —Å–æ–æ–±—â–∞–µ—Ç –∫–æ–º–ø–∏–ª—è—Ç–æ—Ä—É, —á—Ç–æ —Å–æ–¥–µ—Ä–∂–∞—â–∏–π—Å—è –¥–∞–ª–µ–µ –∫–æ–¥ —Å–ª–µ–¥—É–µ—Ç –∫–æ–º–ø–∏–ª–∏—Ä–æ–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ —Ç–µ—Å—Ç–æ–≤:

```rust
fn first_word(text: &str) -> &str {
    match text.find(' ') {
        Some(idx) => &text[..idx],
        None => &text,
    }
}

#[cfg(test)]
mod test {
    use super::*;

    #[test]
    fn test_empty() {
        assert_eq!(first_word(""), "");
    }

    #[test]
    fn test_single_word() {
        assert_eq!(first_word("Hello"), "Hello");
    }

    #[test]
    fn test_multiple_words() {
        assert_eq!(first_word("Hello World"), "Hello");
    }
}
```

- –ú–æ–¥—É–ª—å–Ω—ã–µ —Ç–µ—Å—Ç—ã –ø–æ–∑–≤–æ–ª—è—é—Ç —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–∏–≤–∞—Ç–Ω—ã–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª
- –∞—Ç—Ä–∏–±—É—Ç `#[cfg(test)]` –∞–∫—Ç–∏–≤–∏—Ä—É–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ `cargo test`

__–î—Ä—É–≥–∏–µ —Ç–∏–ø—ã —Ç–µ—Å—Ç–æ–≤__

_–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã_

–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ –æ—Ç –ª–∏—Ü–∞ –∫–ª–∏–µ–Ω—Ç–∞.

–°–æ–∑–¥–∞–µ–º —Ñ–∞–π–ª `.rs` –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ `tests/`:

```rust
// tests/my_library.rs
use my_library::init;

#[test]
fn test_init() {
    assert!(init().is_ok());
}
```

–≠—Ç–∏ —Ç–µ—Å—Ç—ã –∏–º–µ—é—Ç –¥–æ—Å—Ç—É–ø —Ç–æ–ª—å–∫–æ –∫ –ø—É–±–ª–∏—á–Ω–æ–º—É API —Ç–µ—Å—Ç–∏—Ä—É–µ–º–æ–≥–æ –∫—Ä–µ–π—Ç–∞.

_–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã_

`Rust` –∏–º–µ–µ—Ç –≤—Å—Ç—Ä–æ–µ–Ω–Ω—É—é –ø–æ–¥–¥–µ—Ä–∂–∫—É –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–æ–Ω–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤:

```rust
/// –°–æ–∫—Ä–∞—â–∞–µ—Ç —Å—Ç—Ä–æ–∫—É –¥–æ —É–∫–∞–∑–∞–Ω–Ω–æ–π –¥–ª–∏–Ω—ã.
///
/// ```
/// # use playground::shorten_string;
/// assert_eq!(shorten_string("Hello World", 5), "Hello");
/// assert_eq!(shorten_string("Hello World", 20), "Hello World");
/// ```
pub fn shorten_string(s: &str, length: usize) -> &str {
    &s[..std::cmp::min(length, s.len())]
}

```

- –ë–ª–æ–∫–∏ –∫–æ–¥–∞ –≤ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è—Ö `///` —Å—á–∏—Ç–∞—é—Ç—Å—è –≤–∞–ª–∏–¥–Ω—ã–º –∫–æ–¥–æ–º `Rust` (—Ä–∞–∑—É–º–µ–µ—Ç—Å—è, –µ—Å–ª–∏ –∫–æ–¥ –∫–æ–º–ø–∏–ª–∏—Ä—É–µ—Ç—Å—è)
- –∫–æ–¥ –±—É–¥–µ—Ç —Å–∫–æ–º–ø–∏–ª–∏—Ä–æ–≤–∞–Ω –∏ –≤—ã–ø–æ–ª–Ω–µ–Ω –∫–∞–∫ —á–∞—Å—Ç—å `cargo test`
- –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ `#` –≤ –∫–æ–¥ —Å–∫—Ä–æ–µ—Ç –µ–≥–æ –∏–∑ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏, –Ω–æ –æ–Ω –ø–æ-–ø—Ä–µ–∂–Ω–µ–º—É –±—É–¥–µ—Ç –∫–æ–º–ø–∏–ª–∏—Ä–æ–≤–∞—Ç—å—Å—è/–≤—ã–ø–æ–ª–Ω—è—Ç—å—Å—è

__–ü–æ–ª–µ–∑–Ω—ã–µ –∫—Ä–µ–π—Ç—ã__

`Rust` –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –ª–∏—à—å –±–∞–∑–æ–≤—É—é –ø–æ–¥–¥–µ—Ä–∂–∫—É —Ç–µ—Å—Ç–æ–≤.

–í–æ—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ –∫—Ä–µ–π—Ç–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ –º–æ–≥—É—Ç –ø—Ä–∏–≥–æ–¥–∏—Ç—å—Å—è –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:

- [googletest](https://docs.rs/googletest) - –∫–æ–º–ø–ª–µ–∫—Å–Ω–∞—è –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –≤ –ª—É—á—à–∏—Ö —Ç—Ä–∞–¥–∏—Ü–∏—è—Ö `GoogleTest` –¥–ª—è `C++`
- [proptest](https://docs.rs/proptest) - –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –Ω–∞ –æ—Å–Ω–æ–≤–µ —Å–≤–æ–π—Å—Ç–≤ (properties)
- [rstest](https://docs.rs/rstest) - –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è, –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—â–∞—è —Ñ–∏–∫—Å—Ç—É—Ä—ã (fixtures) –∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã

__GoogleTest__

–ö—Ä–µ–π—Ç [googletest](https://docs.rs/googletest) –ø–æ–∑–≤–æ–ª—è–µ—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å –≥–∏–±–∫–∏–µ —Ç–µ—Å—Ç—ã —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º —Å–æ–ø–æ—Å—Ç–∞–≤–∏—Ç–µ–ª–µ–π (matchers):

```rust
use googletest::prelude::*;

#[googletest::test]
fn test_elements_are() {
    let value = vec!["foo", "bar", "baz"];
    expect_that!(value, elements_are!(eq("foo"), lt("xyz"), starts_with("b")));
}
```

–ï—Å–ª–∏ –º—ã –∏–∑–º–µ–Ω–∏–º `b` –Ω–∞  `!` –≤ –ø–æ—Å–ª–µ–¥–Ω–µ–º —ç–ª–µ–º–µ–Ω—Ç–µ, —Ç–µ—Å—Ç –ø—Ä–æ–≤–∞–ª–∏—Ç—Å—è —Å –≤—ã–¥–∞—á–µ–π —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–µ:

```
---- test_elements_are stdout ----
Value of: value
Expected: has elements:
  0. is equal to "foo"
  1. is less than "xyz"
  2. starts with prefix "!"
Actual: ["foo", "bar", "baz"],
  where element #2 is "baz", which does not start with "!"
  at src/testing/googletest.rs:6:5
Error: See failure output above
```

–†–µ–º–∞—Ä–∫–∏:

- –≤—ã–ø–æ–ª–Ω–∏—Ç–µ `cargo add googletest` –¥–ª—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏ `googletest`
- `use googletest::prelude::*;` –∏–º–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç –Ω–µ–∫–æ—Ç–æ—Ä—ã–µ [—á–∞—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –º–∞–∫—Ä–æ—Å—ã –∏ —Ç–∏–ø—ã](https://docs.rs/googletest/latest/googletest/prelude/index.html)
- `googletest` –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –±–æ–ª—å—à–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–æ–ø–æ—Å—Ç–∞–≤–∏—Ç–µ–ª–µ–π
- –ø—Ä–∏—è—Ç–Ω–æ–π –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç—å—é `googletest` —è–≤–ª—è–µ—Ç—Å—è —Ç–æ, —á—Ç–æ –Ω–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è –≤ –º–Ω–æ–≥–æ—Å—Ç—Ä–æ—á–Ω—ã—Ö —Å—Ç—Ä–æ–∫–∞—Ö –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –≤ –≤–∏–¥–µ —Ä–∞–∑–Ω–∏—Ü—ã:

```rust
#[test]
fn test_multiline_string_diff() {
    let haiku = "Memory safety found,\n\
                 Rust's strong typing guides the way,\n\
                 Secure code you'll write.";
    assert_that!(
        haiku,
        eq("Memory safety found,\n\
            Rust's silly humor guides the way,\n\
            Secure code you'll write.")
    );
}
```

–í—ã–≤–æ–¥ –±—É–¥–µ—Ç —Ü–≤–µ—Ç–Ω—ã–º:

```rust
    Value of: haiku
Expected: is equal to "Memory safety found,\nRust's silly humor guides the way,\nSecure code you'll write."
Actual: "Memory safety found,\nRust's strong typing guides the way,\nSecure code you'll write.",
  which isn't equal to "Memory safety found,\nRust's silly humor guides the way,\nSecure code you'll write."
Difference(-actual / +expected):
 Memory safety found,
-Rust's strong typing guides the way,
+Rust's silly humor guides the way,
 Secure code you'll write.
  at src/testing/googletest.rs:17:5=
```

__–ú–æ–∫–∏–Ω–≥__

–î–ª—è –º–æ–∫–∏–Ω–≥–∞ (mocking - —Å–æ–∑–¥–∞–Ω–∏–µ –º–∞–∫–µ—Ç–∞) —à–∏—Ä–æ–∫–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ [mockall](https://docs.rs/mockall/):

```rust
use std::time::Duration;

#[mockall::automock]
pub trait Pet {
    fn is_hungry(&self, since_last_meal: Duration) -> bool;
}

#[test]
fn test_robot_dog() {
    let mut mock_dog = MockPet::new();
    mock_dog.expect_is_hungry().return_const(true);
    assert_eq!(mock_dog.is_hungry(Duration::from_secs(10)), true);
}
```

–†–µ–º–∞—Ä–∫–∏:

- –¥–ª—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏ `mockall` –≤—ã–ø–æ–ª–Ω–∏—Ç–µ –∫–æ–º–∞–Ω–¥—É `cargo add mockall`
- –Ω–∞ [crates.io –¥–æ—Å—Ç—É–ø–Ω—ã –∏ –¥—Ä—É–≥–∏–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ –¥–ª—è –º–æ–∫–∏–Ω–≥–∞](https://crates.io/keywords/mock), –≤ —á–∞—Å—Ç–Ω–æ—Å—Ç–∏, –¥–ª—è –º–æ–∫–∏–Ω–≥–∞ HTTP-—Å–µ—Ä–≤–∏—Å–æ–≤. –î—Ä—É–≥–∏–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ —Ä–∞–±–æ—Ç–∞—é—Ç –∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ `Mockall`: –æ–Ω–∏ –ø–æ–∑–≤–æ–ª—è—é—Ç –ª–µ–≥–∫–æ –ø–æ–ª—É—á–∏—Ç—å –º–∞–∫–µ—Ç —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–≥–æ —Ç—Ä–µ–π—Ç–∞
- –æ–±—Ä–∞—Ç–∏—Ç–µ –≤–Ω–∏–º–∞–Ω–∏–µ, —á—Ç–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –º–∞–∫–µ—Ç–æ–≤ –Ω–µ—Å–∫–æ–ª—å–∫–æ –ø—Ä–æ—Ç–∏–≤–æ—Ä–µ—á–∏–≤–æ: –º–∞–∫–µ—Ç—ã –ø–æ–∑–≤–æ–ª—è—é—Ç –ø–æ–ª–Ω–æ—Å—Ç—å—é –∏–∑–æ–ª–∏—Ä–æ–≤–∞—Ç—å —Ç–µ—Å—Ç –æ—Ç –µ–≥–æ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π. –ù–µ–ø–æ—Å—Ä–µ–¥—Å—Ç–≤–µ–Ω–Ω—ã–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–º —è–≤–ª—è–µ—Ç—Å—è –±–æ–ª–µ–µ –±—ã—Å—Ç—Ä–æ–µ –∏ —Å—Ç–∞–±–∏–ª—å–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤. –° –¥—Ä—É–≥–æ–π —Å—Ç–æ—Ä–æ–Ω—ã, –º–∞–∫–µ—Ç—ã –º–æ–≥—É—Ç –±—ã—Ç—å –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ –∏ –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å –¥–∞–Ω–Ω—ã–µ, –æ—Ç–ª–∏—á–Ω—ã–µ –æ—Ç —Ç–æ–≥–æ, —á—Ç–æ –¥–µ–ª–∞–ª–∏ –±—ã —Ä–µ–∞–ª—å–Ω—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏. –ü–æ-–≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ —Å–ª–µ–¥—É–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ä–µ–∞–ª—å–Ω—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏. –ù–∞–ø—Ä–∏–º–µ—Ä, –º–Ω–æ–≥–∏–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –ø–æ–∑–≤–æ–ª—è—é—Ç –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å —Å–µ—Ä–≤–µ—Ä–Ω—É—é —á–∞—Å—Ç—å –≤ –ø–∞–º—è—Ç–∏ (in-memory backend). –≠—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ –º—ã –ø–æ–ª—É—á–∞–µ–º –ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤, –ø–ª—é—Å –æ–Ω–∏ —Ä–∞–±–æ—Ç–∞—é—Ç –±—ã—Å—Ç—Ä–æ –∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—á–∏—â–∞—é—Ç—Å—è. –ú–Ω–æ–≥–∏–µ –≤–µ–±-—Ñ—Ä–µ–π–º–≤–æ—Ä–∫–∏ –ø–æ–∑–≤–æ–ª—è—é—Ç –∑–∞–ø—É—Å–∫–∞—Ç—å –≤–Ω—É—Ç—Ä–∏–ø—Ä–æ—Ü–µ—Å—Å–Ω—ã–π —Å–µ—Ä–≤–µ—Ä, –∫–æ—Ç–æ—Ä—ã–π –ø—Ä–∏–≤—è–∑—ã–≤–∞–µ—Ç—Å—è –∫ –ø—Ä–æ–∏–∑–≤–æ–ª—å–Ω–æ–º—É –ø–æ—Ä—Ç—É –Ω–∞ –ª–æ–∫–∞–ª—å–Ω–æ–º —Ö–æ—Å—Ç–µ. –≠—Ç–æ—Ç –ø–æ–¥—Ö–æ–¥ —è–≤–ª—è–µ—Ç—Å—è –±–æ–ª–µ–µ –ø—Ä–µ–¥–ø–æ—á—Ç–∏—Ç–µ–ª—å–Ω—ã–º, —á–µ–º –º–æ–∫–∏–Ω–≥, –ø–æ—Å–∫–æ–ª—å–∫—É –ø–æ–∑–≤–æ–ª—è–µ—Ç —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –∫–æ–¥ –≤ —Ä–µ–∞–ª—å–Ω–æ–π —Å—Ä–µ–¥–µ
- `Mockall` –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –º–Ω–æ–≥–æ –ø–æ–ª–µ–∑–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π. –í —á–∞—Å—Ç–Ω–æ—Å—Ç–∏, –º—ã –º–æ–∂–µ–º –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –æ–∂–∏–¥–∞–Ω–∏—è (expectations), –∫–æ—Ç–æ—Ä—ã–µ –∑–∞–≤–∏—Å—è—Ç –æ—Ç –ø–µ—Ä–µ–¥–∞–Ω–Ω—ã—Ö –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤. –ó–¥–µ—Å—å –º—ã –∏—Å–ø–æ–ª—å–∑—É–µ–º —ç—Ç–æ, —á—Ç–æ–±—ã —Å–æ–∑–¥–∞—Ç—å –º–∞–∫–µ—Ç –∫–æ—à–∫–∏, –∫–æ—Ç–æ—Ä–∞—è –ø—Ä–æ–≥–æ–ª–æ–¥–∞–ª–∞—Å—å —á–µ—Ä–µ–∑ 3 —á–∞—Å–∞ –ø–æ—Å–ª–µ —Ç–æ–≥–æ, –∫–∞–∫ –µ–µ –≤ –ø–æ—Å–ª–µ–¥–Ω–∏–π —Ä–∞–∑ –ø–æ–∫–æ—Ä–º–∏–ª–∏:

```rust
#[test]
fn test_robot_cat() {
    let mut mock_cat = MockPet::new();
    mock_cat
        .expect_is_hungry()
        .with(mockall::predicate::gt(Duration::from_secs(3 * 3600)))
        .return_const(true);
    mock_cat.expect_is_hungry().return_const(false);
    assert_eq!(mock_cat.is_hungry(Duration::from_secs(1 * 3600)), false);
    assert_eq!(mock_cat.is_hungry(Duration::from_secs(5 * 3600)), true);
}
```

- –º—ã –º–æ–∂–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `.times(n)`, —á—Ç–æ–±—ã –æ–≥—Ä–∞–Ω–∏—á–∏—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤—ã–∑–æ–≤–æ–≤ —Ñ–∏–∫—Ç–∏–≤–Ω–æ–≥–æ –º–µ—Ç–æ–¥–∞ –¥–æ `n` - –ø—Ä–∏ –ø—Ä–µ–≤—ã—à–µ–Ω–∏–∏ —ç—Ç–æ–≥–æ –ª–∏–º–∏—Ç–∞ –ø—Ä–æ–≥—Ä–∞–º–º–∞ –∑–∞–ø–∞–Ω–∏–∫—É–µ—Ç

__–õ–∏–Ω—Ç–µ—Ä –∏ Clippy__

–ö–æ–º–ø–∏–ª—è—Ç–æ—Ä `Rust` –≤—ã–¥–∞–µ—Ç —Ñ–∞–Ω—Ç–∞—Å—Ç–∏—á–µ—Å–∫–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö, –∞ —Ç–∞–∫–∂–µ –ø–æ–ª–µ–∑–Ω—ã–µ –ø–æ–¥—Å–∫–∞–∑–∫–∏ (lints). [Clippy](https://doc.rust-lang.org/clippy/) –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –µ—â–µ –±–æ–ª—å—à–µ –ø–æ–¥—Å–∫–∞–∑–æ–∫, –æ—Ä–≥–∞–Ω–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö –≤ –≥—Ä—É–ø–ø—ã, –∫–æ—Ç–æ—Ä—ã–µ –º–æ–∂–Ω–æ –≤–∫–ª—é—á–∞—Ç—å/–≤—ã–∫–ª—é—á–∞—Ç—å –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞.

```rust
#[deny(clippy::cast_possible_truncation)]
fn main() {
    let x = 3;
    while (x < 70000) {
        x *= 2;
    }
    println!("X –ø–æ–º–µ—â–∞–µ—Ç—Å—è –≤ u16, –≤–µ—Ä–Ω–æ? {}", x as u16);
}
```

__–£–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ: –∞–ª–≥–æ—Ä–∏—Ç–º –õ—É–Ω–∞__

[–ê–ª–≥–æ—Ä–∏—Ç–º –õ—É–Ω–∞](https://en.wikipedia.org/wiki/Luhn_algorithm) –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–æ–º–µ—Ä–æ–≤ –∫—Ä–µ–¥–∏—Ç–Ω—ã—Ö –∫–∞—Ä—Ç. –ê–ª–≥–æ—Ä–∏—Ç–º –ø—Ä–∏–Ω–∏–º–∞–µ—Ç —Å—Ç—Ä–æ–∫—É –Ω–∞ –≤—Ö–æ–¥ –∏ –≤—ã–ø–æ–ª–Ω—è–µ—Ç —Å–ª–µ–¥—É—é—â–∏–µ –¥–µ–π—Å—Ç–≤–∏—è:

- –∏–≥–Ω–æ—Ä–∏—Ä—É–µ–º –≤—Å–µ –ø—Ä–æ–±–µ–ª—ã
- –æ—Ç–∫–ª–æ–Ω—è–µ–º –Ω–æ–º–µ—Ä–∞, —Å–æ–¥–µ—Ä–∂–∞—â–∏–µ –º–µ–Ω–µ–µ –¥–≤—É—Ö —Ü–∏—Ñ—Ä
- –¥–≤–∏–≥–∞—è—Å—å —Å–ø—Ä–∞–≤–∞ –Ω–∞–ª–µ–≤–æ, —É–¥–≤–∞–∏–≤–∞–µ–º –∫–∞–∂–¥—É—é –≤—Ç–æ—Ä—É—é —Ü–∏—Ñ—Ä—É: –¥–ª—è —á–∏—Å–ª–∞ 1234 —É–¥–≤–∞–∏–≤–∞–µ–º 3 –∏ 1, –¥–ª—è —á–∏—Å–ª–∞ 98765 —É–¥–≤–∞–∏–≤–∞–µ–º 6 –∏ 8
- –ø–æ—Å–ª–µ —É–¥–≤–æ–µ–Ω–∏—è —Ü–∏—Ñ—Ä—ã —Å—É–º–º–∏—Ä—É–µ–º —Ü–∏—Ñ—Ä—ã, –µ—Å–ª–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç –±–æ–ª—å—à–µ 9. –¢–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º, —É–¥–≤–æ–µ–Ω–∏–µ 7 –¥–∞–µ—Ç 14, —á—Ç–æ –¥–∞–µ—Ç 1 + 4 = 5
- —Å—É–º–º–∏—Ä—É–µ–º –≤—Å–µ –Ω–µ—É–¥–≤–æ–µ–Ω–Ω—ã–µ –∏ —É–¥–≤–æ–µ–Ω–Ω—ã–µ —Ü–∏—Ñ—Ä—ã
- –Ω–æ–º–µ—Ä –∫—Ä–µ–¥–∏—Ç–Ω–æ–π –∫–∞—Ä—Ç—ã –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª–µ–Ω, –µ—Å–ª–∏ —Å—É–º–º–∞ –∑–∞–∫–∞–Ω—á–∏–≤–∞–µ—Ç—Å—è –Ω–∞ 0

–ü—Ä–∏–≤–µ–¥–µ–Ω–Ω—ã–π –∫–æ–¥ —Å–æ–¥–µ—Ä–∂–∏—Ç –æ—à–∏–±–æ—á–Ω—É—é —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é –∞–ª–≥–æ—Ä–∏—Ç–º–∞ –õ—É–Ω–∞, –∞ —Ç–∞–∫–∂–µ –¥–≤–∞ –º–æ–¥—É–ª—å–Ω—ã—Ö —Ç–µ—Å—Ç–∞, –∫–æ—Ç–æ—Ä—ã–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞—é—Ç, —á—Ç–æ –±–æ–ª—å—à–∞—è —á–∞—Å—Ç—å –∞–ª–≥–æ—Ä–∏—Ç–º–∞ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –ø—Ä–∞–≤–∏–ª—å–Ω–æ:

```rust
pub fn luhn(cc_number: &str) -> bool {
    let mut sum = 0;
    let mut double = false;

    for c in cc_number.chars().rev() {
        if let Some(digit) = c.to_digit(10) {
            if double {
                let double_digit = digit * 2;
                sum +=
                    if double_digit > 9 { double_digit - 9 } else { double_digit };
            } else {
                sum += digit;
            }
            double = !double;
        } else {
            continue;
        }
    }

    sum % 10 == 0
}

fn main() {
    let cc_number = "1234 5678 1234 5670";
    println!(
        "{cc_number} —è–≤–ª—è–µ—Ç—Å—è –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã–º –Ω–æ–º–µ—Ä–æ–º –∫—Ä–µ–¥–∏—Ç–Ω–æ–π –∫–∞—Ä—Ç—ã? {}",
        if luhn(cc_number) { "–î–∞" } else { "–ù–µ—Ç" }
    );
}

#[cfg(test)]
mod test {
    use super::*;

    #[test]
    fn test_valid_cc_number() {
        assert!(luhn("4263 9826 4026 9299"));
        assert!(luhn("4539 3195 0343 6467"));
        assert!(luhn("7992 7398 713"));
    }

    #[test]
    fn test_invalid_cc_number() {
        assert!(!luhn("4223 9826 4026 9299"));
        assert!(!luhn("4539 3195 0343 6476"));
        assert!(!luhn("8273 1232 7352 0569"));
    }

    #[test]
    fn test_non_digit_cc_number() {
        assert!(!luhn("foo"));
        assert!(!luhn("foo 0 0"));
    }

    #[test]
    fn test_empty_cc_number() {
        assert!(!luhn(""));
        assert!(!luhn(" "));
        assert!(!luhn("  "));
        assert!(!luhn("    "));
    }

    #[test]
    fn test_single_digit_cc_number() {
        assert!(!luhn("0"));
    }

    #[test]
    fn test_two_digit_cc_number() {
        assert!(luhn(" 0 0 "));
    }
}
```

<details>
<summary>–†–µ—à–µ–Ω–∏–µ:</summary>

```rust
pub fn luhn(cc_number: &str) -> bool {
    // –ò—Ç–æ–≥–æ–≤–∞—è —Å—É–º–º–∞ —Ü–∏—Ñ—Ä
    let mut sum = 0;
    // –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ —É–¥–≤–æ–µ–Ω–∏—è —Ü–∏—Ñ—Ä—ã
    let mut double = false;
    // –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ü–∏—Ñ—Ä
    let mut digits = 0;

    // –ü–µ—Ä–µ–±–∏—Ä–∞–µ–º —Ü–∏—Ñ—Ä—ã —Å–ø—Ä–∞–≤–∞ –Ω–∞–ª–µ–≤–æ
    for c in cc_number.chars().rev() {
        // –ï—Å–ª–∏ —Å–∏–º–≤–æ–ª —è–≤–ª—è–µ—Ç—Å—è –≤–∞–ª–∏–¥–Ω—ã–º –¥–µ—Å—è—Ç–∏—á–Ω—ã–º —á–∏—Å–ª–æ–º
        if let Some(digit) = c.to_digit(10) {
            // –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ü–∏—Ñ—Ä
            digits += 1;
            // –ï—Å–ª–∏ —Ü–∏—Ñ—Ä—É –Ω—É–∂–Ω–æ —É–¥–≤–æ–∏—Ç—å
            if double {
                let double_digit = digit * 2;
                // –ï—Å–ª–∏ —É–¥–≤–æ–µ–Ω–Ω–∞—è —Ü–∏—Ñ—Ä–∞ –±–æ–ª—å—à–µ 9, –≤—ã—á–∏—Ç–∞–µ–º –∏–∑ –Ω–µ–µ 9:
                // –µ—Å–ª–∏ –ø–æ–ª—É—á–∏–ª–∏ 14, —Ç–æ 1 + 4 = 5, —á—Ç–æ —ç–∫–≤–∏–≤–∞–ª–µ–Ω—Ç–Ω–æ 14 - 9 = 5
                sum +=
                    if double_digit > 9 { double_digit - 9 } else { double_digit };
            // –ò–Ω–∞—á–µ –ø—Ä–æ—Å—Ç–æ –¥–æ–±–∞–≤–ª—è–µ–º —Ü–∏—Ñ—Ä—É –∫ —Å—É–º–º–µ
            } else {
                sum += digit;
            }
            // –£–¥–≤–∞–∏–≤–∞–µ–º –∫–∞–∂–¥—É—é –≤—Ç–æ—Ä—É—é —Ü–∏—Ñ—Ä—É
            double = !double;
        // –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –ø—Ä–æ–±–µ–ª—ã
        } else if c.is_whitespace() {
            continue;
        // –ï—Å–ª–∏ —Å—Ç—Ä–æ–∫–∞ —Å–æ–¥–µ—Ä–∂–∏—Ç —Å–∏–º–≤–æ–ª, –æ—Ç–ª–∏—á–∞—é—â–∏–π—Å—è –æ—Ç —Ü–∏—Ñ—Ä—ã –∏ –ø—Ä–æ–±–µ–ª–∞
        } else {
            return false;
        }
    }

    // –¶–∏—Ñ—Ä –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –±–æ–ª—å—à–µ –¥–≤—É—Ö –∏ —Å—É–º–º–∞ –¥–æ–ª–∂–Ω–∞ –∑–∞–∫–∞–Ω—á–∏–≤–∞—Ç—å—Å—è –Ω–∞ 0
    digits >= 2 && sum % 10 == 0
}
```

</details>

## –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

__–ü–∞–Ω–∏–∫–∞__

–§–∞—Ç–∞–ª—å–Ω—ã–µ –æ—à–∏–±–∫–∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è –≤ `Rust` —Å –ø–æ–º–æ—â—å—é "–ø–∞–Ω–∏–∫–∏" (panic).

–ü–∞–Ω–∏–∫–∞ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ø—Ä–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–∏ —Ñ–∞—Ç–∞–ª—å–Ω–æ–π –æ—à–∏–±–∫–∏ –≤–æ –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:

```rust
fn main() {
    let v = vec![10, 20, 30];
    println!("v[100]: {}", v[100]);
}
```

–†–µ–º–∞—Ä–∫–∏:

- –ø–∞–Ω–∏–∫–∞ —Å–≤—è–∑–∞–Ω–∞ —Å –Ω–µ–∏—Å–ø—Ä–∞–≤–∏–º—ã–º–∏ –∏ –Ω–µ–æ–∂–∏–¥–∞–Ω–Ω—ã–º–∏ –æ—à–∏–±–∫–∞–º–∏:
  - –ø–∞–Ω–∏–∫–∞ - —ç—Ç–æ —Å–∏–º–ø—Ç–æ–º—ã –æ—à–∏–±–æ–∫ –≤ –ø—Ä–æ–≥—Ä–∞–º–º–µ
  - —Å–±–æ–∏ –≤–æ –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è, —Ç–∞–∫–∏–µ –∫–∞–∫ –Ω–µ—É–¥–∞—á–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –≥—Ä–∞–Ω–∏—Ü (boundaries), –º–æ–≥—É—Ç –≤—ã–∑–≤–∞—Ç—å –ø–∞–Ω–∏–∫—É
  - —É—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è (–Ω–∞–ø—Ä–∏–º–µ—Ä, `assert!`) –ø–∞–Ω–∏–∫—É—é—Ç –ø—Ä–∏ –Ω–µ—É–¥–∞—á–µ
  - –¥–ª—è —Ü–µ–ª–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–Ω–æ–π –ø–∞–Ω–∏–∫–∏ –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –º–∞–∫—Ä–æ—Å `panic!`
- –ø–∞–Ω–∏–∫–∞ "—Ä–∞–∑–º–∞—Ç—ã–≤–∞–µ—Ç" (unwind) —Å—Ç–µ–∫, —Å–±—Ä–∞—Å—ã–≤–∞—è –∑–Ω–∞—á–µ–Ω–∏—è —Ç–∞–∫ –∂–µ, –∫–∞–∫ –µ—Å–ª–∏ –±—ã —Ñ—É–Ω–∫—Ü–∏–∏ –≤–µ—Ä–Ω—É–ª–∏ –∑–Ω–∞—á–µ–Ω–∏—è
- –≤ –ø—Ä–∏–º–µ—Ä–µ –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞ –∫ —ç–ª–µ–º–µ–Ω—Ç—É –≤–µ–∫—Ç–æ—Ä–∞ –ø–æ –∏–Ω–¥–µ–∫—Å—É –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `Vec::get`

–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –ø–∞–Ω–∏–∫–∞ —Ä–∞–∑–º–∞—Ç—ã–≤–∞–µ—Ç —Å—Ç–µ–∫. –†–∞–∑–º–∞—Ç—ã–≤–∞–Ω–∏–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø–µ—Ä–µ—Ö–≤–∞—á–µ–Ω–æ:

```rust
use std::panic;

fn main() {
    let result = panic::catch_unwind(|| "No problem here!");
    println!("{result:?}");

    let result = panic::catch_unwind(|| {
        panic!("Oh no!");
    });
    println!("{result:?}");
}
```

- –ù–µ –ø—ã—Ç–∞–π—Ç–µ—Å—å —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –∏—Å–∫–ª—é—á–µ–Ω–∏—è —Å –ø–æ–º–æ—â—å—é `catch_unwind`
- —ç—Ç–æ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø–æ–ª–µ–∑–Ω–æ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–∞—Ö, –∫–æ—Ç–æ—Ä—ã–µ –¥–æ–ª–∂–Ω—ã –ø—Ä–æ–¥–æ–ª–∂–∞—Ç—å —Ä–∞–±–æ—Ç–∞—Ç—å –¥–∞–∂–µ –≤ —Å–ª—É—á–∞–µ —Å–±–æ—è –æ–¥–Ω–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞
- —ç—Ç–æ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –ø—Ä–∏ —É—Å—Ç–∞–Ω–æ–≤–∫–µ `panic = 'abort'` –≤ `Cargo.toml`

__–û–ø–µ—Ä–∞—Ç–æ—Ä ?__

–û—à–∏–±–∫–∏ –≤—Ä–µ–º–µ–Ω–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è, —Ç–∞–∫–∏–µ –∫–∞–∫ –æ—Ç–∫–∞–∑ –≤ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–∏ –∏–ª–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ —Ñ–∞–π–ª–∞, –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è —Å –ø–æ–º–æ—â—å—é —Ç–∏–ø–∞ `Result`, –Ω–æ —Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ (matching) —ç—Ç–æ–≥–æ —Ç–∏–ø–∞ –ø—Ä–∏ –∫–∞–∂–¥–æ–º –≤—ã–∑–æ–≤–µ –º–æ–∂–µ—Ç –±—ã—Ç—å —É—Ç–æ–º–∏—Ç–µ–ª—å–Ω—ã–º –∏ –∏–∑–ª–∏—à–Ω–∏–º. –û–ø–µ—Ä–∞—Ç–æ—Ä `?` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –≤–æ–∑–≤—Ä–∞—Ç–∞ –æ—à–∏–±–æ–∫ –≤—ã–∑—ã–≤–∞—é—â–µ–º—É (caller). –û–Ω –ø–æ–∑–≤–æ–ª—è–µ—Ç –∑–∞–º–µ–Ω–∏—Ç—å

```rust
match some_expression {
    Ok(value) => value,
    Err(err) => return Err(err),
}
```

–Ω–∞

```rust
some_expression?
```

–ü–æ–ø—Ä–æ–±—É–π—Ç–µ —É–ø—Ä–æ—Å—Ç–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–æ–∫ –≤ —Å–ª–µ–¥—É—é—â–µ–º –∫–æ–¥–µ:

```rust
use std::io::Read;
use std::{fs, io};

fn read_username(path: &str) -> Result<String, io::Error> {
    let username_file_result = fs::File::open(path);
    let mut username_file = match username_file_result {
        Ok(file) => file,
        Err(err) => return Err(err),
    };

    let mut username = String::new();
    match username_file.read_to_string(&mut username) {
        Ok(_) => Ok(username),
        Err(err) => Err(err),
    }
}

fn main() {
    // fs::write("config.dat", "alice").unwrap();
    let username = read_username("config.dat");
    println!("username or error: {username:?}");
}
```

–ü–æ–¥—Å–∫–∞–∑–∫–∏:

- –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è `username` –º–æ–∂–µ—Ç –±—ã—Ç—å –ª–∏–±–æ `Ok(String)`, –ª–∏–±–æ `Err(error)`
- –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `fs::write` –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Ä–∞–∑–Ω—ã—Ö —Å–ª—É—á–∞–µ–≤: –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ —Ñ–∞–π–ª–∞, –ø—É—Å—Ç–æ–π —Ñ–∞–π–ª, —Ñ–∞–π–ª —Å –∏–º–µ–Ω–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- –æ–±—Ä–∞—Ç–∏—Ç–µ –≤–Ω–∏–º–∞–Ω–∏–µ, —á—Ç–æ `main` –º–æ–∂–µ—Ç –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å `Result<(), E>` –¥–æ —Ç–µ—Ö –ø–æ—Ä, –ø–æ–∫–∞ —Ä–µ–∞–ª–∏–∑—É–µ—Ç `std::process:Termination`. –ù–∞ –ø—Ä–∞–∫—Ç–∏–∫–µ —ç—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ `E` —Ä–µ–∞–ª–∏–∑—É–µ—Ç `Debug`. –ò—Å–ø–æ–ª–Ω—è–µ–º—ã–π —Ñ–∞–π–ª –Ω–∞–ø–µ—á–∞—Ç–∞–µ—Ç –≤–∞—Ä–∏–∞–Ω—Ç `Err` –∏ –≤–µ—Ä–Ω–µ—Ç –Ω–µ–Ω—É–ª–µ–≤–æ–π —Å—Ç–∞—Ç—É—Å –≤—ã—Ö–æ–¥–∞ –≤ —Å–ª—É—á–∞–µ –æ—à–∏–±–∫–∏

__–ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è Try__

–û–ø–µ—Ä–∞—Ç–æ—Ä `?` —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–µ–º–Ω–æ–≥–æ —Å–ª–æ–∂–Ω–µ–µ, —á–µ–º –º–æ–∂–Ω–æ –ø–æ–¥—É–º–∞—Ç—å.

–≠—Ç–æ:

```rust
expression?
```

–≠–∫–≤–∏–≤–∞–ª–µ–Ω—Ç–Ω–æ —ç—Ç–æ–º—É:

```rust
match expression {
    Ok(value) => value,
    Err(err)  => return Err(From::from(err)),
}
```

–í—ã–∑–æ–≤ `From::from` –∑–¥–µ—Å—å –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ –º—ã –ø—ã—Ç–∞–µ–º—Å—è –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞—Ç—å —Ç–∏–ø –æ—à–∏–±–∫–∏ –≤ —Ç–∏–ø, –≤–æ–∑–≤—Ä–∞—â–∞–µ–º—ã–π —Ñ—É–Ω–∫—Ü–∏–µ–π. –≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –ª–µ–≥–∫–æ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞—Ç—å –ª–æ–∫–∞–ª—å–Ω—ã–µ –æ—à–∏–±–∫–∏ –≤ –æ—à–∏–±–∫–∏ –±–æ–ª–µ–µ –≤—ã—Å–æ–∫–æ–≥–æ —É—Ä–æ–≤–Ω—è.

_–ü—Ä–∏–º–µ—Ä_

```rust
use std::error::Error;
use std::fmt::{self, Display, Formatter};
use std::fs::File;
use std::io::{self, Read};

#[derive(Debug)]
enum ReadUsernameError {
    IoError(io::Error),
    EmptyUsername(String),
}

impl Error for ReadUsernameError {}

impl Display for ReadUsernameError {
    fn fmt(&self, f: &mut Formatter) -> fmt::Result {
        match self {
            Self::IoError(e) => write!(f, "–û—à–∏–±–∫–∞ –≤–≤–æ–¥–∞/–≤—ã–≤–æ–¥–∞: {e}"),
            Self::EmptyUsername(path) => write!(f, "–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –≤ {path}"),
        }
    }
}

impl From<io::Error> for ReadUsernameError {
    fn from(err: io::Error) -> Self {
        Self::IoError(err)
    }
}

fn read_username(path: &str) -> Result<String, ReadUsernameError> {
    let mut username = String::with_capacity(100);
    File::open(path)?.read_to_string(&mut username)?;
    if username.is_empty() {
        return Err(ReadUsernameError::EmptyUsername(String::from(path)));
    }
    Ok(username)
}

fn main() {
    // fs::write("config.dat", "").unwrap();
    let username = read_username("config.dat");
    println!("–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–ª–∏ –æ—à–∏–±–∫–∞: {username:?}");
}
```

–û–ø–µ—Ä–∞—Ç–æ—Ä `?` –¥–æ–ª–∂–µ–Ω –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å –∑–Ω–∞—á–µ–Ω–∏–µ, —Å–æ–≤–º–µ—Å—Ç–∏–º–æ–µ —Å —Ç–∏–ø–æ–º –∑–Ω–∞—á–µ–Ω–∏—è, –≤–æ–∑–≤—Ä–∞—â–∞–µ–º–æ–≥–æ —Ñ—É–Ω–∫—Ü–∏–µ–π. –î–ª—è `Result` —ç—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ —Ç–∏–ø—ã –æ—à–∏–±–æ–∫ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —Å–æ–≤–º–µ—Å—Ç–∏–º—ã–º–∏. –§—É–Ω–∫—Ü–∏—è, –≤–æ–∑–≤—Ä–∞—â–∞—é—â–∞—è `Result<T, ErrorOuter>`, –º–æ–∂–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `?` —Ç–æ–ª—å–∫–æ –¥–ª—è –∑–Ω–∞—á–µ–Ω–∏—è —Ç–∏–ø–∞ `Result<U, ErrorInner>`, –µ—Å–ª–∏ `ErrorOuter` –∏ `ErrorInner` –∏–º–µ—é—Ç –æ–¥–∏–Ω –∏ —Ç–æ—Ç –∂–µ —Ç–∏–ø, –∏–ª–∏ –µ—Å–ª–∏ `ErrorOuter` —Ä–µ–∞–ª–∏–∑—É–µ—Ç `From<ErrorInner>`.

–†–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω–µ–Ω–Ω–æ–π –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–æ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ `From` —è–≤–ª—è–µ—Ç—Å—è `Result::map_err`, –æ—Å–æ–±–µ–Ω–Ω–æ –∫–æ–≥–¥–∞ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç —Ç–æ–ª—å–∫–æ –≤ –æ–¥–Ω–æ–º –º–µ—Å—Ç–µ.

–î–ª—è `Option` –Ω–µ—Ç —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏. –§—É–Ω–∫—Ü–∏—è, –≤–æ–∑–≤—Ä–∞—â–∞—é—â–∞—è `Option<T>`, –º–æ–∂–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –æ–ø–µ—Ä–∞—Ç–æ—Ä `?` –Ω–∞ `Option<U>` –¥–ª—è –ø—Ä–æ–∏–∑–≤–æ–ª—å–Ω—ã—Ö —Ç–∏–ø–æ–≤ `T` –∏ `U`.

–§—É–Ω–∫—Ü–∏—è, –≤–æ–∑–≤—Ä–∞—â–∞—é—â–∞—è `Result`, –Ω–µ –º–æ–∂–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `?` –Ω–∞ `Option`, –∏ –Ω–∞–æ–±–æ—Ä–æ—Ç. –û–¥–Ω–∞–∫–æ, `Option::ok_or` –ø—Ä–µ–æ–±—Ä–∞–∑—É–µ—Ç `Option` –≤ `Result`, –∞ `Result::ok` - `Result` –≤ `Option`.

__–î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ —Ç–∏–ø—ã –æ—à–∏–±–æ–∫__

–ò–Ω–æ–≥–¥–∞ –º—ã —Ö–æ—Ç–∏–º –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å –ª—é–±–æ–π —Ç–∏–ø –æ—à–∏–±–∫–∏ –±–µ–∑ —Å–æ–∑–¥–∞–Ω–∏—è –ø–µ—Ä–µ—á–∏—Å–ª–µ–Ω–∏—è, –æ—Ö–≤–∞—Ç—ã–≤–∞—é—â–µ–≥–æ –≤—Å–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã. –¢—Ä–µ–π—Ç `std::error::Error` –ø–æ–∑–≤–æ–ª—è–µ—Ç –ª–µ–≥–∫–æ —Å–æ–∑–¥–∞—Ç—å —Ç—Ä–µ–π—Ç-–æ–±—ä–µ–∫—Ç, –∫–æ—Ç–æ—Ä—ã–π –º–æ–∂–µ—Ç —Å–æ–¥–µ—Ä–∂–∞—Ç—å –ª—é–±—É—é –æ—à–∏–±–∫—É:

```rust
use std::error::Error;
use std::fs;
use std::io::Read;

fn read_count(path: &str) -> Result<i32, Box<dyn Error>> {
    let mut count_str = String::new();
    fs::File::open(path)?.read_to_string(&mut count_str)?;
    let count: i32 = count_str.parse()?;
    Ok(count)
}

fn main() {
    fs::write("count.dat", "1i3").unwrap();
    match read_count("count.dat") {
        Ok(count) => println!("–°–æ–¥–µ—Ä–∂–∏–º–æ–µ: {count}"),
        Err(err) => println!("–û—à–∏–±–∫–∞: {err}"),
    }
}
```

–§—É–Ω–∫—Ü–∏—è `read_count` –º–æ–∂–µ—Ç –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å `std::io::Error` (–∏–∑ –æ–ø–µ—Ä–∞—Ü–∏–π —Å —Ñ–∞–π–ª–æ–º) –∏–ª–∏ `std::num::ParseIntError` (–∏–∑ `String::parse`).

–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏—Ö (boxing) –æ—à–∏–±–æ–∫ —Å–æ–∫—Ä–∞—â–∞–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–æ–¥–∞, –Ω–æ –ª–∏—à–∞–µ—Ç –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –ø–æ-—Ä–∞–∑–Ω–æ–º—É –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å —Ä–∞–∑–Ω—ã–µ –æ—à–∏–±–∫–∏. –ü–æ—ç—Ç–æ–º—É –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `Box<dyn Error>` –≤ –æ–±—â–µ–¥–æ—Å—Ç—É–ø–Ω–æ–º API –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ –Ω–µ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è, –Ω–æ —ç—Ç–æ –º–æ–∂–µ—Ç –±—ã—Ç—å —Ö–æ—Ä–æ—à–∏–º –≤–∞—Ä–∏–∞–Ω—Ç–æ–º, –∫–æ–≥–¥–∞ –º—ã –ø—Ä–æ—Å—Ç–æ —Ö–æ—Ç–∏–º –≥–¥–µ-—Ç–æ –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ.

–ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∫–∞—Å—Ç–æ–º–Ω—ã—Ö —Ç–∏–ø–æ–≤ –æ—à–∏–±–æ–∫ —É–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –æ–Ω–∏ —Ä–µ–∞–ª–∏–∑—É—é—Ç `std::error::Error`, —á—Ç–æ–±—ã –∏—Ö –º–æ–∂–Ω–æ –±—ã–ª–æ –æ–±–æ—Ä–∞—á–∏–≤–∞—Ç—å –≤ `Box`.

__thiserror –∏ anyhow__

–ö—Ä–µ–π—Ç—ã [thiserror](https://docs.rs/thiserror/) –∏ [anyhow](https://docs.rs/anyhow/) —à–∏—Ä–æ–∫–æ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –¥–ª—è —É–ø—Ä–æ—â–µ–Ω–∏—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫. `thiserror` –ø–æ–º–æ–≥–∞–µ—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å –∫–∞—Å—Ç–æ–º–Ω—ã–µ —Ç–∏–ø—ã –æ—à–∏–±–æ–∫, —Ä–µ–∞–ª–∏–∑—É—é—â–∏–µ `From<T>`. `anyhow` –ø–æ–º–æ–≥–∞–µ—Ç —Å –æ–±—Ä–∞–±–æ—Ç–∫–æ–π –æ—à–∏–±–æ–∫ –≤ —Ñ—É–Ω–∫—Ü–∏—è—Ö, –≤–∫–ª—é—á–∞—è –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç—É–∞–ª—å–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –≤ –æ—à–∏–±–∫–∏.

```rust
use anyhow::{bail, Context, Result};
use std::fs;
use std::io::Read;
use thiserror::Error;

#[derive(Clone, Debug, Eq, Error, PartialEq)]
#[error("–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –≤ {0}")]
struct EmptyUsernameError(String);

fn read_username(path: &str) -> Result<String> {
    let mut username = String::with_capacity(100);
    fs::File::open(path)
        .with_context(|| format!("–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ {path}"))?
        .read_to_string(&mut username)
        .context("–û—à–∏–±–∫–∞ –ø—Ä–∏ —á—Ç–µ–Ω–∏–∏")?;
    if username.is_empty() {
        bail!(EmptyUsernameError(path.to_string()));
    }
    Ok(username)
}

fn main() {
    // fs::write("config.dat", "").unwrap();
    match read_username("config.dat") {
        Ok(username) => println!("–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: {username}"),
        Err(err) => println!("–û—à–∏–±–∫–∞: {err:?}"),
    }
}
```

`thiserror`:

- –º–∞–∫—Ä–æ—Å `error` –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç—Å—è `thiserror` –∏ —Å–æ–¥–µ—Ä–∂–∏—Ç –±–æ–ª—å—à–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∞—Ç—Ä–∏–±—É—Ç–æ–≤ –¥–ª—è –ª–∞–∫–æ–Ω–∏—á–Ω–æ–≥–æ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Ç–∏–ø–æ–≤ –æ—à–∏–±–æ–∫
- —Ç—Ä–µ–π—Ç `std::error::Error` —Ä–µ–∞–ª–∏–∑—É–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
- —Å–æ–æ–±—â–µ–Ω–∏–µ –∏–∑ `#[error]` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ —Ç—Ä–µ–π—Ç–∞ `Display`

`anyhow`:

- `anyhow::Error` - —ç—Ç–æ –æ–±–µ—Ä—Ç–∫–∞ –Ω–∞–¥ `Box<dyn Error>`. –û–ø—è—Ç—å –∂–µ —ç—Ç–æ –Ω–µ –ª—É—á—à–∏–π –≤—ã–±–æ—Ä –¥–ª—è –æ–±—â–µ–¥–æ—Å—Ç—É–ø–Ω–æ–≥–æ API –±–∏–±–ª–∏–æ—Ç–µ–∫–∏, –Ω–æ –æ–Ω —à–∏—Ä–æ–∫–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è—Ö
- `anyhow::Result<V>` - —ç—Ç–æ —Å–∏–Ω–æ–Ω–∏–º —Ç–∏–ø–∞ `Result<V, anyhow::Error>`
- –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–∏–π —Ç–∏–ø –æ—à–∏–±–∫–∏ –≤–Ω—É—Ç—Ä–∏ –Ω–µ–≥–æ –º–æ–∂–Ω–æ –∏–∑–≤–ª–µ—á—å –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏
- `anyhow::Context` - —ç—Ç–æ —Ç—Ä–µ–π—Ç, —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π –¥–ª—è —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã—Ö —Ç–∏–ø–æ–≤ `Result` –∏ `Option`. `use anyhow::Context` –Ω–µ–æ–±—Ö–æ–¥–∏–º –¥–ª—è –≤–∫–ª—é—á–µ–Ω–∏—è `.context()` –∏ `.with_context()` –Ω–∞ —ç—Ç–∏—Ö —Ç–∏–ø–∞—Ö

__–£–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ: –±–µ–∑ –ø–∞–Ω–∏–∫–∏__

–°–ª–µ–¥—É—é—â–∏–π –∫–æ–¥ —Ä–µ–∞–ª–∏–∑—É–µ—Ç –æ—á–µ–Ω—å –ø—Ä–æ—Å—Ç–æ–π —Å–∏–Ω—Ç–∞–∫—Å–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä —è–∑—ã–∫–∞ –≤—ã—Ä–∞–∂–µ–Ω–∏–π. –û–¥–Ω–∞–∫–æ –æ–Ω –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –æ—à–∏–±–∫–∏ –ø—É—Ç–µ–º –ø–∞–Ω–∏–∫–∏. –ü–µ—Ä–µ–ø–∏—à–∏—Ç–µ –µ–≥–æ, —á—Ç–æ–±—ã –≤–º–µ—Å—Ç–æ —ç—Ç–æ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∏–¥–∏–æ–º–∞—Ç–∏—á–µ—Å–∫—É—é –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–æ–∫ –∏ —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω—è—Ç—å –æ—à–∏–±–∫–∏ –Ω–∞ –≤–æ–∑–≤—Ä–∞—Ç –∏–∑ `main`. –ù–µ —Å—Ç–µ—Å–Ω—è–π—Ç–µ—Å—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `thiserror` –∏ `anyhow`.

–ü–æ–¥—Å–∫–∞–∑–∫–∞: –Ω–∞—á–Ω–∏—Ç–µ –∏—Å–ø—Ä–∞–≤–ª—è—Ç—å –æ—à–∏–±–∫–∏ –≤ —Ñ—É–Ω–∫—Ü–∏–∏ `parse`. –ü–æ—Å–ª–µ —Ç–æ–≥–æ, –∫–∞–∫ –æ–Ω–∞ –∑–∞—Ä–∞–±–æ—Ç–∞–µ—Ç, –æ–±–Ω–æ–≤–∏—Ç–µ `Tokenizer` –¥–ª—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ `Iterator<Item=Result<Token, TokenizerError>>` –∏ –æ–±—Ä–∞–±–æ—Ç–∞–π—Ç–µ –µ–≥–æ –≤ –ø–∞—Ä—Å–µ—Ä–µ.

```rust
use std::iter::Peekable;
use std::str::Chars;

// –ê—Ä–∏—Ñ–º–µ—Ç–∏—á–µ—Å–∫–∏–π –æ–ø–µ—Ä–∞—Ç–æ—Ä
#[derive(Debug, PartialEq, Clone, Copy)]
enum Op {
    Add,
    Sub,
}

// –¢–æ–∫–µ–Ω —è–∑—ã–∫–∞
#[derive(Debug, PartialEq)]
enum Token {
    Number(String),
    Identifier(String),
    Operator(Op),
}

// –í—ã—Ä–∞–∂–µ–Ω–∏–µ —è–∑—ã–∫–∞
#[derive(Debug, PartialEq)]
enum Expression {
    // –°—Å—ã–ª–∫–∞ –Ω–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é
    Var(String),
    // –õ–∏—Ç–µ—Ä–∞–ª—å–Ω–æ–µ —á–∏—Å–ª–æ
    Number(u32),
    // –ë–∏–Ω–∞—Ä–Ω–∞—è –æ–ø–µ—Ä–∞—Ü–∏—è
    Operation(Box<Expression>, Op, Box<Expression>),
}

fn tokenize(input: &str) -> Tokenizer {
    return Tokenizer(input.chars().peekable());
}

struct Tokenizer<'a>(Peekable<Chars<'a>>);

impl<'a> Iterator for Tokenizer<'a> {
    type Item = Token;

    fn next(&mut self) -> Option<Token> {
        let c = self.0.next()?;
        match c {
            '0'..='9' => {
                let mut num = String::from(c);
                while let Some(c @ '0'..='9') = self.0.peek() {
                    num.push(*c);
                    self.0.next();
                }
                Some(Token::Number(num))
            }
            'a'..='z' => {
                let mut ident = String::from(c);
                while let Some(c @ ('a'..='z' | '_' | '0'..='9')) = self.0.peek() {
                    ident.push(*c);
                    self.0.next();
                }
                Some(Token::Identifier(ident))
            }
            '+' => Some(Token::Operator(Op::Add)),
            '-' => Some(Token::Operator(Op::Sub)),
            _ => panic!("–ù–µ–æ–∂–∏–¥–∞–Ω–Ω—ã–π —Å–∏–º–≤–æ–ª {c}"),
        }
    }
}

fn parse(input: &str) -> Expression {
    let mut tokens = tokenize(input);

    fn parse_expr<'a>(tokens: &mut Tokenizer<'a>) -> Expression {
        let Some(tok) = tokens.next() else {
            panic!("–ù–µ–æ–∂–∏–¥–∞–Ω–Ω—ã–π –∫–æ–Ω–µ—Ü –≤–≤–æ–¥–∞");
        };
        let expr = match tok {
            Token::Number(num) => {
                let v = num.parse().expect("–ù–µ–≤–∞–ª–∏–¥–Ω–æ–µ 32-–±–∏—Ç–Ω–æ–µ —Ü–µ–ª–æ–µ —á–∏—Å–ª–æ");
                Expression::Number(v)
            }
            Token::Identifier(ident) => Expression::Var(ident),
            Token::Operator(_) => panic!("–ù–µ–æ–∂–∏–¥–∞–Ω–Ω—ã–π —Ç–æ–∫–µ–Ω {tok:?}"),
        };
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ –±–∏–Ω–∞—Ä–Ω–æ–π –æ–ø–µ—Ä–∞—Ü–∏–∏
        match tokens.next() {
            None => expr,
            Some(Token::Operator(op)) => Expression::Operation(
                Box::new(expr),
                op,
                Box::new(parse_expr(tokens)),
            ),
            Some(tok) => panic!("–ù–µ–æ–∂–∏–¥–∞–Ω–Ω—ã–π —Ç–æ–∫–µ–Ω {tok:?}"),
        }
    }

    parse_expr(&mut tokens)
}

fn main() {
    let expr = parse("10+foo+20-30");
    println!("{expr:?}");
}
```

<details>
<summary>–†–µ—à–µ–Ω–∏–µ:</summary>

```rust
use thiserror::Error;
use std::iter::Peekable;
use std::str::Chars;

#[derive(Debug, PartialEq, Clone, Copy)]
enum Op {
    Add,
    Sub,
}

#[derive(Debug, PartialEq)]
enum Token {
    Number(String),
    Identifier(String),
    Operator(Op),
}

#[derive(Debug, PartialEq)]
enum Expression {
    Var(String),
    Number(u32),
    Operation(Box<Expression>, Op, Box<Expression>),
}

fn tokenize(input: &str) -> Tokenizer {
    return Tokenizer(input.chars().peekable());
}

#[derive(Debug, Error)]
enum TokenizerError {
    #[error("–ù–µ–æ–∂–∏–¥–∞–Ω–Ω—ã–π —Å–∏–º–≤–æ–ª {0}")]
    UnexpectedCharacter(char),
}

struct Tokenizer<'a>(Peekable<Chars<'a>>);

impl<'a> Iterator for Tokenizer<'a> {
    type Item = Result<Token, TokenizerError>;

    fn next(&mut self) -> Option<Result<Token, TokenizerError>> {
        let c = self.0.next()?;
        match c {
            '0'..='9' => {
                let mut num = String::from(c);
                while let Some(c @ '0'..='9') = self.0.peek() {
                    num.push(*c);
                    self.0.next();
                }
                Some(Ok(Token::Number(num)))
            }
            'a'..='z' => {
                let mut ident = String::from(c);
                while let Some(c @ ('a'..='z' | '_' | '0'..='9')) = self.0.peek() {
                    ident.push(*c);
                    self.0.next();
                }
                Some(Ok(Token::Identifier(ident)))
            }
            '+' => Some(Ok(Token::Operator(Op::Add))),
            '-' => Some(Ok(Token::Operator(Op::Sub))),
            _ => Some(Err(TokenizerError::UnexpectedCharacter(c))),
        }
    }
}

#[derive(Debug, Error)]
enum ParserError {
    #[error("–û—à–∏–±–∫–∞ —Ç–æ–∫–µ–Ω–∏–∑–∞—Ç–æ—Ä–∞: {0}")]
    TokenizerError(#[from] TokenizerError),
    #[error("–ù–µ–æ–∂–∏–¥–∞–Ω–Ω—ã–π –∫–æ–Ω–µ—Ü –≤–≤–æ–¥–∞")]
    UnexpectedEOF,
    #[error("–ù–µ–æ–∂–∏–¥–∞–Ω–Ω—ã–π —Ç–æ–∫–µ–Ω {0:?}")]
    UnexpectedToken(Token),
    #[error("–ù–µ–≤–∞–ª–∏–¥–Ω–æ–µ —á–∏—Å–ª–æ")]
    InvalidNumber(#[from] std::num::ParseIntError),
}

fn parse(input: &str) -> Result<Expression, ParserError> {
    let mut tokens = tokenize(input);

    fn parse_expr<'a>(
        tokens: &mut Tokenizer<'a>,
    ) -> Result<Expression, ParserError> {
        let tok = tokens.next().ok_or(ParserError::UnexpectedEOF)??;
        let expr = match tok {
            Token::Number(num) => {
                let v = num.parse()?;
                Expression::Number(v)
            }
            Token::Identifier(ident) => Expression::Var(ident),
            Token::Operator(_) => return Err(ParserError::UnexpectedToken(tok)),
        };

        Ok(match tokens.next() {
            None => expr,
            Some(Ok(Token::Operator(op))) => Expression::Operation(
                Box::new(expr),
                op,
                Box::new(parse_expr(tokens)?),
            ),
            Some(Err(e)) => return Err(e.into()),
            Some(Ok(tok)) => return Err(ParserError::UnexpectedToken(tok)),
        })
    }

    parse_expr(&mut tokens)
}

fn main() -> anyhow::Result<()> {
    let expr = parse("10+foo+20-30")?;
    println!("{expr:?}");
    Ok(())
}
```

</details>

## –ù–µ–±–µ–∑–æ–ø–∞—Å–Ω—ã–π Rust

__–ù–µ–±–µ–∑–æ–ø–∞—Å–Ω—ã–π Rust__

`Rust` —Å–æ—Å—Ç–æ–∏—Ç –∏–∑ –¥–≤—É—Ö —á–∞—Å—Ç–µ–π:

- –±–µ–∑–æ–ø–∞—Å–Ω—ã–π `Rust` - —Ä–∞–±–æ—Ç–∞ —Å –ø–∞–º—è—Ç—å—é —è–≤–ª—è–µ—Ç—Å—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–π, –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –Ω–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ
- –Ω–µ–±–µ–∑–æ–ø–∞—Å–Ω—ã–π `Rust` - –∫–æ–¥ –º–æ–∂–µ—Ç –ø—Ä–∏–≤–æ–¥–∏—Ç—å –∫ –Ω–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–º—É –ø–æ–≤–µ–¥–µ–Ω–∏—é –ø—Ä–∏ –Ω–∞—Ä—É—à–µ–Ω–∏–∏ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã—Ö —É—Å–ª–æ–≤–∏–π

–í —ç—Ç–æ–º –∫—É—Ä—Å–µ –º—ã –≤–∏–¥–µ–ª–∏ –≤ –æ—Å–Ω–æ–≤–Ω–æ–º –±–µ–∑–æ–ø–∞—Å–Ω—ã–π `Rust`, –Ω–æ –≤–∞–∂–Ω–æ –ø–æ–Ω–∏–º–∞—Ç—å, —á—Ç–æ —Ç–∞–∫–æ–µ –Ω–µ–±–µ–∑–æ–ø–∞—Å–Ω—ã–π `Rust`.

–ù–µ–±–µ–∑–æ–ø–∞—Å–Ω—ã–π –∫–æ–¥ –æ–±—ã—á–Ω–æ –Ω–µ–±–æ–ª—å—à–æ–π –∏ –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–π, –∏ –µ–≥–æ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å —Ç—â–∞—Ç–µ–ª—å–Ω–æ –¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∞. –û–±—ã—á–Ω–æ –æ–Ω –æ–±–æ—Ä–∞—á–∏–≤–∞–µ—Ç—Å—è –≤ –±–µ–∑–æ–ø–∞—Å–Ω—ã–π —É—Ä–æ–≤–µ–Ω—å –∞–±—Å—Ç—Ä–∞–∫—Ü–∏–∏ (safe abstraction layer).

–ù–µ–±–µ–∑–æ–ø–∞—Å–Ω—ã–π `Rust` –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –¥–æ—Å—Ç—É–ø –∫ 5 –Ω–æ–≤—ã–º –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—è–º:

- —Ä–∞–∑—ã–º–µ–Ω–æ–≤–∞–Ω–∏–µ —Å—ã—Ä—ã—Ö —É–∫–∞–∑–∞—Ç–µ–ª–µ–π (raw pointers)
- –¥–æ—Å—Ç—É–ø –∏ –º–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏—è –º—É—Ç–∞–±–µ–ª—å–Ω—ã—Ö —Å—Ç–∞—Ç–∏—á–Ω—ã—Ö –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö
- –¥–æ—Å—Ç—É–ø –∫ –ø–æ–ª—è–º `union`
- –≤—ã–∑–æ–≤ `unsafe` —Ñ—É–Ω–∫—Ü–∏–π, –≤–∫–ª—é—á–∞—è `extern` (–≤–Ω–µ—à–Ω–∏–µ) —Ñ—É–Ω–∫—Ü–∏–∏
- —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è `unsafe` —Ç—Ä–µ–π—Ç–æ–≤

–ù–µ–±–µ–∑–æ–ø–∞—Å–Ω—ã–π `Rust` –Ω–µ –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ –∫–æ–¥ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π. –û–Ω –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∏ –æ—Ç–∫–ª—é—á–∏–ª–∏ –Ω–µ–∫–æ—Ç–æ—Ä—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –∫–æ–º–ø–∏–ª—è—Ç–æ—Ä–∞ –∏ –∏–º –ø—Ä–∏—Ö–æ–¥–∏—Ç—Å—è –ø–∏—Å–∞—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –∫–æ–¥ —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ. –≠—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ –∫–æ–º–ø–∏–ª—è—Ç–æ—Ä –Ω–µ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç —Å–æ–±–ª—é–¥–µ–Ω–∏–µ –ø—Ä–∞–≤–∏–ª –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –ø–∞–º—è—Ç–∏ `Rust`.

__–†–∞–∑—ã–º–µ–Ω–æ–≤–∞–Ω–∏–µ —Å—ã—Ä—ã—Ö —É–∫–∞–∑–∞—Ç–µ–ª–µ–π__

–°–æ–∑–¥–∞–Ω–∏–µ —É–∫–∞–∑–∞—Ç–µ–ª–µ–π —è–≤–ª—è–µ—Ç—Å—è –±–µ–∑–æ–ø–∞—Å–Ω—ã–º, –Ω–æ –∏—Ö —Ä–∞–∑—ã–º–µ–Ω–æ–≤–∞–Ω–∏–µ —Ç—Ä–µ–±—É–µ—Ç `unsafe`:

```rust
fn main() {
    let mut s = String::from("careful!");

    let r1 = &mut s as *mut String;
    let r2 = r1 as *const String;

    // –ë–µ–∑–æ–ø–∞—Å–Ω–æ, –ø–æ—Å–∫–æ–ª—å–∫—É r1 –∏ r2 –±—ã–ª–∏ –ø–æ–ª—É—á–µ–Ω—ã –∏–∑ —Å—Å—ã–ª–æ–∫ –∏ –ø–æ—ç—Ç–æ–º—É
    // –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ –Ω–µ —Ä–∞–≤–Ω—ã –Ω—É–ª—é –∏ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –≤—ã—Ä–æ–≤–Ω–µ–Ω—ã (properly aligned), –æ–±—ä–µ–∫—Ç—ã, –ª–µ–∂–∞—â–∏–µ –≤ –æ—Å–Ω–æ–≤–µ —Å—Å—ã–ª–æ–∫,
    // –∏–∑ –∫–æ—Ç–æ—Ä—ã—Ö –æ–Ω–∏ –±—ã–ª–∏ –ø–æ–ª—É—á–µ–Ω—ã, –∞–∫—Ç–∏–≤–Ω—ã –Ω–∞ –ø—Ä–æ—Ç—è–∂–µ–Ω–∏–∏ –≤—Å–µ–≥–æ –Ω–µ–±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ –±–ª–æ–∫–∞,
    // –∏ –∫ –Ω–∏–º –Ω–µ–ª—å–∑—è –ø–æ–ª—É—á–∏—Ç—å –¥–æ—Å—Ç—É–ø –Ω–∏ —á–µ—Ä–µ–∑ —Å—Å—ã–ª–∫–∏, –Ω–∏ (–∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω–æ) —á–µ—Ä–µ–∑ –¥—Ä—É–≥–∏–µ —É–∫–∞–∑–∞—Ç–µ–ª–∏
    unsafe {
        println!("r1 is: {}", *r1);
        *r1 = String::from("uhoh");
        println!("r2 is: {}", *r2);
    }

    // –ù–µ–±–µ–∑–æ–ø–∞—Å–Ω–æ. –ù–µ –¥–µ–ª–∞–π—Ç–µ —Ç–∞–∫
    /*
    let r3: &String = unsafe { &*r1 };
    drop(s);
    println!("r3 is: {}", *r3);
    */
}
```

–•–æ—Ä–æ—à–µ–π –ø—Ä–∞–∫—Ç–∏–∫–æ–π —è–≤–ª—è–µ—Ç—Å—è –Ω–∞–ø–∏—Å–∞–Ω–∏–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –Ω–µ–±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ –±–ª–æ–∫–∞, –æ–±—ä—è—Å–Ω—è—é—â–µ–≥–æ, –∫–∞–∫ –∫–æ–¥ –≤–Ω—É—Ç—Ä–∏ –Ω–µ–≥–æ —É–¥–æ–≤–ª–µ—Ç–≤–æ—Ä—è–µ—Ç —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –≤—ã–ø–æ–ª–Ω—è–µ–º—ã—Ö –∏–º –Ω–µ–±–µ–∑–æ–ø–∞—Å–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π.

–í —Å–ª—É—á–∞–µ —Ä–∞–∑—ã–º–µ–Ω–æ–≤–∞–Ω–∏—è —É–∫–∞–∑–∞—Ç–µ–ª–µ–π —ç—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ —É–∫–∞–∑–∞—Ç–µ–ª–∏ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å [–≤–∞–ª–∏–¥–Ω—ã–º–∏](https://doc.rust-lang.org/std/ptr/index.html#safety), —Ç.–µ.:

- —É–∫–∞–∑–∞—Ç–µ–ª—å –Ω–µ –¥–æ–ª–∂–µ–Ω —Ä–∞–≤–Ω—è—Ç—å—Å—è –Ω—É–ª—é
- —É–∫–∞–∑–∞—Ç–µ–ª—å –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —Ä–∞–∑—ã–º–µ–Ω–æ–≤—ã–≤–∞–µ–º—ã–º (–≤ –ø—Ä–µ–¥–µ–ª–∞—Ö –æ–¥–Ω–æ–≥–æ –≤—ã–¥–µ–ª–µ–Ω–Ω–æ–≥–æ –æ–±—ä–µ–∫—Ç–∞)
- –æ–±—ä–µ–∫—Ç –Ω–µ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –æ—Å–≤–æ–±–æ–∂–¥–µ–Ω
- –Ω–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞ –∫ –æ–¥–Ω–æ–π –∏ —Ç–æ–π –∂–µ –ª–æ–∫–∞—Ü–∏–∏ –ø–∞–º—è—Ç–∏
- –µ—Å–ª–∏ —É–∫–∞–∑–∞—Ç–µ–ª—å –±—ã–ª –ø–æ–ª—É—á–µ–Ω –ø—É—Ç–µ–º –ø—Ä–∏–≤–µ–¥–µ–Ω–∏—è —Å—Å—ã–ª–∫–∏ (reference coercion), –±–∞–∑–æ–≤—ã–π –æ–±—ä–µ–∫—Ç –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –∞–∫—Ç–∏–≤–Ω—ã–º –∏ –Ω–∏–∫–∞–∫–∞—è —Å—Å—ã–ª–∫–∞ –Ω–µ –º–æ–∂–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ –ø–∞–º—è—Ç–∏

–í –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–µ —Å–ª—É—á–∞–µ–≤ —É–∫–∞–∑–∞—Ç–µ–ª—å —Ç–∞–∫–∂–µ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω–æ –≤—ã—Ä–æ–≤–Ω–µ–Ω.

–í —Ä–∞–∑–¥–µ–ª–µ "–ù–µ–±–µ–∑–æ–ø–∞—Å–Ω–æ" –ø—Ä–∏–≤–µ–¥–µ–Ω –ø—Ä–∏–º–µ—Ä —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω–µ–Ω–Ω–æ–π –æ—à–∏–±–∫–∏ –Ω–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–≥–æ –ø–æ–≤–µ–¥–µ–Ω–∏—è: `*r1` –∏–º–µ–µ—Ç `'static` –≤—Ä–µ–º—è –∂–∏–∑–Ω–∏, –ø–æ—ç—Ç–æ–º—É `r3` –∏–º–µ–µ—Ç —Ç–∏–ø `&'static String` –∏, —Ç–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º, –ø–µ—Ä–µ–∂–∏–≤–∞–µ—Ç `s`. –°–æ–∑–¥–∞–Ω–∏–µ —Å—Å—ã–ª–∫–∏ –∏–∑ —É–∫–∞–∑–∞—Ç–µ–ª—è —Ç—Ä–µ–±—É–µ—Ç _–±–æ–ª—å—à–æ–π –æ—Å—Ç–æ—Ä–æ–∂–Ω–æ—Å—Ç–∏_.

__–ú–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏—è —Å—Ç–∞—Ç–∏—á–Ω—ã—Ö –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö__

–ß—Ç–µ–Ω–∏–µ –∏–º–º—É—Ç–∞–±–µ–ª—å–Ω–æ–π —Å—Ç–∞—Ç–∏—á–Ω–æ–π –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π —è–≤–ª—è–µ—Ç—Å—è –±–µ–∑–æ–ø–∞—Å–Ω—ã–º:

```rust
static HELLO_WORLD: &str = "Hello, world!";

fn main() {
    println!("HELLO_WORLD: {HELLO_WORLD}");
}
```

–û–¥–Ω–∞–∫–æ, —É—á–∏—Ç—ã–≤–∞—è —Ä–∏—Å–∫ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏—è –≥–æ–Ω–∫–∏ –¥–∞–Ω–Ω—ã—Ö (data race), —á—Ç–µ–Ω–∏–µ –∏ –º–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏—è –º—É—Ç–∞–±–µ–ª—å–Ω—ã—Ö —Å—Ç–∞—Ç–∏—á–Ω—ã—Ö –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö —è–≤–ª—è—é—Ç—Å—è –Ω–µ–±–µ–∑–æ–ø–∞—Å–Ω—ã–º–∏:

```rust
static mut COUNTER: u32 = 0;

fn add_to_counter(inc: u32) {
    unsafe {
        COUNTER += inc;
    }
}

fn main() {
    add_to_counter(42);

    unsafe {
        println!("COUNTER: {COUNTER}");
    }
}
```

–ü—Ä–æ–≥—Ä–∞–º–º–∞ –≤ –ø—Ä–∏–º–µ—Ä–µ –±–µ–∑–æ–ø–∞—Å–Ω–∞, –ø–æ—Å–∫–æ–ª—å–∫—É –æ–Ω–∞ –æ–¥–Ω–æ–ø–æ—Ç–æ—á–Ω–∞—è. –û–¥–Ω–∞–∫–æ –∫–æ–º–ø–∏–ª—è—Ç–æ—Ä `Rust` –∫–æ–Ω—Å–µ—Ä–≤–∞—Ç–∏–≤–µ–Ω –∏ –ø—Ä–µ–¥–ø–æ–ª–∞–≥–∞–µ—Ç —Ö—É–¥—à–µ–µ. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —É–¥–∞–ª–∏—Ç—å `unsafe` –∏ —É–≤–∏–¥–∏—Ç–µ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –∫–æ–º–ø–∏–ª—è—Ç–æ—Ä–∞ –æ —Ç–æ–º, —á—Ç–æ –∏–∑–º–µ–Ω–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏–∫–∏ –∏–∑ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –ø–æ—Ç–æ–∫–æ–≤ –º–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ –Ω–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–º—É –ø–æ–≤–µ–¥–µ–Ω–∏—é.

–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∏–∑–º–µ–Ω—è–µ–º–æ–π —Å—Ç–∞—Ç–∏–∫–∏, –∫–∞–∫ –ø—Ä–∞–≤–∏–ª–æ, —è–≤–ª—è–µ—Ç—Å—è –ø–ª–æ—Ö–æ–π –∏–¥–µ–µ–π, –Ω–æ –≤ –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö —Å–ª—É—á–∞—è—Ö —ç—Ç–æ –º–æ–∂–µ—Ç –∏–º–µ—Ç—å —Å–º—ã—Å–ª –≤ –Ω–∏–∑–∫–æ—É—Ä–æ–≤–Ω–µ–≤–æ–º –∫–æ–¥–µ `no_std`, –Ω–∞–ø—Ä–∏–º–µ—Ä, –ø—Ä–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–∏—Ç–µ–ª—è –∫—É—á–∏ (heap allocator) –∏–ª–∏ —Ä–∞–±–æ—Ç–µ —Å –Ω–µ–∫–æ—Ç–æ—Ä—ã–º–∏ API —è–∑—ã–∫–∞ `C`.

__–û–±—ä–µ–¥–∏–Ω–µ–Ω–∏—è__

–û–±—ä–µ–¥–∏–Ω–µ–Ω–∏—è (unions) –ø–æ—Ö–æ–∂–∏ –Ω–∞ –ø–µ—Ä–µ—á–∏—Å–ª–µ–Ω–∏—è, –Ω–æ –∞–∫—Ç–∏–≤–Ω–æ–µ –ø–æ–ª–µ –Ω—É–∂–Ω–æ –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ:

```rust
#[repr(C)]
union MyUnion {
    i: u8,
    b: bool,
}

fn main() {
    let u = MyUnion { i: 42 };
    println!("int: {}", unsafe { u.i });
    println!("bool: {}", unsafe { u.b }); // –Ω–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ
}
```

–í `Rust` –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏—è –Ω—É–∂–Ω—ã –æ—á–µ–Ω—å —Ä–µ–¥–∫–æ, –ø–æ—Å–∫–æ–ª—å–∫—É –æ–±—ã—á–Ω–æ –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø–µ—Ä–µ—á–∏—Å–ª–µ–Ω–∏—è. –ò–Ω–æ–≥–¥–∞ –æ–Ω–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã –¥–ª—è –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è —Å API –±–∏–±–ª–∏–æ—Ç–µ–∫ —è–∑—ã–∫–∞ `C`.

–ï—Å–ª–∏ –º—ã –ø—Ä–æ—Å—Ç–æ —Ö–æ—Ç–∏–º –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∏—Ä–æ–≤–∞—Ç—å –±–∞–π—Ç—ã –∫–∞–∫ –¥—Ä—É–≥–æ–π —Ç–∏–ø, –Ω–∞–º, –≤–µ—Ä–æ—è—Ç–Ω–æ, –ø–æ–Ω–∞–¥–æ–±–∏—Ç—Å—è [std::mem::transmute](https://doc.rust-lang.org/stable/std/mem/fn.transmute.html) –∏–ª–∏ –±–µ–∑–æ–ø–∞—Å–Ω–∞—è –æ–±–æ–ª–æ—á–∫–∞, —Ç–∞–∫–∞—è –∫–∞–∫ –∫—Ä–µ–π—Ç [zerocopy](https://crates.io/crates/zerocopy).

__–ù–µ–±–µ–∑–æ–ø–∞—Å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏__

_–í—ã–∑–æ–≤ –Ω–µ–±–µ–∑–æ–ø–∞—Å–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π_

–§—É–Ω–∫—Ü–∏—è –∏–ª–∏ –º–µ—Ç–æ–¥ –º–æ–≥—É—Ç –±—ã—Ç—å –ø–æ–º–µ—á–µ–Ω—ã –∫–∞–∫ `unsafe`, –µ—Å–ª–∏ —É –Ω–∏—Ö –µ—Å—Ç—å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —É—Å–ª–æ–≤–∏—è, –∫–æ—Ç–æ—Ä—ã–µ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —Å–æ–±–ª—é–¥–µ–Ω—ã –≤–æ –∏–∑–±–µ–∂–∞–Ω–∏–µ –Ω–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–≥–æ –ø–æ–≤–µ–¥–µ–Ω–∏—è:

```rust
extern "C" {
    fn abs(input: i32) -> i32;
}

fn main() {
    let emojis = "üóª‚ààüåè";

    // –ë–µ–∑–æ–ø–∞—Å–Ω–æ, –ø–æ—Ç–æ–º—É —á—Ç–æ –∏–Ω–¥–µ–∫—Å—ã –Ω–∞—Ö–æ–¥—è—Ç—Å—è –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º –ø–æ—Ä—è–¥–∫–µ, –≤ –ø—Ä–µ–¥–µ–ª–∞—Ö
    // —Ñ—Ä–∞–≥–º–µ–Ω—Ç–∞ —Å—Ç—Ä–æ–∫–∏ (string slice) –∏ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ UTF-8
    unsafe {
        println!("—ç–º–æ–¥–∑–∏: {}", emojis.get_unchecked(0..4));
        println!("—ç–º–æ–¥–∑–∏: {}", emojis.get_unchecked(4..7));
        println!("—ç–º–æ–¥–∑–∏: {}", emojis.get_unchecked(7..11));
    }

    println!("–∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–∏–º–≤–æ–ª–æ–≤: {}", count_chars(unsafe { emojis.get_unchecked(0..7) }));

    unsafe {
        // –ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–æ –Ω–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ
        println!("–∞–±—Å–æ–ª—é—Ç–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ -3 —Å–æ–≥–ª–∞—Å–Ω–æ C: {}", abs(-3));
    }

    // –ù–µ—Å–æ–±–ª—é–¥–µ–Ω–∏–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π –∫–æ–¥–∏—Ä–æ–≤–∫–∏ UTF-8 –Ω–∞—Ä—É—à–∞–µ—Ç –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –ø–∞–º—è—Ç–∏
    // println!("—ç–º–æ–¥–∑–∏: {}", unsafe { emojis.get_unchecked(0..3) });
    // println!("–∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–∏–º–≤–æ–ª–æ–≤: {}", count_chars(unsafe {
    // emojis.get_unchecked(0..3) }));
}

fn count_chars(s: &str) -> usize {
    s.chars().count()
}
```

_–°–æ–∑–¥–∞–Ω–∏–µ –Ω–µ–±–µ–∑–æ–ø–∞—Å–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π_

–ú—ã –º–æ–∂–µ–º –ø–æ–º–µ—Ç–∏—Ç—å —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –∫–∞–∫ `unsafe`, –µ—Å–ª–∏ –æ–Ω–∏ —Ç—Ä–µ–±—É—é—Ç —Å–æ–±–ª—é–¥–µ–Ω–∏—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã—Ö —É—Å–ª–æ–≤–∏–π –≤–æ –∏–∑–±–µ–∂–∞–Ω–∏–µ –Ω–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–≥–æ –ø–æ–≤–µ–¥–µ–Ω–∏—è:

```rust
/// –ú–µ–Ω—è–µ—Ç –∑–Ω–∞—á–µ–Ω–∏—è, –Ω–∞ –∫–æ—Ç–æ—Ä—ã–µ —É–∫–∞–∑—ã–≤–∞—é—Ç —É–∫–∞–∑–∞—Ç–µ–ª–∏
///
/// # –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
///
/// –£–∫–∞–∑–∞—Ç–µ–ª–∏ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –≤–∞–ª–∏–¥–Ω—ã–º–∏ –∏ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –≤—ã—Ä–æ–≤–Ω–µ–Ω–Ω—ã–º–∏
unsafe fn swap(a: *mut u8, b: *mut u8) {
    let temp = *a;
    *a = *b;
    *b = temp;
}

fn main() {
    let mut a = 42;
    let mut b = 66;

    // –ë–µ–∑–æ–ø–∞—Å–Ω–æ, –ø–æ—Å–∫–æ–ª—å–∫—É...
    unsafe {
        swap(&mut a, &mut b);
    }

    println!("a = {}, b = {}", a, b);
}
```

_–í—ã–∑–æ–≤ –Ω–µ–±–µ–∑–æ–ø–∞—Å–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π_

`get_unchecked`, –∫–∞–∫ –∏ –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ —Ñ—É–Ω–∫—Ü–∏–π `_unchecked`, –Ω–µ–±–µ–∑–æ–ø–∞—Å–Ω–∞, –ø–æ—Å–∫–æ–ª—å–∫—É –º–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ –Ω–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–º—É –ø–æ–≤–µ–¥–µ–Ω–∏—é, –µ—Å–ª–∏ –¥–∏–∞–ø–∞–∑–æ–Ω –Ω–µ–≤–µ—Ä–µ–Ω. `abs` –Ω–µ–±–µ–∑–æ–ø–∞—Å–Ω–∞ –ø–æ –¥—Ä—É–≥–æ–π –ø—Ä–∏—á–∏–Ω–µ: —ç—Ç–æ –≤–Ω–µ—à–Ω—è—è —Ñ—É–Ω–∫—Ü–∏—è (`FFI`). –í—ã–∑–æ–≤ –≤–Ω–µ—à–Ω–∏—Ö —Ñ—É–Ω–∫—Ü–∏–π –æ–±—ã—á–Ω–æ —è–≤–ª—è–µ—Ç—Å—è –ø—Ä–æ–±–ª–µ–º–æ–π —Ç–æ–ª—å–∫–æ —Ç–æ–≥–¥–∞, –∫–æ–≥–¥–∞ —ç—Ç–∏ —Ñ—É–Ω–∫—Ü–∏–∏ —Å–æ–≤–µ—Ä—à–∞—é—Ç –¥–µ–π—Å—Ç–≤–∏—è —Å —É–∫–∞–∑–∞—Ç–µ–ª—è–º–∏, –∫–æ—Ç–æ—Ä—ã–µ –º–æ–≥—É—Ç –Ω–∞—Ä—É—à–∏—Ç—å –º–æ–¥–µ–ª—å –ø–∞–º—è—Ç–∏ `Rust`, –Ω–æ –≤ —Ü–µ–ª–æ–º –ª—é–±–∞—è —Ñ—É–Ω–∫—Ü–∏—è `C` –º–æ–∂–µ—Ç –∏–º–µ—Ç—å –Ω–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ –ø—Ä–∏ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã—Ö –æ–±—Å—Ç–æ—è—Ç–µ–ª—å—Å—Ç–≤–∞—Ö.

_–°–æ–∑–¥–∞–Ω–∏–µ –Ω–µ–±–µ–∑–æ–ø–∞—Å–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π_

–ù–∞ —Å–∞–º–æ–º –¥–µ–ª–µ –≤ –ø—Ä–∏–º–µ—Ä–µ —Å–æ–∑–¥–∞–Ω–∏—è –Ω–µ–±–µ–∑–æ–ø–∞—Å–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–∏ –º—ã –Ω–µ —Å—Ç–∞–ª–∏ –±—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —É–∫–∞–∑–∞—Ç–µ–ª–∏ - —Ç–∞–∫—É—é —Ñ—É–Ω–∫—Ü–∏—é –º–æ–∂–Ω–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —Å –ø–æ–º–æ—â—å—é —Å—Å—ã–ª–æ–∫.

–û–±—Ä–∞—Ç–∏—Ç–µ –≤–Ω–∏–º–∞–Ω–∏–µ, —á—Ç–æ –Ω–µ–±–µ–∑–æ–ø–∞—Å–Ω—ã–π –∫–æ–¥ —Ä–∞–∑—Ä–µ—à–µ–Ω –≤–Ω—É—Ç—Ä–∏ –Ω–µ–±–µ–∑–æ–ø–∞—Å–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–∏ –±–µ–∑ –±–ª–æ–∫–∞ `unsafe`. –ú—ã –º–æ–∂–µ–º –∑–∞–ø—Ä–µ—Ç–∏—Ç—å —ç—Ç–æ —Å –ø–æ–º–æ—â—å—é `#[deny(unsafe_op_in_unsafe_fn)]`. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –¥–æ–±–∞–≤–∏—Ç—å –µ–≥–æ –∏ –ø–æ—Å–º–æ—Ç—Ä–∏—Ç–µ, —á—Ç–æ –ø—Ä–æ–∏–∑–æ–π–¥–µ—Ç. –í–µ—Ä–æ—è—Ç–Ω–æ, —ç—Ç–æ –∏–∑–º–µ–Ω–∏—Ç—Å—è –≤ –±—É–¥—É—â–µ–π –≤–µ—Ä—Å–∏–∏ `Rust`.

__–ù–µ–±–µ–∑–æ–ø–∞—Å–Ω—ã–µ —Ç—Ä–µ–π—Ç—ã__

–ö–∞–∫ –∏ –≤ —Å–ª—É—á–∞–µ —Å —Ñ—É–Ω–∫—Ü–∏—è–º–∏, –º—ã –º–æ–∂–µ–º –ø–æ–º–µ—Ç–∏—Ç—å —Ç—Ä–µ–π—Ç –∫–∞–∫ `unsafe`, –µ—Å–ª–∏ –µ–≥–æ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –¥–æ–ª–∂–Ω–∞ –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–µ —É—Å–ª–æ–≤–∏—è –≤–æ –∏–∑–±–µ–∂–∞–Ω–∏–µ –Ω–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–≥–æ –ø–æ–≤–µ–¥–µ–Ω–∏—è.

–ù–∞–ø—Ä–∏–º–µ—Ä, –∫—Ä–µ–π—Ç [zerocopy](https://docs.rs/zerocopy/latest/zerocopy/trait.AsBytes.html) –∏–º–µ–µ—Ç –Ω–µ–±–µ–∑–æ–ø–∞—Å–Ω—ã–π —Ç—Ä–µ–π—Ç, –∫–æ—Ç–æ—Ä—ã–π –≤—ã–≥–ª—è–¥–∏—Ç [–ø—Ä–∏–º–µ—Ä–Ω–æ —Ç–∞–∫](https://docs.rs/zerocopy/latest/zerocopy/trait.AsBytes.html):

```rust
use std::mem::size_of_val;
use std::slice;

/// ...
/// # –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
/// –¢–∏–ø –¥–æ–ª–∂–µ–Ω –∏–º–µ—Ç—å –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –∏ –Ω–µ –∏–º–µ—Ç—å –æ—Ç—Å—Ç—É–ø–æ–≤ (padding)
pub unsafe trait AsBytes {
    fn as_bytes(&self) -> &[u8] {
        unsafe {
            slice::from_raw_parts(
                self as *const Self as *const u8,
                size_of_val(self),
            )
        }
    }
}

// –ë–µ–∑–æ–ø–∞—Å–Ω–æ, –ø–æ—Å–∫–æ–ª—å–∫—É `u32` –∏–º–µ–µ—Ç –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –∏ –Ω–µ –∏–º–µ–µ—Ç –æ—Ç—Å—Ç—É–ø–æ–≤
unsafe impl AsBytes for u32 {}
```

–í `Rustdoc` –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —Ä–∞–∑–¥–µ–ª `# Safety` (–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å) —Å —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º–∏ –∫ –±–µ–∑–æ–ø–∞—Å–Ω–æ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ —Ç—Ä–µ–π—Ç–∞.

–†–µ–∞–ª—å–Ω—ã–π —Ä–∞–∑–¥–µ–ª –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –¥–ª—è `AsBytes` –≥–æ—Ä–∞–∑–¥–æ –¥–ª–∏–Ω–Ω–µ–µ –∏ —Å–ª–æ–∂–Ω–µ–µ.

–í—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ —Ç—Ä–µ–π—Ç—ã `Send` –∏ `Sync` —è–≤–ª—è—é—Ç—Å—è –Ω–µ–±–µ–∑–æ–ø–∞—Å–Ω—ã–º–∏.

__–£–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ: –±–µ–∑–æ–ø–∞—Å–Ω–∞—è –æ–±–µ—Ä—Ç–∫–∞ FFI__

–û–±—Ä–∞—Ç–∏—Ç–µ –≤–Ω–∏–º–∞–Ω–∏–µ: —ç—Ç–æ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ —è–≤–ª—è–µ—Ç—Å—è —Å–ª–æ–∂–Ω—ã–º –∏ –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–º.

–í `Rust` –∏–º–µ–µ—Ç—Å—è –æ—Ç–ª–∏—á–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –≤—ã–∑–æ–≤–∞ —Ñ—É–Ω–∫—Ü–∏–π —á–µ—Ä–µ–∑ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –≤–Ω–µ—à–Ω–∏—Ö —Ñ—É–Ω–∫—Ü–∏–π (foreign function interface, FFI). –ú—ã –±—É–¥–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —ç—Ç–æ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–π –æ–±–æ–ª–æ—á–∫–∏ –¥–ª—è —Ñ—É–Ω–∫—Ü–∏–π `libc`, –∫–æ—Ç–æ—Ä—ã–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –≤ `C` –¥–ª—è —á—Ç–µ–Ω–∏—è –∏–º–µ–Ω —Ñ–∞–π–ª–æ–≤ –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏.

–ü–æ–ª–µ–∑–Ω–æ –∏–∑—É—á–∏—Ç—å —Å–ª–µ–¥—É—é—â–∏–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–∞:

- [opendir(3)](https://man7.org/linux/man-pages/man3/opendir.3.html)
- [readdir(3)](https://man7.org/linux/man-pages/man3/readdir.3.html)
- [closedir(3)](https://man7.org/linux/man-pages/man3/closedir.3.html)

–¢–∞–∫–∂–µ –ø–æ–ª–µ–∑–Ω–æ –∏–∑—É—á–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é –º–æ–¥—É–ª—è [std::ffi](https://doc.rust-lang.org/std/ffi/). –¢–∞–º –≤—ã –Ω–∞–π–¥–µ—Ç–µ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ç–∏–ø–æ–≤ —Å—Ç—Ä–æ–∫, –∫–æ—Ç–æ—Ä—ã–µ –≤–∞–º –ø–æ–Ω–∞–¥–æ–±—è—Ç—Å—è –¥–ª—è —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è:

–¢–∏–ø—ã|–ö–æ–¥–∏—Ä–æ–≤–∫–∞|–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ
---|---|---
[str](https://doc.rust-lang.org/std/primitive.str.html) –∏ [String](https://doc.rust-lang.org/std/string/struct.String.html)|UTF-8|–û–±—Ä–∞–±–æ—Ç–∫–∞ —Ç–µ–∫—Å—Ç–∞ –≤ `Rust`
[CStr](https://doc.rust-lang.org/std/ffi/struct.CStr.html) –∏ [CString](https://doc.rust-lang.org/std/ffi/struct.CString.html)|NUL-–∑–∞–≤–µ—Ä—à–µ–Ω–Ω–∞—è|–í–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ —Å —Ñ—É–Ω–∫—Ü–∏—è–º–∏ `C`
[OsStr](https://doc.rust-lang.org/std/ffi/struct.OsStr.html) –∏ [OsString](https://doc.rust-lang.org/std/ffi/struct.OsString.html)|–ó–∞–≤–∏—Å–∏—Ç –æ—Ç –û–°|–í–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ —Å –û–°

–í—ã –±—É–¥–µ—Ç–µ –≤—ã–ø–æ–ª–Ω—è—Ç—å —Å–ª–µ–¥—É—é—â–∏–µ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è —Ç–∏–ø–æ–≤:

- `&str` –≤ `CString` - –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –≤—ã–¥–µ–ª–µ–Ω–∏–µ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–∞ –¥–ª—è –∑–∞–≤–µ—Ä—à–∞—é—â–µ–≥–æ —Å–∏–º–≤–æ–ª–∞ `\0`
- `CString` –≤ `*const i8` - –¥–ª—è –≤—ã–∑–æ–≤–∞ —Ñ—É–Ω–∫—Ü–∏–π `C` –Ω—É–∂–µ–Ω —É–∫–∞–∑–∞—Ç–µ–ª—å
- `*const i8` –≤ `&CStr` - —Ç—Ä–µ–±—É–µ—Ç—Å—è —Å—Ä–µ–¥—Å—Ç–≤–æ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏—è –∑–∞–≤–µ—Ä—à–∞—é—â–µ–≥–æ —Å–∏–º–≤–æ–ª–∞ `\0`
- `&CStr` –≤ `&[u8]` - —Å—Ä–µ–∑ –±–∞–π—Ç–æ–≤ - —ç—Ç–æ —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è "–Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö"
- `&[u8]` –≤ `&OsStr` - `&OsStr` - —ç—Ç–æ —à–∞–≥ –Ω–∞ –ø—É—Ç–∏ –∫ `OsString`, –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ [OsStrExt](https://doc.rust-lang.org/std/os/unix/ffi/trait.OsStrExt.html) –¥–ª—è –µ–µ —Å–æ–∑–¥–∞–Ω–∏—è
- `&OsStr` –≤ `OsString` - –¥–∞–Ω–Ω—ã–µ –≤ `&OsStr` –Ω—É–∂–Ω–æ –∫–ª–æ–Ω–∏—Ä–æ–≤–∞—Ç—å –¥–ª—è —Ç–æ–≥–æ, —á—Ç–æ–±—ã –∏–º–µ—Ç—å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –∏—Ö –≤–µ—Ä–Ω—É—Ç—å –∏ –ø–æ–≤—Ç–æ—Ä–Ω–æ –≤—ã–∑–≤–∞—Ç—å `readdir`

–í [Nomicon](https://doc.rust-lang.org/nomicon/ffi.html) –∏–º–µ–µ—Ç—Å—è –æ—Ç–ª–∏—á–Ω—ã–π —Ä–∞–∑–¥–µ–ª –æ FFI.

```rust
mod ffi {
    use std::os::raw::{c_char, c_int};
    #[cfg(not(target_os = "macos"))]
    use std::os::raw::{c_long, c_uchar, c_ulong, c_ushort};

    // –ù–µ–ø—Ä–æ–∑—Ä–∞—á–Ω—ã–π —Ç–∏–ø. –°–º. https://doc.rust-lang.org/nomicon/ffi.html.
    #[repr(C)]
    pub struct DIR {
        _data: [u8; 0],
        _marker: core::marker::PhantomData<(*mut u8, core::marker::PhantomPinned)>,
    }

    // –ú–∞–∫–µ—Ç –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–∏ —Å–æ —Å—Ç—Ä–∞–Ω–∏—Ü–µ–π —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–∞ Linux –¥–ª—è `readdir(3)`, –≥–¥–µ `ino_t` –∏
    // `off_t` —Ä–∞–∑—Ä–µ—à–∞—é—Ç—Å—è —Å–æ–≥–ª–∞—Å–Ω–æ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è–º –≤
    // /usr/include/x86_64-linux-gnu/{sys/types.h, bits/typesizes.h}.
    #[cfg(not(target_os = "macos"))]
    #[repr(C)]
    pub struct dirent {
        pub d_ino: c_ulong,
        pub d_off: c_long,
        pub d_reclen: c_ushort,
        pub d_type: c_uchar,
        pub d_name: [c_char; 256],
    }

    // –ú–∞–∫–µ—Ç –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–∏ —Å–æ —Å—Ç—Ä–∞–Ω–∏—Ü–µ–π —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–∞ `macOS` –¥–ª—è `dir(5)`.
    #[cfg(all(target_os = "macos"))]
    #[repr(C)]
    pub struct dirent {
        pub d_fileno: u64,
        pub d_seekoff: u64,
        pub d_reclen: u16,
        pub d_namlen: u16,
        pub d_type: u8,
        pub d_name: [c_char; 1024],
    }

    extern "C" {
        pub fn opendir(s: *const c_char) -> *mut DIR;

        #[cfg(not(all(target_os = "macos", target_arch = "x86_64")))]
        pub fn readdir(s: *mut DIR) -> *const dirent;

        // –°–º. https://github.com/rust-lang/libc/issues/414 –∏ —Ä–∞–∑–¥–µ–ª
        // _DARWIN_FEATURE_64_BIT_INODE –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–∞ `macOS` –¥–ª—è `stat(2)`.
        //
        // "–ü–ª–∞—Ç—Ñ–æ—Ä–º—ã, —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–≤—à–∏–µ –¥–æ —Ç–æ–≥–æ, –∫–∞–∫ —ç—Ç–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ç–∞–ª–∏ –¥–æ—Å—Ç—É–ø–Ω—ã"
        // (platforms that existed before these updates were available) –æ—Ç–Ω–æ—Å—è—Ç—Å—è –∫
        // macOS (–Ω–æ –Ω–µ –∫ iOS, wearOS –∏ —Ç.–¥.) –Ω–∞ Intel –∏ PowerPC.
        #[cfg(all(target_os = "macos", target_arch = "x86_64"))]
        #[link_name = "readdir$INODE64"]
        pub fn readdir(s: *mut DIR) -> *const dirent;

        pub fn closedir(s: *mut DIR) -> c_int;
    }
}

use std::ffi::{CStr, CString, OsStr, OsString};
use std::os::unix::ffi::OsStrExt;

#[derive(Debug)]
struct DirectoryIterator {
    path: CString,
    dir: *mut ffi::DIR,
}

impl DirectoryIterator {
    fn new(path: &str) -> Result<DirectoryIterator, String> {
        // –í—ã–∑—ã–≤–∞–µ–º `opendir` –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –∑–Ω–∞—á–µ–Ω–∏–µ `Ok` –ø—Ä–∏ —É—Å–ø–µ—Ö–µ
        // –∏ `Err` —Å —Å–æ–æ–±—â–µ–Ω–∏–µ–º –ø—Ä–∏ –Ω–µ—É–¥–∞—á–µ
        unimplemented!()
    }
}

impl Iterator for DirectoryIterator {
    type Item = OsString;
    fn next(&mut self) -> Option<OsString> {
        // –ü—Ä–æ–¥–æ–ª–∂–∞–µ–º –≤—ã–∑—ã–≤–∞—Ç—å `readdir` –¥–æ —Ç–µ—Ö –ø–æ—Ä, –ø–æ–∫–∞ –Ω–µ –≤–µ—Ä–Ω–µ—Ç—Å—è —É–∫–∞–∑–∞—Ç–µ–ª—å –Ω–∞ –∑–Ω–∞—á–µ–Ω–∏–µ NULL
        unimplemented!()
    }
}

impl Drop for DirectoryIterator {
    fn drop(&mut self) {
        // –í—ã–∑—ã–≤–≤–∞–µ–º `closedir` –ø–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏
        unimplemented!()
    }
}

fn main() -> Result<(), String> {
    let iter = DirectoryIterator::new(".")?;
    println!("—Ñ–∞–π–ª—ã: {:#?}", iter.collect::<Vec<_>>());
    Ok(())
}

#[cfg(test)]
mod tests {
    use super::*;
    use std::error::Error;

    #[test]
    fn test_nonexisting_directory() {
        let iter = DirectoryIterator::new("no-such-directory");
        assert!(iter.is_err());
    }

    #[test]
    fn test_empty_directory() -> Result<(), Box<dyn Error>> {
        let tmp = tempfile::TempDir::new()?;
        let iter = DirectoryIterator::new(
            tmp.path().to_str().ok_or("Non UTF-8 character in path")?,
        )?;
        let mut entries = iter.collect::<Vec<_>>();
        entries.sort();
        assert_eq!(entries, &[".", ".."]);
        Ok(())
    }

    #[test]
    fn test_nonempty_directory() -> Result<(), Box<dyn Error>> {
        let tmp = tempfile::TempDir::new()?;
        std::fs::write(tmp.path().join("foo.txt"), "The Foo Diaries\n")?;
        std::fs::write(tmp.path().join("bar.png"), "<PNG>\n")?;
        std::fs::write(tmp.path().join("crab.rs"), "//! Crab\n")?;
        let iter = DirectoryIterator::new(
            tmp.path().to_str().ok_or("Non UTF-8 character in path")?,
        )?;
        let mut entries = iter.collect::<Vec<_>>();
        entries.sort();
        assert_eq!(entries, &[".", "..", "bar.png", "crab.rs", "foo.txt"]);
        Ok(())
    }
}
```

<details>
<summary>–†–µ—à–µ–Ω–∏–µ:</summary>

```rust
impl DirectoryIterator {
    fn new(path: &str) -> Result<DirectoryIterator, String> {
        // –í—ã–∑—ã–≤–∞–µ–º `opendir` –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –∑–Ω–∞—á–µ–Ω–∏–µ `Ok` –ø—Ä–∏ —É—Å–ø–µ—Ö–µ
        // –∏ `Err` —Å —Å–æ–æ–±—â–µ–Ω–∏–µ–º –ø—Ä–∏ –Ω–µ—É–¥–∞—á–µ
        let path =
            CString::new(path).map_err(|err| format!("Invalid path: {err}"))?;
        // –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å: `path.as_ptr()` –Ω–µ –º–æ–∂–µ—Ç –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å NULL
        let dir = unsafe { ffi::opendir(path.as_ptr()) };
        if dir.is_null() {
            Err(format!("Could not open {:?}", path))
        } else {
            Ok(DirectoryIterator { path, dir })
        }
    }
}

impl Iterator for DirectoryIterator {
    type Item = OsString;
    fn next(&mut self) -> Option<OsString> {
        // –ü—Ä–æ–¥–æ–ª–∂–∞–µ–º –≤—ã–∑—ã–≤–∞—Ç—å `readdir` –¥–æ —Ç–µ—Ö –ø–æ—Ä, –ø–æ–∫–∞ –Ω–µ –≤–µ—Ä–Ω–µ—Ç—Å—è —É–∫–∞–∑–∞—Ç–µ–ª—å –Ω–∞ –∑–Ω–∞—á–µ–Ω–∏–µ NULL
        // –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å: `self.dir` –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ –¥–æ–ª–∂–Ω–æ –∏–º–µ—Ç—å –∑–Ω–∞—á–µ–Ω–∏–µ NULL
        let dirent = unsafe { ffi::readdir(self.dir) };
        if dirent.is_null() {
            // –ú—ã –¥–æ—Å—Ç–∏–≥–ª–∏ –∫–æ–Ω—Ü–∞ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏
            return None;
        }
        // –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å: `dirent` –Ω–µ –¥–æ–ª–∂–Ω–æ –∏–º–µ—Ç—å –∑–Ω–∞—á–µ–Ω–∏–µ NULL –∏ `dirent.d_name` –¥–æ–ª–∂–Ω–æ –∑–∞–≤–µ—Ä—à–∞—Ç—å—Å—è NUL
        let d_name = unsafe { CStr::from_ptr((*dirent).d_name.as_ptr()) };
        let os_str = OsStr::from_bytes(d_name.to_bytes());
        Some(os_str.to_owned())
    }
}

impl Drop for DirectoryIterator {
    fn drop(&mut self) {
        // –í—ã–∑—ã–≤–∞–µ–º `closedir` –ø–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏
        if !self.dir.is_null() {
            // –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Ç—å: `self.dir` –Ω–µ –¥–æ–ª–∂–Ω–æ –∏–º–µ—Ç—å –∑–Ω–∞—á–µ–Ω–∏–µ NULL
            if unsafe { ffi::closedir(self.dir) } != 0 {
                panic!("Could not close {:?}", self.path);
            }
        }
    }
}
```

</details>

# –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–π `Rust`

`Rust` –ø–æ–ª–Ω–æ—Å—Ç—å—é –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –ø–∞—Ä–∞–ª–ª–µ–ª–∏–∑–º (concurrency) —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –ø–æ—Ç–æ–∫–æ–≤ –û–° —Å –º—å—é—Ç–µ–∫—Å–∞–º–∏ (mutexes) –∏ –∫–∞–Ω–∞–ª–∞–º–∏ (channels).

–°–∏—Å—Ç–µ–º–∞ —Ç–∏–ø–æ–≤ `Rust` –∏–≥—Ä–∞–µ—Ç –≤–∞–∂–Ω—É—é —Ä–æ–ª—å –≤ —Ç–æ–º, —á—Ç–æ –º–Ω–æ–≥–∏–µ –æ—à–∏–±–∫–∏ –ø–∞—Ä–∞–ª–ª–µ–ª–∏–∑–º–∞ —Å—Ç–∞–Ω–æ–≤—è—Ç—Å—è –æ—à–∏–±–∫–∞–º–∏ –≤—Ä–µ–º–µ–Ω–∏ –∫–æ–º–ø–∏–ª—è—Ü–∏–∏. –≠—Ç–æ —á–∞—Å—Ç–æ –Ω–∞–∑—ã–≤–∞—é—Ç –±–µ—Å—Å—Ç—Ä–∞—à–Ω—ã–º –ø–∞—Ä–∞–ª–ª–µ–ª–∏–∑–º–æ–º (fearless concurrency), –ø–æ—Å–∫–æ–ª—å–∫—É –º—ã –º–æ–∂–µ–º –ø–æ–ª–æ–∂–∏—Ç—å—Å—è –Ω–∞ –∫–æ–º–ø–∏–ª—è—Ç–æ—Ä, –∫–æ—Ç–æ—Ä—ã–π –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—É—é –æ–±—Ä–∞–±–æ—Ç–∫—É –ø–∞—Ä–∞–ª–ª–µ–ª–∏–∑–º–∞ –≤–æ –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è.

## –ü–æ—Ç–æ–∫–∏

–ü–æ—Ç–æ–∫–∏ (threads) `Rust` —Ä–∞–±–æ—Ç–∞—é—Ç –∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ –ø–æ—Ç–æ–∫–∞–º –≤ –¥—Ä—É–≥–∏—Ö —è–∑—ã–∫–∞—Ö:

```rust
use std::thread;
use std::time::Duration;

fn main() {
    thread::spawn(|| {
        for i in 1..10 {
            println!("–∑–Ω–∞—á–µ–Ω–∏–µ —Å—á–µ—Ç—á–∏–∫–∞ –≤ –≤—ã–¥–µ–ª–µ–Ω–Ω–æ–º –ø–æ—Ç–æ–∫–µ: {i}!");
            thread::sleep(Duration::from_millis(5));
        }
    });

    for i in 1..5 {
        println!("–∑–Ω–∞—á–µ–Ω–∏–µ —Å—á–µ—Ç—á–∏–∫–∞ –≤ –æ—Å–Ω–æ–≤–Ω–æ–º –ø–æ—Ç–æ–∫–µ: {i}");
        thread::sleep(Duration::from_millis(5));
    }
}
```

- –ø–æ—Ç–æ–∫–∏ —è–≤–ª—è—é—Ç—Å—è –ø–æ—Ç–æ–∫–∞–º–∏ –¥–µ–º–æ–Ω–∞ (daemon threads), –æ—Å–Ω–æ–≤–Ω–æ–π –ø–æ—Ç–æ–∫ –Ω–µ –∂–¥–µ—Ç –∏—Ö –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
- –ø–æ—Ç–æ–∫–∏ –ø–∞–Ω–∏–∫—É—é—Ç –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –¥—Ä—É–≥ –æ—Ç –¥—Ä—É–≥–∞
  - –ø–∞–Ω–∏–∫–∞ –º–æ–∂–µ—Ç —Å–æ–¥–µ—Ä–∂–∞—Ç—å –ø–æ–ª–µ–∑–Ω—É—é –Ω–∞–≥—Ä—É–∑–∫—É (payload), –∫–æ—Ç–æ—Ä—É—é –º–æ–∂–Ω–æ –∏–∑–≤–ª–µ—á—å —Å –ø–æ–º–æ—â—å—é `downcast_ref`

–†–µ–º–∞—Ä–∫–∏:

- –æ–±—Ä–∞—Ç–∏—Ç–µ –≤–Ω–∏–º–∞–Ω–∏–µ, —á—Ç–æ –æ—Å–Ω–æ–≤–Ω–æ–π –ø–æ—Ç–æ–∫ –Ω–µ –∂–¥–µ—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –≤—ã–¥–µ–ª–µ–Ω–Ω—ã—Ö (spawned) –ø–æ—Ç–æ–∫–æ–≤
- –¥–ª—è –æ–∂–∏–¥–∞–Ω–∏—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –ø–æ—Ç–æ–∫–∞ —Å–ª–µ–¥—É–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `let handle = thread::spawn()` –∏ –∑–∞—Ç–µ–º `handle.join()`
- –≤—ã–∑–æ–≤–∏—Ç–µ –ø–∞–Ω–∏–∫—É –≤ –ø–æ—Ç–æ–∫–µ. –û–±—Ä–∞—Ç–∏—Ç–µ –≤–Ω–∏–º–∞–Ω–∏–µ, —á—Ç–æ —ç—Ç–æ –Ω–µ –≤–ª–∏—è–µ—Ç –Ω–∞ `main`
- –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `Result`, –≤–æ–∑–≤—Ä–∞—â–∞–µ–º—ã–π –∏–∑ `handle.join()`, –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ –ø–æ–ª–µ–∑–Ω–æ–π –Ω–∞–≥—Ä—É–∑–∫–µ –ø–∞–Ω–∏–∫–∏. –í —ç—Ç–æ–º –º–æ–∂–µ—Ç –ø–æ–º–æ—á—å [Any](https://doc.rust-lang.org/std/any/index.html)

__–ü–æ—Ç–æ–∫–∏ —Å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–æ–π –æ–±–ª–∞—Å—Ç—å—é –≤–∏–¥–∏–º–æ—Å—Ç–∏__

–û–±—ã—á–Ω—ã–µ –ø–æ—Ç–æ–∫–∏ –Ω–µ –º–æ–≥—É—Ç –∑–∞–∏–º—Å—Ç–≤–æ–≤–∞—Ç—å –∑–Ω–∞—á–µ–Ω–∏—è –∏–∑ –æ–∫—Ä—É–∂–µ–Ω–∏—è:

```rust
use std::thread;

fn foo() {
    let s = String::from("–ø—Ä–∏–≤–µ—Ç");
    thread::spawn(|| {
        println!("–¥–ª–∏–Ω–∞: {}", s.len());
    });
}

fn main() {
    foo();
}
```

–û–¥–Ω–∞–∫–æ –¥–ª—è —ç—Ç–æ–≥–æ –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å [scoped threads](https://doc.rust-lang.org/std/thread/fn.scope.html) (–ø–æ—Ç–æ–∫–∏ —Å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–æ–π –æ–±–ª–∞—Å—Ç—å—é –≤–∏–¥–∏–º–æ—Å—Ç–∏):

```rust
use std::thread;

fn main() {
    let s = String::from("–ø—Ä–∏–≤–µ—Ç");

    thread::scope(|scope| {
        scope.spawn(|| {
            println!("–¥–ª–∏–Ω–∞: {}", s.len());
        });
    });
}
```

–†–µ–º–∞—Ä–∫–∏:

- –∫–æ–≥–¥–∞ —Ñ—É–Ω–∫—Ü–∏—è `thread::scope` –∑–∞–≤–µ—Ä—à–∞–µ—Ç—Å—è, –≤—Å–µ –ø–æ—Ç–æ–∫–∏ –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ –æ–±—ä–µ–¥–∏–Ω—è—é—Ç—Å—è, –ø–æ—ç—Ç–æ–º—É –æ–Ω–∏ –º–æ–≥—É—Ç –≤–µ—Ä–Ω—É—Ç—å –∑–∞–∏–º—Å—Ç–≤–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
- –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è –æ–±—ã—á–Ω—ã–µ –ø—Ä–∞–≤–∏–ª–∞ –∑–∞–∏–º—Å—Ç–≤–æ–≤–∞–Ω–∏—è `Rust`: –º—ã –º–æ–∂–µ–º –∑–∞–∏–º—Å—Ç–≤–æ–≤–∞—Ç—å –∑–Ω–∞—á–µ–Ω–∏–µ –º—É—Ç–∞–±–µ–ª—å–Ω–æ –≤ –æ–¥–Ω–æ–º –ø–æ—Ç–æ–∫–µ, –∏–ª–∏ –∏–º–º—É—Ç–∞–±–µ–ª—å–Ω–æ –≤ –ª—é–±–æ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–µ –ø–æ—Ç–æ–∫–æ–≤

## –ö–∞–Ω–∞–ª—ã

–ö–∞–Ω–∞–ª—ã (channels) `Rust` —Å–æ—Å—Ç–æ—è—Ç –∏–∑ –¥–≤—É—Ö —á–∞—Å—Ç–µ–π: `Sender<T>` (–æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—å/–ø–µ—Ä–µ–¥–∞—Ç—á–∏–∫) –∏ `Receiver<T>` (–ø–æ–ª—É—á–∞—Ç–µ–ª—å/–ø—Ä–∏–µ–º–Ω–∏–∫). –û–Ω–∏ —Å–æ–µ–¥–∏–Ω—è—é—Ç—Å—è —Å –ø–æ–º–æ—â—å—é –∫–∞–Ω–∞–ª–∞, –Ω–æ –º—ã –≤–∏–¥–∏–º —Ç–æ–ª—å–∫–æ –∫–æ–Ω–µ—á–Ω—ã–µ —Ç–æ—á–∫–∏:

```rust
use std::sync::mpsc;

fn main() {
    let (tx, rx) = mpsc::channel();

    tx.send(10).unwrap();
    tx.send(20).unwrap();

    println!("–ü–æ–ª—É—á–µ–Ω–æ: {:?}", rx.recv());
    println!("–ü–æ–ª—É—á–µ–Ω–æ: {:?}", rx.recv());

    let tx2 = tx.clone();
    tx2.send(30).unwrap();
    println!("–ü–æ–ª—É—á–µ–Ω–æ: {:?}", rx.recv());
}
```

- `mpsc` –æ–∑–Ω–∞—á–∞–µ—Ç Multi-Producer, Single-Consumer (–Ω–µ—Å–∫–æ–ª—å–∫–æ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª–µ–π, –æ–¥–∏–Ω –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—å). `Sender` –∏ `SyncSender` —Ä–µ–∞–ª–∏–∑—É—é—Ç `Clone` (–ø–æ—ç—Ç–æ–º—É –º—ã –º–æ–∂–µ–º —Å–æ–∑–¥–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª–µ–π), –∞ `Receiver` –Ω–µ —Ä–µ–∞–ª–∏–∑—É–µ—Ç (–ø–æ—ç—Ç–æ–º—É —É –Ω–∞—Å –º–æ–∂–µ—Ç –±—ã—Ç—å —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—å)
- `send()` –∏ `recv()` –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç `Result`. –ï—Å–ª–∏ –æ–Ω–∏ –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç `Err`, –∑–Ω–∞—á–∏—Ç —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π `Sender` –∏–ª–∏ `Receiver` —É–Ω–∏—á—Ç–æ–∂–µ–Ω (dropped) –∏ –∫–∞–Ω–∞–ª –∑–∞–∫—Ä—ã—Ç

__–ù–µ—Å–≤—è–∑–∞–Ω–Ω—ã–µ –∫–∞–Ω–∞–ª—ã__

`mpsc::channel()` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –Ω–µ—Å–≤—è–∑–∞–Ω–Ω—ã–π (unbounded) –∏ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –∫–∞–Ω–∞–ª:

```rust
use std::sync::mpsc;
use std::thread;
use std::time::Duration;

fn main() {
    let (tx, rx) = mpsc::channel();

    thread::spawn(move || {
        let thread_id = thread::current().id();
        for i in 1..10 {
            tx.send(format!("–°–æ–æ–±—â–µ–Ω–∏–µ {i}")).unwrap();
            println!("{thread_id:?}: –æ—Ç–ø—Ä–∞–≤–∏–ª —Å–æ–æ–±—â–µ–Ω–∏–µ {i}");
        }
        println!("{thread_id:?}: –≥–æ—Ç–æ–≤–æ");
    });
    thread::sleep(Duration::from_millis(100));

    for msg in rx.iter() {
        println!("–û—Å–Ω–æ–≤–Ω–æ–π –ø–æ—Ç–æ–∫: –ø–æ–ª—É—á–µ–Ω–æ {msg}");
    }
}
```

__–°–≤—è–∑–∞–Ω–Ω—ã–µ –∫–∞–Ω–∞–ª—ã__

`send()` —Å–≤—è–∑–∞–Ω–Ω–æ–≥–æ (bounded) —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–≥–æ –∫–∞–Ω–∞–ª–∞ –±–ª–æ–∫–∏—Ä—É–µ—Ç —Ç–µ–∫—É—â–∏–π –ø–æ—Ç–æ–∫:

```rust
use std::sync::mpsc;
use std::thread;
use std::time::Duration;

fn main() {
    let (tx, rx) = mpsc::sync_channel(3);

    thread::spawn(move || {
        let thread_id = thread::current().id();
        for i in 1..10 {
            tx.send(format!("–°–æ–æ–±—â–µ–Ω–∏–µ {i}")).unwrap();
            println!("{thread_id:?}: –æ—Ç–ø—Ä–∞–≤–∏–ª —Å–æ–æ–±—â–µ–Ω–∏–µ {i}");
        }
        println!("{thread_id:?}: –≥–æ—Ç–æ–≤–æ");
    });
    thread::sleep(Duration::from_millis(100));

    for msg in rx.iter() {
        println!("–û—Å–Ω–æ–≤–Ω–æ–π –ø–æ—Ç–æ–∫: –ø–æ–ª—É—á–µ–Ω–æ {msg}");
    }
}
```

–†–µ–º–∞—Ä–∫–∏:

- –≤—ã–∑–æ–≤ `send()` –±–ª–æ–∫–∏—Ä—É–µ—Ç —Ç–µ–∫—É—â–∏–π –ø–æ—Ç–æ–∫ –¥–æ —Ç–µ—Ö –ø–æ—Ä, –ø–æ–∫–∞ –≤ –∫–∞–Ω–∞–ª–µ –∏–º–µ–µ—Ç—Å—è –º–µ—Å—Ç–æ –¥–ª—è –Ω–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π. –ü–æ—Ç–æ–∫ –º–æ–∂–µ—Ç –±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å—Å—è –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ, –µ—Å–ª–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –ø–æ–ª—É—á–∞—Ç–µ–ª—å
- –≤—ã–∑–æ–≤ `send()` –∑–∞–∫–∞–Ω—á–∏–≤–∞–µ—Ç—Å—è –æ—à–∏–±–∫–æ–π (–ø–æ—ç—Ç–æ–º—É –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è `Result`), –µ—Å–ª–∏ –∫–∞–Ω–∞–ª –∑–∞–∫—Ä—ã—Ç. –ö–∞–Ω–∞–ª –∑–∞–∫—Ä—ã–≤–∞–µ—Ç—Å—è –ø–æ—Å–ª–µ —É–Ω–∏—á—Ç–æ–∂–µ–Ω–∏—è –ø–æ–ª—É—á–∞—Ç–µ–ª—è
- —Å–≤—è–∑–∞–Ω–Ω—ã–π –∫–∞–Ω–∞–ª —Å –Ω—É–ª–µ–≤—ã–º —Ä–∞–∑–º–µ—Ä–æ–º –Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è "rendezvous channel". –ö–∞–∂–¥—ã–π –≤—ã–∑–æ–≤ `send()` –±–ª–æ–∫–∏—Ä—É–µ—Ç —Ç–µ–∫—É—â–∏–π –ø–æ—Ç–æ–∫, –ø–æ–∫–∞ –¥—Ä—É–≥–æ–π –ø–æ—Ç–æ–∫ –Ω–µ –≤—ã–∑–æ–≤–µ—Ç `read()`

## Send –∏ Sync

–û—Ç–∫—É–¥–∞ `Rust` –∑–Ω–∞–µ—Ç –æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –∑–∞–ø—Ä–µ—Ç–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ –æ–±—â–µ–º—É (shared) —Å–æ—Å—Ç–æ—è–Ω–∏—é –∏–∑ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –ø–æ—Ç–æ–∫–æ–≤? –û—Ç–≤–µ—Ç –∫—Ä–æ–µ—Ç—Å—è –≤ –¥–≤—É—Ö —Ç—Ä–µ–π—Ç–∞—Ö:

- [Send](https://doc.rust-lang.org/std/marker/trait.Send.html): —Ç–∏–ø `T` —è–≤–ª—è–µ—Ç—Å—è `Send`, –µ—Å–ª–∏ –ø–µ—Ä–µ–¥–∞—á–∞ `T` –≤ –¥—Ä—É–≥–æ–π –ø–æ—Ç–æ–∫ —è–≤–ª—è–µ—Ç—Å—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–π
- [Sync](https://doc.rust-lang.org/std/marker/trait.Sync.html): —Ç–∏–ø `T` —è–≤–ª—è–µ—Ç—Å—è `Sync`, –µ—Å–ª–∏ –ø–µ—Ä–µ–¥–∞—á–∞ `&T` –≤ –¥—Ä—É–≥–æ–π –ø–æ—Ç–æ–∫ —è–≤–ª—è–µ—Ç—Å—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–π

`Send` –∏ `Sync` —è–≤–ª—è—é—Ç—Å—è [–Ω–µ–±–µ–∑–æ–ø–∞—Å–Ω—ã–º–∏ —Ç—Ä–µ–π—Ç–∞–º–∏](https://google.github.io/comprehensive-rust/unsafe/unsafe-traits.html). –ö–æ–º–ø–∏–ª—è—Ç–æ—Ä –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Ä–µ–∞–ª–∏–∑—É–µ—Ç –∏—Ö –¥–ª—è –Ω–∞—à–∏—Ö —Ç–∏–ø–æ–≤ –ø—Ä–∏ —É—Å–ª–æ–≤–∏–∏, —á—Ç–æ –æ–Ω–∏ —Å–æ–¥–µ—Ä–∂–∞—Ç —Ç–æ–ª—å–∫–æ —Ç–∏–ø—ã `Send` –∏ `Sync`. –≠—Ç–∏ —Ç–∏–ø—ã –º–æ–∂–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ, –µ—Å–ª–∏ –º—ã —É–≤–µ—Ä–µ–Ω—ã –≤ –≤–∞–ª–∏–¥–Ω–æ—Å—Ç–∏ –Ω–∞—à–∏—Ö —Ç–∏–ø–æ–≤.

–†–µ–º–∞—Ä–∫–∏:

- –æ —Ç–∏–ø–∞—Ö `Send` –∏ `Sync` –º–æ–∂–Ω–æ –¥—É–º–∞—Ç—å –∫–∞–∫ –æ –º–∞—Ä–∫–µ—Ä–∞—Ö —Ç–æ–≥–æ, —á—Ç–æ —Ç–∏–ø —Å–æ–¥–µ—Ä–∂–∏—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ –±–µ–∑–æ–ø–∞—Å–Ω—ã—Ö —Å —Ç–æ—á–∫–∏ –∑—Ä–µ–Ω–∏—è –ø–æ—Ç–æ–∫–æ–≤ (thread-safety) —Å–≤–æ–π—Å—Ç–≤
- —ç—Ç–∏ —Ç–∏–ø—ã –º–æ–≥—É—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –≤ –∫–∞—á–µ—Å—Ç–≤–µ –æ–±—â–∏—Ö –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π –ø–æ –∞–Ω–∞–ª–æ–≥–∏–∏ —Å –æ–±—ã—á–Ω—ã–º–∏ —Ç—Ä–µ–π—Ç–∞–º–∏

__Send__

–¢–∏–ø `T` —è–≤–ª—è–µ—Ç—Å—è `Send`, –µ—Å–ª–∏ –ø–µ—Ä–µ–¥–∞—á–∞ –∑–Ω–∞—á–µ–Ω–∏—è `T` –≤ –¥—Ä—É–≥–æ–π –ø–æ—Ç–æ–∫ —è–≤–ª—è–µ—Ç—Å—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–π.

–≠—Ñ—Ñ–µ–∫—Ç –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏—è –≤–ª–∞–¥–µ–Ω–∏—è –≤ –¥—Ä—É–≥–æ–π –ø–æ—Ç–æ–∫ –∑–∞–∫–ª—é—á–∞–µ—Ç—Å—è –≤ —Ç–æ–º, —á—Ç–æ –¥–µ—Å—Ç—Ä—É–∫—Ç–æ—Ä—ã `T` –∑–∞–ø—É—Å–∫–∞—é—Ç—Å—è –≤ —ç—Ç–æ–º –Ω–æ–≤–æ–º –ø–æ—Ç–æ–∫–µ. –ü–æ—ç—Ç–æ–º—É –≤–æ–ø—Ä–æ—Å —Å–æ—Å—Ç–æ–∏—Ç –≤ —Ç–æ–º, –∫–æ–≥–¥–∞ –º—ã –º–æ–∂–µ–º –≤—ã–¥–µ–ª–∏—Ç—å –∑–Ω–∞—á–µ–Ω–∏–µ –≤ –æ–¥–Ω–æ–º –ø–æ—Ç–æ–∫–µ –∏ –æ—Å–≤–æ–±–æ–¥–∏—Ç—å –µ–≥–æ –≤ –¥—Ä—É–≥–æ–º –ø–æ—Ç–æ–∫–µ.

–ù–∞–ø—Ä–∏–º–µ—Ä, –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ `SQLite` –¥–æ—Å—Ç—É–ø–Ω–æ —Ç–æ–ª—å–∫–æ –≤ –æ–¥–Ω–æ–º –ø–æ—Ç–æ–∫–µ.

__Sync__

–¢–∏–ø `T` —è–≤–ª—è–µ—Ç—Å—è `Sync`, –µ—Å–ª–∏ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π –¥–æ—Å—Ç—É–ø –∫ –∑–Ω–∞—á–µ–Ω–∏—é `T` –∏–∑ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –ø–æ—Ç–æ–∫–æ–≤ —è–≤–ª—è–µ—Ç—Å—è –±–µ–∑–æ–ø–∞—Å–Ω—ã–º.

–ï—Å–ª–∏ –±—ã—Ç—å –±–æ–ª–µ–µ —Ç–æ—á–Ω—ã–º, –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –≥–ª–∞—Å–∏—Ç —Å–ª–µ–¥—É—é—â–µ–µ: `T` —è–≤–ª—è–µ—Ç—Å—è `Sync`, –µ—Å–ª–∏ –∏ —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ `&T` —è–≤–ª—è–µ—Ç—Å—è `Send`.

–≠—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ –µ—Å–ª–∏ —Ç–∏–ø —è–≤–ª—è–µ—Ç—Å—è "–ø–æ—Ç–æ–∫–æ–±–µ–∑–æ–ø–∞—Å–Ω—ã–º" (thread-safe) –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–Ω–æ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è, –æ–Ω —Ç–∞–∫–∂–µ –ø–æ—Ç–æ–∫–æ–±–µ–∑–æ–ø–∞—Å–µ–Ω –¥–ª—è –ø–µ—Ä–µ–¥–∞—á–∏ —Å—Å—ã–ª–æ–∫ –º–µ–∂–¥—É –ø–æ—Ç–æ–∫–∞–º–∏.

–ï—Å–ª–∏ —Ç–∏–ø —è–≤–ª—è–µ—Ç—Å—è `Sync`, –µ–≥–æ –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –ø–æ—Ç–æ–∫–∞—Ö –±–µ–∑ —Ä–∏—Å–∫–∞ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏—è –≥–æ–Ω–æ–∫ –∑–∞ –¥–∞–Ω–Ω—ã–º–∏ (data race) –∏ –¥—Ä—É–≥–∏—Ö –ø—Ä–æ–±–ª–µ–º —Å —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–µ–π, –ø–æ—ç—Ç–æ–º—É –µ–≥–æ –º–æ–∂–Ω–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ –ø–µ—Ä–µ–º–µ—â–∞—Ç—å –≤ –¥—Ä—É–≥–æ–π –ø–æ—Ç–æ–∫. –°—Å—ã–ª–∫–∞ –Ω–∞ —Ç–∏–ø —Ç–∞–∫–∂–µ –º–æ–∂–µ—Ç –±–µ–∑–æ–ø–∞—Å–Ω–æ –ø–µ—Ä–µ–º–µ—â–∞—Ç—å—Å—è –≤ –¥—Ä—É–≥–æ–π –ø–æ—Ç–æ–∫, –ø–æ—Å–∫–æ–ª—å–∫—É –¥–æ—Å—Ç—É–ø –∫ –¥–∞–Ω–Ω—ã–º, –Ω–∞ –∫–æ—Ç–æ—Ä—ã–µ –æ–Ω–∞ —Å—Å—ã–ª–∞–µ—Ç—Å—è, –∏–∑ –ª—é–±–æ–≥–æ –ø–æ—Ç–æ–∫–∞ —è–≤–ª—è–µ—Ç—Å—è –±–µ–∑–æ–ø–∞—Å–Ω—ã–º.

__–ü—Ä–∏–º–µ—Ä—ã__

_Send + Sync_

–ë–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ —Ç–∏–ø–æ–≤ —è–≤–ª—è–µ—Ç—Å—è `Send + Sync`:

- `i8`, `f32`, `bool`, `char`, `&str` etc.
- `(T1, T2)`, `[T; N]`, `&[T]`, `struct { x: T }` etc.
- `String`, `Option<T>`, `Vec<T>`, `Box<T>` etc.
- `Arc<T>` - —è–≤–Ω–æ –ø–æ—Ç–æ–∫–æ–±–µ–∑–æ–ø–∞—Å–Ω—ã–π –±–ª–∞–≥–æ–¥–∞—Ä—è –∞—Ç–æ–º–∞—Ä–Ω–æ–º—É –ø–æ–¥—Å—á–µ—Ç—É —Å—Å—ã–ª–æ–∫
- `Mutex<T>` - —è–≤–Ω–æ –ø–æ—Ç–æ–∫–æ–±–µ–∑–æ–ø–∞—Å–Ω—ã–π –±–ª–∞–≥–æ–¥–∞—Ä—è –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–π –±–ª–æ–∫–∏—Ä–æ–≤–∫–µ
- `AtomicBool`, `AtomicU8` etc., –≥–¥–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ –∞—Ç–æ–º–∞—Ä–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏

–î–∂–µ–Ω–µ—Ä–∏–∫–∏ –æ–±—ã—á–Ω–æ —è–≤–ª—è—é—Ç—Å—è `Send + Sync`, –∫–æ–≥–¥–∞ —Ç–∞–∫–æ–≤—ã–º–∏ —è–≤–ª—è—é—Ç—Å—è –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —Ç–∏–ø–æ–≤.

_Send + !Sync_

–≠—Ç–∏ —Ç–∏–ø—ã –º–æ–≥—É—Ç –ø–µ—Ä–µ–º–µ—â–∞—Ç—å—Å—è –≤ –¥—Ä—É–≥–∏–µ –ø–æ—Ç–æ–∫–∏, –Ω–æ –Ω–µ —è–≤–ª—è—é—Ç—Å—è –ø–æ—Ç–æ–∫–æ–±–µ–∑–æ–ø–∞—Å–Ω—ã–º–∏. –û–±—ã—á–Ω–æ —ç—Ç–æ —Å–≤—è–∑–∞–Ω–æ —Å –∏—Ö –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–π –∏–∑–º–µ–Ω—á–∏–≤–æ—Å—Ç—å—é:

- `mpsc::Sender<T>`
- `mpsc::Receiver<T>`
- `Cell<T>`
- `RefCell<T>`

_!Send + Sync_

–≠—Ç–∏ —Ç–∏–ø—ã —è–≤–ª—è—é—Ç—Å—è –ø–æ—Ç–æ–∫–æ–±–µ–∑–æ–ø–∞—Å–Ω—ã–º–∏, –Ω–æ –Ω–µ –º–æ–≥—É—Ç –ø–µ—Ä–µ–º–µ—â–∞—Ç—å—Å—è –≤ –¥—Ä—É–≥–∏–µ –ø–æ—Ç–æ–∫–∏:

- `MutexGuard<T: Sync>` - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –ø—Ä–∏–º–∏—Ç–∏–≤—ã —É—Ä–æ–≤–Ω—è –û–°, –∫–æ—Ç–æ—Ä—ã–µ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –æ—Å–≤–æ–±–æ–∂–¥–µ–Ω—ã –≤ —Å–æ–∑–¥–∞–≤—à–µ–º –∏—Ö –ø–æ—Ç–æ–∫–µ

_!Send + !Sync_

–≠—Ç–∏ —Ç–∏–ø—ã –Ω–µ —è–≤–ª—è—é—Ç—Å—è –ø–æ—Ç–æ–∫–æ–±–µ–∑–æ–ø–∞—Å–Ω—ã–º–∏ –∏ –Ω–µ –º–æ–≥—É—Ç –ø–µ—Ä–µ–º–µ—â–∞—Ç—å—Å—è –≤ –¥—Ä—É–≥–æ–π –ø–æ—Ç–æ–∫:

- `Rc<T>` - –∫–∞–∂–¥—ã–π `Rc<T>` —Å–æ–¥–µ—Ä–∂–∏—Ç —Å—Å—ã–ª–∫—É –Ω–∞ `RcBox<T>`, –∫–æ—Ç–æ—Ä—ã–π —Å–æ–¥–µ—Ä–∂–∏—Ç –Ω–µ–∞—Ç–æ–º–∞—Ä–Ω—ã–π —Å—á–µ—Ç—á–∏–∫ —Å—Å—ã–ª–æ–∫
- `*const T`, `*mut T` - `Rust` –ø—Ä–µ–¥–ø–æ–ª–∞–≥–∞–µ—Ç, —á—Ç–æ —Å—ã—Ä—ã–µ —É–∫–∞–∑–∞—Ç–µ–ª–∏ –º–æ–≥—É—Ç –∏–º–µ—Ç—å –Ω—é–∞–Ω—Å—ã, —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Å –∏—Ö –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–º –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ–º

## –û–±—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ

`Rust` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Å–∏—Å—Ç–µ–º—É —Ç–∏–ø–æ–≤ –¥–ª—è –æ–±–µ—Å–ø–µ—á–µ–Ω–∏—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –æ–±—â–∏—Ö (shared) –¥–∞–Ω–Ω—ã—Ö. –≠—Ç–æ –¥–µ–ª–∞–µ—Ç—Å—è –≤ –æ—Å–Ω–æ–≤–Ω–æ–º —Å –ø–æ–º–æ—â—å—é –¥–≤—É—Ö —Ç–∏–ø–æ–≤:

- [`Arc<T>`](https://doc.rust-lang.org/std/sync/struct.Arc.html) - –∞—Ç–æ–º–∞—Ä–Ω—ã–π —Å—á–µ—Ç—á–∏–∫ —Å—Å—ã–ª–æ–∫ –Ω–∞ `T`: –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –ø–µ—Ä–µ–¥–∞—á—É –º–µ–∂–¥—É –ø–æ—Ç–æ–∫–∞–º–∏ –∏ –æ—Å–≤–æ–±–æ–∂–¥–∞–µ—Ç `T` –ø—Ä–∏ —É–Ω–∏—á—Ç–æ–∂–µ–Ω–∏–∏ –ø–æ—Å–ª–µ–¥–Ω–µ–π —Å—Å—ã–ª–∫–∏ –Ω–∞ –Ω–µ–µ
- [`Mutex<T>`](https://doc.rust-lang.org/std/sync/struct.Mutex.html) - –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –≤–∑–∞–∏–º–æ–∏—Å–∫–ª—é—á–∞—é—â–∏–π –¥–æ—Å—Ç—É–ø –∫ –∑–Ω–∞—á–µ–Ω–∏—é `T`

__Arc__

`Arc<T>` –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –æ–±—â–∏–π –¥–æ—Å—Ç—É–ø —Ç–æ–ª—å–∫–æ –¥–ª—è —á—Ç–µ–Ω–∏—è –∫ `T` —á–µ—Ä–µ–∑ `Arc::clone()`:

```rust
use std::sync::Arc;
use std::thread;

fn main() {
    let v = Arc::new(vec![10, 20, 30]);
    let mut handles = Vec::new();
    for _ in 1..5 {
        let v = Arc::clone(&v);
        handles.push(thread::spawn(move || {
            let thread_id = thread::current().id();
            println!("{thread_id:?}: {v:?}");
        }));
    }

    handles.into_iter().for_each(|h| h.join().unwrap());
    println!("v: {v:?}");
}
```

–†–µ–º–∞—Ä–∫–∏:

- `Arc` –æ–∑–Ω–∞—á–∞–µ—Ç Atomic Reference Counter (–∞—Ç–æ–º–∞—Ä–Ω—ã–π —Å—á–µ—Ç—á–∏–∫ —Å—Å—ã–ª–æ–∫) –∏ —è–≤–ª—è–µ—Ç—Å—è –ø–æ—Ç–æ–∫–æ–±–µ–∑–æ–ø–∞—Å–Ω–æ–π –≤–µ—Ä—Å–∏–µ–π `Rc`, –≤ –∫–æ—Ç–æ—Ä–æ–π –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –∞—Ç–æ–º–∞—Ä–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏
- `Arc<T>` —Ä–µ–∞–ª–∏–∑—É–µ—Ç `Clone` –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –æ—Ç —Ç–æ–≥–æ, –¥–µ–ª–∞–µ—Ç –ª–∏ —ç—Ç–æ `T`. –û–Ω —Ä–µ–∞–ª–∏–∑—É–µ—Ç `Send` –∏ `Sync`, —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ `T` –∏—Ö —Ä–µ–∞–ª–∏–∑—É–µ—Ç
- `Arc::clone()` –∏–º–µ–µ—Ç –Ω–µ–∫–æ—Ç–æ—Ä—É—é —Ü–µ–Ω—É –∑–∞ —Å—á–µ—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∞—Ç–æ–º–∞—Ä–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π, –Ω–æ –ø–æ—Å–ª–µ —ç—Ç–æ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `T` —è–≤–ª—è–µ—Ç—Å—è –±–µ—Å–ø–ª–∞—Ç–Ω—ã–º
- –æ—Å—Ç–µ—Ä–µ–≥–∞–π—Ç–µ—Å—å —Å—Å—ã–ª–æ—á–Ω—ã—Ö —Ü–∏–∫–ª–æ–≤, `Arc` –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Å–±–æ—Ä—â–∏–∫ –º—É—Å–æ—Ä–∞ –¥–ª—è –∏—Ö –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏—è
  - –≤ —ç—Ç–æ–º –º–æ–∂–µ—Ç –ø–æ–º–æ—á—å `std::sync::Weak`

__Mutex__

`Mutex<T>` –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –≤–∑–∞–∏–º–Ω–æ–µ –∏—Å–∫–ª—é—á–µ–Ω–∏–µ –∏ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –º—É—Ç–∞–±–µ–ª—å–Ω—ã–π –¥–æ—Å—Ç—É–ø –∫ `T` —á–µ—Ä–µ–∑ –¥–æ—Å—Ç—É–ø–Ω—ã–π —Ç–æ–ª—å–∫–æ –¥–ª—è —á—Ç–µ–Ω–∏—è –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å (—Ñ–æ—Ä–º–∞ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–π –∏–∑–º–µ–Ω—á–∏–≤–æ—Å—Ç–∏):

```rust
use std::sync::Mutex;

fn main() {
    let v = Mutex::new(vec![10, 20, 30]);
    println!("v: {:?}", v.lock().unwrap());

    {
        let mut guard = v.lock().unwrap();
        guard.push(40);
    }

    println!("v: {:?}", v.lock().unwrap());
}
```

–û–±—Ä–∞—Ç–∏—Ç–µ –≤–Ω–∏–º–∞–Ω–∏–µ –Ω–∞ –Ω–µ—è–≤–Ω—É—é —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é (`impl<T: Send> Sync for Mutex<T>`)[https://doc.rust-lang.org/std/sync/struct.Mutex.html#impl-Sync-for-Mutex%3CT%3E](https://doc.rust-lang.org/std/sync/struct.Mutex.html#impl-Sync-for-Mutex%3CT%3E).

–†–µ–º–∞—Ä–∫–∏:

- `Mutex` –≤ `Rust` –ø–æ—Ö–æ–∂ –Ω–∞ –∫–æ–ª–ª–µ–∫—Ü–∏—é, —Å–æ—Å—Ç–æ—è—â—É—é –∏–∑ –æ–¥–Ω–æ–≥–æ —ç–ª–µ–º–µ–Ω—Ç–∞ - –∑–∞—â–∏—â–µ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
  - –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ –∑–∞–±—ã—Ç—å –ø–æ–ª—É—á–∏—Ç—å (acquire) –º—å—é—Ç–µ–∫—Å –ø–µ—Ä–µ–¥ –¥–æ—Å—Ç—É–ø–æ–º –∫ –∑–∞—â–∏—â–µ–Ω–Ω—ã–º –¥–∞–Ω–Ω—ã–º
- –∏–∑ `&Mutex<T>` —á–µ—Ä–µ–∑ –±–ª–æ–∫–∏—Ä–æ–≤–∫—É (lock) –º–æ–∂–Ω–æ –ø–æ–ª—É—á–∏—Ç—å `&mut T`. `MutexGuard` –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç, —á—Ç–æ `&mut T` –Ω–µ –∂–∏–≤–µ—Ç –¥–æ–ª—å—à–µ —É–¥–µ—Ä–∂–∏–≤–∞–µ–º–æ–π (held) –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏
- `Mutex<T>` —Ä–µ–∞–ª–∏–∑—É–µ—Ç `Send` –∏ `Sync`, —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ `T` —Ä–µ–∞–ª–∏–∑—É–µ—Ç `Send`
- `RwLock` —è–≤–ª—è–µ—Ç—Å—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–æ–π, –¥–æ—Å—Ç—É–ø–Ω–æ–π –∫–∞–∫ –¥–ª—è —á—Ç–µ–Ω–∏—è, —Ç–∞–∫ –∏ –¥–ª—è –∑–∞–ø–∏—Å–∏
- –ø–æ—á–µ–º—É `lock()` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `Result`?
  - –ï—Å–ª–∏ –ø–æ—Ç–æ–∫, –≤ –∫–æ—Ç–æ—Ä–æ–º –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –º—å—é—Ç–µ–∫—Å, –ø–∞–Ω–∏–∫—É–µ—Ç, –º—å—é—Ç–µ–∫—Å —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è "–æ—Ç—Ä–∞–≤–ª–µ–Ω–Ω—ã–º" (poisoned), —Å–∏–≥–Ω–∞–ª–∏–∑–∏—Ä—É—è –æ —Ç–æ–º, —á—Ç–æ –∑–∞—â–∏—â–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –º–æ–≥—É—Ç –Ω–∞—Ö–æ–¥–∏—Ç—å—Å—è –≤ –Ω–µ—Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ–º —Å–æ—Å—Ç–æ—è–Ω–∏–∏. –í—ã–∑–æ–≤ `lock()` –Ω–∞ –æ—Ç—Ä–∞–≤–ª–µ–Ω–Ω–æ–º –º—å—é—Ç–µ–∫—Å–µ –ø—Ä–æ–≤–∞–ª–∏–≤–∞–µ—Ç—Å—è —Å [PoisonError](https://doc.rust-lang.org/std/sync/struct.PoisonError.html). –î–ª—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –º–æ–∂–Ω–æ –≤—ã–∑–≤–∞—Ç—å `into_iter()` –Ω–∞ –æ—à–∏–±–∫–µ

__–ü—Ä–∏–º–µ—Ä__

–†–∞—Å—Å–º–æ—Ç—Ä–∏–º `Arc` –∏ `Mutex` –≤ –¥–µ–π—Å—Ç–≤–∏–∏:

```rust
use std::thread;
// use std::sync::{Arc, Mutex};

fn main() {
    let v = vec![10, 20, 30];
    let handle = thread::spawn(|| {
        v.push(10);
    });
    v.push(1000);

    handle.join().unwrap();
    println!("v: {v:?}");
}
```

–í–æ–∑–º–æ–∂–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ:

```rust
use std::sync::{Arc, Mutex};
use std::thread;

fn main() {
    let v = Arc::new(Mutex::new(vec![10, 20, 30]));

    let v2 = Arc::clone(&v);
    let handle = thread::spawn(move || {
        let mut v2 = v2.lock().unwrap();
        v2.push(10);
    });

    {
        let mut v = v.lock().unwrap();
        v.push(1000);
    }

    handle.join().unwrap();

    println!("v: {v:?}");
}
```

–†–µ–º–∞—Ä–∫–∏:

- `v` –æ–±–µ—Ä–Ω—É—Ç –≤ `Arc` –∏ `Mutex`, –ø–æ—Å–∫–æ–ª—å–∫—É –∏—Ö –∑–æ–Ω—ã –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏ –æ—Ä—Ç–æ–≥–æ–Ω–∞–ª—å–Ω—ã
  - –æ–±–æ—Ä–∞—á–∏–≤–∞–Ω–∏–µ `Mutex` –≤ `Arc` —è–≤–ª—è–µ—Ç—Å—è —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω–µ–Ω–Ω—ã–º –ø–∞—Ç—Ç–µ—Ä–Ω–æ–º –¥–ª—è –ø–µ—Ä–µ–¥–∞—á–∏ –º—É—Ç–∞–±–µ–ª—å–Ω–æ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è –º–µ–∂–¥—É –ø–æ—Ç–æ–∫–∞–º–∏
- `v: Arc<_>` –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –∫–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω –∫–∞–∫ `v2` –¥–ª—è –ø–µ—Ä–µ–¥–∞—á–∏ –≤ –¥—Ä—É–≥–æ–π –ø–æ—Ç–æ–∫. –û–±—Ä–∞—Ç–∏—Ç–µ –≤–Ω–∏–º–∞–Ω–∏–µ –Ω–∞ `move` –≤ —Å–∏–≥–Ω–∞—Ç—É—Ä–µ –ª—è–º–±–¥—ã
- –±–ª–æ–∫–∏ –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω—ã –¥–ª—è –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–≥–æ —Å—É–∂–µ–Ω–∏—è –æ–±–ª–∞—Å—Ç–∏ –≤–∏–¥–∏–º–æ—Å—Ç–∏ `LockGuard`

## –£–ø—Ä–∞–∂–Ω–µ–Ω–∏—è

–ü–æ–ø—Ä–∞–∫—Ç–∏–∫—É–µ–º—Å—è –ø—Ä–∏–º–µ–Ω—è—Ç—å –Ω–æ–≤—ã–µ –∑–Ω–∞–Ω–∏—è –Ω–∞ –¥–≤—É—Ö —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è—Ö:

- [–æ–±–µ–¥–∞—é—â–∏–µ —Ñ–∏–ª–æ—Å–æ—Ñ—ã](https://ru.wikipedia.org/wiki/%D0%97%D0%B0%D0%B4%D0%B0%D1%87%D0%B0_%D0%BE%D0%B1_%D0%BE%D0%B1%D0%B5%D0%B4%D0%B0%D1%8E%D1%89%D0%B8%D1%85_%D1%84%D0%B8%D0%BB%D0%BE%D1%81%D0%BE%D1%84%D0%B0%D1%85) - –∫–ª–∞—Å—Å–∏—á–µ—Å–∫–∞—è –∑–∞–¥–∞—á–∞ –ø–∞—Ä–∞–ª–ª–µ–ª–∏–∑–º–∞
- –º–Ω–æ–≥–æ–ø–æ—Ç–æ—á–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å—Å—ã–ª–æ–∫

__–û–±–µ–¥–∞—é—â–∏–µ —Ñ–∏–ª–æ—Å–æ—Ñ—ã__

–£—Å–ª–æ–≤–∏—è –∑–∞–¥–∞—á–∏:

–ü—è—Ç—å –±–µ–∑–º–æ–ª–≤–Ω—ã—Ö —Ñ–∏–ª–æ—Å–æ—Ñ–æ–≤ —Å–∏–¥—è—Ç –≤–æ–∫—Ä—É–≥ –∫—Ä—É–≥–ª–æ–≥–æ —Å—Ç–æ–ª–∞, –ø–µ—Ä–µ–¥ –∫–∞–∂–¥—ã–º —Ñ–∏–ª–æ—Å–æ—Ñ–æ–º —Å—Ç–æ–∏—Ç —Ç–∞—Ä–µ–ª–∫–∞ —Å–ø–∞–≥–µ—Ç—Ç–∏. –ù–∞ —Å—Ç–æ–ª–µ –º–µ–∂–¥—É –∫–∞–∂–¥–æ–π –ø–∞—Ä–æ–π –±–ª–∏–∂–∞–π—à–∏—Ö —Ñ–∏–ª–æ—Å–æ—Ñ–æ–≤ –ª–µ–∂–∏—Ç –ø–æ –æ–¥–Ω–æ–π –≤–∏–ª–∫–µ.

–ö–∞–∂–¥—ã–π —Ñ–∏–ª–æ—Å–æ—Ñ –º–æ–∂–µ—Ç –ª–∏–±–æ –µ—Å—Ç—å, –ª–∏–±–æ —Ä–∞–∑–º—ã—à–ª—è—Ç—å. –ü—Ä–∏–µ–º –ø–∏—â–∏ –Ω–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º –æ—Å—Ç–∞–≤—à–∏—Ö—Å—è —Å–ø–∞–≥–µ—Ç—Ç–∏ - –ø–æ–¥—Ä–∞–∑—É–º–µ–≤–∞–µ—Ç—Å—è –±–µ—Å–∫–æ–Ω–µ—á–Ω—ã–π –∑–∞–ø–∞—Å. –¢–µ–º –Ω–µ –º–µ–Ω–µ–µ, —Ñ–∏–ª–æ—Å–æ—Ñ –º–æ–∂–µ—Ç –µ—Å—Ç—å —Ç–æ–ª—å–∫–æ —Ç–æ–≥–¥–∞, –∫–æ–≥–¥–∞ –¥–µ—Ä–∂–∏—Ç –¥–≤–µ –≤–∏–ª–∫–∏ - –≤–∑—è—Ç—É—é —Å–ø—Ä–∞–≤–∞ –∏ —Å–ª–µ–≤–∞.

–ö–∞–∂–¥—ã–π —Ñ–∏–ª–æ—Å–æ—Ñ –º–æ–∂–µ—Ç –≤–∑—è—Ç—å –±–ª–∏–∂–∞–π—à—É—é –≤–∏–ª–∫—É (–µ—Å–ª–∏ –æ–Ω–∞ –¥–æ—Å—Ç—É–ø–Ω–∞) –∏–ª–∏ –ø–æ–ª–æ–∂–∏—Ç—å - –µ—Å–ª–∏ –æ–Ω —É–∂–µ –¥–µ—Ä–∂–∏—Ç –µ–µ. –í–∑—è—Ç–∏–µ –∫–∞–∂–¥–æ–π –≤–∏–ª–∫–∏ –∏ –≤–æ–∑–≤—Ä–∞—â–µ–Ω–∏–µ –µ–µ –Ω–∞ —Å—Ç–æ–ª —è–≤–ª—è—é—Ç—Å—è —Ä–∞–∑–¥–µ–ª—å–Ω—ã–º–∏ –¥–µ–π—Å—Ç–≤–∏—è–º–∏, –∫–æ—Ç–æ—Ä—ã–µ –¥–æ–ª–∂–Ω—ã –≤—ã–ø–æ–ª–Ω—è—Ç—å—Å—è –æ–¥–Ω–æ –∑–∞ –¥—Ä—É–≥–∏–º.

–ó–∞–¥–∞—á–∞ –∑–∞–∫–ª—é—á–∞–µ—Ç—Å—è –≤ —Ç–æ–º, —á—Ç–æ–±—ã —Ä–∞–∑—Ä–∞–±–æ—Ç–∞—Ç—å –º–æ–¥–µ–ª—å (–ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–π –∞–ª–≥–æ—Ä–∏—Ç–º), –ø—Ä–∏ –∫–æ—Ç–æ—Ä–æ–π –Ω–∏ –æ–¥–∏–Ω –∏–∑ —Ñ–∏–ª–æ—Å–æ—Ñ–æ–≤ –Ω–µ –±—É–¥–µ—Ç –≥–æ–ª–æ–¥–∞—Ç—å, —Ç–æ –µ—Å—Ç—å –±—É–¥–µ—Ç —á–µ—Ä–µ–¥–æ–≤–∞—Ç—å –ø—Ä–∏–µ–º –ø–∏—â–∏ –∏ —Ä–∞–∑–º—ã—à–ª–µ–Ω–∏—è 100 —Ä–∞–∑.

```rust
use std::sync::{mpsc, Arc, Mutex};
use std::thread;
use std::time::Duration;

struct Fork;

struct Philosopher {
    name: String,
    // left_fork: ...
    // right_fork: ...
    // thoughts: ...
}

impl Philosopher {
    fn think(&self) {
        self.thoughts
            .send(format!("–≠–≤—Ä–∏–∫–∞! {} —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–ª(–∞) –Ω–æ–≤—É—é –∏–¥–µ—é!", &self.name))
            .unwrap();
    }

    fn eat(&self) {
        // –ë–µ—Ä–µ–º –≤–∏–ª–∫–∏
        println!("{} –µ—Å—Ç...", &self.name);
        thread::sleep(Duration::from_millis(10));
    }
}

static PHILOSOPHERS: &[&str] =
    &["–°–æ–∫—Ä–∞—Ç", "–ì–∏–ø–∞—Ç–∏—è", "–ü–ª–∞—Ç–æ–Ω", "–ê—Ä–∏—Å—Ç–æ—Ç–µ–ª—å", "–ü–∏—Ñ–∞–≥–æ—Ä"];

fn main() {
    // –°–æ–∑–¥–∞–µ–º –≤–∏–ª–∫–∏

    // –°–æ–∑–¥–∞–µ–º —Ñ–∏–ª–æ—Å–æ—Ñ–æ–≤

    // –ö–∞–∂–¥—ã–π —Ñ–∏–ª–æ—Å–æ—Ñ —Ä–∞–∑–º—ã—à–ª—è–µ—Ç –∏ –µ—Å—Ç 100 —Ä–∞–∑

    // –í—ã–≤–æ–¥–∏–º —Ä–∞–∑–º—ã—à–ª–µ–Ω–∏—è —Ñ–∏–ª–æ—Å–æ—Ñ–æ–≤
}
```

–ü–æ–¥—Å–∫–∞–∑–∫–∞: —Ä–∞—Å—Å–º–æ—Ç—Ä–∏—Ç–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è [std::mem::swap](https://doc.rust-lang.org/std/mem/fn.swap.html) –¥–ª—è —Ä–µ—à–µ–Ω–∏—è –ø—Ä–æ–±–ª–µ–º—ã –≤–∑–∞–∏–º–Ω–æ–π –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ (deadlock).

<details>
<summary>–†–µ—à–µ–Ω–∏–µ:</summary>

```rust
use std::sync::{mpsc, Arc, Mutex};
use std::thread;
use std::time::Duration;

struct Fork;

struct Philosopher {
    name: String,
    left_fork: Arc<Mutex<Fork>>,
    right_fork: Arc<Mutex<Fork>>,
    thoughts: mpsc::SyncSender<String>,
}

impl Philosopher {
    fn think(&self) {
        self.thoughts
            .send(format!("–≠–≤—Ä–∏–∫–∞! {} —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–ª(–∞) –Ω–æ–≤—É—é –∏–¥–µ—é!", &self.name))
            .unwrap();
    }

    fn eat(&self) {
        println!("{} –ø—ã—Ç–∞–µ—Ç—Å—è –µ—Å—Ç—å", &self.name);

        let _left = self.left_fork.lock().unwrap();
        let _right = self.right_fork.lock().unwrap();

        println!("{} –µ—Å—Ç...", &self.name);

        thread::sleep(Duration::from_millis(10));
    }
}

static PHILOSOPHERS: &[&str] =
    &["–°–æ–∫—Ä–∞—Ç", "–ì–∏–ø–∞—Ç–∏—è", "–ü–ª–∞—Ç–æ–Ω", "–ê—Ä–∏—Å—Ç–æ—Ç–µ–ª—å", "–ü–∏—Ñ–∞–≥–æ—Ä"];

fn main() {
    let (tx, rx) = mpsc::sync_channel(10);

    let forks = (0..PHILOSOPHERS.len())
        .map(|_| Arc::new(Mutex::new(Fork)))
        .collect::<Vec<_>>();

    for i in 0..forks.len() {
        let tx = tx.clone();

        let mut left_fork = Arc::clone(&forks[i]);
        let mut right_fork = Arc::clone(&forks[(i + 1) % forks.len()]);

        // –í–æ –∏–∑–±–µ–∂–∞–Ω–∏–µ –≤–∑–∞–∏–º–Ω–æ–π –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –Ω–∞–º –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –≥–¥–µ-—Ç–æ –Ω–∞—Ä—É—à–∏—Ç—å —Å–∏–º–º–µ—Ç—Ä–∏—é.
        // –ú–µ–Ω—è–µ–º –≤–∏–ª–∫–∏ –º–µ—Å—Ç–∞–º–∏ –±–µ–∑ –∏—Ö –ø–æ–≤—Ç–æ—Ä–Ω–æ–π –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
        if i == forks.len() - 1 {
            std::mem::swap(&mut left_fork, &mut right_fork);
        }

        let philosopher = Philosopher {
            name: PHILOSOPHERS[i].to_string(),
            thoughts: tx,
            left_fork,
            right_fork,
        };

        thread::spawn(move || {
            for _ in 0..100 {
                philosopher.eat();
                philosopher.think();
            }
        });
    }

    drop(tx);

    for thought in rx {
        println!("{thought}");
    }
}
```

</details>

__–ú–Ω–æ–≥–æ–ø–æ—Ç–æ—á–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å—Å—ã–ª–æ–∫__

–°–æ–∑–¥–∞–¥–∏–º –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –¥–ª—è –º–Ω–æ–≥–æ–ø–æ—Ç–æ—á–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å—Å—ã–ª–æ–∫. –û–Ω –¥–æ–ª–∂–µ–Ω –Ω–∞—á–∏–Ω–∞—Ç—å —Å –æ—Å–Ω–æ–≤–Ω–æ–π –≤–µ–±-—Å—Ç—Ä–∞–Ω–∏—Ü—ã –∏ –ø—Ä–æ–≤–µ—Ä—è—Ç—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å —Å—Å—ã–ª–æ–∫ –Ω–∞ –Ω–µ–π. –ó–∞—Ç–µ–º –æ–Ω –¥–æ–ª–∂–µ–Ω —Ä–µ–∫—É—Ä—Å–∏–≤–Ω–æ –ø—Ä–æ–≤–µ—Ä—è—Ç—å –¥—Ä—É–≥–∏–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –≤ —Ç–æ–º –∂–µ –¥–æ–º–µ–Ω–µ –∏ –ø—Ä–æ–¥–æ–ª–∂–∞—Ç—å –¥–µ–ª–∞—Ç—å —ç—Ç–æ –¥–æ —Ç–µ—Ö –ø–æ—Ä, –ø–æ–∫–∞ –≤—Å–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –Ω–µ –±—É–¥—É—Ç –ø—Ä–æ–≤–µ—Ä–µ–Ω—ã.

–î–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Ç–∞–∫–æ–≥–æ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞ –≤–∞–º –ø–æ—Ç—Ä–µ–±—É–µ—Ç—Å—è –∫–∞–∫–æ–π-–Ω–∏–±—É–¥—å –∫–ª–∏–µ–Ω—Ç `HTTP`, –Ω–∞–ø—Ä–∏–º–µ—Ä, [reqwest](https://docs.rs/reqwest/):

```bash
cargo add reqwest --features blocking,rustls-tls
```

–î–ª—è –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏—è —Å—Å—ã–ª–æ–∫ –º–æ–∂–Ω–æ –≤–æ—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è [scraper](https://docs.rs/scraper/):

```bash
cargo add scraper
```

–ù–∞–∫–æ–Ω–µ—Ü, –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫ –ø—Ä–∏–≥–æ–¥–∏—Ç—Å—è [thiserror](https://docs.rs/thiserror/):

```bash
cargo add thiserror
```

`Cargo.toml`:

```toml
[package]
name = "link-checker"
version = "0.1.0"
edition = "2021"
publish = false

[dependencies]
reqwest = { version = "0.11.12", features = ["blocking", "rustls-tls"] }
scraper = "0.13.0"
thiserror = "1.0.37"
```

–ù–∞—á–Ω–∏—Ç–µ —Å –Ω–µ–±–æ–ª—å—à–æ–≥–æ —Å–∞–π—Ç–∞, —Ç–∞–∫–æ–≥–æ –∫–∞–∫ `https://www.google.org`.

`src/main.rs`:

```rust
use reqwest::blocking::Client;
use reqwest::Url;
use scraper::{Html, Selector};
use thiserror::Error;

#[derive(Error, Debug)]
enum Error {
    #[error("–æ—à–∏–±–∫–∞ –∑–∞–ø—Ä–æ—Å–∞: {0}")]
    ReqwestError(#[from] reqwest::Error),
    #[error("–ø–ª–æ—Ö–æ–π –æ—Ç–≤–µ—Ç HTTP: {0}")]
    BadResponse(String),
}

#[derive(Debug)]
struct CrawlCommand {
    url: Url,
    extract_links: bool,
}

fn visit_page(client: &Client, command: &CrawlCommand) -> Result<Vec<Url>, Error> {
    println!("–ø—Ä–æ–≤–µ—Ä–∫–∞ {:#}", command.url);

    let response = client.get(command.url.clone()).send()?;

    if !response.status().is_success() {
        return Err(Error::BadResponse(response.status().to_string()));
    }

    let mut link_urls = Vec::new();

    if !command.extract_links {
        return Ok(link_urls);
    }

    let base_url = response.url().to_owned();
    let body_text = response.text()?;
    let document = Html::parse_document(&body_text);

    let selector = Selector::parse("a").unwrap();
    let href_values = document
        .select(&selector)
        .filter_map(|element| element.value().attr("href"));
    for href in href_values {
        match base_url.join(href) {
            Ok(link_url) => {
                link_urls.push(link_url);
            }
            Err(err) => {
                println!("–≤ {base_url:#} –Ω–µ –ø–æ–¥–¥–∞–µ—Ç—Å—è —Ä–∞–∑–±–æ—Ä—É {href:?}: {err}");
            }
        }
    }
    Ok(link_urls)
}

fn main() {
    let client = Client::new();
    let start_url = Url::parse("https://www.google.org").unwrap();
    let crawl_command = CrawlCommand{ url: start_url, extract_links: true };

    match visit_page(&client, &crawl_command) {
        Ok(links) => println!("—Å—Å—ã–ª–∫–∏: {links:#?}"),
        Err(err) => println!("–Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ –∏–∑–≤–ª–µ—á—å —Å—Å—ã–ª–∫–∏: {err:#}"),
    }
}
```

–ó–∞–¥–∞—á–∏:

- –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø–æ—Ç–æ–∫–∏ –¥–ª—è –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å—Å—ã–ª–æ–∫: –æ—Ç–ø—Ä–∞–≤—å—Ç–µ –ø—Ä–æ–≤–µ—Ä—è–µ–º—ã–µ URL-–∞–¥—Ä–µ—Å–∞ –≤ –∫–∞–Ω–∞–ª –∏ –ø–æ–∑–≤–æ–ª—å—Ç–µ –Ω–µ—Å–∫–æ–ª—å–∫–∏–º –ø–æ—Ç–æ–∫–∞–º –ø—Ä–æ–≤–µ—Ä—è—Ç—å URL-–∞–¥—Ä–µ—Å–∞ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ
- —Ä–µ–∞–ª–∏–∑—É–π—Ç–µ —Ä–µ–∫—É—Ä—Å–∏–≤–Ω–æ–µ –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ —Å—Å—ã–ª–æ–∫ —Å–æ –≤—Å–µ—Ö —Å—Ç—Ä–∞–Ω–∏—Ü –¥–æ–º–µ–Ω–∞ `www.google.org`. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –≤–µ—Ä—Ö–Ω–∏–π –ø—Ä–µ–¥–µ–ª –≤ 100 —Å—Ç—Ä–∞–Ω–∏—Ü –∏–ª–∏ –æ–∫–æ–ª–æ —Ç–æ–≥–æ, —á—Ç–æ–±—ã —Å–∞–π—Ç –≤–∞—Å –Ω–µ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–ª

<details>
<summary>–†–µ—à–µ–Ω–∏–µ:</summary>

```rust
use std::sync::{mpsc, Arc, Mutex};
use std::thread;
use std::collections::HashSet;

use reqwest::blocking::Client;
use reqwest::Url;
use scraper::{Html, Selector};
use thiserror::Error;

#[derive(Error, Debug)]
enum Error {
    #[error("–æ—à–∏–±–∫–∞ –∑–∞–ø—Ä–æ—Å–∞: {0}")]
    ReqwestError(#[from] reqwest::Error),
    #[error("–ø–ª–æ—Ö–æ–π –æ—Ç–≤–µ—Ç HTTP: {0}")]
    BadResponse(String),
}

#[derive(Debug)]
struct CrawlCommand {
    url: Url,
    extract_links: bool,
}

fn visit_page(client: &Client, command: &CrawlCommand) -> Result<Vec<Url>, Error> {
    println!("–ø—Ä–æ–≤–µ—Ä–∫–∞ {:#}", command.url);

    let response = client.get(command.url.clone()).send()?;

    if !response.status().is_success() {
        return Err(Error::BadResponse(response.status().to_string()));
    }

    let mut link_urls = Vec::new();

    if !command.extract_links {
        return Ok(link_urls);
    }

    let base_url = response.url().to_owned();
    let body_text = response.text()?;
    let document = Html::parse_document(&body_text);

    let selector = Selector::parse("a").unwrap();
    let href_values = document
        .select(&selector)
        .filter_map(|element| element.value().attr("href"));
    for href in href_values {
        match base_url.join(href) {
            Ok(link_url) => {
                link_urls.push(link_url);
            }
            Err(err) => {
                println!("–≤ {base_url:#} –Ω–µ –ø–æ–¥–¥–∞–µ—Ç—Å—è —Ä–∞–∑–±–æ—Ä—É {href:?}: {err}");
            }
        }
    }
    Ok(link_urls)
}

struct CrawlState {
    domain: String,
    visited_pages: HashSet<String>,
}

impl CrawlState {
    fn new(start_url: &Url) -> CrawlState {
        let mut visited_pages = HashSet::new();

        visited_pages.insert(start_url.as_str().to_string());

        CrawlState {
            domain: start_url.domain().unwrap().to_string(),
            visited_pages
        }
    }

    /// –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç, –¥–æ–ª–∂–Ω—ã –ª–∏ –∏–∑–≤–ª–µ–∫–∞—Ç—å—Å—è —Å—Å—ã–ª–∫–∏ –Ω–∞ —É–∫–∞–∑–∞–Ω–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ
    fn should_extract_links(&self, url: &Url) -> bool {
        let Some(url_domain) = url.domain() else {
            return false;
        };
        url_domain == self.domain
    }

    /// –ü–æ–º–µ—á–∞–µ—Ç —É–∫–∞–∑–∞–Ω–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É –∫–∞–∫ –ø–æ—Å–µ—â–µ–Ω–Ω—É—é,
    /// –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `false`, –µ—Å–ª–∏ —Å—Ç—Ä–∞–Ω–∏—Ü–∞ —É–∂–µ –ø–æ—Å–µ—â–∞–ª–∞—Å—å
    fn mark_visited(&mut self, url: &Url) -> bool {
        self.visited_pages.insert(url.as_str().to_string())
    }
}

type CrawlResult = Result<Vec<Url>, (Url, Error)>;

fn spawn_crawler_threads(
    command_receiver: mpsc::Receiver<CrawlCommand>,
    result_sender: mpsc::Sender<CrawlResult>,
    thread_count: u32,
) {
    let command_receiver = Arc::new(Mutex::new(command_receiver));

    for _ in 0..thread_count {
        let result_sender = result_sender.clone();
        let command_receiver = command_receiver.clone();

        thread::spawn(move || {
            let client = Client::new();

            loop {
                let command_result = {
                    let receiver_guard = command_receiver.lock().unwrap();
                    receiver_guard.recv()
                };

                let Ok(crawl_command) = command_result else {
                    // –û—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—å —É–Ω–∏—á—Ç–æ–∂–µ–Ω, –∫–æ–º–∞–Ω–¥ –±–æ–ª—å—à–µ –Ω–µ –±—É–¥–µ—Ç
                    break;
                };

                let crawl_result = match visit_page(&client, &crawl_command) {
                    Ok(link_urls) => Ok(link_urls),
                    Err(error) => Err((crawl_command.url, error)),
                };

                result_sender.send(crawl_result).unwrap();
            }
        });
    }
}

fn control_crawl(
    start_url: Url,
    command_sender: mpsc::Sender<CrawlCommand>,
    result_receiver: mpsc::Receiver<CrawlResult>,
) -> Vec<Url> {
    let mut crawl_state = CrawlState::new(&start_url);

    let start_command = CrawlCommand { url: start_url, extract_links: true };
    command_sender.send(start_command).unwrap();

    let mut pending_urls = 1;

    let mut bad_urls = Vec::new();

    while pending_urls > 0 {
        let crawl_result = result_receiver.recv().unwrap();
        pending_urls -= 1;

        match crawl_result {
            Ok(link_urls) => {
                for url in link_urls {
                    if crawl_state.mark_visited(&url) {
                        let extract_links = crawl_state.should_extract_links(&url);
                        let crawl_command = CrawlCommand { url, extract_links };
                        command_sender.send(crawl_command).unwrap();
                        pending_urls += 1;
                    }
                }
            }
            Err((url, error)) => {
                bad_urls.push(url);
                println!("–ø—Ä–∏ –∏–∑–≤–ª–µ—á–µ–Ω–∏–∏ —Å—Å—ã–ª–æ–∫ –≤–æ–∑–Ω–∏–∫–ª–∞ –æ—à–∏–±–∫–∞: {:#}", error);
                continue;
            }
        }
    }
    bad_urls
}

fn check_links(start_url: Url) -> Vec<Url> {
    let (result_sender, result_receiver) = mpsc::channel::<CrawlResult>();
    let (command_sender, command_receiver) = mpsc::channel::<CrawlCommand>();
    spawn_crawler_threads(command_receiver, result_sender, 16);
    control_crawl(start_url, command_sender, result_receiver)
}

fn main() {
    let start_url = reqwest::Url::parse("https://www.google.org").unwrap();
    let bad_urls = check_links(start_url);
    println!("–ø–ª–æ—Ö–∏–µ URL: {:#?}", bad_urls);
}
```

</details>

# –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π Rust

"–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ—Å—Ç—å" (async) - —ç—Ç–æ –º–æ–¥–µ–ª—å –ø–∞—Ä–∞–ª–ª–µ–ª–∏–∑–º–∞, –≤ –∫–æ—Ç–æ—Ä–æ–π –Ω–µ—Å–∫–æ–ª—å–∫–æ –∑–∞–¥–∞—á –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ. –ö–∞–∂–¥–∞—è –∑–∞–¥–∞—á–∞ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –¥–æ —Ç–µ—Ö –ø–æ—Ä, –ø–æ–∫–∞ –Ω–µ –∑–∞–≤–µ—Ä—à–∏—Ç—Å—è –∏–ª–∏ –Ω–µ –∑–∞–±–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è, –∑–∞—Ç–µ–º –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è —Å–ª–µ–¥—É—é—â–∞—è (–≥–æ—Ç–æ–≤–∞—è –∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—é) –∑–∞–¥–∞—á–∞ –∏ —Ç.–¥. –¢–∞–∫–∞—è –º–æ–¥–µ–ª—å –ø–æ–∑–≤–æ–ª—è–µ—Ç –≤—ã–ø–æ–ª–Ω—è—Ç—å –±–æ–ª—å—à–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–¥–∞—á —Å –ø–æ–º–æ—â—å—é –Ω–µ–±–æ–ª—å—à–æ–≥–æ —á–∏—Å–ª–∞ –ø–æ—Ç–æ–∫–æ–≤. –≠—Ç–æ —Å–≤—è–∑–∞–Ω–æ —Å —Ç–µ–º, —á—Ç–æ –Ω–∞–∫–ª–∞–¥–Ω—ã–µ —Ä–∞—Å—Ö–æ–¥—ã –Ω–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∫–∞–∂–¥–æ–π –∑–∞–¥–∞—á–∏ –æ–±—ã—á–Ω–æ –æ—á–µ–Ω—å –Ω–∏–∑–∫–∏–µ, –∞ –æ–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Å–∏—Å—Ç–µ–º—ã –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è—é—Ç –ø—Ä–∏–º–∏—Ç–∏–≤—ã –¥–ª—è —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–≥–æ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –º–µ–∂–¥—É –∑–∞–¥–∞—á–∞–º–∏.

–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ `Rust` –æ—Å–Ω–æ–≤–∞–Ω—ã –Ω–∞ —Ñ—å—é—á–µ—Ä—Å–∞—Ö (futures, –æ—Ç "future" - –±—É–¥—É—â–µ–µ), –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è—é—â–∏—Ö —Å–æ–±–æ–π —Ä–∞–±–æ—Ç—É, –∫–æ—Ç–æ—Ä–∞—è –º–æ–∂–µ—Ç –±—ã—Ç—å –∑–∞–≤–µ—Ä—à–µ–Ω–∞ –≤ –±—É–¥—É—â–µ–º. –§—å—é—á–µ—Ä—Å—ã "–æ–ø—Ä–∞—à–∏–≤–∞—é—Ç—Å—è" (polled) –¥–æ —Ç–µ—Ö –ø–æ—Ä, –ø–æ–∫–∞ –Ω–µ —Å–æ–æ–±—â–∞—Ç –æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏.

–§—å—é—á–µ—Ä—Å—ã –æ–ø—Ä–∞—à–∏–≤–∞—é—Ç—Å—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–π —Å—Ä–µ–¥–æ–π –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è (async runtime). –î–æ—Å—Ç—É–ø–Ω–æ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ç–∞–∫–∏—Ö —Å—Ä–µ–¥. –û–¥–Ω–æ–π –∏–∑ —Å–∞–º—ã—Ö –ø–æ–ø—É–ª—è—Ä–Ω—ã—Ö —è–≤–ª—è–µ—Ç—Å—è [Tokio](https://tokio.rs/).

–°—Ä–∞–≤–Ω–µ–Ω–∏—è:

- –≤ `Python` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø–æ—Ö–æ–∂–∞—è –º–æ–¥–µ–ª—å –≤ `asyncio`. –û–¥–Ω–∞–∫–æ, –µ–≥–æ —Ç–∏–ø `Future` –æ—Å–Ω–æ–≤–∞–Ω –Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è—Ö –æ–±—Ä–∞—Ç–Ω–æ–≥–æ –≤—ã–∑–æ–≤–∞ (callbacks), –∞ –Ω–µ –Ω–∞ –æ–ø—Ä–æ—Å–∞—Ö. –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –ø—Ä–æ–≥—Ä–∞–º–º—ã `Python` –¥–æ–ª–∂–Ω—ã –≤—ã–ø–æ–ª–Ω—è—Ç—å—Å—è –≤ —Ü–∏–∫–ª–µ, –∫–∞–∫ –∏ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –ø—Ä–æ–≥—Ä–∞–º–º—ã `Rust`
- `Promise` –≤ `JavaScript` –ø–æ—Ö–æ–∂ –Ω–∞ —Ñ—å—é—á–µ—Ä—Å, –Ω–æ —Ç–∞–∫–∂–µ –æ—Å–Ω–æ–≤–∞–Ω –Ω–∞ –∫–æ–ª–±—ç–∫–∞—Ö. –°—Ä–µ–¥—ã –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —Ä–µ–∞–ª–∏–∑—É–µ—Ç —Ü–∏–∫–ª —Å–æ–±—ã—Ç–∏–π (event loop), –ø–æ—ç—Ç–æ–º—É –º–Ω–æ–≥–∏–µ –¥–µ—Ç–∞–ª–∏ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è –ø—Ä–æ–º–∏—Å–∞ —è–≤–ª—è—é—Ç—Å—è —Å–∫—Ä—ã—Ç—ã–º–∏

## –û—Å–Ω–æ–≤—ã –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ—Å—Ç–∏

__async/await__

–ù–∞ –≤—ã—Å–æ–∫–æ–º —É—Ä–æ–≤–Ω–µ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –∫–æ–¥ `Rust` –≤—ã–≥–ª—è–¥–∏—Ç –æ—á–µ–Ω—å –ø–æ—Ö–æ–∂–µ –Ω–∞ –æ–±—ã—á–Ω—ã–π —Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –∫–æ–¥:

```rust
use futures::executor::block_on;

async fn count_to(count: i32) {
    for i in 1..=count {
        println!("–ó–Ω–∞—á–µ–Ω–∏–µ —Å—á–µ—Ç—á–∏–∫–∞: {i}!");
    }
}

async fn async_main(count: i32) {
    count_to(count).await;
}

fn main() {
    block_on(async_main(10));
}
```

–†–µ–º–∞—Ä–∫–∏:

- —ç—Ç–æ —É–ø—Ä–æ—â–µ–Ω–Ω—ã–π –ø—Ä–∏–º–µ—Ä –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏ —Å–∏–Ω—Ç–∞–∫—Å–∏—Å–∞. –í –Ω–µ–º –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç –¥–æ–ª–≥–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –∏–ª–∏ –ø–∞—Ä–∞–ª–ª–µ–ª–∏–∑–º
- –∫–∞–∫–æ–π —Ç–∏–ø –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è?
  - –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `let future: () = async_main(10);` –≤ `main()` –∏ –ø–æ—Å–º–æ—Ç—Ä–∏—Ç–µ
- –∫–ª—é—á–µ–≤–æ–µ —Å–ª–æ–≤–æ `async` - —ç—Ç–æ —Å–∏–Ω—Ç–∞–∫—Å–∏—á–µ—Å–∫–∏–π —Å–∞—Ö–∞—Ä. –ö–æ–º–ø–∏–ª—è—Ç–æ—Ä –∑–∞–º–µ–Ω—è–µ—Ç –≤–æ–∑–≤—Ä–∞—â–∞–µ–º—ã–π —Ç–∏–ø —Ñ—å—é—á–µ—Ä—Å–æ–º
- –º—ã –Ω–µ –º–æ–∂–µ–º —Å–¥–µ–ª–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏—é `main` –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–π –±–µ–∑ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–∏—è –∫–æ–º–ø–∏–ª—è—Ç–æ—Ä—É –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–π –æ —Ç–æ–º, –∫–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤–æ–∑–≤—Ä–∞—â–∞–µ–º—ã–π —Ñ—å—é—á–µ—Ä—Å
- –¥–ª—è –∑–∞–ø—É—Å–∫–∞ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–≥–æ –∫–æ–¥–∞ —Ç—Ä–µ–±—É–µ—Ç—Å—è –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å (executor). `block_on()` –±–ª–æ–∫–∏—Ä—É–µ—Ç —Ç–µ–∫—É—â–∏–π –ø–æ—Ç–æ–∫ –¥–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —Ñ—å—é—á–µ—Ä—Å–∞
- `.await` –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ –∂–¥–µ—Ç –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –¥—Ä—É–≥–æ–π –æ–ø–µ—Ä–∞—Ü–∏–∏. –í –æ—Ç–ª–∏—á–∏–µ –æ—Ç `block_on()`, `await` –Ω–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç —Ç–µ–∫—É—â–∏–π –ø–æ—Ç–æ–∫
- `await` –º–æ–∂–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è —Ç–æ–ª—å–∫–æ –≤–Ω—É—Ç—Ä–∏ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–∏ (–∏–ª–∏ –±–ª–æ–∫–∞, –æ —á–µ–º –º—ã –ø–æ–≥–æ–≤–æ—Ä–∏–º –ø–æ–∑–∂–µ)

__–§—å—é—á–µ—Ä—Å—ã__

[Future](https://doc.rust-lang.org/std/future/trait.Future.html) - —ç—Ç–æ —Ç—Ä–µ–π—Ç, —Ä–µ–∞–ª–∏–∑—É–µ–º—ã–π –æ–±—ä–µ–∫—Ç–∞–º–∏, –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è—é—â–∏–º–∏ –æ–ø–µ—Ä–∞—Ü–∏—é, –∫–æ—Ç–æ—Ä–∞—è –ø–æ–∫–∞ –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –∑–∞–≤–µ—Ä—à–µ–Ω–∞. –§—å—é—á–µ—Ä—Å—ã –º–æ–≥—É—Ç –æ–ø—Ä–∞—à–∏–≤–∞—Ç—å—Å—è, `poll()` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç [Poll](https://doc.rust-lang.org/std/task/enum.Poll.html).

```rust
use std::pin::Pin;
use std::task::Context;

pub trait Future {
    type Output;

    fn poll(self: Pin<&mut Self>, cx: &mut Context<'_>) -> Poll<Self::Output>;
}

pub enum Poll<T> {
    Ready(T),
    Pending,
}
```

–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `impl Future`. –¢–∞–∫–∂–µ –≤–æ–∑–º–æ–∂–Ω–æ (–Ω–æ —Ä–µ–¥–∫–æ –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è) —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `Future` –¥–ª—è —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã—Ö —Ç–∏–ø–æ–≤. –ù–∞–ø—Ä–∏–º–µ—Ä, `JoinHandle`, –≤–æ–∑–≤—Ä–∞—â–∞–µ–º—ã–π `tokio::spawn` —Ä–µ–∞–ª–∏–∑—É–µ—Ç `Future`, —á—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –ø—Ä–∏—Å–æ–µ–¥–∏–Ω—è—Ç—å—Å—è (join) –∫ –Ω–µ–º—É.

–ö–ª—é—á–µ–≤–æ–µ —Å–ª–æ–≤–æ `await` –ø—Ä–∏–æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–∏, –ø–æ–∫–∞ —Ñ—å—é—á–µ—Ä—Å –Ω–µ –±—É–¥–µ—Ç –≥–æ—Ç–æ–≤.

–†–µ–º–∞—Ä–∫–∏:

- —Ç–∏–ø—ã `Future` –∏ `Poll` —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã –≤ —Ç–æ—á–Ω–æ—Å—Ç–∏, –∫–∞–∫ –ø–æ–∫–∞–∑–∞–Ω–æ
- –º—ã –Ω–µ –±—É–¥–µ–º —Ä–∞—Å—Å–º–∞—Ç—Ä–∏–≤–∞—Ç—å `Pin` –∏ `Context`, –ø–æ—Å–∫–æ–ª—å–∫—É –Ω–µ –±—É–¥–µ—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å –Ω–æ–≤—ã–µ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –ø—Ä–∏–º–∏—Ç–∏–≤—ã. –ö–æ—Ä–æ—Ç–∫–æ:
  - `Context` –ø–æ–∑–≤–æ–ª—è–µ—Ç —Ñ—å—é—á–µ—Ä—Å—É –ø–ª–∞–Ω–∏—Ä–æ–≤–∞—Ç—å –ø–æ–≤—Ç–æ—Ä–Ω—ã–π –æ–ø—Ä–æ—Å –ø—Ä–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–∏ —Å–æ–±—ã—Ç–∏—è
  - `Pin` –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç, —á—Ç–æ —Ñ—å—é—á–µ—Ä—Å –Ω–µ –ø–µ—Ä–µ–º–µ—â–∞–µ—Ç—Å—è –≤ –ø–∞–º—è—Ç–∏, –ø–æ—ç—Ç–æ–º—É —Å—Å—ã–ª–∫–∏ –≤ —ç—Ç–æ–º —Ñ—å—é—á–µ—Ä—Å–µ –æ—Å—Ç–∞—é—Ç—Å—è –≤–∞–ª–∏–¥–Ω—ã–º–∏. –≠—Ç–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ, —á—Ç–æ–±—ã —Å—Å—ã–ª–∫–∏ –æ—Å—Ç–∞–≤–∞–ª–∏—Å—å –≤–∞–ª–∏–¥–Ω—ã–º–∏ –ø–æ—Å–ª–µ `await`

__–°—Ä–µ–¥–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è__

–°—Ä–µ–¥–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è (runtime) –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –ø–æ–¥–¥–µ—Ä–∂–∫—É –¥–ª—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–≥–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –æ–ø–µ—Ä–∞—Ü–∏–π (reactor) –∏ –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ —Ñ—å—é—á–µ—Ä—Å–æ–≤ (executor). `Rust` –Ω–µ –∏–º–µ–µ—Ç "–≤—Å—Ç—Ä–æ–µ–Ω–Ω–æ–π" —Å—Ä–µ–¥—ã –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è, –Ω–æ –¥–æ—Å—Ç—É–ø–Ω–æ –Ω–µ—Å–∫–æ–ª—å–∫–æ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤:

- [Tokio](https://tokio.rs/) - –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω—ã–π, —Å —Ö–æ—Ä–æ—à–∏–º –Ω–∞–±–æ—Ä–æ–º –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤, —Ç–∞–∫–∏—Ö –∫–∞–∫ [Hyper](https://hyper.rs/) –¥–ª—è `HTTP` –∏–ª–∏ [Tonic](https://github.com/hyperium/tonic) –¥–ª—è `gRPC`
- [async-std](https://async.rs/) - —Å—Ç—Ä–µ–º–∏—Ç—Å—è –±—ã—Ç—å "—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–π –±–∏–±–ª–∏–æ—Ç–µ–∫–æ–π –¥–ª—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–≥–æ –∫–æ–¥–∞" –∏ –≤–∫–ª—é—á–∞–µ—Ç —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—É—é —Å—Ä–µ–¥—É –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –≤ `async::task`
- [smol](https://docs.rs/smol/latest/smol/) - –ø—Ä–æ—Å—Ç–æ–π –∏ –ª–µ–≥–∫–æ–≤–µ—Å–Ω—ã–π

–ù–µ—Å–∫–æ–ª—å–∫–æ –±–æ–ª—å—à–∏—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π –∏–º–µ—é—Ç —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–µ —Å—Ä–µ–¥—ã –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è. –û–¥–Ω–∏–º –∏–∑ —Ç–∞–∫–∏—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π —è–≤–ª—è–µ—Ç—Å—è [Fuchsia](https://fuchsia.googlesource.com/fuchsia/+/refs/heads/main/src/lib/fuchsia-async/src/lib.rs).

–§—å—é—á–µ—Ä—Å—ã —è–≤–ª—è—é—Ç—Å—è "–∏–Ω–µ—Ä—Ç–Ω—ã–º–∏" –≤ —Ç–æ–º —Å–º—ã—Å–ª–µ, —á—Ç–æ –æ–Ω–∏ –Ω–∏—á–µ–≥–æ –Ω–µ –¥–µ–ª–∞—é—Ç, –ø–æ–∫–∞ –Ω–µ –±—É–¥—É—Ç –æ–ø—Ä–æ—à–µ–Ω—ã –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª–µ–º. –≠—Ç–æ –æ—Ç–ª–∏—á–∞–µ—Ç—Å—è –æ—Ç –ø—Ä–æ–º–∏—Å–æ–≤ `JS`, –Ω–∞–ø—Ä–∏–º–µ—Ä, –∫–æ—Ç–æ—Ä—ã–µ –∑–∞–ø—É—Å–∫–∞—é—Ç—Å—è, –¥–∞–∂–µ –µ—Å–ª–∏ –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è.

__Tokio__

`Tokio` –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç:

- –º–Ω–æ–≥–æ–ø–æ—Ç–æ—á–Ω—É—é —Å—Ä–µ–¥—É –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–≥–æ –∫–æ–¥–∞
- –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—É—é –≤–µ—Ä—Å–∏—é —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–π –±–∏–±–ª–∏–æ—Ç–µ–∫–∏
- –±–æ–ª—å—à—É—é —ç–∫–æ—Å–∏—Å—Ç–µ–º—É –±–∏–±–ª–∏–æ—Ç–µ–∫

```rust
use tokio::time;

async fn count_to(count: i32) {
    for i in 1..=count {
        println!("–ó–Ω–∞—á–µ–Ω–∏–µ —Å—á–µ—Ç—á–∏–∫–∞ –≤ –∑–∞–¥–∞—á–µ: {i}!");
        time::sleep(time::Duration::from_millis(5)).await;
    }
}

#[tokio::main]
async fn main() {
    tokio::spawn(count_to(10));

    for i in 1..5 {
        println!("–ó–Ω–∞—á–µ–Ω–∏–µ —Å—á–µ—Ç—á–∏–∫–∞ –≤ –æ—Å–Ω–æ–≤–Ω–æ–π –∑–∞–¥–∞—á–µ: {i}");
        time::sleep(time::Duration::from_millis(5)).await;
    }
}
```

–†–µ–º–∞—Ä–∫–∏:

- –º–∞–∫—Ä–æ—Å `tokio::main` –ø–æ–∑–≤–æ–ª—è–µ—Ç –¥–µ–ª–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏—é `main` –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–π
- —Ñ—É–Ω–∫—Ü–∏—è `spawn` —Å–æ–∑–¥–∞–µ—Ç –Ω–æ–≤—É—é –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—É—é "–∑–∞–¥–∞—á—É"
- –æ–±—Ä–∞—Ç–∏—Ç–µ –≤–Ω–∏–º–∞–Ω–∏–µ: `spawn` –ø—Ä–∏–Ω–∏–º–∞–µ—Ç `Future`, –º—ã –Ω–µ –≤—ã–∑—ã–≤–∞–µ—Ç `.await` –Ω–∞ `count_to()`
- –ø–æ—á–µ–º—É `count_to()` –æ–±—ã—á–Ω–æ –Ω–µ –¥–æ—Ö–æ–¥–∏—Ç –¥–æ 10? –≠—Ç–æ –ø—Ä–∏–º–µ—Ä –æ—Ç–º–µ–Ω—ã –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–π –æ–ø–µ—Ä–∞—Ü–∏–∏. `tokio::spawn()` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ (handle), –∫–æ—Ç–æ—Ä—ã–π –º–æ–∂–µ—Ç –∑–∞—Å—Ç–∞–≤–∏—Ç—å –ø–æ—Ç–æ–∫ –∂–¥–∞—Ç—å –µ–≥–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è
- –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –∑–∞–º–µ–Ω–∏—Ç—å `tokio::spawn` –Ω–∞ `count_to(10).await`
- –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –¥–æ–±–∞–≤–∏—Ç—å –æ–∂–∏–¥–∞–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –∑–∞–¥–∞—á–∏, –≤–æ–∑–≤—Ä–∞—â–∞–µ–º–æ–π `tokio::spawn()`

__–ó–∞–¥–∞—á–∏__

`Rust` –∏–º–µ–µ—Ç —Å–∏—Å—Ç–µ–º—É –∑–∞–¥–∞—á (task system), –∫–æ—Ç–æ—Ä–∞—è —è–≤–ª—è–µ—Ç—Å—è —Ñ–æ—Ä–º–æ–π –ª–µ–≥–∫–æ–≤–µ—Å–Ω–æ–≥–æ —Ç—Ä–µ–π–¥–∏–Ω–≥–∞ (threading).

–ó–∞–¥–∞—á–∞ –∏–º–µ–µ—Ç –æ–¥–∏–Ω –≤–µ—Ä—Ö–Ω–µ—É—Ä–æ–≤–Ω–µ–≤—ã–π —Ñ—å—é—á–µ—Ä—Å, –∫–æ—Ç–æ—Ä—ã–π –æ–ø—Ä–∞—à–∏–≤–∞–µ—Ç—Å—è –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª–µ–º. –≠—Ç–æ—Ç —Ñ—å—é—á–µ—Ä—Å –º–æ–∂–µ—Ç –∏–º–µ—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –≤–ª–æ–∂–µ–Ω–Ω—ã—Ö —Ñ—å—é—á–µ—Ä—Å–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ –æ–Ω –æ–ø—Ä–∞—à–∏–≤–∞–µ—Ç –º–µ—Ç–æ–¥–æ–º `poll`, —á—Ç–æ –ø—Ä–∏–±–ª–∏–∑–∏—Ç–µ–ª—å–Ω–æ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç —Å—Ç–µ–∫—É –≤—ã–∑–æ–≤–æ–≤ (call stack). –ü–∞—Ä–∞–ª–ª–µ–ª–∏–∑–º –≤–Ω—É—Ç—Ä–∏ –∑–∞–¥–∞—á–∏ –≤–æ–∑–º–æ–∂–µ–Ω –ø—É—Ç–µ–º –æ–ø—Ä–æ—Å–∞ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –¥–æ—á–µ—Ä–Ω–∏—Ö —Ñ—å—é—á–µ—Ä—Å–æ–≤, –Ω–∞–ø—Ä–∏–º–µ—Ä, –∑–∞–ø—É—Å–∫ —Ç–∞–π–º–µ—Ä–∞ –∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –≤–≤–æ–¥–∞-–≤—ã–≤–æ–¥–∞.

```rust
use tokio::io::{self, AsyncReadExt, AsyncWriteExt};
use tokio::net::TcpListener;

#[tokio::main]
async fn main() -> io::Result<()> {
    let listener = TcpListener::bind("127.0.0.1:0").await?;
    println!("–∑–∞–ø—Ä–æ—Å—ã –ø—Ä–∏–Ω–∏–º–∞—é—Ç—Å—è –Ω–∞ –ø–æ—Ä—Ç—É {}", listener.local_addr()?.port());

    loop {
        let (mut socket, addr) = listener.accept().await?;

        println!("–∑–∞–ø—Ä–æ—Å –∏–∑ {addr:?}");

        tokio::spawn(async move {
            socket.write_all(b"–ö—Ç–æ —Ç—ã?\n").await.expect("–æ—à–∏–±–∫–∞ —Å–æ–∫–µ—Ç–∞");

            let mut buf = vec![0; 1024];
            let name_size = socket.read(&mut buf).await.expect("–æ—à–∏–±–∫–∞ —Å–æ–∫–µ—Ç–∞");
            let name = std::str::from_utf8(&buf[..name_size]).unwrap().trim();
            let reply = format!("–ü—Ä–∏–≤–µ—Ç, {name}!\n");
            socket.write_all(reply.as_bytes()).await.expect("–æ—à–∏–±–∫–∞ —Å–æ–∫–µ—Ç–∞");
        });
    }
}
```

- –ü–µ—Ä–µ–¥ –Ω–∞–º–∏ `async` –±–ª–æ–∫. –¢–∞–∫–∏–µ –±–ª–æ–∫–∏ –ø–æ—Ö–æ–∂–∏ –Ω–∞ –∑–∞–º—ã–∫–∞–Ω–∏—è, –Ω–æ –Ω–µ –ø—Ä–∏–Ω–∏–º–∞—é—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤. –ò—Ö –≤–æ–∑–≤—Ä–∞—â–∞–µ–º—ã–º –∑–Ω–∞—á–µ–Ω–∏–µ–º —è–≤–ª—è–µ—Ç—Å—è —Ñ—å—é—á–µ—Ä—Å, –∫–∞–∫ —É `async fn`
- –ø–µ—Ä–µ–¥–µ–ª–∞–π—Ç–µ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –±–ª–æ–∫ –≤ —Ñ—É–Ω–∫—Ü–∏—é –∏ —É–ª—É—á—à–∏—Ç–µ –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–æ–∫ —Å –ø–æ–º–æ—â—å—é –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞ `?`

__–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –∫–∞–Ω–∞–ª—ã__

–ù–µ–∫–æ—Ç–æ—Ä—ã–µ –∫—Ä–µ–π—Ç—ã –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –∫–∞–Ω–∞–ª—ã, –Ω–∞–ø—Ä–∏–º–µ—Ä, `tokio`:

```rust
use tokio::sync::mpsc::{self, Receiver};

async fn ping_handler(mut input: Receiver<()>) {
    let mut count: usize = 0;

    while let Some(_) = input.recv().await {
        count += 1;
        println!("–ø–æ–ª—É—á–µ–Ω–æ {count} –ø–∏–Ω–≥–æ–≤");
    }

    println!("ping_handler –∑–∞–≤–µ—Ä—à–µ–Ω");
}

#[tokio::main]
async fn main() {
    let (sender, receiver) = mpsc::channel(32);
    let ping_handler_task = tokio::spawn(ping_handler(receiver));
    for i in 0..10 {
        sender.send(()).await.expect("–ø—Ä–æ–≤–∞–ª –æ—Ç–ø—Ä–∞–≤–∫–∏ –ø–∏–Ω–≥–∞");
        println!("–æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ {} –ø–∏–Ω–≥–æ–≤", i + 1);
    }

    drop(sender);

    ping_handler_task.await.expect("—á—Ç–æ-—Ç–æ –ø–æ—à–ª–æ –Ω–µ —Ç–∞–∫");
}
```

- –∏–∑–º–µ–Ω–∏—Ç–µ —Ä–∞–∑–º–µ—Ä –∫–∞–Ω–∞–ª–∞ –Ω–∞ `3` –∏ –ø–æ—Å–º–æ—Ç—Ä–∏—Ç–µ, –∫–∞–∫ —ç—Ç–æ –ø–æ–≤–ª–∏—è–µ—Ç –Ω–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ
- –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã—Ö –∫–∞–Ω–∞–ª–æ–≤ –∞–Ω–∞–ª–æ–≥–∏—á–µ–Ω –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—É `sync` –∫–∞–Ω–∞–ª–æ–≤, –æ –∫–æ—Ç–æ—Ä—ã—Ö –º—ã –≥–æ–≤–æ—Ä–∏–ª–∏ —Ä–∞–Ω–µ–µ
- –ø–æ–ø—Ä–æ–±—É–π—Ç–µ —É–¥–∞–ª–∏—Ç—å `std::mem::drop`. –ß—Ç–æ –ø—Ä–æ–∏–∑–æ–π–¥–µ—Ç? –ü–æ—á–µ–º—É?
- –∫—Ä–µ–π—Ç [Flume](https://docs.rs/flume/latest/flume/) –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –∫–∞–Ω–∞–ª—ã, –∫–æ—Ç–æ—Ä—ã–µ —Ä–µ–∞–ª–∏–∑—É—é—Ç –∫–∞–∫ `sync`, —Ç–∞–∫ –∏ `async send`, –∏ `recv`. –≠—Ç–æ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø–æ–ª–µ–∑–Ω—ã–º –¥–ª—è —Å–ª–æ–∂–Ω—ã—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π —Å –∑–∞–¥–∞—á–∞–º–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –≤–≤–æ–¥–∞-–≤—ã–≤–æ–¥–∞ –∏ —Ç—è–∂–µ–ª—ã–º–∏ –¥–ª—è –¶–ü –∑–∞–¥–∞—á–∞–º–∏
- `async` –∫–∞–Ω–∞–ª—ã –º–æ–≥—É—Ç –±—ã—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω—ã –≤–º–µ—Å—Ç–µ —Å –¥—Ä—É–≥–∏–º–∏ `future` –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Å–ª–æ–∂–Ω–æ–≥–æ –ø–æ—Ç–æ–∫–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è (control flow)

## –ü–æ—Ç–æ–∫ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ñ—å—é—á–µ—Ä—Å–æ–≤

–§—å—é—á–µ—Ä—Å—ã –º–æ–≥—É—Ç –æ–±—ä–µ–¥–∏–Ω—è—Ç—å—Å—è –≤–º–µ—Å—Ç–µ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –≥—Ä–∞—Ñ–æ–≤ –ø–æ—Ç–æ–∫–æ–≤ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö –≤—ã—á–∏—Å–ª–µ–Ω–∏–π. –ú—ã —É–∂–µ –≤–∏–¥–µ–ª–∏ –∑–∞–¥–∞—á–∏, –∫–æ—Ç–æ—Ä—ã–µ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∏—Ä—É—é—Ç –∫–∞–∫ –∞–≤—Ç–æ–Ω–æ–º–Ω—ã–µ –ø–æ—Ç–æ–∫–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è.

__Join__

–ú–µ—Ç–æ–¥ `join_all` –∂–¥–µ—Ç, –∫–æ–≥–¥–∞ –≤—Å–µ —Ñ—å—é—á–µ—Ä—Å—ã –±—É–¥—É—Ç –≥–æ—Ç–æ–≤—ã, –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∏—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã. –≠—Ç–æ –ø–æ—Ö–æ–∂–µ –Ω–∞ `Promise.all` –≤ `JavaScript` –∏–ª–∏ `asyncio.gather` –≤ `Python`.

```rust
use anyhow::Result;
use futures::future;
use reqwest;
use std::collections::HashMap;

async fn size_of_page(url: &str) -> Result<usize> {
    let resp = reqwest::get(url).await?;
    Ok(resp.text().await?.len())
}

#[tokio::main]
async fn main() {
    let urls: [&str; 4] = [
        "https://google.com",
        "https://httpbin.org/ip",
        "https://play.rust-lang.org/",
        "BAD_URL",
    ];
    let futures_iter = urls.into_iter().map(size_of_page);
    let results = future::join_all(futures_iter).await;
    let page_sizes_dict: HashMap<&str, Result<usize>> =
        urls.into_iter().zip(results.into_iter()).collect();
    println!("{:?}", page_sizes_dict);
}
```

–†–µ–º–∞—Ä–∫–∏:

- –¥–ª—è –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —Ñ—å—é—á–µ—Ä—Å–æ–≤ –Ω–µ–ø–µ—Ä–µ—Å–µ–∫–∞—é—â–∏—Ö—Å—è —Ç–∏–ø–æ–≤ –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `std::future::join!` –Ω–æ –º—ã –¥–æ–ª–∂–Ω—ã –∑–Ω–∞—Ç—å, —Å–∫–æ–ª—å–∫–æ —Ñ—å—é—á–µ—Ä—Å–æ–≤ —É –Ω–∞—Å –±—É–¥–µ—Ç –≤–æ –≤—Ä–µ–º—è –∫–æ–º–ø–∏–ª—è—Ü–∏–∏. –í –Ω–∞—Å—Ç–æ—è—â–µ–µ –≤—Ä–µ–º—è `join_all()` –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ –∫—Ä–µ–π—Ç–µ `futures`, –Ω–æ —Å–∫–æ—Ä–æ –±—É–¥–µ—Ç —Å—Ç–∞–±–∏–ª–∏–∑–∏—Ä–æ–≤–∞–Ω –≤ `std::future`
- —Ä–∏—Å–∫ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è –∑–∞–∫–ª—é—á–∞–µ—Ç—Å—è –≤ —Ç–æ–º, —á—Ç–æ –∫–∞–∫–æ–π-–Ω–∏–±—É–¥—å —Ñ—å—é—á–µ—Ä—Å –º–æ–∂–µ—Ç –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ —Ä–∞–∑—Ä–µ—à–∏—Ç—å—Å—è, —á—Ç–æ –ø—Ä–∏–≤–µ–¥–µ—Ç –∫ –æ—Å—Ç–∞–Ω–æ–≤–∫–µ –ø—Ä–æ–≥—Ä–∞–º–º—ã
- –º—ã –º–æ–∂–µ–º –∫–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞—Ç—å `join_all()` —Å `join!`, –Ω–∞–ø—Ä–∏–º–µ—Ä, —á—Ç–æ–±—ã –æ–±—ä–µ–¥–∏–Ω–∏—Ç—å –≤—Å–µ –∑–∞–ø—Ä–æ—Å—ã –∫ —Å–ª—É–∂–±–µ `HTTP`, –∞ —Ç–∞–∫–∂–µ –∑–∞–ø—Ä–æ—Å –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –¥–æ–±–∞–≤–∏—Ç—å `tokio::time::sleep()` –≤–æ —Ñ—å—é—á–µ—Ä—Å, –∏—Å–ø–æ–ª—å–∑—É—è `future::join!`. –≠—Ç–æ –Ω–µ —Ç–∞–π–º–∞—É—Ç (–¥–ª—è –∫–æ—Ç–æ—Ä–æ–≥–æ —Ç—Ä–µ–±—É–µ—Ç—Å—è `select!`, –∫–∞–∫ –æ–ø–∏—Å–∞–Ω–æ –≤ —Å–ª–µ–¥—É—é—â–µ–º —Ä–∞–∑–¥–µ–ª–µ), –∞ –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è —Ä–∞–±–æ—Ç—ã `join!`

__Select__

–û–ø–µ—Ä–∞—Ü–∏—è –≤—ã–±–æ—Ä–∞ (select) –∂–¥–µ—Ç –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ –ª—é–±–æ–≥–æ —Ñ—å—é—á–µ—Ä—Å–∞ –∏–∑ –Ω–∞–±–æ—Ä–∞ –∏ —Ä–µ–∞–≥–∏—Ä—É–µ—Ç –Ω–∞ –µ–≥–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç. –í `JavaScript` —ç—Ç–æ –ø–æ—Ö–æ–∂–µ –Ω–∞ `Promise.race`. –í `Python` —ç—Ç–æ –ø–æ—Ö–æ–∂–µ –Ω–∞ `asyncio.wait(task_set, return_when=asyncio.FIRST_COMPLETED)`.

–ü–æ–¥–æ–±–Ω–æ –æ–ø–µ—Ä–∞—Ç–æ—Ä—É `match`, —Ç–µ–ª–æ `select!` –∏–º–µ–µ—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ –≤–µ—Ç–≤–µ–π (arms), –∫–∞–∂–¥–∞—è –∏–∑ –∫–æ—Ç–æ—Ä—ã—Ö –∏–º–µ–µ—Ç —Ñ–æ—Ä–º—É `pattern = future => statement`. –ö–æ–≥–¥–∞ `future` –≥–æ—Ç–æ–≤, –µ–≥–æ –≤–æ–∑–≤—Ä–∞—â–∞–µ–º–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –¥–µ—Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä—É–µ—Ç—Å—è `pattern`. –ó–∞—Ç–µ–º `statement` –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è —Å –∏—Ç–æ–≥–æ–≤—ã–º–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º–∏. –†–µ–∑—É–ª—å—Ç–∞—Ç `statement` —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–º –º–∞–∫—Ä–æ—Å–∞ `select!`.

```rust
use tokio::sync::mpsc::{self, Receiver};
use tokio::time::{sleep, Duration};

#[derive(Debug, PartialEq)]
enum Animal {
    Cat { name: String },
    Dog { name: String },
}

async fn first_animal_to_finish_race(
    mut cat_rcv: Receiver<String>,
    mut dog_rcv: Receiver<String>,
) -> Option<Animal> {
    tokio::select! {
        cat_name = cat_rcv.recv() => Some(Animal::Cat { name: cat_name? }),
        dog_name = dog_rcv.recv() => Some(Animal::Dog { name: dog_name? })
    }
}

#[tokio::main]
async fn main() {
    let (cat_sender, cat_receiver) = mpsc::channel(32);
    let (dog_sender, dog_receiver) = mpsc::channel(32);

    tokio::spawn(async move {
        sleep(Duration::from_millis(500)).await;
        cat_sender.send(String::from("–§–µ–ª–∏–∫—Å")).await.expect("–æ—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –∏–º–µ–Ω–∏ –∫–æ—Ç–∞");
    });

    tokio::spawn(async move {
        sleep(Duration::from_millis(50)).await;
        dog_sender.send(String::from("–†–µ–∫—Å")).await.expect("–æ—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –∏–º–µ–Ω–∏ —Å–æ–±–∞–∫–∏");
    });

    let winner = first_animal_to_finish_race(cat_receiver, dog_receiver)
        .await
        .expect("–æ—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –ø–æ–±–µ–¥–∏—Ç–µ–ª—è");

    println!("–ü–æ–±–µ–¥–∏—Ç–µ–ª–µ–º —è–≤–ª—è–µ—Ç—Å—è {winner:?}");
}
```

–†–µ–º–∞—Ä–∫–∏:

- –≤ –ø—Ä–∏–º–µ—Ä–µ —É –Ω–∞—Å –∏–º–µ–µ—Ç—Å—è –≥–æ–Ω–∫–∞ –º–µ–∂–¥—É –∫–æ—à–∫–æ–π –∏ —Å–æ–±–∞–∫–æ–π. `first_animal_to_finish_race()` "—Å–ª—É—à–∞–µ—Ç" (listening) –æ–±–∞ –∫–∞–Ω–∞–ª–∞ –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø–µ—Ä–≤—ã–π –ø–æ –≤—Ä–µ–º–µ–Ω–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç. –ü–æ—Å–∫–æ–ª—å–∫—É –∏–º—è —Å–æ–±–∞–∫–∏ –ø—Ä–∏–±—ã–≤–∞–µ—Ç —á–µ—Ä–µ–∑ 50 –º—Å, —Å–æ–±–∞–∫–∞ –≤—ã–∏–≥—Ä—ã–≤–∞–µ—Ç —É –∫–æ—à–∫–∏, –∏–º—è –∫–æ—Ç–æ—Ä–æ–π –ø—Ä–∏–±—ã–≤–∞–µ—Ç —á–µ—Ä–µ–∑ 500 –º—Å
- –≤ –ø—Ä–∏–º–µ—Ä–µ –≤–º–µ—Å—Ç–æ `channel` –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `oneshot`, –ø–æ—Å–∫–æ–ª—å–∫—É –ø—Ä–µ–¥–ø–æ–ª–∞–≥–∞–µ—Ç—Å—è –æ–¥–Ω–æ–∫—Ä–∞—Ç–Ω—ã–π –≤—ã–∑–æ–≤ –º–µ—Ç–æ–¥–∞ `send`
- –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –¥–æ–±–∞–≤–∏—Ç—å –∫ –≥–æ–Ω–∫–µ –¥–µ–¥–ª–∞–π–Ω, –¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É—è –≤—ã–±–æ—Ä —Ä–∞–∑–Ω—ã—Ö —Ñ—å—é—á–µ—Ä—Å–æ–≤
- –æ–±—Ä–∞—Ç–∏—Ç–µ –≤–Ω–∏–º–∞–Ω–∏–µ, —á—Ç–æ `select!` —É–Ω–∏—á—Ç–æ–∂–∞–µ—Ç –Ω–µ —Å–æ–≤–ø–∞–≤—à–∏–µ –≤–µ—Ç–≤–∏, —á—Ç–æ –æ—Ç–º–µ–Ω—è–µ—Ç –∏—Ö —Ñ—å—é—á–µ—Ä—Å—ã. `select!` –ª–µ–≥—á–µ –≤—Å–µ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å, –∫–æ–≥–¥–∞ –∫–∞–∂–¥–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ —ç—Ç–æ–≥–æ –º–∞–∫—Ä–æ—Å–∞ —Å–æ–∑–¥–∞–µ—Ç –Ω–æ–≤—ã–µ —Ñ—å—é—á–µ—Ä—Å—ã
  - –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–æ–π —è–≤–ª—è–µ—Ç—Å—è –ø–µ—Ä–µ–¥–∞—á–∞ `&mut future` –≤–º–µ—Å—Ç–æ —Å–∞–º–æ–≥–æ —Ñ—å—é—á–µ—Ä—Å–∞, –Ω–æ —ç—Ç–æ –º–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ –ø—Ä–æ–±–ª–µ–º–∞–º, –æ –∫–æ—Ç–æ—Ä–æ–º –º—ã –ø–æ–≥–æ–≤–æ—Ä–∏–º –ø–æ–∑–∂–µ

## –õ–æ–≤—É—à–∫–∏ async/await

`async/await` –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç —É–¥–æ–±–Ω—É—é –∏ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—É—é –∞–±—Å—Ç—Ä–∞–∫—Ü–∏—é –¥–ª—è –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–≥–æ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–≥–æ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—è. –û–¥–Ω–∞–∫–æ –º–æ–¥–µ–ª—å `async/await` –≤ `Rust` —Ç–∞–∫–∂–µ –∏–º–µ–µ—Ç —Å–≤–æ–∏ –ø–æ–¥–≤–æ–¥–Ω—ã–µ –∫–∞–º–Ω–∏ –∏ –ª–æ–≤—É—à–∫–∏, –æ –∫–æ—Ç–æ—Ä—ã—Ö –º—ã –ø–æ–≥–æ–≤–æ—Ä–∏–º –≤ —ç—Ç–æ–º —Ä–∞–∑–¥–µ–ª–µ.

__–ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è__

–ë–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã—Ö —Å—Ä–µ–¥ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –¥–æ–ø—É—Å–∫–∞—é—Ç –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ —Ç–æ–ª—å–∫–æ –∑–∞–¥–∞—á –≤–≤–æ–¥–∞-–≤—ã–≤–æ–¥–∞. –≠—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ –∑–∞–¥–∞—á–∏ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –¶–ü –±—É–¥—É—Ç –±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è (executor) –∏ –ø—Ä–µ–ø—è—Ç—Å—Ç–≤–æ–≤–∞—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—é –¥—Ä—É–≥–∏—Ö –∑–∞–¥–∞—á. –ü—Ä–æ—Å—Ç–æ–π –æ–±—Ö–æ–¥–Ω–æ–π –ø—É—Ç—å - –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —ç–∫–≤–∏–≤–∞–ª–µ–Ω—Ç–Ω—ã–µ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –º–µ—Ç–æ–¥—ã —Ç–∞–º, –≥–¥–µ —ç—Ç–æ –≤–æ–∑–º–æ–∂–Ω–æ.

```rust
use futures::future::join_all;
use std::time::Instant;

async fn sleep_ms(start: &Instant, id: u64, duration_ms: u64) {
    std::thread::sleep(std::time::Duration::from_millis(duration_ms));
    println!(
        "—Ñ—å—é—á–µ—Ä—Å {id} —Å–ø–∞–ª –≤ —Ç–µ—á–µ–Ω–∏–µ {duration_ms} –º—Å, –∑–∞–≤–µ—Ä—à–∏–ª—Å—è –ø–æ—Å–ª–µ {} –º—Å",
        start.elapsed().as_millis()
    );
}

#[tokio::main(flavor = "current_thread")]
async fn main() {
    let start = Instant::now();
    let sleep_futures = (1..=10).map(|t| sleep_ms(&start, t, t * 10));
    join_all(sleep_futures).await;
}
```

–†–µ–º–∞—Ä–∫–∏:

- –∑–∞–ø—É—Å—Ç–∏—Ç–µ –∫–æ–¥ –∏ —É–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –ø–µ—Ä–µ—Ö–æ–¥—ã –≤ —Ä–µ–∂–∏–º —Å–Ω–∞ –ø—Ä–æ–∏—Å—Ö–æ–¥—è—Ç –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ, –∞ –Ω–µ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ
- `flavor = "current_thread"` –ø–æ–º–µ—â–∞–µ—Ç –≤—Å–µ –∑–∞–¥–∞—á–∏ –≤ –æ–¥–∏–Ω –ø–æ—Ç–æ–∫. –≠—Ç–æ –¥–µ–ª–∞–µ—Ç —ç—Ñ—Ñ–µ–∫—Ç –±–æ–ª–µ–µ –æ—á–µ–≤–∏–¥–Ω—ã–º, –Ω–æ —Ä–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–Ω–∞—è –æ—à–∏–±–∫–∞ –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É–µ—Ç –∏ –≤ –º–Ω–æ–≥–æ–ø–æ—Ç–æ—á–Ω–æ–π –≤–µ—Ä—Å–∏–∏
- –∑–∞–º–µ–Ω–∏—Ç–µ `std::thread::sleep` –Ω–∞ `tokio::time::sleep` –∏ –¥–æ–∂–¥–∏—Ç–µ—Å—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
- –¥—Ä—É–≥–∏–º —Ä–µ—à–µ–Ω–∏–µ–º –º–æ–∂–µ—Ç –±—ã—Ç—å `tokio::task::spawn_blocking`, –∫–æ—Ç–æ—Ä—ã–π –ø–æ—Ä–æ–∂–¥–∞–µ—Ç —Ä–µ–∞–ª—å–Ω—ã–π –ø–æ—Ç–æ–∫ –∏ –ø—Ä–µ–æ–±—Ä–∞–∑—É–µ—Ç –µ–≥–æ –¥–µ—Å–∫—Ä–∏–ø—Ç–æ—Ä –≤ `future`, –Ω–µ –±–ª–æ–∫–∏—Ä—É—è –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è
- –æ –∑–∞–¥–∞—á–∞—Ö –Ω–µ —Å–ª–µ–¥—É–µ—Ç –¥—É–º–∞—Ç—å –∫–∞–∫ –æ –ø–æ—Ç–æ–∫–∞—Ö –û–°. –û–Ω–∏ –Ω–µ —Å–æ–≤–ø–∞–¥–∞—é—Ç 1 –∫ 1, –∏ –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª–µ–π –ø–æ–∑–≤–æ–ª—è—é—Ç –≤—ã–ø–æ–ª–Ω—è—Ç—å –º–Ω–æ–∂–µ—Å—Ç–≤–æ –∑–∞–¥–∞—á –≤ –æ–¥–Ω–æ–º –ø–æ—Ç–æ–∫–µ –û–°. –≠—Ç–æ –æ—Å–æ–±–µ–Ω–Ω–æ –ø—Ä–æ–±–ª–µ–º–∞—Ç–∏—á–Ω–æ –ø—Ä–∏ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–∏ —Å –¥—Ä—É–≥–∏–º–∏ –±–∏–±–ª–∏–æ—Ç–µ–∫–∞–º–∏ —á–µ—Ä–µ–∑ `FFI`, –≥–¥–µ —ç—Ç–∞ –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ –º–æ–∂–µ—Ç –∑–∞–≤–∏—Å–µ—Ç—å –æ—Ç –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞ –ø–æ—Ç–æ–∫–æ–≤ –∏–ª–∏ —Å–æ–ø–æ—Å—Ç–∞–≤–ª—è—Ç—å—Å—è —Å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–º–∏ –ø–æ—Ç–æ–∫–∞–º–∏ –û–° (–Ω–∞–ø—Ä–∏–º–µ—Ä, `CUDA`). –í —Ç–∞–∫–∏—Ö —Å–∏—Ç—É–∞—Ü–∏—è—Ö –æ—Ç–¥–∞–≤–∞–π—Ç–µ –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏–µ `tokio::task::spawn_blocking`
- –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –º—å—é—Ç–µ–∫—Å—ã –æ—Å—Ç–æ—Ä–æ–∂–Ω–æ. –£–¥–µ—Ä–∂–∞–Ω–∏–µ –º—å—é—Ç–µ–∫—Å–∞ –Ω–∞–¥ `.await` –º–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ –±–ª–æ–∫–∏—Ä–æ–≤–∫–µ –¥—Ä—É–≥–æ–π –∑–∞–¥–∞—á–∏, –∫–æ—Ç–æ—Ä–∞—è –º–æ–∂–µ—Ç –≤—ã–ø–æ–ª–Ω—è—Ç—å—Å—è –≤ —Ç–æ–º –∂–µ –ø–æ—Ç–æ–∫–µ

__Pin__

–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –±–ª–æ–∫–∏ –∏ —Ñ—É–Ω–∫—Ü–∏–∏ –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç —Ç–∏–ø—ã, —Ä–µ–∞–ª–∏–∑—É—é—â–∏–µ —Ç—Ä–µ–π—Ç `Future`. –í–æ–∑–≤—Ä–∞—â–∞–µ–º—ã–π —Ç–∏–ø —è–≤–ª—è–µ—Ç—Å—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–º –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è –∫–æ–º–ø–∏–ª—è—Ç–æ—Ä–∞, –∫–æ—Ç–æ—Ä—ã–π –ø—Ä–µ–≤—Ä–∞—â–∞–µ—Ç –ª–æ–∫–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –≤ –¥–∞–Ω–Ω—ã–µ, —Ö—Ä–∞–Ω—è—â–∏–µ—Å—è –≤–Ω—É—Ç—Ä–∏ —Ñ—å—é—á–µ—Ä—Å–∞.

–ù–µ–∫–æ—Ç–æ—Ä—ã–µ –∏–∑ —ç—Ç–∏—Ö –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –º–æ–≥—É—Ç —Å–æ–¥–µ—Ä–∂–∞—Ç—å —É–∫–∞–∑–∞—Ç–µ–ª–∏ –Ω–∞ –¥—Ä—É–≥–∏–µ –ª–æ–∫–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ. –ü–æ —ç—Ç–æ–π –ø—Ä–∏—á–∏–Ω–µ —Ñ—å—é—á–µ—Ä—Å—ã –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ –¥–æ–ª–∂–Ω—ã –ø–µ—Ä–µ–º–µ—â–∞—Ç—å—Å—è –≤ –¥—Ä—É–≥—É—é —è—á–µ–π–∫—É –ø–∞–º—è—Ç–∏, –ø–æ—Å–∫–æ–ª—å–∫—É —ç—Ç–æ —Å–¥–µ–ª–∞–µ—Ç —Ç–∞–∫–∏–µ —É–∫–∞–∑–∞—Ç–µ–ª–∏ –Ω–µ–¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã–º–∏.

–ß—Ç–æ–±—ã –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—Ç–∏—Ç—å –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ —Ñ—å—é—á–µ—Ä—Å–∞ –≤ –ø–∞–º—è—Ç–∏, –µ–≥–æ –º–æ–∂–Ω–æ –æ–ø—Ä–∞—à–∏–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ –∑–∞–∫—Ä–µ–ø–ª–µ–Ω–Ω—ã–π (pinned) —É–∫–∞–∑–∞—Ç–µ–ª—å. `Pin` - —ç—Ç–æ –æ–±–æ–ª–æ—á–∫–∞ —Å—Å—ã–ª–∫–∏, –∫–æ—Ç–æ—Ä–∞—è –∑–∞–ø—Ä–µ—â–∞–µ—Ç –≤—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏, –∫–æ—Ç–æ—Ä—ã–µ –º–æ–≥–ª–∏ –±—ã –ø–µ—Ä–µ–º–µ—Å—Ç–∏—Ç—å —ç–∫–∑–µ–º–ø–ª—è—Ä, –Ω–∞ –∫–æ—Ç–æ—Ä—ã–π –æ–Ω–∞ —É–∫–∞–∑—ã–≤–∞–µ—Ç, –≤ –¥—Ä—É–≥—É—é —è—á–µ–π–∫—É –ø–∞–º—è—Ç–∏.

```rust
use tokio::sync::{mpsc, oneshot};
use tokio::task::spawn;
use tokio::time::{sleep, Duration};

// –†–∞–±–æ—á–∞—è –µ–¥–∏–Ω–∏—Ü–∞. –í –¥–∞–Ω–Ω–æ–º —Å–ª—É—á–∞–µ –æ–Ω–∞ –ø—Ä–æ—Å—Ç–æ —Å–ø–∏—Ç –≤ —Ç–µ—á–µ–Ω–∏–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏
// –∏ –æ—Ç–≤–µ—á–∞–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ–º –≤ –∫–∞–Ω–∞–ª `respond_on`
#[derive(Debug)]
struct Work {
    input: u32,
    respond_on: oneshot::Sender<u32>,
}

// –í–æ—Ä–∫–µ—Ä, –∫–æ—Ç–æ—Ä—ã–π –∏—â–µ—Ç —Ä–∞–±–æ—Ç—É –≤ –æ—á–µ—Ä–µ–¥–∏ (queue) –∏ –≤—ã–ø–æ–ª–Ω—è–µ—Ç –µ–µ
async fn worker(mut work_queue: mpsc::Receiver<Work>) {
    let mut iterations = 0;
    loop {
        tokio::select! {
            Some(work) = work_queue.recv() => {
                sleep(Duration::from_millis(10)).await; // –≤—ã–ø–æ–ª–Ω—è–µ–º "—Ä–∞–±–æ—Ç—É"
                work.respond_on
                    .send(work.input * 1000)
                    .expect("–ø—Ä–æ–≤–∞–ª –æ—Ç–ø—Ä–∞–≤–∫–∏ –æ—Ç–≤–µ—Ç–∞");
                iterations += 1;
            }
            // TODO: —Å–æ–æ–±—â–∞—Ç—å –æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–µ –∏—Ç–µ—Ä–∞—Ü–∏–π –∫–∞–∂–¥—ã–π 100 –º—Å
        }
    }
}

// "–ó–∞–ø—Ä–∞—à–∏–≤–∞—Ç–µ–ª—å" (requester), –∫–æ—Ç–æ—Ä—ã–π –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç —Ä–∞–±–æ—Ç—É –∏ –∂–¥–µ—Ç –µ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
async fn do_work(work_queue: &mpsc::Sender<Work>, input: u32) -> u32 {
    let (tx, rx) = oneshot::channel();
    work_queue
        .send(Work { input, respond_on: tx })
        .await
        .expect("–ø—Ä–æ–≤–∞–ª –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ä–∞–±–æ—Ç—ã –≤ –æ—á–µ—Ä–µ–¥—å");
    rx.await.expect("–ø—Ä–æ–≤–∞–ª –æ–∂–∏–¥–∞–Ω–∏—è –æ—Ç–≤–µ—Ç–∞")
}

#[tokio::main]
async fn main() {
    let (tx, rx) = mpsc::channel(10);
    spawn(worker(rx));
    for i in 0..100 {
        let resp = do_work(&tx, i).await;
        println!("—Ä–µ–∑—É–ª—å—Ç–∞—Ç —Ä–∞–±–æ—Ç—ã –¥–ª—è –∏—Ç–µ—Ä–∞—Ü–∏–∏ {i}: {resp}");
    }
}
```

–†–µ–º–∞—Ä–∫–∏:

- –≤ –ø—Ä–∏–º–µ—Ä–µ –≤—ã –º–æ–≥–ª–∏ —Ä–∞—Å–ø–æ–∑–Ω–∞—Ç—å —à–∞–±–ª–æ–Ω –∞–∫—Ç–æ—Ä–∞ (actor pattern). –ê–∫—Ç–æ—Ä—ã, –∫–∞–∫ –ø—Ä–∞–≤–∏–ª–æ, –≤—ã–∑—ã–≤–∞—é—Ç `select!` –≤ —Ü–∏–∫–ª–µ
- —ç—Ç–æ –æ–±–æ–±—â–µ–Ω–∏–µ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö —É—Ä–æ–∫–æ–≤, —Ç–∞–∫ —á—Ç–æ –Ω–µ —Ç–æ—Ä–æ–ø–∏—Ç–µ—Å—å
  - –¥–æ–±–∞–≤—å—Ç–µ `_ = sleep(Duration::from_millis(100)) => { println!(..) }` –≤ `select!`. –≠—Ç–æ –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ –≤—ã–ø–æ–ª–Ω–∏—Ç—Å—è. –ü–æ—á–µ–º—É?
  - —Ç–µ–ø–µ—Ä—å –¥–æ–±–∞–≤—å—Ç–µ `timeout_fut`, —Å–æ–¥–µ—Ä–∂–∞—â–∏–π —ç—Ç–æ—Ç —Ñ—å—é—á–µ—Ä—Å –∑–∞ –ø—Ä–µ–¥–µ–ª–∞–º–∏ `loop`:

```rust
let mut timeout_fut = sleep(Duration::from_millis(100));
loop {
    select! {
        ..,
        _ = timeout_fut => { println!(..); },
    }
}
```

  - —ç—Ç–æ —Ç–∞–∫–∂–µ –Ω–µ –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å. –ò–∑—É—á–∏—Ç–µ –æ—à–∏–±–∫–∏ –∫–æ–º–ø–∏–ª—è—Ç–æ—Ä–∞, –¥–æ–±–∞–≤—å—Ç–µ `&mut` –≤ `timeout_fut` –≤ `select!` –¥–ª—è —Ä–µ—à–µ–Ω–∏—è –ø—Ä–æ–±–ª–µ–º—ã –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏—è, –∑–∞—Ç–µ–º –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `Box::pin`:

```rust
let mut timeout_fut = Box::pin(sleep(Duration::from_millis(100)));
loop {
    select! {
        ..,
        _ = &mut timeout_fut => { println!(..); },
    }
}
```

  - —ç—Ç–æ –∫–æ–º–ø–∏–ª–∏—Ä—É–µ—Ç—Å—è, –Ω–æ –ø–æ –∏—Å—Ç–µ—á–µ–Ω–∏–∏ —Ç–∞–π–º-–∞—É—Ç–∞ –Ω–∞ –∫–∞–∂–¥–æ–π –∏—Ç–µ—Ä–∞—Ü–∏–∏ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç `Poll::Ready` (–¥–ª—è —Ä–µ—à–µ–Ω–∏—è —ç—Ç–æ–π –ø—Ä–æ–±–ª–µ–º—ã –º–æ–∂–µ—Ç –ø–æ–º–æ—á—å –æ–±—ä–µ–¥–∏–Ω–µ–Ω–Ω—ã–π —Ñ—å—é—á–µ—Ä—Å). –û–±–Ω–æ–≤–∏—Ç–µ –∫–æ–¥, —á—Ç–æ–±—ã —Å–±—Ä–∞—Å—ã–≤–∞—Ç—å `timeout_fut` –∫–∞–∂–¥—ã–π —Ä–∞–∑, –∫–æ–≥–¥–∞ –æ–Ω –∏—Å—Ç–µ–∫–∞–µ—Ç
- `Box` –≤—ã–¥–µ–ª—è–µ—Ç –ø–∞–º—è—Ç—å –≤ –∫—É—á–µ. –í –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö —Å–ª—É—á–∞—è—Ö `std::pin::pin!` - —ç—Ç–æ —Ç–æ–∂–µ –≤–∞—Ä–∏–∞–Ω—Ç, –Ω–æ –µ–≥–æ —Å–ª–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–ª—è —Ñ—å—é—á–µ—Ä—Å–∞, –∫–æ—Ç–æ—Ä–æ–π –ø–µ—Ä–µ–Ω–∞–∑–Ω–∞—á–∞–µ—Ç—Å—è
- –¥—Ä—É–≥–∞—è –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞ - –≤–æ–æ–±—â–µ –Ω–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `pin`, –∞ —Å–æ–∑–¥–∞—Ç—å –¥—Ä—É–≥—É—é –∑–∞–¥–∞—á—É, –∫–æ—Ç–æ—Ä–∞—è –±—É–¥–µ—Ç –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å—Å—è –≤ –∫–∞–Ω–∞–ª `oneshot` –∫–∞–∂–¥—ã–µ 100 –º—Å
- –¥–∞–Ω–Ω—ã–µ, —Å–æ–¥–µ—Ä–∂–∞—â–∏–µ —É–∫–∞–∑–∞—Ç–µ–ª–∏ –Ω–∞ —Å–µ–±—è, –Ω–∞–∑—ã–≤–∞—é—Ç—Å—è —Å–∞–º–æ—Å—Å—ã–ª–∞—é—â–∏–º–∏—Å—è (self-referential). –û–±—ã—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤–æ –ø—Ä–æ–≤–µ—Ä–∫–∏ –∑–∞–∏–º—Å—Ç–≤–æ–≤–∞–Ω–∏–π (borrow checker) –≤ `Rust` –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ —Ç–∞–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö, –ø–æ—Å–∫–æ–ª—å–∫—É —Å—Å—ã–ª–∫–∏ –Ω–µ –º–æ–≥—É—Ç –∂–∏—Ç—å –¥–æ–ª—å—à–µ –¥–∞–Ω–Ω—ã—Ö, –Ω–∞ –∫–æ—Ç–æ—Ä—ã–µ –æ–Ω–∏ —É–∫–∞–∑—ã–≤–∞—é—Ç. –û–¥–Ω–∞–∫–æ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞ –¥–ª—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã—Ö –±–ª–æ–∫–æ–≤ –∏ —Ñ—É–Ω–∫—Ü–∏–π –Ω–µ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è —Å—Ä–µ–¥—Å—Ç–≤–æ–º –ø—Ä–æ–≤–µ—Ä–∫–∏ –∑–∞–∏–º—Å—Ç–≤–æ–≤–∞–Ω–∏–π
- `Pin` - —ç—Ç–æ –æ–±–µ—Ä—Ç–∫–∞ –Ω–∞–¥ —Å—Å—ã–ª–∫–æ–π. –û–±—ä–µ–∫—Ç –Ω–µ –º–æ–∂–µ—Ç –ø–µ—Ä–µ–º–µ—â–∞—Ç—å—Å—è —Å –ø–æ–º–æ—â—å—é –∑–∞–∫—Ä–µ–ø–ª–µ–Ω–Ω–æ–≥–æ —É–∫–∞–∑–∞—Ç–µ–ª—è. –û–¥–Ω–∞–∫–æ –æ–Ω –º–æ–∂–µ—Ç –ø–µ—Ä–µ–º–µ—â–∞—Ç—å—Å—è —Å –ø–æ–º–æ—â—å—é –Ω–µ–∑–∞–∫—Ä–µ–ø–ª–µ–Ω–Ω–æ–≥–æ —É–∫–∞–∑–∞—Ç–µ–ª—è
- –º–µ—Ç–æ–¥ `poll` —Ç—Ä–µ–π—Ç–∞ `Future` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `Pin<&mut Self>` –≤–º–µ—Å—Ç–æ `&mut Self` –¥–ª—è —Å—Å—ã–ª–∫–∏ –Ω–∞ —ç–∫–∑–µ–º–ø–ª—è—Ä. –í–æ—Ç –ø–æ—á–µ–º—É –æ–Ω –º–æ–∂–µ—Ç –≤—ã–∑—ã–≤–∞—Ç—å—Å—è —Ç–æ–ª—å–∫–æ –Ω–∞ –∑–∞–∫—Ä–µ–ø–ª–µ–Ω–Ω–æ–º —É–∫–∞–∑–∞—Ç–µ–ª–µ

__–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ —Ç—Ä–µ–π—Ç—ã__

–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –º–µ—Ç–æ–¥—ã –≤ —Ç—Ä–µ–π—Ç–∞—Ö –ø–æ–∫–∞ –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è –≤ —Å—Ç–∞–±–∏–ª—å–Ω–æ–π –≤–µ—Ä—Å–∏–∏ `Rust`.

–ö—Ä–µ–π—Ç [async_trait](https://docs.rs/async-trait/latest/async_trait/) –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –º–∞–∫—Ä–æ—Å –¥–ª—è —Ä–µ—à–µ–Ω–∏—è —ç—Ç–æ–π –∑–∞–¥–∞—á–∏:

```rust
use async_trait::async_trait;
use std::time::Instant;
use tokio::time::{sleep, Duration};

#[async_trait]
trait Sleeper {
    async fn sleep(&self);
}

struct FixedSleeper {
    sleep_ms: u64,
}

#[async_trait]
impl Sleeper for FixedSleeper {
    async fn sleep(&self) {
        sleep(Duration::from_millis(self.sleep_ms)).await;
    }
}

async fn run_all_sleepers_multiple_times(
    sleepers: Vec<Box<dyn Sleeper>>,
    n_times: usize,
) {
    for _ in 0..n_times {
        println!("running all sleepers..");
        for sleeper in &sleepers {
            let start = Instant::now();
            sleeper.sleep().await;
            println!("slept for {}ms", start.elapsed().as_millis());
        }
    }
}

#[tokio::main]
async fn main() {
    let sleepers: Vec<Box<dyn Sleeper>> = vec![
        Box::new(FixedSleeper { sleep_ms: 50 }),
        Box::new(FixedSleeper { sleep_ms: 100 }),
    ];
    run_all_sleepers_multiple_times(sleepers, 5).await;
}
```

–†–µ–º–∞—Ä–∫–∏:

- `async_trait` –ø—Ä–æ—Å—Ç –≤ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏, –Ω–æ —É—á—Ç–∏—Ç–µ, —á—Ç–æ –¥–ª—è —Ä–∞–±–æ—Ç—ã –æ–Ω –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –≤—ã–¥–µ–ª–µ–Ω–∏–µ –ø–∞–º—è—Ç–∏ –≤ –∫—É—á–µ. –≠—Ç–æ –≤–ª–µ—á–µ—Ç –∏–∑–¥–µ—Ä–∂–∫–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
- –ø–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é "—Å–ø—è—â—É—é" —Å—Ç—Ä—É–∫—Ç—É—Ä—É, –∫–æ—Ç–æ—Ä–∞—è –±—É–¥–µ—Ç —Å–ø–∞—Ç—å —Å–ª—É—á–∞–π–Ω–æ–µ –≤—Ä–µ–º—è, –∏ –¥–æ–±–∞–≤–∏—Ç—å –µ–µ –≤ –≤–µ–∫—Ç–æ—Ä

__–û—Ç–º–µ–Ω–∞__

–£–¥–∞–ª–µ–Ω–∏–µ —Ñ—å—é—á–µ—Ä—Å–∞ –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ –µ–≥–æ –±–æ–ª—å—à–µ –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ–ª—å–∑—è –±—É–¥–µ—Ç –æ–ø—Ä–æ—Å–∏—Ç—å. –≠—Ç–æ –Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è –æ—Ç–º–µ–Ω–æ–π (cancellation) –∏ –º–æ–∂–µ—Ç –ø—Ä–æ–∏–∑–æ–π—Ç–∏ –≤ –ª—é–±–æ–π –º–æ–º–µ–Ω—Ç –æ–∂–∏–¥–∞–Ω–∏—è. –ù–µ–æ–±—Ö–æ–¥–∏–º–æ –ø–æ–∑–∞–±–æ—Ç–∏—Ç—å—Å—è –æ —Ç–æ–º, —á—Ç–æ–±—ã —Å–∏—Å—Ç–µ–º–∞ —Ä–∞–±–æ—Ç–∞–ª–∞ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –¥–∞–∂–µ –≤ —Å–ª—É—á–∞–µ –æ—Ç–º–µ–Ω—ã —Ñ—å—é—á–µ—Ä—Å–∞. –ù–∞–ø—Ä–∏–º–µ—Ä, –æ–Ω –Ω–µ –¥–æ–ª–∂–µ–Ω –±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å—Å—è –∏–ª–∏ —Ç–µ—Ä—è—Ç—å –¥–∞–Ω–Ω—ã–µ.

```rust
use std::io::{self, ErrorKind};
use std::time::Duration;
use tokio::io::{AsyncReadExt, AsyncWriteExt, DuplexStream};

struct LinesReader {
    stream: DuplexStream,
}

impl LinesReader {
    fn new(stream: DuplexStream) -> Self {
        Self { stream }
    }

    async fn next(&mut self) -> io::Result<Option<String>> {
        let mut bytes = Vec::new();
        let mut buf = [0];
        while self.stream.read(&mut buf[..]).await? != 0 {
            bytes.push(buf[0]);
            if buf[0] == b'\n' {
                break;
            }
        }
        if bytes.is_empty() {
            return Ok(None);
        }
        let s = String::from_utf8(bytes)
            .map_err(|_| io::Error::new(ErrorKind::InvalidData, "–Ω–µ UTF-8"))?;
        Ok(Some(s))
    }
}

async fn slow_copy(source: String, mut dest: DuplexStream) -> std::io::Result<()> {
    for b in source.bytes() {
        dest.write_u8(b).await?;
        tokio::time::sleep(Duration::from_millis(10)).await
    }
    Ok(())
}

#[tokio::main]
async fn main() -> std::io::Result<()> {
    let (client, server) = tokio::io::duplex(5);
    let handle = tokio::spawn(slow_copy("–ø—Ä–∏–≤–µ—Ç\n–ø—Ä–∏–≤–µ—Ç\n".to_owned(), client));

    let mut lines = LinesReader::new(server);
    let mut interval = tokio::time::interval(Duration::from_millis(60));
    loop {
        tokio::select! {
            _ = interval.tick() => println!("—Ç–∏–∫!"),
            line = lines.next() => if let Some(l) = line? {
                print!("{}", l)
            } else {
                break
            },
        }
    }
    handle.await.unwrap()?;
    Ok(())
}
```

–†–µ–º–∞—Ä–∫–∏:

- –∫–æ–º–ø–∏–ª—è—Ç–æ—Ä –Ω–µ –ø–æ–º–æ–≥–∞–µ—Ç —Å –æ–±–µ—Å–ø–µ—á–µ–Ω–∏–µ–º –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –æ—Ç–º–µ–Ω—ã. –ù–µ–æ–±—Ö–æ–¥–∏–º–æ —á–∏—Ç–∞—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é API –∏ –ø–æ–Ω–∏–º–∞—Ç—å, –∫–∞–∫–∏–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º –≤–ª–∞–¥–µ–µ—Ç –≤–∞—à–∞ `async fn`
- –≤ –æ—Ç–ª–∏—á–∏–µ –æ—Ç `panic!` –∏ `?`, –æ—Ç–º–µ–Ω–∞ - —ç—Ç–æ —á–∞—Å—Ç—å –Ω–æ—Ä–º–∞–ª—å–Ω–æ–≥–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–æ—Ç–æ–∫–æ–º –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è (–∞ –Ω–µ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫)
- –≤ –ø—Ä–∏–º–µ—Ä–µ —Ç–µ—Ä—è–µ—Ç—Å—è —á–∞—Å—Ç—å —Å—Ç—Ä–æ–∫–∏
  - –µ—Å–ª–∏ –≤–µ—Ç–≤—å `tick()` –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –ø–µ—Ä–≤–æ–π, `next()` –∏ –µ–≥–æ `buf` —É–Ω–∏—á—Ç–æ–∂–∞—é—Ç—Å—è
  - `LinesReader ` –º–æ–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å –±–µ–∑–æ–ø–∞—Å–Ω—ã–º –¥–ª—è –æ—Ç–º–µ–Ω—ã –ø—É—Ç–µ–º –≤–∫–ª—é—á–µ–Ω–∏—è `buf` –≤ —Å—Ç—Ä—É–∫—Ç—É—Ä—É:

```rust
struct LinesReader {
    stream: DuplexStream,
    bytes: Vec<u8>,
    buf: [u8; 1],
}

impl LinesReader {
    fn new(stream: DuplexStream) -> Self {
        Self { stream, bytes: Vec::new(), buf: [0] }
    }
    async fn next(&mut self) -> io::Result<Option<String>> {
        // ...
        let raw = std::mem::take(&mut self.bytes);
        let s = String::from_utf8(raw)
        // ...
    }
}
```

- [Interval::tick](https://docs.rs/tokio/latest/tokio/time/struct.Interval.html#method.tick) –±–µ–∑–æ–ø–∞—Å–µ–Ω –¥–ª—è –æ—Ç–º–µ–Ω—ã, –ø–æ—Å–∫–æ–ª—å–∫—É –æ–Ω –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç, –±—ã–ª –ª–∏ "–¥–æ—Å—Ç–∞–≤–ª–µ–Ω" (delivered) —Ç–∏–∫
- [AsyncReadExt::read](https://docs.rs/tokio/latest/tokio/io/trait.AsyncReadExt.html#method.read) –±–µ–∑–æ–ø–∞—Å–µ–Ω –¥–ª—è –æ—Ç–º–µ–Ω—ã, –ø–æ—Å–∫–æ–ª—å–∫—É –æ–Ω –ª–∏–±–æ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è, –ª–∏–±–æ –Ω–µ —á–∏—Ç–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ
- [AsyncBufReadExt::read_line](https://docs.rs/tokio/latest/tokio/io/trait.AsyncBufReadExt.html#method.read_line), –∫–∞–∫ –∏ –ø—Ä–∏–º–µ—Ä, –Ω–µ —è–≤–ª—è–µ—Ç—Å—è –±–µ–∑–æ–ø–∞—Å–Ω—ã–º –¥–ª—è –æ—Ç–º–µ–Ω—ã. –ü–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–∏ –∏ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤—ã —Å–º. –≤ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏

## –£–ø—Ä–∞–∂–Ω–µ–Ω–∏—è

–î–ª—è —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏ –Ω–∞–≤—ã–∫–æ–≤ —Ä–∞–±–æ—Ç—ã —Å –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–º `Rust`, –µ—Å—Ç—å –µ—â–µ –¥–≤–∞ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è:

- –æ–±–µ–¥–∞—é—â–∏–µ —Ñ–∏–ª–æ—Å–æ—Ñ—ã - –Ω–∞ —ç—Ç–æ—Ç —Ä–∞–∑ –≤–∞–º –Ω—É–∂–Ω–æ —Ä–µ—à–∏—Ç—å —ç—Ç—É –∑–∞–¥–∞—á—É —Å –ø–æ–º–æ—â—å—é –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–≥–æ `Rust`
- –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–ª—è —á–∞—Ç–∞

__–û–±–µ–¥–∞—é—â–∏–µ —Ñ–∏–ª–æ—Å–æ—Ñ—ã__

```rust
use std::sync::Arc;
use tokio::sync::mpsc::{self, Sender};
use tokio::sync::Mutex;
use tokio::time;

struct Fork;

struct Philosopher {
    name: String,
    // left_fork: ...
    // right_fork: ...
    // thoughts: ...
}

impl Philosopher {
    async fn think(&self) {
        self.thoughts
            .send(format!("–≠–≤—Ä–∏–∫–∞! {} —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–ª(–∞) –Ω–æ–≤—É—é –∏–¥–µ—é!", &self.name))
            .await
            .unwrap();
    }

    async fn eat(&self) {
        // –ü—ã—Ç–∞–µ–º—Å—è –¥–æ —Ç–µ—Ö –ø–æ—Ä, –ø–æ–∫–∞ –Ω–µ –ø–æ–ª—É—á–∏–º –æ–±–µ –≤–∏–ª–∫–∏
        println!("{} –µ—Å—Ç...", &self.name);
        time::sleep(time::Duration::from_millis(5)).await;
    }
}

static PHILOSOPHERS: &[&str] =
     &["–°–æ–∫—Ä–∞—Ç", "–ì–∏–ø–∞—Ç–∏—è", "–ü–ª–∞—Ç–æ–Ω", "–ê—Ä–∏—Å—Ç–æ—Ç–µ–ª—å", "–ü–∏—Ñ–∞–≥–æ—Ä"];

#[tokio::main]
async fn main() {
    // –°–æ–∑–¥–∞–µ–º –≤–∏–ª–∫–∏

    // –°–æ–∑–¥–∞–µ–º —Ñ–∏–ª–æ—Å–æ—Ñ–æ–≤

    // –ö–∞–∂–¥—ã–π —Ñ–∏–ª–æ—Å–æ—Ñ —Ä–∞–∑–º—ã—à–ª—è–µ—Ç –∏ –µ—Å—Ç 100 —Ä–∞–∑

    // –í—ã–≤–æ–¥–∏–º —Ä–∞–∑–º—ã—à–ª–µ–Ω–∏—è —Ñ–∏–ª–æ—Å–æ—Ñ–æ–≤
}
```

–î–ª—è —Ä–∞–±–æ—Ç—ã —Å –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–º `Rust` —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `tokio`:

```toml
[package]
name = "dining-philosophers-async"
version = "0.1.0"
edition = "2021"

[dependencies]
tokio = { version = "1.26.0", features = ["sync", "time", "macros", "rt-multi-thread"] }
```

–ü–æ–¥—Å–∫–∞–∑–∫–∞: –Ω–∞ —ç—Ç–æ—Ç —Ä–∞–∑ –≤–∞–º –ø—Ä–∏–¥–µ—Ç—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `Mutex` –∏ –º–æ–¥—É–ª—å `mpsc` –∏–∑ `tokio`.

<details>
<summary>–†–µ—à–µ–Ω–∏–µ:</summary>

```rust
use std::sync::Arc;
use tokio::sync::mpsc::{self, Sender};
use tokio::sync::Mutex;
use tokio::time;

struct Fork;

struct Philosopher {
    name: String,
    left_fork: Arc<Mutex<Fork>>,
    right_fork: Arc<Mutex<Fork>>,
    thoughts: Sender<String>,
}

impl Philosopher {
    async fn think(&self) {
        self.thoughts
            .send(format!("–≠–≤—Ä–∏–∫–∞! {} —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–ª(–∞) –Ω–æ–≤—É—é –∏–¥–µ—é!", &self.name))
            .await
            .unwrap();
    }

    async fn eat(&self) {
         // –ü—ã—Ç–∞–µ–º—Å—è –¥–æ —Ç–µ—Ö –ø–æ—Ä, –ø–æ–∫–∞ –Ω–µ –ø–æ–ª—É—á–∏–º –æ–±–µ –≤–∏–ª–∫–∏
        let (_left_fork, _right_fork) = loop {
            // –ë–µ—Ä–µ–º –≤–∏–ª–∫–∏...
            let left_fork = self.left_fork.try_lock();
            let right_fork = self.right_fork.try_lock();

            let Ok(left_fork) = left_fork else {
                // –ï—Å–ª–∏ –º—ã –Ω–µ –ø–æ–ª—É—á–∏–ª–∏ –ª–µ–≤—É—é –≤–∏–ª–∫—É, —É–¥–∞–ª—è–µ–º –ø—Ä–∞–≤—É—é –≤–∏–ª–∫—É,
                // –µ—Å–ª–∏ –æ–Ω–∞ —É –Ω–∞—Å –±—ã–ª–∞, –ø–æ–∑–≤–æ–ª—è—è –≤—ã–ø–æ–ª–Ω—è—Ç—å—Å—è –¥—Ä—É–≥–∏–º –∑–∞–¥–∞—á–∞–º
                drop(right_fork);
                time::sleep(time::Duration::from_millis(1)).await;
                continue;
            };

            let Ok(right_fork) = right_fork else {
                // –ï—Å–ª–∏ –º—ã –Ω–µ –ø–æ–ª—É—á–∏–ª–∏ –ø—Ä–∞–≤—É—é –≤–∏–ª–∫—É, —É–¥–∞–ª—è–µ–º –ª–µ–≤—É—é –≤–∏–ª–∫—É,
                // –µ—Å–ª–∏ –æ–Ω–∞ —É –Ω–∞—Å –±—ã–ª–∞, –ø–æ–∑–≤–æ–ª—è—è –≤—ã–ø–æ–ª–Ω—è—Ç—å—Å—è –¥—Ä—É–≥–∏–º –∑–∞–¥–∞—á–∞–º
                drop(left_fork);
                time::sleep(time::Duration::from_millis(1)).await;
                continue;
            };

            break (left_fork, right_fork);
        };

        println!("{} –µ—Å—Ç...", &self.name);
        time::sleep(time::Duration::from_millis(5)).await;
        // –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∏ —É–Ω–∏—á—Ç–æ–∂–∞—é—Ç—Å—è –∑–¥–µ—Å—å
    }
}

static PHILOSOPHERS: &[&str] =
   &["–°–æ–∫—Ä–∞—Ç", "–ì–∏–ø–∞—Ç–∏—è", "–ü–ª–∞—Ç–æ–Ω", "–ê—Ä–∏—Å—Ç–æ—Ç–µ–ª—å", "–ü–∏—Ñ–∞–≥–æ—Ä"];

#[tokio::main]
async fn main() {
    // –°–æ–∑–¥–∞–µ–º –≤–∏–ª–∫–∏
    let mut forks = vec![];
    (0..PHILOSOPHERS.len()).for_each(|_| forks.push(Arc::new(Mutex::new(Fork))));

    // –°–æ–∑–¥–∞–µ–º —Ñ–∏–ª–æ—Å–æ—Ñ–æ–≤
    let (philosophers, mut rx) = {
        let mut philosophers = vec![];

        let (tx, rx) = mpsc::channel(10);

        for (i, name) in PHILOSOPHERS.iter().enumerate() {
            let left_fork = Arc::clone(&forks[i]);
            let right_fork = Arc::clone(&forks[(i + 1) % PHILOSOPHERS.len()]);

            philosophers.push(Philosopher {
                name: name.to_string(),
                left_fork,
                right_fork,
                thoughts: tx.clone(),
            });
        }

        (philosophers, rx)
        // `tx` —É–Ω–∏—á—Ç–æ–∂–∞–µ—Ç—Å—è –∑–¥–µ—Å—å, –ø–æ—ç—Ç–æ–º—É –Ω–∞–º –Ω–µ –Ω—É–∂–Ω–æ —è–≤–Ω–æ —É–¥–∞–ª—è—Ç—å –µ–≥–æ –ø–æ–∑–∂–µ
    };

    // –ö–∞–∂–¥—ã–π —Ñ–∏–ª–æ—Å–æ—Ñ –¥—É–º–∞–µ—Ç –∏ –µ—Å—Ç 100 —Ä–∞–∑
    for phil in philosophers {
        tokio::spawn(async move {
            for _ in 0..100 {
                phil.think().await;
                phil.eat().await;
            }
        });
    }

    // –í—ã–≤–æ–¥–∏–º —Ä–∞–∑–º—ã—à–ª–µ–Ω–∏—è —Ñ–∏–ª–æ—Å–æ—Ñ–æ–≤
    while let Some(thought) = rx.recv().await {
        println!("{thought}");
    }
}
```

</details>

__–ß–∞—Ç__

–í —ç—Ç–æ–º —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–∏ –º—ã –∏—Å–ø–æ–ª—å–∑—É–µ–º –Ω–æ–≤—ã–µ –∑–Ω–∞–Ω–∏—è –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è —á–∞—Ç–∞. –£ –Ω–∞—Å –µ—Å—Ç—å —Å–µ—Ä–≤–µ—Ä, –∫ –∫–æ—Ç–æ—Ä–æ–º—É –ø–æ–¥–∫–ª—é—á–∞—é—Ç—Å—è –∫–ª–∏–µ–Ω—Ç—ã –∏ –≤ –∫–æ—Ç–æ—Ä–æ–º –æ–Ω–∏ –ø—É–±–ª–∏–∫—É—é—Ç —Å–≤–æ–∏ —Å–æ–æ–±—â–µ–Ω–∏—è. –ö–ª–∏–µ–Ω—Ç —á–∏—Ç–∞–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è —á–µ—Ä–µ–∑ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –≤–≤–æ–¥ –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∏—Ö –Ω–∞ —Å–µ—Ä–≤–µ—Ä. –°–µ—Ä–≤–µ—Ä –ø–µ—Ä–µ–¥–∞–µ—Ç (broadcast) —Å–æ–æ–±—â–µ–Ω–∏–µ –≤—Å–µ–º –∫–ª–∏–µ–Ω—Ç–∞–º.

–î–ª—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ —ç—Ç–æ–≥–æ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–∞ –º—ã –±—É–¥–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å [—à–∏—Ä–æ–∫–æ–≤–µ—â–∞—Ç–µ–ª—å–Ω—ã–π –∫–∞–Ω–∞–ª](https://docs.rs/tokio/latest/tokio/sync/broadcast/fn.channel.html) –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ –∏ [tokio_websockets](https://docs.rs/tokio-websockets/) –¥–ª—è –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è –º–µ–∂–¥—É –∫–ª–∏–µ–Ω—Ç–æ–º –∏ —Å–µ—Ä–≤–µ—Ä–æ–º.

–°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—ã–π –ø—Ä–æ–µ–∫—Ç –∏ –¥–æ–±–∞–≤—å—Ç–µ —Å–ª–µ–¥—É—é—â–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –≤ `Cargo.toml`:

```toml
[package]
name = "chat-async"
version = "0.1.0"
edition = "2021"

[dependencies]
futures-util = { version = "0.3.30", features = ["sink"] }
http = "1.0.0"
tokio = { version = "1.28.1", features = ["full"] }
tokio-websockets = { version = "0.5.1", features = ["client", "fastrand", "server", "sha1_smol"] }
```

_–ù–µ–æ–±—Ö–æ–¥–∏–º—ã–µ API_

–í–∞–º –ø–æ—Ç—Ä–µ–±—É—é—Ç—Å—è —Å–ª–µ–¥—É—é—â–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ –∏–∑ `tokio` –∏ `tokio_websockets`. –ü–æ—Ç—Ä–∞—Ç—å—Ç–µ –Ω–µ—Å–∫–æ–ª—å–∫–æ –º–∏–Ω—É—Ç –¥–ª—è –æ–∑–Ω–∞–∫–æ–º–ª–µ–Ω–∏—è —Å–æ —Å–ª–µ–¥—É—é—â–∏–º–∏ API:

- [StreamExt::next()](https://docs.rs/futures-util/0.3.28/futures_util/stream/trait.StreamExt.html#method.next), —Ä–µ–∞–ª–∏–∑—É–µ–º—ã–π `WebSocketStream` - –¥–ª—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–≥–æ —á—Ç–µ–Ω–∏—è —Å–æ–æ–±—â–µ–Ω–∏–π –∏–∑ –ø–æ—Ç–æ–∫–∞ –≤–µ–±-—Å–æ–∫–µ—Ç–æ–≤
- [SinkExt::send()](https://docs.rs/futures-util/0.3.28/futures_util/sink/trait.SinkExt.html#method.send), —Ä–µ–∞–ª–∏–∑—É–µ–º—ã–π `WebSocketStream` - –¥–ª—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–π –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π –≤ –ø–æ—Ç–æ–∫ –≤–µ–±-—Å–æ–∫–µ—Ç–æ–≤
- [Lines::next_line()](https://docs.rs/tokio/latest/tokio/io/struct.Lines.html#method.next_line) - –¥–ª—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–≥–æ —á—Ç–µ–Ω–∏—è —Å–æ–æ–±—â–µ–Ω–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —á–µ—Ä–µ–∑ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –≤–≤–æ–¥
- [Sender::subscribe()](https://docs.rs/tokio/latest/tokio/sync/broadcast/struct.Sender.html#method.subscribe) - –¥–ª—è –ø–æ–¥–ø–∏—Å–∫–∏ –Ω–∞ —à–∏—Ä–æ–∫–æ–≤–µ—â–∞—Ç–µ–ª—å–Ω—ã–π –∫–∞–Ω–∞–ª

_–î–≤–∞ –±–∏–Ω–∞—Ä–Ω–∏–∫–∞_

–ö–∞–∫ –ø—Ä–∞–≤–∏–ª–æ, –≤ –ø—Ä–æ–µ–∫—Ç–µ –º–æ–∂–µ—Ç –±—ã—Ç—å —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω –∏—Å–ø–æ–ª–Ω—è–µ–º—ã–π —Ñ–∞–π–ª (binary) –∏ –æ–¥–∏–Ω —Ñ–∞–π–ª `src/main.rs`. –ù–∞–º —Ç—Ä–µ–±—É–µ—Ç—Å—è –¥–≤–∞ –±–∏–Ω–∞—Ä–Ω–∏–∫–∞. –û–¥–∏–Ω –¥–ª—è –∫–ª–∏–µ–Ω—Ç–∞ –∏ –µ—â–µ –æ–¥–∏–Ω –¥–ª—è —Å–µ—Ä–≤–µ—Ä–∞. –¢–µ–æ—Ä–µ—Ç–∏—á–µ—Å–∫–∏ –∏—Ö –º–æ–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å –¥–≤—É–º—è –æ—Ç–¥–µ–ª—å–Ω—ã–º–∏ –ø—Ä–æ–µ–∫—Ç–∞–º–∏, –Ω–æ –º—ã –ø–æ–º–µ—Å—Ç–∏–º –æ–±–∞ –±–∏–Ω–∞—Ä–Ω–∏–∫–∞ –≤ –æ–¥–∏–Ω –ø—Ä–æ–µ–∫—Ç. –î–ª—è —Ç–æ–≥–æ, —á—Ç–æ–±—ã —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–ª–æ, –∫–ª–∏–µ–Ω—Ç –∏ —Å–µ—Ä–≤–µ—Ä –¥–æ–ª–∂–Ω—ã –Ω–∞—Ö–æ–¥–∏—Ç—å—Å—è –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ `src/bin` (—Å–º. [–¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é](https://doc.rust-lang.org/cargo/reference/cargo-targets.html#binaries)).

–°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Å–ª–µ–¥—É—é—â–∏–π –∫–æ–¥ —Å–µ—Ä–≤–µ—Ä–∞ –∏ –∫–ª–∏–µ–Ω—Ç–∞ –≤ `src/bin/server.rs` –∏ `src/bin/client.rs`, —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ.

```rust
// src/bin/server.rs
use futures_util::sink::SinkExt;
use futures_util::stream::StreamExt;
use std::error::Error;
use std::net::SocketAddr;
use tokio::net::{TcpListener, TcpStream};
use tokio::sync::broadcast::{channel, Sender};
use tokio_websockets::{Message, ServerBuilder, WebSocketStream};

async fn handle_connection(
    addr: SocketAddr,
    mut ws_stream: WebSocketStream<TcpStream>,
    bcast_tx: Sender<String>,
) -> Result<(), Box<dyn Error + Send + Sync>> {
    todo!("—Ä–µ–∞–ª–∏–∑—É–π –º–µ–Ω—è")
}

#[tokio::main]
async fn main() -> Result<(), Box<dyn Error + Send + Sync>> {
    let (bcast_tx, _) = channel(16);

    let listener = TcpListener::bind("127.0.0.1:2000").await?;
    println!("–ó–∞–ø—Ä–æ—Å—ã –ø—Ä–∏–Ω–∏–º–∞—é—Ç—Å—è –Ω–∞ –ø–æ—Ä—Ç—É 2000");

    loop {
        let (socket, addr) = listener.accept().await?;
        println!("–ó–∞–ø—Ä–æ—Å –æ—Ç {addr:?}");
        let bcast_tx = bcast_tx.clone();
        tokio::spawn(async move {
            // –û–±–æ—Ä–∞—á–∏–≤–∞–µ–º —Å—ã—Ä–æ–π –ø–æ—Ç–æ–∫ TCP –≤ –≤–µ–±-—Å–æ–∫–µ—Ç
            let ws_stream = ServerBuilder::new().accept(socket).await?;

            handle_connection(addr, ws_stream, bcast_tx).await
        });
    }
}
```

```rust
// src/bin/client.rs
use futures_util::stream::StreamExt;
use futures_util::SinkExt;
use http::Uri;
use tokio::io::{AsyncBufReadExt, BufReader};
use tokio_websockets::{ClientBuilder, Message};

#[tokio::main]
async fn main() -> Result<(), tokio_websockets::Error> {
    let (mut ws_stream, _) =
        ClientBuilder::from_uri(Uri::from_static("ws://127.0.0.1:2000"))
            .connect()
            .await?;

    let stdin = tokio::io::stdin();
    let mut stdin = BufReader::new(stdin).lines();

    todo!("—Ä–µ–∞–ª–∏–∑—É–π –º–µ–Ω—è")
}
```

_–ó–∞–ø—É—Å–∫ –±–∏–Ω–∞—Ä–Ω–∏–∫–æ–≤_

–ö–æ–º–∞–Ω–¥–∞ –¥–ª—è –∑–∞–ø—É—Å–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞:

```bash
cargo run --bin server
```

–ö–æ–º–∞–Ω–¥–∞ –¥–ª—è –∑–∞–ø—É—Å–∫–∞ –∫–ª–∏–µ–Ω—Ç–∞:

```bash
cargo run --bin client
```

_–ó–∞–¥–∞—á–∏_

- —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏—é `handle_connection` –≤ `src/bin/server.rs`
  - –ø–æ–¥—Å–∫–∞–∑–∫–∞: –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `tokio::select!` –¥–ª—è –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–≥–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –¥–≤—É—Ö –∑–∞–¥–∞—á –≤ –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ–º —Ü–∏–∫–ª–µ. –û–¥–Ω–∞ –∑–∞–¥–∞—á–∞ –ø–æ–ª—É—á–∞–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏—è –æ—Ç –∫–ª–∏–µ–Ω—Ç–∞ –∏ –ø–µ—Ä–µ–¥–∞–µ—Ç –∏—Ö –¥—Ä—É–≥–∏–º –∫–ª–∏–µ–Ω—Ç–∞–º. –î—Ä—É–≥–∞—è - –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∫–ª–∏–µ–Ω—Ç—É —Å–æ–æ–±—â–µ–Ω–∏—è, –ø–æ–ª—É—á–µ–Ω–Ω—ã–µ –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞
- –∑–∞–≤–µ—Ä—à–∏—Ç–µ —Ñ—É–Ω–∫—Ü–∏—é `main` –≤ `src/bin/client.rs`
  - –ø–æ–¥—Å–∫–∞–∑–∫–∞: —Ç–∞–∫–∂–µ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `tokio::select!` –≤ –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ–º —Ü–∏–∫–ª–µ –¥–ª—è –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–≥–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –¥–≤—É—Ö –∑–∞–¥–∞—á: 1) —á—Ç–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–≥–æ –≤–≤–æ–¥–∞ –∏ –∏—Ö –æ—Ç–ø—Ä–∞–≤–∫–∞ —Å–µ—Ä–≤–µ—Ä—É; 2) –ø–æ–ª—É—á–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞ –∏ –∏—Ö –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ
- –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ: –∏–∑–º–µ–Ω–∏—Ç–µ –∫–æ–¥ –¥–ª—è –ø–µ—Ä–µ–¥–∞—á–∏ —Å–æ–æ–±—â–µ–Ω–∏–π –≤—Å–µ–º –∫–ª–∏–µ–Ω—Ç–∞–º, –∫—Ä–æ–º–µ –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—è

<details>
<summary>–†–µ—à–µ–Ω–∏–µ:</summary>

```rust
// src/bin/server.rs
use futures_util::sink::SinkExt;
use futures_util::stream::StreamExt;
use std::error::Error;
use std::net::SocketAddr;
use tokio::net::{TcpListener, TcpStream};
use tokio::sync::broadcast::{channel, Sender};
use tokio_websockets::{Message, ServerBuilder, WebSocketStream};

async fn handle_connection(
    addr: SocketAddr,
    mut ws_stream: WebSocketStream<TcpStream>,
    bcast_tx: Sender<String>,
) -> Result<(), Box<dyn Error + Send + Sync>> {

    ws_stream
        .send(Message::text("–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ —á–∞—Ç! –û—Ç–ø—Ä–∞–≤—å—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ".to_string()))
        .await?;
    let mut bcast_rx = bcast_tx.subscribe();

    // –ë–µ—Å–∫–æ–Ω–µ—á–Ω—ã–π —Ü–∏–∫–ª –¥–ª—è –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–≥–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –¥–≤—É—Ö –∑–∞–¥–∞—á:
    // 1) –ø–æ–ª—É—á–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π –∏–∑ `ws_stream` –∏ –∏—Ö –ø–µ—Ä–µ–¥–∞—á–∞ –∫–ª–∏–µ–Ω—Ç–∞–º
    // 2) –ø–æ–ª—É—á–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π –≤ `bcast_rx` –∏ –∏—Ö –æ—Ç–ø—Ä–∞–≤–∫–∞ –∫–ª–∏–µ–Ω—Ç—É
    loop {
        tokio::select! {
            incoming = ws_stream.next() => {
                match incoming {
                    Some(Ok(msg)) => {
                        if let Some(text) = msg.as_text() {
                            println!("{addr:?}: {text:?}");
                            bcast_tx.send(text.into())?;
                        }
                    }
                    Some(Err(err)) => return Err(err.into()),
                    None => return Ok(()),
                }
            }
            msg = bcast_rx.recv() => {
                ws_stream.send(Message::text(msg?)).await?;
            }
        }
    }
}

#[tokio::main]
async fn main() -> Result<(), Box<dyn Error + Send + Sync>> {
    let (bcast_tx, _) = channel(16);

    let listener = TcpListener::bind("127.0.0.1:2000").await?;
    println!("–ó–∞–ø—Ä–æ—Å—ã –ø—Ä–∏–Ω–∏–º–∞—é—Ç—Å—è –Ω–∞ –ø–æ—Ä—Ç—É 2000");

    loop {
        let (socket, addr) = listener.accept().await?;
        println!("–ó–∞–ø—Ä–æ—Å –æ—Ç {addr:?}");
        let bcast_tx = bcast_tx.clone();
        tokio::spawn(async move {
            // –û–±–æ—Ä–∞—á–∏–≤–∞–µ–º —Å—ã—Ä–æ–π –ø–æ—Ç–æ–∫ TCP –≤ –≤–µ–±-—Å–æ–∫–µ—Ç
            let ws_stream = ServerBuilder::new().accept(socket).await?;

            handle_connection(addr, ws_stream, bcast_tx).await
        });
    }
}
```

```rust
// src/bin/client.rs
use futures_util::stream::StreamExt;
use futures_util::SinkExt;
use http::Uri;
use tokio::io::{AsyncBufReadExt, BufReader};
use tokio_websockets::{ClientBuilder, Message};

#[tokio::main]
async fn main() -> Result<(), tokio_websockets::Error> {
    let (mut ws_stream, _) =
        ClientBuilder::from_uri(Uri::from_static("ws://127.0.0.1:2000"))
            .connect()
            .await?;

    let stdin = tokio::io::stdin();
    let mut stdin = BufReader::new(stdin).lines();

    // –ë–µ—Å–∫–æ–Ω–µ—á–Ω—ã–π —Ü–∏–∫–ª –¥–ª—è –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–π –æ—Ç–ø—Ä–∞–≤–∫–∏ –∏ –ø–æ–ª—É—á–µ–Ω–∏—è —Å–æ–æ–±—â–µ–Ω–∏–π
    loop {
        tokio::select! {
            incoming = ws_stream.next() => {
                match incoming {
                    Some(Ok(msg)) => {
                        if let Some(text) = msg.as_text() {
                            println!("–û—Ç —Å–µ—Ä–≤–µ—Ä–∞: {}", text);
                        }
                    },
                    Some(Err(err)) => return Err(err.into()),
                    None => return Ok(()),
                }
            }
            res = stdin.next_line() => {
                match res {
                    Ok(None) => return Ok(()),
                    Ok(Some(line)) => ws_stream.send(Message::text(line.to_string())).await?,
                    Err(err) => return Err(err.into()),
                }
            }

        }
    }
}
```

</details>

Happy coding!